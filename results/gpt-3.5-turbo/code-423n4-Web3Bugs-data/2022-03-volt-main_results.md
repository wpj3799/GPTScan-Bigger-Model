

  .oooooo.    ooooooooo.   ooooooooooooo  .oooooo..o                                 
 d8P'  `Y8b   `888   `Y88. 8'   888   `8 d8P'    `Y8                                 
888            888   .d88'      888      Y88bo.       .ooooo.   .oooo.   ooo. .oo.   
888            888ooo88P'       888       `"Y8888o.  d88' `"Y8 `P  )88b  `888P"Y88b  
888     ooooo  888              888           `"Y88b 888        .oP"888   888   888  
`88.    .88'   888              888      oo     .d8P 888   .o8 d8(  888   888   888  
 `Y8bood8P'   o888o            o888o     8""88888P'  `Y8bod8P' `Y888""8o o888o o888o                                                        


                                                                   

[19:42:15] Loaded 10 rules                                                                                                                                                                             tasks.py:119
[12/08/24 19:42:15] ERROR    CryticCompile: Cannot execute `forge`, is it installed and in PATH?                                                                                                   subprocess.py:38
                    ERROR    CryticCompile: Cannot execute `forge`, is it installed and in PATH?                                                                                                   subprocess.py:38
           Traceback (most recent call last):                                                                                                                                                          tasks.py:126
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/falcon/falcon.py", line 90, in __init__                                                                     
               crytic_compile = CryticCompile(target, **kwargs)                                                                                                                                                    
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/crytic_compile/crytic_compile.py", line 131, in __init__                                                    
               self._compile(**kwargs)                                                                                                                                                                             
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/crytic_compile/crytic_compile.py", line 553, in _compile                                                    
               self._platform.compile(self, **kwargs)                                                                                                                                                              
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/crytic_compile/platform/foundry.py", line 67, in compile                                                    
               hardhat_like_parsing(crytic_compile, self._target, build_directory, self._target)                                                                                                                   
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/crytic_compile/platform/hardhat.py", line 52, in hardhat_like_parsing                                       
               raise InvalidCompilation(txt)                                                                                                                                                                       
           crytic_compile.platform.exceptions.InvalidCompilation: Compilation failed. Can you run build command?                                                                                                   
           /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-03-volt-main/out/build-info is not a directory.                                                                 
                                                                                                                                                                                                                   
           During handling of the above exception, another exception occurred:                                                                                                                                     
                                                                                                                                                                                                                   
           Traceback (most recent call last):                                                                                                                                                                      
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 124, in simple_cli                                                                                                         
               falcon_instance = compile_project(source_dir)                                                                                                                                                       
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 103, in compile_project                                                                                                    
               return falcon.Falcon(abs_path)                                                                                                                                                                      
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/falcon/falcon.py", line 94, in __init__                                                                     
               raise FalconError(f"Invalid compilation: \n{str(e)}")                                                                                                                                               
           falcon.exceptions.FalconError: Invalid compilation:                                                                                                                                                     
           Compilation failed. Can you run build command?                                                                                                                                                          
           /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-03-volt-main/out/build-info is not a directory.                                                                 
                                                                                                                                                                                                                   
           Compile failed.                                                                                                                                                                             tasks.py:127
           Since the compilation is failed, some static analysis tool may not be enabled, which may cause lower precision and recall.                                                                  tasks.py:128
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ have inside code statements that update/accrue interest/exchange rate,                                                                                                                                          │
│ Code:                                                                                                                                                                                                           │
│     function mint(                                                                                                                                                                                              │
│         address to,                                                                                                                                                                                             │
│         uint256 amountIn,                                                                                                                                                                                       │
│         uint256 minVoltAmountOut                                                                                                                                                                                │
│     )                                                                                                                                                                                                           │
│         external                                                                                                                                                                                                │
│         virtual                                                                                                                                                                                                 │
│         override                                                                                                                                                                                                │
│         nonReentrant                                                                                                                                                                                            │
│         whenNotPaused                                                                                                                                                                                           │
│         whileMintingNotPaused                                                                                                                                                                                   │
│         returns (uint256 amountVoltOut)                                                                                                                                                                         │
│     {                                                                                                                                                                                                           │
│         updateOracle();                                                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         amountVoltOut = _getMintAmountOut(amountIn);                                                                                                                                                            │
│         require(                                                                                                                                                                                                │
│             amountVoltOut >= minVoltAmountOut,                                                                                                                                                                  │
│             "PegStabilityModule: Mint not enough out"                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         underlyingToken.safeTransferFrom(                                                                                                                                                                       │
│             msg.sender,                                                                                                                                                                                         │
│             address(pcvDeposit),                                                                                                                                                                                │
│             amountIn                                                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint256 amountFeiToTransfer = Math.min(                                                                                                                                                                 │
│             volt().balanceOf(address(this)),                                                                                                                                                                    │
│             amountVoltOut                                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│         uint256 amountFeiToMint = amountVoltOut - amountFeiToTransfer;                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         if (amountFeiToTransfer != 0) {                                                                                                                                                                         │
│             IERC20(volt()).safeTransfer(to, amountFeiToTransfer);                                                                                                                                               │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         if (amountFeiToMint != 0) {                                                                                                                                                                             │
│             rateLimitedMinter.mintVolt(to, amountFeiToMint);                                                                                                                                                    │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         _replenishBuffer(amountVoltOut);                                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         emit Mint(to, amountIn, amountVoltOut);                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function testMintsVolt() public {                                                                                                                                                                           │
│         uint256 mintAmount = 100;                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         vm.prank(addresses.minterAddress);                                                                                                                                                                      │
│         volt.mint(addresses.userAddress, mintAmount);                                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         assertEq(volt.balanceOf(addresses.userAddress), mintAmount);                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function setUp() public {                                                                                                                                                                                   │
│         core = getCore();                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         volt = core.volt();                                                                                                                                                                                     │
│         MockScalingPriceOracle mockScalingPriceOracle = new MockScalingPriceOracle(                                                                                                                             │
│                 address(0),                                                                                                                                                                                     │
│                 keccak256(abi.encodePacked("test")),                                                                                                                                                            │
│                 10e18,                                                                                                                                                                                          │
│                 101,                                                                                                                                                                                            │
│                 100                                                                                                                                                                                             │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         oracle = new OraclePassThrough(                                                                                                                                                                         │
│             ScalingPriceOracle(address(mockScalingPriceOracle))                                                                                                                                                 │
│         );                                                                                                                                                                                                      │
│         underlyingToken = new MockERC20();                                                                                                                                                                      │
│         pcvDeposit = new MockPCVDepositV2(                                                                                                                                                                      │
│             address(core),                                                                                                                                                                                      │
│             address(underlyingToken),                                                                                                                                                                           │
│             0,                                                                                                                                                                                                  │
│             0                                                                                                                                                                                                   │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         rateLimitedMinter = new GlobalRateLimitedMinter(                                                                                                                                                        │
│             address(core),                                                                                                                                                                                      │
│             rps,                                                                                                                                                                                                │
│             rps,                                                                                                                                                                                                │
│             rps,                                                                                                                                                                                                │
│             individualMaxBufferCap,                                                                                                                                                                             │
│             bufferCap                                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         NonCustodialPSM.OracleParams memory oracleParams = NonCustodialPSM                                                                                                                                      │
│             .OracleParams({                                                                                                                                                                                     │
│                 coreAddress: address(core),                                                                                                                                                                     │
│                 oracleAddress: address(oracle),                                                                                                                                                                 │
│                 backupOracle: address(0),                                                                                                                                                                       │
│                 decimalsNormalizer: 0                                                                                                                                                                           │
│             });                                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         NonCustodialPSM.RateLimitedParams                                                                                                                                                                       │
│             memory multiRateLimitedParams = NonCustodialPSM.RateLimitedParams({                                                                                                                                 │
│                 maxRateLimitPerSecond: rps,                                                                                                                                                                     │
│                 rateLimitPerSecond: rps,                                                                                                                                                                        │
│                 bufferCap: bufferCap                                                                                                                                                                            │
│             });                                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         NonCustodialPSM.PSMParams memory PSMParams = NonCustodialPSM.PSMParams({                                                                                                                                │
│             mintFeeBasisPoints: 0,                                                                                                                                                                              │
│             redeemFeeBasisPoints: 0,                                                                                                                                                                            │
│             underlyingToken: underlyingToken,                                                                                                                                                                   │
│             pcvDeposit: pcvDeposit,                                                                                                                                                                             │
│             rateLimitedMinter: rateLimitedMinter                                                                                                                                                                │
│         });                                                                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         /// create PSM                                                                                                                                                                                          │
│         psm = new NonCustodialPSM(                                                                                                                                                                              │
│             oracleParams,                                                                                                                                                                                       │
│             multiRateLimitedParams,                                                                                                                                                                             │
│             PSMParams                                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         vm.startPrank(addresses.governorAddress);                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         /// grant the PSM the PCV Controller role                                                                                                                                                               │
│         core.grantMinter(addresses.governorAddress);                                                                                                                                                            │
│         core.grantMinter(address(rateLimitedMinter));                                                                                                                                                           │
│         core.grantPCVController(address(psm));                                                                                                                                                                  │
│         core.grantPCVController(addresses.governorAddress);                                                                                                                                                     │
│         rateLimitedMinter.addAddress(                                                                                                                                                                           │
│             address(psm),                                                                                                                                                                                       │
│             uint112(rps),                                                                                                                                                                                       │
│             uint112(bufferCap)                                                                                                                                                                                  │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         /// mint FEI to the user                                                                                                                                                                                │
│         volt.mint(address(this), mintAmount);                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         vm.stopPrank();                                                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         /// mint the PSM and user some stable coins                                                                                                                                                             │
│         underlyingToken.mint(address(pcvDeposit), mintAmount);                                                                                                                                                  │
│         underlyingToken.mint(address(this), mintAmount);                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         /// invest all excess tokens in the PCV deposit                                                                                                                                                         │
│         pcvDeposit.deposit();                                                                                                                                                                                   │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ have inside code statements that update/accrue interest/exchange rate,                                                                                                                                          │
│ Code:                                                                                                                                                                                                           │
│     function testPSMSetup() public {                                                                                                                                                                            │
│         uint256 startingPSMUnderlyingBalance = underlyingToken.balanceOf(                                                                                                                                       │
│             address(psm)                                                                                                                                                                                        │
│         );                                                                                                                                                                                                      │
│         uint256 startingUserFEIBalance = volt.balanceOf(address(this));                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         assertEq(startingPSMUnderlyingBalance, 0);                                                                                                                                                              │
│         assertEq(startingUserFEIBalance, mintAmount);                                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         assertTrue(core.isPCVController(address(psm)));                                                                                                                                                         │
│         assertTrue(core.isMinter(address(rateLimitedMinter)));                                                                                                                                                  │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function testSwapUnderlyingForFeiAfterPriceIncrease() public {                                                                                                                                              │
│         uint256 amountStableIn = 101_000;                                                                                                                                                                       │
│         uint256 amountVoltOut = 99999; /// subtract 1 for precision loss from doInvert                                                                                                                          │
│                                                                                                                                                                                                                 │
│         vm.warp(28 days + block.timestamp);                                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         underlyingToken.approve(address(psm), amountStableIn);                                                                                                                                                  │
│         psm.mint(address(this), amountStableIn, amountVoltOut);                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         uint256 endingUserFEIBalance = volt.balanceOf(address(this));                                                                                                                                           │
│         uint256 endingPSMUnderlyingBalance = underlyingToken.balanceOf(                                                                                                                                         │
│             address(psm)                                                                                                                                                                                        │
│         );                                                                                                                                                                                                      │
│         uint256 endingPCVDepositUnderlyingBalance = underlyingToken.balanceOf(                                                                                                                                  │
│             address(pcvDeposit)                                                                                                                                                                                 │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         assertEq(                                                                                                                                                                                               │
│             endingPCVDepositUnderlyingBalance,                                                                                                                                                                  │
│             mintAmount + amountStableIn                                                                                                                                                                         │
│         );                                                                                                                                                                                                      │
│         assertEq(endingPSMUnderlyingBalance, 0);                                                                                                                                                                │
│         assertEq(endingUserFEIBalance, mintAmount + amountVoltOut);                                                                                                                                             │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function testSwapUnderlyingForFei() public {                                                                                                                                                                │
│         underlyingToken.approve(address(psm), mintAmount);                                                                                                                                                      │
│         psm.mint(address(this), mintAmount, mintAmount);                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         uint256 endingUserFEIBalance = volt.balanceOf(address(this));                                                                                                                                           │
│         uint256 endingPSMUnderlyingBalance = underlyingToken.balanceOf(                                                                                                                                         │
│             address(psm)                                                                                                                                                                                        │
│         );                                                                                                                                                                                                      │
│         uint256 endingPCVDepositUnderlyingBalance = underlyingToken.balanceOf(                                                                                                                                  │
│             address(pcvDeposit)                                                                                                                                                                                 │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         assertEq(endingPCVDepositUnderlyingBalance, mintAmount * 2);                                                                                                                                            │
│         assertEq(endingPSMUnderlyingBalance, 0);                                                                                                                                                                │
│         assertEq(endingUserFEIBalance, mintAmount * 2);                                                                                                                                                         │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function testSwapFeiForUnderlying() public {                                                                                                                                                                │
│         volt.approve(address(psm), mintAmount);                                                                                                                                                                 │
│         psm.redeem(address(this), mintAmount, mintAmount);                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint256 endingUserFEIBalance = volt.balanceOf(address(this));                                                                                                                                           │
│         uint256 endingUserUnderlyingBalance = underlyingToken.balanceOf(                                                                                                                                        │
│             address(this)                                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│         uint256 endingPSMUnderlyingBalance = underlyingToken.balanceOf(                                                                                                                                         │
│             address(psm)                                                                                                                                                                                        │
│         );                                                                                                                                                                                                      │
│         uint256 endingPCVDepositUnderlyingBalance = underlyingToken.balanceOf(                                                                                                                                  │
│             address(pcvDeposit)                                                                                                                                                                                 │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         assertEq(endingPSMUnderlyingBalance, 0);                                                                                                                                                                │
│         assertEq(endingUserFEIBalance, 0);                                                                                                                                                                      │
│         assertEq(endingUserUnderlyingBalance, mintAmount * 2);                                                                                                                                                  │
│         assertEq(endingPCVDepositUnderlyingBalance, 0);                                                                                                                                                         │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function testSwapVoltForUnderlyingAfterPriceIncrease() public {                                                                                                                                             │
│         uint256 amountVoltIn = 100_000;                                                                                                                                                                         │
│         uint256 amountStableOut = 101_000;                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         vm.warp(28 days + block.timestamp);                                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         volt.approve(address(psm), amountVoltIn);                                                                                                                                                               │
│         psm.redeem(address(this), amountVoltIn, amountStableOut);                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         uint256 endingUserFEIBalance = volt.balanceOf(address(this));                                                                                                                                           │
│         uint256 endingUserUnderlyingBalance = underlyingToken.balanceOf(                                                                                                                                        │
│             address(this)                                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│         uint256 endingPSMUnderlyingBalance = underlyingToken.balanceOf(                                                                                                                                         │
│             address(psm)                                                                                                                                                                                        │
│         );                                                                                                                                                                                                      │
│         uint256 endingPCVDepositUnderlyingBalance = underlyingToken.balanceOf(                                                                                                                                  │
│             address(pcvDeposit)                                                                                                                                                                                 │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         assertEq(endingPSMUnderlyingBalance, 0);                                                                                                                                                                │
│         assertEq(endingUserFEIBalance, mintAmount - amountVoltIn);                                                                                                                                              │
│         assertEq(endingUserUnderlyingBalance, mintAmount + amountStableOut);                                                                                                                                    │
│         assertEq(                                                                                                                                                                                               │
│             endingPCVDepositUnderlyingBalance,                                                                                                                                                                  │
│             mintAmount - amountStableOut                                                                                                                                                                        │
│         );                                                                                                                                                                                                      │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function testUnderlyingBufferDepletion() public {                                                                                                                                                           │
│         uint256 bufferStart = psm.buffer();                                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         volt.approve(address(psm), mintAmount);                                                                                                                                                                 │
│         psm.redeem(address(this), mintAmount, mintAmount);                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint256 bufferEnd = psm.buffer();                                                                                                                                                                       │
│         uint256 endingUserFEIBalance = volt.balanceOf(address(this));                                                                                                                                           │
│         uint256 endingUserUnderlyingBalance = underlyingToken.balanceOf(                                                                                                                                        │
│             address(this)                                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│         uint256 endingPSMUnderlyingBalance = underlyingToken.balanceOf(                                                                                                                                         │
│             address(psm)                                                                                                                                                                                        │
│         );                                                                                                                                                                                                      │
│         uint256 endingPCVDepositUnderlyingBalance = underlyingToken.balanceOf(                                                                                                                                  │
│             address(pcvDeposit)                                                                                                                                                                                 │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         assertEq(endingPSMUnderlyingBalance, 0);                                                                                                                                                                │
│         assertEq(endingUserFEIBalance, 0);                                                                                                                                                                      │
│         assertEq(endingUserUnderlyingBalance, mintAmount * 2);                                                                                                                                                  │
│         assertEq(endingPCVDepositUnderlyingBalance, 0);                                                                                                                                                         │
│         assertEq(bufferStart, bufferCap);                                                                                                                                                                       │
│         assertEq(bufferEnd, bufferCap - mintAmount);                                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ have inside code statements that update/accrue interest/exchange rate,                                                                                                                                          │
│ Code:                                                                                                                                                                                                           │
│     function testFeiBufferDepletion() public {                                                                                                                                                                  │
│         uint256 bufferStart = rateLimitedMinter.individualBuffer(address(psm));                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         underlyingToken.approve(address(psm), mintAmount);                                                                                                                                                      │
│         psm.mint(address(this), mintAmount, mintAmount);                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         uint256 bufferEnd = rateLimitedMinter.individualBuffer(address(psm));                                                                                                                                   │
│         uint256 endingUserFEIBalance = volt.balanceOf(address(this));                                                                                                                                           │
│         uint256 endingPSMUnderlyingBalance = underlyingToken.balanceOf(                                                                                                                                         │
│             address(psm)                                                                                                                                                                                        │
│         );                                                                                                                                                                                                      │
│         uint256 endingPCVDepositUnderlyingBalance = underlyingToken.balanceOf(                                                                                                                                  │
│             address(pcvDeposit)                                                                                                                                                                                 │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         assertEq(endingPCVDepositUnderlyingBalance, mintAmount * 2);                                                                                                                                            │
│         assertEq(endingPSMUnderlyingBalance, 0);                                                                                                                                                                │
│         assertEq(endingUserFEIBalance, mintAmount * 2);                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         assertEq(bufferStart, bufferCap);                                                                                                                                                                       │
│         assertEq(bufferEnd, bufferCap - mintAmount);                                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function testERC20WithdrawSuccess() public {                                                                                                                                                                │
│         vm.startPrank(addresses.governorAddress);                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         core.grantPCVController(address(this));                                                                                                                                                                 │
│         underlyingToken.mint(address(psm), mintAmount);                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         vm.stopPrank();                                                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         uint256 startingBalance = underlyingToken.balanceOf(address(this));                                                                                                                                     │
│         psm.withdrawERC20(address(underlyingToken), address(this), mintAmount);                                                                                                                                 │
│         uint256 endingBalance = underlyingToken.balanceOf(address(this));                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         assertEq(endingBalance - startingBalance, mintAmount);                                                                                                                                                  │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function testSetGlobalRateLimitedMinterFailure() public {                                                                                                                                                   │
│         vm.expectRevert(bytes("UNAUTHORIZED"));                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         psm.setGlobalRateLimitedMinter(GlobalRateLimitedMinter(address(this)));                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function testSetGlobalRateLimitedMinterFailureZeroAddress() public {                                                                                                                                        │
│         vm.startPrank(addresses.governorAddress);                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         vm.expectRevert(                                                                                                                                                                                        │
│             bytes("PegStabilityModule: Invalid new GlobalRateLimitedMinter")                                                                                                                                    │
│         );                                                                                                                                                                                                      │
│         psm.setGlobalRateLimitedMinter(GlobalRateLimitedMinter(address(0)));                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         vm.stopPrank();                                                                                                                                                                                         │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function testSetGlobalRateLimitedMinterSuccess() public {                                                                                                                                                   │
│         vm.startPrank(addresses.governorAddress);                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         psm.setGlobalRateLimitedMinter(GlobalRateLimitedMinter(address(this)));                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         assertEq(address(psm.rateLimitedMinter()), address(this));                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         vm.stopPrank();                                                                                                                                                                                         │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function testSetup() public {                                                                                                                                                                               │
│         assertEq(scalingPriceOracle.oracle(), oracle);                                                                                                                                                          │
│         assertEq(scalingPriceOracle.jobId(), jobId);                                                                                                                                                            │
│         assertEq(scalingPriceOracle.fee(), fee);                                                                                                                                                                │
│         assertEq(scalingPriceOracle.currentMonth(), currentMonth);                                                                                                                                              │
│         assertEq(scalingPriceOracle.previousMonth(), previousMonth);                                                                                                                                            │
│         assertEq(                                                                                                                                                                                               │
│             scalingPriceOracle.getMonthlyAPR(),                                                                                                                                                                 │
│             monthlyChangeRateBasisPoints                                                                                                                                                                        │
│         );                                                                                                                                                                                                      │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function testPriceDecreaseAfterInterpolation() public {                                                                                                                                                     │
│         scalingPriceOracle = new MockScalingPriceOracle(                                                                                                                                                        │
│             oracle,                                                                                                                                                                                             │
│             jobId,                                                                                                                                                                                              │
│             fee,                                                                                                                                                                                                │
│             previousMonth, /// flip current and previous months so that rate is -3%                                                                                                                             │
│             currentMonth                                                                                                                                                                                        │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         vm.warp(block.timestamp + 28 days);                                                                                                                                                                     │
│         assertEq(97e16, scalingPriceOracle.getCurrentOraclePrice());                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function testFulfillSucceedsTwentyPercent() public {                                                                                                                                                        │
│         uint256 storedCurrentMonth = scalingPriceOracle.currentMonth();                                                                                                                                         │
│         uint256 newCurrentMonth = (currentMonth * 120) / 100;                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         /// this will succeed as max allowable is 20%                                                                                                                                                           │
│         scalingPriceOracle.fulfill(newCurrentMonth);                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         assertEq(scalingPriceOracle.monthlyChangeRateBasisPoints(), 2_000);                                                                                                                                     │
│         /// assert that all state transitions were done correctly with current and previous month                                                                                                               │
│         assertEq(scalingPriceOracle.previousMonth(), storedCurrentMonth);                                                                                                                                       │
│         assertEq(scalingPriceOracle.currentMonth(), newCurrentMonth);                                                                                                                                           │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function setUp() public {                                                                                                                                                                                   │
│         core = getCore();                                                                                                                                                                                       │
│         volt = core.volt();                                                                                                                                                                                     │
│         MockScalingPriceOracle mockScalingPriceOracle = new MockScalingPriceOracle(                                                                                                                             │
│                 oracleAddress,                                                                                                                                                                                  │
│                 jobId,                                                                                                                                                                                          │
│                 10e18,                                                                                                                                                                                          │
│                 101,                                                                                                                                                                                            │
│                 100                                                                                                                                                                                             │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         oracle = new OraclePassThrough(                                                                                                                                                                         │
│             ScalingPriceOracle(address(mockScalingPriceOracle))                                                                                                                                                 │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         rateLimitedMinter = new GlobalRateLimitedMinter(                                                                                                                                                        │
│             address(core),                                                                                                                                                                                      │
│             rps,                                                                                                                                                                                                │
│             rps,                                                                                                                                                                                                │
│             rps,                                                                                                                                                                                                │
│             individualMaxBufferCap,                                                                                                                                                                             │
│             bufferCap                                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         NonCustodialPSM.OracleParams memory oracleParams = NonCustodialPSM                                                                                                                                      │
│             .OracleParams({                                                                                                                                                                                     │
│                 coreAddress: address(core),                                                                                                                                                                     │
│                 oracleAddress: address(oracle),                                                                                                                                                                 │
│                 backupOracle: address(0),                                                                                                                                                                       │
│                 decimalsNormalizer: 0                                                                                                                                                                           │
│             });                                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         NonCustodialPSM.RateLimitedParams                                                                                                                                                                       │
│             memory multiRateLimitedParams = NonCustodialPSM.RateLimitedParams({                                                                                                                                 │
│                 maxRateLimitPerSecond: rps,                                                                                                                                                                     │
│                 rateLimitPerSecond: rps,                                                                                                                                                                        │
│                 bufferCap: bufferCap                                                                                                                                                                            │
│             });                                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         NonCustodialPSM.PSMParams memory psmParams = NonCustodialPSM.PSMParams({                                                                                                                                │
│             mintFeeBasisPoints: 0,                                                                                                                                                                              │
│             redeemFeeBasisPoints: 0,                                                                                                                                                                            │
│             underlyingToken: fei,                                                                                                                                                                               │
│             pcvDeposit: rariFEIPCVDeposit,                                                                                                                                                                      │
│             rateLimitedMinter: rateLimitedMinter                                                                                                                                                                │
│         });                                                                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         /// create PSM                                                                                                                                                                                          │
│         psm = new NonCustodialPSM(                                                                                                                                                                              │
│             oracleParams,                                                                                                                                                                                       │
│             multiRateLimitedParams,                                                                                                                                                                             │
│             psmParams                                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         vm.prank(feiDAOTimelock);                                                                                                                                                                               │
│         feiCore.grantPCVController(address(psm));                                                                                                                                                               │
│         vm.prank(feiDAOTimelock);                                                                                                                                                                               │
│         fei.mint(address(this), mintAmount);                                                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         vm.startPrank(addresses.governorAddress);                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         /// grant the PSM the PCV Controller role                                                                                                                                                               │
│         core.grantMinter(addresses.governorAddress);                                                                                                                                                            │
│         core.grantMinter(address(rateLimitedMinter));                                                                                                                                                           │
│         core.grantPCVController(address(psm));                                                                                                                                                                  │
│         core.grantPCVController(addresses.governorAddress);                                                                                                                                                     │
│         rateLimitedMinter.addAddress(                                                                                                                                                                           │
│             address(this),                                                                                                                                                                                      │
│             uint112(rps),                                                                                                                                                                                       │
│             uint112(bufferCap)                                                                                                                                                                                  │
│         );                                                                                                                                                                                                      │
│         rateLimitedMinter.addAddress(                                                                                                                                                                           │
│             address(psm),                                                                                                                                                                                       │
│             uint112(rps),                                                                                                                                                                                       │
│             uint112(bufferCap)                                                                                                                                                                                  │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         /// mint VOLT to the user                                                                                                                                                                               │
│         volt.mint(address(this), mintAmount);                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         vm.stopPrank();                                                                                                                                                                                         │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function testSwap() public {                                                                                                                                                                                │
│         rariFEIPCVDeposit.deposit(); // get env cleaned up and ready for testing                                                                                                                                │
│         uint256 startingUserVoltBalance = volt.balanceOf(address(this));                                                                                                                                        │
│         uint256 startingPCVDepositFeiBalance = rariFEIPCVDeposit.balance();                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         fei.approve(address(psm), mintAmount);                                                                                                                                                                  │
│         psm.mint(address(this), mintAmount, mintAmount);                                                                                                                                                        │
│         rariFEIPCVDeposit.deposit();                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         uint256 endingUserVoltBalance = volt.balanceOf(address(this));                                                                                                                                          │
│         uint256 endingPCVDepositFeiBalance = rariFEIPCVDeposit.balance();                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         assertEq(endingUserVoltBalance - startingUserVoltBalance, mintAmount);                                                                                                                                  │
│         assertEq(                                                                                                                                                                                               │
│             endingPCVDepositFeiBalance - startingPCVDepositFeiBalance,                                                                                                                                          │
│             mintAmount - 1 /// goes down by 1 because of cToken pricing rounding down                                                                                                                           │
│         );                                                                                                                                                                                                      │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function testMintAfterPriceIncrease() public {                                                                                                                                                              │
│         uint256 amountFeiIn = 101_000;                                                                                                                                                                          │
│         uint256 amountVoltOut = 99_999;                                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         rariFEIPCVDeposit.deposit(); // get env cleaned up and ready for testing                                                                                                                                │
│         vm.warp(28 days + block.timestamp);                                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         uint256 startingUserVoltBalance = volt.balanceOf(address(this));                                                                                                                                        │
│         uint256 startingPCVDepositFeiBalance = rariFEIPCVDeposit.balance();                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         fei.approve(address(psm), amountFeiIn);                                                                                                                                                                 │
│         psm.mint(address(this), amountFeiIn, amountVoltOut);                                                                                                                                                    │
│         rariFEIPCVDeposit.deposit();                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         uint256 endingUserVoltBalance = volt.balanceOf(address(this));                                                                                                                                          │
│         uint256 endingPCVDepositFeiBalance = rariFEIPCVDeposit.balance();                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         assertEq(                                                                                                                                                                                               │
│             endingUserVoltBalance - startingUserVoltBalance,                                                                                                                                                    │
│             amountVoltOut                                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│         assertEq(                                                                                                                                                                                               │
│             endingPCVDepositFeiBalance - startingPCVDepositFeiBalance,                                                                                                                                          │
│             amountFeiIn - 1                                                                                                                                                                                     │
│         );                                                                                                                                                                                                      │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function testRedeemAfterPriceIncrease() public {                                                                                                                                                            │
│         uint256 amountVoltIn = 100_000;                                                                                                                                                                         │
│         uint256 amountFeiOut = 101_000;                                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         rariFEIPCVDeposit.deposit(); // get env cleaned up and ready for testing                                                                                                                                │
│         vm.warp(28 days + block.timestamp);                                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         uint256 startingUserVoltBalance = volt.balanceOf(address(this));                                                                                                                                        │
│         uint256 startingPCVDepositFeiBalance = rariFEIPCVDeposit.balance();                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         volt.approve(address(psm), amountVoltIn);                                                                                                                                                               │
│         psm.redeem(address(this), amountVoltIn, amountFeiOut);                                                                                                                                                  │
│         rariFEIPCVDeposit.deposit();                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         uint256 endingUserVoltBalance = volt.balanceOf(address(this));                                                                                                                                          │
│         uint256 endingPCVDepositFeiBalance = rariFEIPCVDeposit.balance();                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         assertEq(startingUserVoltBalance - endingUserVoltBalance, amountVoltIn);                                                                                                                                │
│         assertEq(                                                                                                                                                                                               │
│             startingPCVDepositFeiBalance - endingPCVDepositFeiBalance,                                                                                                                                          │
│             amountFeiOut - 1                                                                                                                                                                                    │
│         );                                                                                                                                                                                                      │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ have inside code statements that update/accrue interest/exchange rate,                                                                                                                                          │
│ Code:                                                                                                                                                                                                           │
│     function testGlobalRateLimitedMint() public {                                                                                                                                                               │
│         uint256 voltAvailableToMint = rateLimitedMinter.individualBuffer(                                                                                                                                       │
│             address(this)                                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│         uint256 startingVolt = volt.balanceOf(address(this));                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         rateLimitedMinter.mintMaxAllowableVolt(address(this));                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         uint256 endingVolt = volt.balanceOf(address(this));                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         assertEq(endingVolt, voltAvailableToMint + startingVolt);                                                                                                                                               │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function getCurrentOraclePrice() public view override returns (uint256) {                                                                                                                                   │
│         int256 oraclePriceInt = oraclePrice.toInt256();                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         int256 timeDelta = Math.min(block.timestamp - startTime, TIMEFRAME).toInt256();                                                                                                                         │
│         int256 pricePercentageChange = oraclePriceInt * monthlyChangeRateBasisPoints / Constants.BP_INT;                                                                                                        │
│         int256 priceDelta = pricePercentageChange * timeDelta / TIMEFRAME.toInt256();                                                                                                                           │
│                                                                                                                                                                                                                 │
│         return (oraclePriceInt + priceDelta).toUint256();                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function mint(address dst, uint256 rawAmount) external {                                                                                                                                                    │
│         require(msg.sender == minter, "Vcon: only the minter can mint");                                                                                                                                        │
│         require(dst != address(0), "Vcon: cannot transfer to the zero address");                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // mint the amount                                                                                                                                                                                      │
│         uint96 amount = safe96(rawAmount, "Vcon: amount exceeds 96 bits");                                                                                                                                      │
│         uint96 safeSupply = safe96(                                                                                                                                                                             │
│             totalSupply,                                                                                                                                                                                        │
│             "Vcon: totalSupply exceeds 96 bits"                                                                                                                                                                 │
│         );                                                                                                                                                                                                      │
│         totalSupply = add96(                                                                                                                                                                                    │
│             safeSupply,                                                                                                                                                                                         │
│             amount,                                                                                                                                                                                             │
│             "Vcon: totalSupply exceeds 96 bits"                                                                                                                                                                 │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // transfer the amount to the recipient                                                                                                                                                                 │
│         balances = add96(                                                                                                                                                                                       │
│             balances,                                                                                                                                                                                           │
│             amount,                                                                                                                                                                                             │
│             "Vcon: transfer amount overflows"                                                                                                                                                                   │
│         );                                                                                                                                                                                                      │
│         emit Transfer(address(0), dst, amount);                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         // move delegates                                                                                                                                                                                       │
│         _moveDelegates(address(0), delegates, amount);                                                                                                                                                          │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function mint(address dst, uint256 rawAmount) external {                                                                                                                                                    │
│         require(msg.sender == minter, "Vcon: only the minter can mint");                                                                                                                                        │
│         require(dst != address(0), "Vcon: cannot transfer to the zero address");                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // mint the amount                                                                                                                                                                                      │
│         uint96 amount = safe96(rawAmount, "Vcon: amount exceeds 96 bits");                                                                                                                                      │
│         uint96 safeSupply = safe96(                                                                                                                                                                             │
│             totalSupply,                                                                                                                                                                                        │
│             "Vcon: totalSupply exceeds 96 bits"                                                                                                                                                                 │
│         );                                                                                                                                                                                                      │
│         totalSupply = add96(                                                                                                                                                                                    │
│             safeSupply,                                                                                                                                                                                         │
│             amount,                                                                                                                                                                                             │
│             "Vcon: totalSupply exceeds 96 bits"                                                                                                                                                                 │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // transfer the amount to the recipient                                                                                                                                                                 │
│         balances = add96(                                                                                                                                                                                       │
│             balances,                                                                                                                                                                                           │
│             amount,                                                                                                                                                                                             │
│             "Vcon: transfer amount overflows"                                                                                                                                                                   │
│         );                                                                                                                                                                                                      │
│         emit Transfer(address(0), dst, amount);                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         // move delegates                                                                                                                                                                                       │
│         _moveDelegates(address(0), delegates, amount);                                                                                                                                                          │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve transfering token from an address different from message sender                                                                                                                              │
│ Code:                                                                                                                                                                                                           │
│     function transfer(address dst, uint256 rawAmount) external returns (bool) {                                                                                                                                 │
│         uint96 amount = safe96(rawAmount, "Vcon: amount exceeds 96 bits");                                                                                                                                      │
│         _transferTokens(msg.sender, dst, amount);                                                                                                                                                               │
│         return true;                                                                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve transfering token from an address different from message sender and there is no check of allowance/approval from the address owner                                                           │
│ Code:                                                                                                                                                                                                           │
│     function transfer(address dst, uint256 rawAmount) external returns (bool) {                                                                                                                                 │
│         uint96 amount = safe96(rawAmount, "Vcon: amount exceeds 96 bits");                                                                                                                                      │
│         _transferTokens(msg.sender, dst, amount);                                                                                                                                                               │
│         return true;                                                                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No.                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that invoke user checkpoint,                                                                                                                                             │
│ Code:                                                                                                                                                                                                           │
│     function getPriorVotes(address account, uint256 blockNumber)                                                                                                                                                │
│         public                                                                                                                                                                                                  │
│         view                                                                                                                                                                                                    │
│         returns (uint96)                                                                                                                                                                                        │
│     {                                                                                                                                                                                                           │
│         require(blockNumber < block.number, "Vcon: not yet determined");                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         uint32 nCheckpoints = numCheckpoints;                                                                                                                                                                   │
│         if (nCheckpoints == 0) {                                                                                                                                                                                │
│             return 0;                                                                                                                                                                                           │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // First check most recent balance                                                                                                                                                                      │
│         if (checkpoints.fromBlock <= blockNumber) {                                                                                                                                                             │
│             return checkpoints.votes;                                                                                                                                                                           │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // Next check implicit zero balance                                                                                                                                                                     │
│         if (checkpoints[0].fromBlock > blockNumber) {                                                                                                                                                           │
│             return 0;                                                                                                                                                                                           │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint32 lower = 0;                                                                                                                                                                                       │
│         uint32 upper = nCheckpoints - 1;                                                                                                                                                                        │
│         while (upper > lower) {                                                                                                                                                                                 │
│             uint32 center = upper - (upper - lower) / 2; // ceil, avoiding overflow                                                                                                                             │
│             Checkpoint memory cp = checkpoints;                                                                                                                                                                 │
│             if (cp.fromBlock == blockNumber) {                                                                                                                                                                  │
│                 return cp.votes;                                                                                                                                                                                │
│             } else if (cp.fromBlock < blockNumber) {                                                                                                                                                            │
│                 lower = center;                                                                                                                                                                                 │
│             } else {                                                                                                                                                                                            │
│                 upper = center - 1;                                                                                                                                                                             │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         return checkpoints.votes;                                                                                                                                                                               │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that invoke user checkpoint,                                                                                                                                             │
│ Code:                                                                                                                                                                                                           │
│     function _moveDelegates(                                                                                                                                                                                    │
│         address srcRep,                                                                                                                                                                                         │
│         address dstRep,                                                                                                                                                                                         │
│         uint96 amount                                                                                                                                                                                           │
│     ) internal {                                                                                                                                                                                                │
│         if (srcRep != dstRep && amount > 0) {                                                                                                                                                                   │
│             if (srcRep != address(0)) {                                                                                                                                                                         │
│                 uint32 srcRepNum = numCheckpoints;                                                                                                                                                              │
│                 uint96 srcRepOld = srcRepNum > 0                                                                                                                                                                │
│                     ? checkpoints.votes                                                                                                                                                                         │
│                     : 0;                                                                                                                                                                                        │
│                 uint96 srcRepNew = sub96(                                                                                                                                                                       │
│                     srcRepOld,                                                                                                                                                                                  │
│                     amount,                                                                                                                                                                                     │
│                     "Vcon: vote amount underflows"                                                                                                                                                              │
│                 );                                                                                                                                                                                              │
│                 _writeCheckpoint(srcRep, srcRepNum, srcRepOld, srcRepNew);                                                                                                                                      │
│             }                                                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│             if (dstRep != address(0)) {                                                                                                                                                                         │
│                 uint32 dstRepNum = numCheckpoints;                                                                                                                                                              │
│                 uint96 dstRepOld = dstRepNum > 0                                                                                                                                                                │
│                     ? checkpoints.votes                                                                                                                                                                         │
│                     : 0;                                                                                                                                                                                        │
│                 uint96 dstRepNew = add96(                                                                                                                                                                       │
│                     dstRepOld,                                                                                                                                                                                  │
│                     amount,                                                                                                                                                                                     │
│                     "Vcon: vote amount overflows"                                                                                                                                                               │
│                 );                                                                                                                                                                                              │
│                 _writeCheckpoint(dstRep, dstRepNum, dstRepOld, dstRepNew);                                                                                                                                      │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that invoke user checkpoint, and have inside code statements that calculate/assigns/distribute the balance/share/stake/fee/loan/reward                                   │
│ Code:                                                                                                                                                                                                           │
│     function _moveDelegates(                                                                                                                                                                                    │
│         address srcRep,                                                                                                                                                                                         │
│         address dstRep,                                                                                                                                                                                         │
│         uint96 amount                                                                                                                                                                                           │
│     ) internal {                                                                                                                                                                                                │
│         if (srcRep != dstRep && amount > 0) {                                                                                                                                                                   │
│             if (srcRep != address(0)) {                                                                                                                                                                         │
│                 uint32 srcRepNum = numCheckpoints;                                                                                                                                                              │
│                 uint96 srcRepOld = srcRepNum > 0                                                                                                                                                                │
│                     ? checkpoints.votes                                                                                                                                                                         │
│                     : 0;                                                                                                                                                                                        │
│                 uint96 srcRepNew = sub96(                                                                                                                                                                       │
│                     srcRepOld,                                                                                                                                                                                  │
│                     amount,                                                                                                                                                                                     │
│                     "Vcon: vote amount underflows"                                                                                                                                                              │
│                 );                                                                                                                                                                                              │
│                 _writeCheckpoint(srcRep, srcRepNum, srcRepOld, srcRepNew);                                                                                                                                      │
│             }                                                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│             if (dstRep != address(0)) {                                                                                                                                                                         │
│                 uint32 dstRepNum = numCheckpoints;                                                                                                                                                              │
│                 uint96 dstRepOld = dstRepNum > 0                                                                                                                                                                │
│                     ? checkpoints.votes                                                                                                                                                                         │
│                     : 0;                                                                                                                                                                                        │
│                 uint96 dstRepNew = add96(                                                                                                                                                                       │
│                     dstRepOld,                                                                                                                                                                                  │
│                     amount,                                                                                                                                                                                     │
│                     "Vcon: vote amount overflows"                                                                                                                                                               │
│                 );                                                                                                                                                                                              │
│                 _writeCheckpoint(dstRep, dstRepNum, dstRepOld, dstRepNew);                                                                                                                                      │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that invoke user checkpoint,                                                                                                                                             │
│ Code:                                                                                                                                                                                                           │
│     function _writeCheckpoint(                                                                                                                                                                                  │
│         address delegatee,                                                                                                                                                                                      │
│         uint32 nCheckpoints,                                                                                                                                                                                    │
│         uint96 oldVotes,                                                                                                                                                                                        │
│         uint96 newVotes                                                                                                                                                                                         │
│     ) internal {                                                                                                                                                                                                │
│         uint32 blockNumber = safe32(                                                                                                                                                                            │
│             block.number,                                                                                                                                                                                       │
│             "Vcon: block number exceeds 32 bits"                                                                                                                                                                │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (                                                                                                                                                                                                    │
│             nCheckpoints > 0 &&                                                                                                                                                                                 │
│             checkpoints.fromBlock == blockNumber                                                                                                                                                                │
│         ) {                                                                                                                                                                                                     │
│             checkpoints.votes = newVotes;                                                                                                                                                                       │
│         } else {                                                                                                                                                                                                │
│             checkpoints = Checkpoint(                                                                                                                                                                           │
│                 blockNumber,                                                                                                                                                                                    │
│                 newVotes                                                                                                                                                                                        │
│             );                                                                                                                                                                                                  │
│             numCheckpoints = nCheckpoints + 1;                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         emit DelegateVotesChanged(delegatee, oldVotes, newVotes);                                                                                                                                               │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function updateMaxRateLimitPerSecond(uint256 newRateLimitPerSecond)                                                                                                                                         │
│         external                                                                                                                                                                                                │
│         virtual                                                                                                                                                                                                 │
│         override                                                                                                                                                                                                │
│         onlyGovernor                                                                                                                                                                                            │
│     {                                                                                                                                                                                                           │
│         require(                                                                                                                                                                                                │
│             newRateLimitPerSecond <= MAX_RATE_LIMIT_PER_SECOND,                                                                                                                                                 │
│             "MultiRateLimited: exceeds global max rate limit per second"                                                                                                                                        │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint256 oldMaxRateLimitPerSecond = individualMaxRateLimitPerSecond;                                                                                                                                     │
│         individualMaxRateLimitPerSecond = newRateLimitPerSecond;                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         emit MultiMaxRateLimitPerSecondUpdate(                                                                                                                                                                  │
│             oldMaxRateLimitPerSecond,                                                                                                                                                                           │
│             newRateLimitPerSecond                                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function updateMaxBufferCap(uint256 newBufferCap)                                                                                                                                                           │
│         external                                                                                                                                                                                                │
│         virtual                                                                                                                                                                                                 │
│         override                                                                                                                                                                                                │
│         onlyGovernor                                                                                                                                                                                            │
│     {                                                                                                                                                                                                           │
│         require(                                                                                                                                                                                                │
│             newBufferCap <= bufferCap,                                                                                                                                                                          │
│             "MultiRateLimited: exceeds global buffer cap"                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint256 oldBufferCap = individualMaxBufferCap;                                                                                                                                                          │
│         individualMaxBufferCap = newBufferCap;                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         emit MultiBufferCapUpdate(oldBufferCap, newBufferCap);                                                                                                                                                  │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function updateAddress(                                                                                                                                                                                     │
│         address rateLimitedAddress,                                                                                                                                                                             │
│         uint112 _rateLimitPerSecond,                                                                                                                                                                            │
│         uint112 _bufferCap                                                                                                                                                                                      │
│     )                                                                                                                                                                                                           │
│         external                                                                                                                                                                                                │
│         virtual                                                                                                                                                                                                 │
│         override                                                                                                                                                                                                │
│         addressIsRegistered(rateLimitedAddress)                                                                                                                                                                 │
│         hasAnyOfTwoRoles(TribeRoles.ADD_MINTER_ROLE, TribeRoles.GOVERNOR)                                                                                                                                       │
│     {                                                                                                                                                                                                           │
│         if (core().hasRole(TribeRoles.ADD_MINTER_ROLE, msg.sender)) {                                                                                                                                           │
│             require(                                                                                                                                                                                            │
│                 _rateLimitPerSecond <= individualMaxRateLimitPerSecond,                                                                                                                                         │
│                 "MultiRateLimited: rate limit per second exceeds non governor allowable amount"                                                                                                                 │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 _bufferCap <= individualMaxBufferCap,                                                                                                                                                           │
│                 "MultiRateLimited: max buffer cap exceeds non governor allowable amount"                                                                                                                        │
│             );                                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│         require(                                                                                                                                                                                                │
│             _bufferCap <= bufferCap,                                                                                                                                                                            │
│             "MultiRateLimited: buffercap too high"                                                                                                                                                              │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         _updateAddress(rateLimitedAddress, _rateLimitPerSecond, _bufferCap);                                                                                                                                    │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function removeAddress(address rateLimitedAddress)                                                                                                                                                          │
│         external                                                                                                                                                                                                │
│         virtual                                                                                                                                                                                                 │
│         override                                                                                                                                                                                                │
│         addressIsRegistered(rateLimitedAddress)                                                                                                                                                                 │
│         onlyGuardianOrGovernor                                                                                                                                                                                  │
│     {                                                                                                                                                                                                           │
│         uint256 oldRateLimitPerSecond = rateLimitPerAddress                                                                                                                                                     │
│             .rateLimitPerSecond;                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         delete rateLimitPerAddress;                                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         emit IndividualRateLimitPerSecondUpdate(                                                                                                                                                                │
│             rateLimitedAddress,                                                                                                                                                                                 │
│             oldRateLimitPerSecond,                                                                                                                                                                              │
│             0                                                                                                                                                                                                   │
│         );                                                                                                                                                                                                      │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function individualBuffer(address rateLimitedAddress)                                                                                                                                                       │
│         public                                                                                                                                                                                                  │
│         view                                                                                                                                                                                                    │
│         override                                                                                                                                                                                                │
│         returns (uint112)                                                                                                                                                                                       │
│     {                                                                                                                                                                                                           │
│         RateLimitData memory rateLimitData = rateLimitPerAddress[                                                                                                                                               │
│             rateLimitedAddress                                                                                                                                                                                  │
│         ];                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint256 elapsed = block.timestamp - rateLimitData.lastBufferUsedTime;                                                                                                                                   │
│         return                                                                                                                                                                                                  │
│             uint112(                                                                                                                                                                                            │
│                 Math.min(                                                                                                                                                                                       │
│                     rateLimitData.bufferStored +                                                                                                                                                                │
│                         (rateLimitData.rateLimitPerSecond * elapsed),                                                                                                                                           │
│                     rateLimitData.bufferCap                                                                                                                                                                     │
│                 )                                                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function _updateAddress(                                                                                                                                                                                    │
│         address rateLimitedAddress,                                                                                                                                                                             │
│         uint112 _rateLimitPerSecond,                                                                                                                                                                            │
│         uint112 _bufferCap                                                                                                                                                                                      │
│     ) internal {                                                                                                                                                                                                │
│         RateLimitData storage rateLimitData = rateLimitPerAddress[                                                                                                                                              │
│             rateLimitedAddress                                                                                                                                                                                  │
│         ];                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             rateLimitData.lastBufferUsedTime != 0,                                                                                                                                                              │
│             "MultiRateLimited: rate limit address does not exist"                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             _rateLimitPerSecond <= MAX_RATE_LIMIT_PER_SECOND,                                                                                                                                                   │
│             "MultiRateLimited: rateLimitPerSecond too high"                                                                                                                                                     │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint112 oldRateLimitPerSecond = rateLimitData.rateLimitPerSecond;                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         rateLimitData.lastBufferUsedTime = block.timestamp.toUint32();                                                                                                                                          │
│         rateLimitData.bufferCap = _bufferCap;                                                                                                                                                                   │
│         rateLimitData.rateLimitPerSecond = _rateLimitPerSecond;                                                                                                                                                 │
│         rateLimitData.bufferStored = _bufferCap;                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         emit IndividualRateLimitPerSecondUpdate(                                                                                                                                                                │
│             rateLimitedAddress,                                                                                                                                                                                 │
│             oldRateLimitPerSecond,                                                                                                                                                                              │
│             _rateLimitPerSecond                                                                                                                                                                                 │
│         );                                                                                                                                                                                                      │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function _depleteIndividualBuffer(                                                                                                                                                                          │
│         address rateLimitedAddress,                                                                                                                                                                             │
│         uint256 amount                                                                                                                                                                                          │
│     ) internal returns (uint256) {                                                                                                                                                                              │
│         _depleteBuffer(amount);                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         uint256 newBuffer = individualBuffer(rateLimitedAddress);                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         require(newBuffer != 0, "MultiRateLimited: no rate limit buffer");                                                                                                                                      │
│         require(amount <= newBuffer, "MultiRateLimited: rate limit hit");                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         rateLimitPerAddress.bufferStored = uint112(                                                                                                                                                             │
│             newBuffer - amount                                                                                                                                                                                  │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         rateLimitPerAddress.lastBufferUsedTime = block                                                                                                                                                          │
│             .timestamp                                                                                                                                                                                          │
│             .toUint32();                                                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         emit IndividualBufferUsed(                                                                                                                                                                              │
│             rateLimitedAddress,                                                                                                                                                                                 │
│             amount,                                                                                                                                                                                             │
│             newBuffer - amount                                                                                                                                                                                  │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         return amount;                                                                                                                                                                                          │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function setRateLimitPerSecond(uint256 newRateLimitPerSecond)                                                                                                                                               │
│         external                                                                                                                                                                                                │
│         virtual                                                                                                                                                                                                 │
│         onlyGovernorOrAdmin                                                                                                                                                                                     │
│     {                                                                                                                                                                                                           │
│         require(                                                                                                                                                                                                │
│             newRateLimitPerSecond <= MAX_RATE_LIMIT_PER_SECOND,                                                                                                                                                 │
│             "RateLimited: rateLimitPerSecond too high"                                                                                                                                                          │
│         );                                                                                                                                                                                                      │
│         _updateBufferStored();                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         _setRateLimitPerSecond(newRateLimitPerSecond);                                                                                                                                                          │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function _depleteBuffer(uint256 amount) internal virtual returns (uint256) {                                                                                                                                │
│         uint256 newBuffer = buffer();                                                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         uint256 usedAmount = amount;                                                                                                                                                                            │
│         if (doPartialAction && usedAmount > newBuffer) {                                                                                                                                                        │
│             usedAmount = newBuffer;                                                                                                                                                                             │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         require(newBuffer != 0, "RateLimited: no rate limit buffer");                                                                                                                                           │
│         require(usedAmount <= newBuffer, "RateLimited: rate limit hit");                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         bufferStored = newBuffer - usedAmount;                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         lastBufferUsedTime = block.timestamp;                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         emit BufferUsed(usedAmount, bufferStored);                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         return usedAmount;                                                                                                                                                                                      │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function _setRateLimitPerSecond(uint256 newRateLimitPerSecond) internal {                                                                                                                                   │
│         uint256 oldRateLimitPerSecond = rateLimitPerSecond;                                                                                                                                                     │
│         rateLimitPerSecond = newRateLimitPerSecond;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         emit RateLimitPerSecondUpdate(                                                                                                                                                                          │
│             oldRateLimitPerSecond,                                                                                                                                                                              │
│             newRateLimitPerSecond                                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: mint or vest or collect token/liquidity/earning and assign them to the address recipient or to variable,                                                                                             │
│ Code:                                                                                                                                                                                                           │
│     function mintMaxAllowableVolt(address to)                                                                                                                                                                   │
│         external                                                                                                                                                                                                │
│         virtual                                                                                                                                                                                                 │
│         override                                                                                                                                                                                                │
│         whenNotPaused                                                                                                                                                                                           │
│     {                                                                                                                                                                                                           │
│         uint256 amount = Math.min(individualBuffer(msg.sender), buffer());                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         _depleteIndividualBuffer(msg.sender, amount);                                                                                                                                                           │
│         _mintVolt(to, amount);                                                                                                                                                                                  │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: mint or vest or collect token/liquidity/earning and assign them to the address recipient or to variable, and this operation could be front run to benefit the account/address that can be controlled │
│ by the parameter and has no sender check in the function code                                                                                                                                                   │
│ Code:                                                                                                                                                                                                           │
│     function mintMaxAllowableVolt(address to)                                                                                                                                                                   │
│         external                                                                                                                                                                                                │
│         virtual                                                                                                                                                                                                 │
│         override                                                                                                                                                                                                │
│         whenNotPaused                                                                                                                                                                                           │
│     {                                                                                                                                                                                                           │
│         uint256 amount = Math.min(individualBuffer(msg.sender), buffer());                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         _depleteIndividualBuffer(msg.sender, amount);                                                                                                                                                           │
│         _mintVolt(to, amount);                                                                                                                                                                                  │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to invoke user checkpoint? Answer only ZERO or ONE statement, cover the code with backquotes.                                  │
│ Code:                                                                                                                                                                                                           │
│     function _moveDelegates(                                                                                                                                                                                    │
│         address srcRep,                                                                                                                                                                                         │
│         address dstRep,                                                                                                                                                                                         │
│         uint96 amount                                                                                                                                                                                           │
│     ) internal {                                                                                                                                                                                                │
│         if (srcRep != dstRep && amount > 0) {                                                                                                                                                                   │
│             if (srcRep != address(0)) {                                                                                                                                                                         │
│                 uint32 srcRepNum = numCheckpoints;                                                                                                                                                              │
│                 uint96 srcRepOld = srcRepNum > 0                                                                                                                                                                │
│                     ? checkpoints.votes                                                                                                                                                                         │
│                     : 0;                                                                                                                                                                                        │
│                 uint96 srcRepNew = sub96(                                                                                                                                                                       │
│                     srcRepOld,                                                                                                                                                                                  │
│                     amount,                                                                                                                                                                                     │
│                     "Vcon: vote amount underflows"                                                                                                                                                              │
│                 );                                                                                                                                                                                              │
│                 _writeCheckpoint(srcRep, srcRepNum, srcRepOld, srcRepNew);                                                                                                                                      │
│             }                                                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│             if (dstRep != address(0)) {                                                                                                                                                                         │
│                 uint32 dstRepNum = numCheckpoints;                                                                                                                                                              │
│                 uint96 dstRepOld = dstRepNum > 0                                                                                                                                                                │
│                     ? checkpoints.votes                                                                                                                                                                         │
│                     : 0;                                                                                                                                                                                        │
│                 uint96 dstRepNew = add96(                                                                                                                                                                       │
│                     dstRepOld,                                                                                                                                                                                  │
│                     amount,                                                                                                                                                                                     │
│                     "Vcon: vote amount overflows"                                                                                                                                                               │
│                 );                                                                                                                                                                                              │
│                 _writeCheckpoint(dstRep, dstRepNum, dstRepOld, dstRepNew);                                                                                                                                      │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ `ONE statement`                                                                                                                                                                                                 │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:42:42] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-03-volt-main/contracts/vcon/Vcon.sol, current function:      tasks.py:260
                             _moveDelegates, current vul: wrong-order-checkpoint                                                                                                                                   
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
                      Scan Results                       
┏━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┓
┃ Type ┃ Description ┃ Affected Files ┃ Analysis Report ┃
┡━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━┩
└──────┴─────────────┴────────────────┴─────────────────┘
                  Summary                   
┏━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓
┃ Key                  ┃ Value             ┃
┡━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩
│ Files                │ 46                │
│ Contracts            │ 48                │
│ Functions            │ 141               │
│ Lines of Code        │ 6052              │
│ Used Time            │ 26.78379988670349 │
│ Estimated Cost (USD) │ 0.0194755         │
└──────────────────────┴───────────────────┘
