

  .oooooo.    ooooooooo.   ooooooooooooo  .oooooo..o                                 
 d8P'  `Y8b   `888   `Y88. 8'   888   `8 d8P'    `Y8                                 
888            888   .d88'      888      Y88bo.       .ooooo.   .oooo.   ooo. .oo.   
888            888ooo88P'       888       `"Y8888o.  d88' `"Y8 `P  )88b  `888P"Y88b  
888     ooooo  888              888           `"Y88b 888        .oP"888   888   888  
`88.    .88'   888              888      oo     .d8P 888   .o8 d8(  888   888   888  
 `Y8bood8P'   o888o            o888o     8""88888P'  `Y8bod8P' `Y888""8o o888o o888o                                                        


                                                                   

[19:37:31] Loaded 10 rules                                                                                                                                                                             tasks.py:119
[12/08/24 19:37:31] INFO     CryticCompile: 'npx hardhat clean' running (wd: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main)               subprocess.py:41
[12/08/24 19:37:32] ERROR    CryticCompile: 'npx' returned non-zero exit code 1                                                                                                                    subprocess.py:60
                    ERROR    CryticCompile: An unexpected error occurred:                                                                                                                          subprocess.py:68
                             stderr: Error: Cannot find module '@nomicfoundation/hardhat-toolbox'                                                                                                                  
                             stderr: Require stack:                                                                                                                                                                
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/hardhat.config.js                                                    
                             stderr: -                                                                                                                                                                             
                             /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/core/config/config-loading.js                    
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/cli/cli.js                             
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/cli/bootstrap.js                       
                             stderr:     at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)                                                                                                   
                             stderr:     at Function._load (node:internal/modules/cjs/loader:1075:27)                                                                                                              
                             stderr:     at TracingChannel.traceSync (node:diagnostics_channel:322:14)                                                                                                             
                             stderr:     at wrapModuleLoad (node:internal/modules/cjs/loader:219:24)                                                                                                               
                             stderr:     at Module.require (node:internal/modules/cjs/loader:1340:12)                                                                                                              
                             stderr:     at require (node:internal/modules/helpers:138:16)                                                                                                                         
                             stderr:     at Object.<anonymous> (/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/hardhat.config.js:1:1)                      
                             stderr:     at Module._compile (node:internal/modules/cjs/loader:1565:14)                                                                                                             
                             stderr:     at Object..js (node:internal/modules/cjs/loader:1708:10)                                                                                                                  
                             stderr:     at Module.load (node:internal/modules/cjs/loader:1318:32) {                                                                                                               
                             stderr:   code: 'MODULE_NOT_FOUND',                                                                                                                                                   
                             stderr:   requireStack: [                                                                                                                                                             
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/hardhat.config.js',                                               
                             stderr:                                                                                                                                                                               
                             '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/core/config/config-loading.js',                 
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/cli/cli.js',                        
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/cli/bootstrap.js'                   
                             stderr:   ]                                                                                                                                                                           
                             stderr: }                                                                                                                                                                             
                    INFO     CryticCompile: 'npx hardhat clean --global' running (wd: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main)      subprocess.py:41
[12/08/24 19:37:33] ERROR    CryticCompile: 'npx' returned non-zero exit code 1                                                                                                                    subprocess.py:60
                    ERROR    CryticCompile: An unexpected error occurred:                                                                                                                          subprocess.py:68
                             stderr: Error: Cannot find module '@nomicfoundation/hardhat-toolbox'                                                                                                                  
                             stderr: Require stack:                                                                                                                                                                
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/hardhat.config.js                                                    
                             stderr: -                                                                                                                                                                             
                             /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/core/config/config-loading.js                    
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/cli/cli.js                             
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/cli/bootstrap.js                       
                             stderr:     at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)                                                                                                   
                             stderr:     at Function._load (node:internal/modules/cjs/loader:1075:27)                                                                                                              
                             stderr:     at TracingChannel.traceSync (node:diagnostics_channel:322:14)                                                                                                             
                             stderr:     at wrapModuleLoad (node:internal/modules/cjs/loader:219:24)                                                                                                               
                             stderr:     at Module.require (node:internal/modules/cjs/loader:1340:12)                                                                                                              
                             stderr:     at require (node:internal/modules/helpers:138:16)                                                                                                                         
                             stderr:     at Object.<anonymous> (/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/hardhat.config.js:1:1)                      
                             stderr:     at Module._compile (node:internal/modules/cjs/loader:1565:14)                                                                                                             
                             stderr:     at Object..js (node:internal/modules/cjs/loader:1708:10)                                                                                                                  
                             stderr:     at Module.load (node:internal/modules/cjs/loader:1318:32) {                                                                                                               
                             stderr:   code: 'MODULE_NOT_FOUND',                                                                                                                                                   
                             stderr:   requireStack: [                                                                                                                                                             
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/hardhat.config.js',                                               
                             stderr:                                                                                                                                                                               
                             '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/core/config/config-loading.js',                 
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/cli/cli.js',                        
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/cli/bootstrap.js'                   
                             stderr:   ]                                                                                                                                                                           
                             stderr: }                                                                                                                                                                             
                    INFO     CryticCompile: Problem executing hardhat: An unexpected error occurred:                                                                                                 hardhat.py:327
                             Error: Cannot find module '@nomicfoundation/hardhat-toolbox'                                                                                                                          
                             Require stack:                                                                                                                                                                        
                             - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/hardhat.config.js                                                            
                             - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/core/config/config-loading.js                  
                             - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/cli/cli.js                                     
                             - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/cli/bootstrap.js                               
                                 at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)                                                                                                           
                                 at Function._load (node:internal/modules/cjs/loader:1075:27)                                                                                                                      
                                 at TracingChannel.traceSync (node:diagnostics_channel:322:14)                                                                                                                     
                                 at wrapModuleLoad (node:internal/modules/cjs/loader:219:24)                                                                                                                       
                                 at Module.require (node:internal/modules/cjs/loader:1340:12)                                                                                                                      
                                 at require (node:internal/modules/helpers:138:16)                                                                                                                                 
                                 at Object.<anonymous> (/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/hardhat.config.js:1:1)                              
                                 at Module._compile (node:internal/modules/cjs/loader:1565:14)                                                                                                                     
                                 at Object..js (node:internal/modules/cjs/loader:1708:10)                                                                                                                          
                                 at Module.load (node:internal/modules/cjs/loader:1318:32) {                                                                                                                       
                               code: 'MODULE_NOT_FOUND',                                                                                                                                                           
                               requireStack: [                                                                                                                                                                     
                                 '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/hardhat.config.js',                                                       
                                 '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/core/config/config-loading.js               
                             ',                                                                                                                                                                                    
                                 '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/cli/cli.js',                                
                                 '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/cli/bootstrap.js'                           
                               ]                                                                                                                                                                                   
                             }                                                                                                                                                                                     
                                                                                                                                                                                                                   
                    INFO     CryticCompile: 'npx hardhat compile --force' running (wd: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main)     subprocess.py:41
[12/08/24 19:37:34] ERROR    CryticCompile: 'npx' returned non-zero exit code 1                                                                                                                    subprocess.py:60
                    ERROR    CryticCompile: An unexpected error occurred:                                                                                                                          subprocess.py:68
                             stderr: Error: Cannot find module '@nomicfoundation/hardhat-toolbox'                                                                                                                  
                             stderr: Require stack:                                                                                                                                                                
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/hardhat.config.js                                                    
                             stderr: -                                                                                                                                                                             
                             /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/core/config/config-loading.js                    
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/cli/cli.js                             
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/cli/bootstrap.js                       
                             stderr:     at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)                                                                                                   
                             stderr:     at Function._load (node:internal/modules/cjs/loader:1075:27)                                                                                                              
                             stderr:     at TracingChannel.traceSync (node:diagnostics_channel:322:14)                                                                                                             
                             stderr:     at wrapModuleLoad (node:internal/modules/cjs/loader:219:24)                                                                                                               
                             stderr:     at Module.require (node:internal/modules/cjs/loader:1340:12)                                                                                                              
                             stderr:     at require (node:internal/modules/helpers:138:16)                                                                                                                         
                             stderr:     at Object.<anonymous> (/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/hardhat.config.js:1:1)                      
                             stderr:     at Module._compile (node:internal/modules/cjs/loader:1565:14)                                                                                                             
                             stderr:     at Object..js (node:internal/modules/cjs/loader:1708:10)                                                                                                                  
                             stderr:     at Module.load (node:internal/modules/cjs/loader:1318:32) {                                                                                                               
                             stderr:   code: 'MODULE_NOT_FOUND',                                                                                                                                                   
                             stderr:   requireStack: [                                                                                                                                                             
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/hardhat.config.js',                                               
                             stderr:                                                                                                                                                                               
                             '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/core/config/config-loading.js',                 
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/cli/cli.js',                        
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/node_modules/hardhat/internal/cli/bootstrap.js'                   
                             stderr:   ]                                                                                                                                                                           
                             stderr: }                                                                                                                                                                             
[19:37:34] Traceback (most recent call last):                                                                                                                                                          tasks.py:126
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/falcon/falcon.py", line 90, in __init__                                                                     
               crytic_compile = CryticCompile(target, **kwargs)                                                                                                                                                    
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/crytic_compile/crytic_compile.py", line 131, in __init__                                                    
               self._compile(**kwargs)                                                                                                                                                                             
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/crytic_compile/crytic_compile.py", line 553, in _compile                                                    
               self._platform.compile(self, **kwargs)                                                                                                                                                              
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/crytic_compile/platform/hardhat.py", line 183, in compile                                                   
               hardhat_like_parsing(crytic_compile, self._target, build_directory, hardhat_working_dir)                                                                                                            
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/crytic_compile/platform/hardhat.py", line 52, in hardhat_like_parsing                                       
               raise InvalidCompilation(txt)                                                                                                                                                                       
           crytic_compile.platform.exceptions.InvalidCompilation: Compilation failed. Can you run build command?                                                                                                   
           /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/artifacts/build-info is not a directory.                                                         
                                                                                                                                                                                                                   
           During handling of the above exception, another exception occurred:                                                                                                                                     
                                                                                                                                                                                                                   
           Traceback (most recent call last):                                                                                                                                                                      
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 124, in simple_cli                                                                                                         
               falcon_instance = compile_project(source_dir)                                                                                                                                                       
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 103, in compile_project                                                                                                    
               return falcon.Falcon(abs_path)                                                                                                                                                                      
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/falcon/falcon.py", line 94, in __init__                                                                     
               raise FalconError(f"Invalid compilation: \n{str(e)}")                                                                                                                                               
           falcon.exceptions.FalconError: Invalid compilation:                                                                                                                                                     
           Compilation failed. Can you run build command?                                                                                                                                                          
           /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/artifacts/build-info is not a directory.                                                         
                                                                                                                                                                                                                   
           Compile failed.                                                                                                                                                                             tasks.py:127
           Since the compilation is failed, some static analysis tool may not be enabled, which may cause lower precision and recall.                                                                  tasks.py:128
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function deposit(uint256 _amount) external returns (uint256 _mintAmount) {                                                                                                                                  │
│         require(paused == false, "ERROR: PAUSED");                                                                                                                                                              │
│         require(_amount > 0, "ERROR: DEPOSIT_ZERO");                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         //deposit and pay fees                                                                                                                                                                                  │
│         uint256 _liquidity = vault.attributionValue(crowdPool); //get USDC balance with crowdPool's attribution                                                                                                 │
│         uint256 _supply = totalSupply();                                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         crowdPool += vault.addValue(_amount, msg.sender, address(this)); //increase attribution                                                                                                                 │
│                                                                                                                                                                                                                 │
│         if (_supply > 0 && _liquidity > 0) {                                                                                                                                                                    │
│             _mintAmount = (_amount * _supply) / _liquidity;                                                                                                                                                     │
│         } else if (_supply > 0 && _liquidity == 0) {                                                                                                                                                            │
│             //when vault lose all underwritten asset =                                                                                                                                                          │
│             _mintAmount = _amount * _supply; //dilute LP token value af. Start CDS again.                                                                                                                       │
│         } else {                                                                                                                                                                                                │
│             //when _supply == 0,                                                                                                                                                                                │
│             _mintAmount = _amount;                                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         emit Deposit(msg.sender, _amount, _mintAmount);                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         //mint iToken                                                                                                                                                                                           │
│         _mint(msg.sender, _mintAmount);                                                                                                                                                                         │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function deposit(uint256 _amount) external returns (uint256 _mintAmount) {                                                                                                                                  │
│         require(paused == false, "ERROR: PAUSED");                                                                                                                                                              │
│         require(_amount > 0, "ERROR: DEPOSIT_ZERO");                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         //deposit and pay fees                                                                                                                                                                                  │
│         uint256 _liquidity = vault.attributionValue(crowdPool); //get USDC balance with crowdPool's attribution                                                                                                 │
│         uint256 _supply = totalSupply();                                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         crowdPool += vault.addValue(_amount, msg.sender, address(this)); //increase attribution                                                                                                                 │
│                                                                                                                                                                                                                 │
│         if (_supply > 0 && _liquidity > 0) {                                                                                                                                                                    │
│             _mintAmount = (_amount * _supply) / _liquidity;                                                                                                                                                     │
│         } else if (_supply > 0 && _liquidity == 0) {                                                                                                                                                            │
│             //when vault lose all underwritten asset =                                                                                                                                                          │
│             _mintAmount = _amount * _supply; //dilute LP token value af. Start CDS again.                                                                                                                       │
│         } else {                                                                                                                                                                                                │
│             //when _supply == 0,                                                                                                                                                                                │
│             _mintAmount = _amount;                                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         emit Deposit(msg.sender, _amount, _mintAmount);                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         //mint iToken                                                                                                                                                                                           │
│         _mint(msg.sender, _mintAmount);                                                                                                                                                                         │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function requestWithdraw(uint256 _amount) external {                                                                                                                                                        │
│         uint256 _balance = balanceOf(msg.sender);                                                                                                                                                               │
│         require(_balance >= _amount, "ERROR: REQUEST_EXCEED_BALANCE");                                                                                                                                          │
│         require(_amount > 0, "ERROR: REQUEST_ZERO");                                                                                                                                                            │
│         withdrawalReq.timestamp = block.timestamp;                                                                                                                                                              │
│         withdrawalReq.amount = _amount;                                                                                                                                                                         │
│         emit WithdrawRequested(msg.sender, _amount, block.timestamp);                                                                                                                                           │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function withdraw(uint256 _amount) external returns (uint256 _retVal) {                                                                                                                                     │
│         Withdrawal memory request = withdrawalReq;                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         require(paused == false, "ERROR: PAUSED");                                                                                                                                                              │
│         require(                                                                                                                                                                                                │
│             request.timestamp +                                                                                                                                                                                 │
│                 parameters.getLockup(msg.sender) <                                                                                                                                                              │
│                 block.timestamp,                                                                                                                                                                                │
│             "ERROR: WITHDRAWAL_QUEUE"                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             request.timestamp +                                                                                                                                                                                 │
│                 parameters.getLockup(msg.sender) +                                                                                                                                                              │
│                 parameters.getWithdrawable(msg.sender) >                                                                                                                                                        │
│                 block.timestamp,                                                                                                                                                                                │
│             "ERROR: WITHDRAWAL_NO_ACTIVE_REQUEST"                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             request.amount >= _amount,                                                                                                                                                                          │
│             "ERROR: WITHDRAWAL_EXCEEDED_REQUEST"                                                                                                                                                                │
│         );                                                                                                                                                                                                      │
│         require(_amount > 0, "ERROR: WITHDRAWAL_ZERO");                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         //Calculate underlying value                                                                                                                                                                            │
│         _retVal = (vault.attributionValue(crowdPool) * _amount) / totalSupply();                                                                                                                                │
│                                                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         //reduce requested amount                                                                                                                                                                               │
│         request.amount -= _amount;                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         //Burn iToken                                                                                                                                                                                           │
│         _burn(msg.sender, _amount);                                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         //Withdraw liquidity                                                                                                                                                                                    │
│         crowdPool -= vault.withdrawValue(_retVal, msg.sender);                                                                                                                                                  │
│         emit Withdraw(msg.sender, _amount, _retVal);                                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function withdraw(uint256 _amount) external returns (uint256 _retVal) {                                                                                                                                     │
│         Withdrawal memory request = withdrawalReq;                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         require(paused == false, "ERROR: PAUSED");                                                                                                                                                              │
│         require(                                                                                                                                                                                                │
│             request.timestamp +                                                                                                                                                                                 │
│                 parameters.getLockup(msg.sender) <                                                                                                                                                              │
│                 block.timestamp,                                                                                                                                                                                │
│             "ERROR: WITHDRAWAL_QUEUE"                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             request.timestamp +                                                                                                                                                                                 │
│                 parameters.getLockup(msg.sender) +                                                                                                                                                              │
│                 parameters.getWithdrawable(msg.sender) >                                                                                                                                                        │
│                 block.timestamp,                                                                                                                                                                                │
│             "ERROR: WITHDRAWAL_NO_ACTIVE_REQUEST"                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             request.amount >= _amount,                                                                                                                                                                          │
│             "ERROR: WITHDRAWAL_EXCEEDED_REQUEST"                                                                                                                                                                │
│         );                                                                                                                                                                                                      │
│         require(_amount > 0, "ERROR: WITHDRAWAL_ZERO");                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         //Calculate underlying value                                                                                                                                                                            │
│         _retVal = (vault.attributionValue(crowdPool) * _amount) / totalSupply();                                                                                                                                │
│                                                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         //reduce requested amount                                                                                                                                                                               │
│         request.amount -= _amount;                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         //Burn iToken                                                                                                                                                                                           │
│         _burn(msg.sender, _amount);                                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         //Withdraw liquidity                                                                                                                                                                                    │
│         crowdPool -= vault.withdrawValue(_retVal, msg.sender);                                                                                                                                                  │
│         emit Withdraw(msg.sender, _amount, _retVal);                                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function valueOfUnderlying(address _owner) public view returns (uint256) {                                                                                                                                  │
│         uint256 _balance = balanceOf(_owner);                                                                                                                                                                   │
│         if (_balance == 0) {                                                                                                                                                                                    │
│             return 0;                                                                                                                                                                                           │
│         } else {                                                                                                                                                                                                │
│             return                                                                                                                                                                                              │
│                 _balance * vault.attributionValue(crowdPool) / totalSupply();                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function _beforeTokenTransfer(                                                                                                                                                                              │
│         address from,                                                                                                                                                                                           │
│         address to,                                                                                                                                                                                             │
│         uint256 amount                                                                                                                                                                                          │
│     ) internal virtual override {                                                                                                                                                                               │
│         super._beforeTokenTransfer(from, to, amount);                                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         if (from != address(0)) {                                                                                                                                                                               │
│             uint256 _after = balanceOf(from) - amount;                                                                                                                                                          │
│             if (_after < withdrawalReq.amount) {                                                                                                                                                                │
│                 withdrawalReq.amount = _after;                                                                                                                                                                  │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function requestWithdraw(uint256 _amount) external {                                                                                                                                                        │
│         uint256 _balance = balanceOf(msg.sender);                                                                                                                                                               │
│         require(_balance >= _amount, "ERROR: REQUEST_EXCEED_BALANCE");                                                                                                                                          │
│         require(_amount > 0, "ERROR: REQUEST_ZERO");                                                                                                                                                            │
│         withdrawalReq.timestamp = block.timestamp;                                                                                                                                                              │
│         withdrawalReq.amount = _amount;                                                                                                                                                                         │
│         emit WithdrawRequested(msg.sender, _amount, block.timestamp);                                                                                                                                           │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function withdraw(uint256 _amount) external returns (uint256 _retVal) {                                                                                                                                     │
│         uint256 _supply = totalSupply();                                                                                                                                                                        │
│         require(_supply != 0, "ERROR: NO_AVAILABLE_LIQUIDITY");                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         uint256 _liquidity = originalLiquidity();                                                                                                                                                               │
│         _retVal = (_amount * _liquidity) / _supply;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             marketStatus == MarketStatus.Trading,                                                                                                                                                               │
│             "ERROR: WITHDRAWAL_PENDING"                                                                                                                                                                         │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             withdrawalReq.timestamp +                                                                                                                                                                           │
│                 parameters.getLockup(msg.sender) <                                                                                                                                                              │
│                 block.timestamp,                                                                                                                                                                                │
│             "ERROR: WITHDRAWAL_QUEUE"                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             withdrawalReq.timestamp +                                                                                                                                                                           │
│                 parameters.getLockup(msg.sender) +                                                                                                                                                              │
│                 parameters.getWithdrawable(msg.sender) >                                                                                                                                                        │
│                 block.timestamp,                                                                                                                                                                                │
│             "ERROR: WITHDRAWAL_NO_ACTIVE_REQUEST"                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             withdrawalReq.amount >= _amount,                                                                                                                                                                    │
│             "ERROR: WITHDRAWAL_EXCEEDED_REQUEST"                                                                                                                                                                │
│         );                                                                                                                                                                                                      │
│         require(_amount > 0, "ERROR: WITHDRAWAL_ZERO");                                                                                                                                                         │
│         require(                                                                                                                                                                                                │
│             _retVal <= availableBalance(),                                                                                                                                                                      │
│             "ERROR: WITHDRAW_INSUFFICIENT_LIQUIDITY"                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│         //reduce requested amount                                                                                                                                                                               │
│         withdrawalReq.amount -= _amount;                                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         //Burn iToken                                                                                                                                                                                           │
│         _burn(msg.sender, _amount);                                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         //Withdraw liquidity                                                                                                                                                                                    │
│         vault.withdrawValue(_retVal, msg.sender);                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         emit Withdraw(msg.sender, _amount, _retVal);                                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function withdraw(uint256 _amount) external returns (uint256 _retVal) {                                                                                                                                     │
│         uint256 _supply = totalSupply();                                                                                                                                                                        │
│         require(_supply != 0, "ERROR: NO_AVAILABLE_LIQUIDITY");                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         uint256 _liquidity = originalLiquidity();                                                                                                                                                               │
│         _retVal = (_amount * _liquidity) / _supply;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             marketStatus == MarketStatus.Trading,                                                                                                                                                               │
│             "ERROR: WITHDRAWAL_PENDING"                                                                                                                                                                         │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             withdrawalReq.timestamp +                                                                                                                                                                           │
│                 parameters.getLockup(msg.sender) <                                                                                                                                                              │
│                 block.timestamp,                                                                                                                                                                                │
│             "ERROR: WITHDRAWAL_QUEUE"                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             withdrawalReq.timestamp +                                                                                                                                                                           │
│                 parameters.getLockup(msg.sender) +                                                                                                                                                              │
│                 parameters.getWithdrawable(msg.sender) >                                                                                                                                                        │
│                 block.timestamp,                                                                                                                                                                                │
│             "ERROR: WITHDRAWAL_NO_ACTIVE_REQUEST"                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             withdrawalReq.amount >= _amount,                                                                                                                                                                    │
│             "ERROR: WITHDRAWAL_EXCEEDED_REQUEST"                                                                                                                                                                │
│         );                                                                                                                                                                                                      │
│         require(_amount > 0, "ERROR: WITHDRAWAL_ZERO");                                                                                                                                                         │
│         require(                                                                                                                                                                                                │
│             _retVal <= availableBalance(),                                                                                                                                                                      │
│             "ERROR: WITHDRAW_INSUFFICIENT_LIQUIDITY"                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│         //reduce requested amount                                                                                                                                                                               │
│         withdrawalReq.amount -= _amount;                                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         //Burn iToken                                                                                                                                                                                           │
│         _burn(msg.sender, _amount);                                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         //Withdraw liquidity                                                                                                                                                                                    │
│         vault.withdrawValue(_retVal, msg.sender);                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         emit Withdraw(msg.sender, _amount, _retVal);                                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function withdrawCredit(uint256 _credit)                                                                                                                                                                    │
│         external                                                                                                                                                                                                │
│         override                                                                                                                                                                                                │
│         returns (uint256 _pending)                                                                                                                                                                              │
│     {                                                                                                                                                                                                           │
│         IndexInfo storage _index = indicies;                                                                                                                                                                    │
│         uint256 _rewardPerCredit = rewardPerCredit;                                                                                                                                                             │
│         require(                                                                                                                                                                                                │
│             IRegistry(registry).isListed(msg.sender) &&                                                                                                                                                         │
│                 _index.credit >= _credit &&                                                                                                                                                                     │
│                 _credit <= availableBalance(),                                                                                                                                                                  │
│             "ERROR: WITHDRAW_CREDIT_BAD_CONDITIONS"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         //calculate acrrued premium                                                                                                                                                                             │
│         _pending = _sub(                                                                                                                                                                                        │
│             (_index.credit * _rewardPerCredit) / MAGIC_SCALE_1E6,                                                                                                                                               │
│             _index.rewardDebt                                                                                                                                                                                   │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         //Withdraw liquidity                                                                                                                                                                                    │
│         if (_credit > 0) {                                                                                                                                                                                      │
│             totalCredit -= _credit;                                                                                                                                                                             │
│             _index.credit -= _credit;                                                                                                                                                                           │
│             emit CreditDecrease(msg.sender, _credit);                                                                                                                                                           │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         //withdraw acrrued premium                                                                                                                                                                              │
│         if (_pending > 0) {                                                                                                                                                                                     │
│             vault.transferAttribution(_pending, msg.sender);                                                                                                                                                    │
│             attributionDebt -= _pending;                                                                                                                                                                        │
│             _index.rewardDebt =                                                                                                                                                                                 │
│                 (_index.credit * _rewardPerCredit) /                                                                                                                                                            │
│                 MAGIC_SCALE_1E6;                                                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function _adjustAlloc(uint256 _liquidity) internal {                                                                                                                                                        │
│         //Check current leverage rate and get target total credit allocation                                                                                                                                    │
│         uint256 _targetCredit = (targetLev * _liquidity) / MAGIC_SCALE_1E6;                                                                                                                                     │
│         uint256 _allocatable = _targetCredit;                                                                                                                                                                   │
│         uint256 _allocatablePoints = totalAllocPoint;                                                                                                                                                           │
│         uint256 _length = poolList.length;                                                                                                                                                                      │
│         PoolStatus[] memory _poolList = new PoolStatus[](_length);                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         //Check each pool and if current credit allocation > target && it is impossible to adjust, then withdraw all availablle credit                                                                          │
│         for (uint256 i = 0; i < _length; i++) {                                                                                                                                                                 │
│             address _pool = poolList;                                                                                                                                                                           │
│             if (_pool != address(0)) {                                                                                                                                                                          │
│                 uint256 _allocation = allocPoints[_pool];                                                                                                                                                       │
│                 //Target credit allocation for a pool                                                                                                                                                           │
│                 uint256 _target = (_targetCredit * _allocation) /                                                                                                                                               │
│                     _allocatablePoints;                                                                                                                                                                         │
│                 //get how much has been allocated for a pool                                                                                                                                                    │
│                 uint256 _current = IPoolTemplate(_pool).allocatedCredit(                                                                                                                                        │
│                     address(this)                                                                                                                                                                               │
│                 );                                                                                                                                                                                              │
│                 //get how much liquidty is available to withdraw                                                                                                                                                │
│                 uint256 _available = IPoolTemplate(_pool).availableBalance();                                                                                                                                   │
│                 //if needed to withdraw credit but unable, then withdraw all available.                                                                                                                         │
│                 //Otherwise, skip.                                                                                                                                                                              │
│                 if (                                                                                                                                                                                            │
│                     (_current > _target && _current - _target > _available) ||                                                                                                                                  │
│                     IPoolTemplate(_pool).paused() == true                                                                                                                                                       │
│                 ) {                                                                                                                                                                                             │
│                     IPoolTemplate(_pool).withdrawCredit(_available);                                                                                                                                            │
│                     totalAllocatedCredit -= _available;                                                                                                                                                         │
│                     _poolList.addr = address(0);                                                                                                                                                                │
│                     _allocatable -= _current - _available;                                                                                                                                                      │
│                     _allocatablePoints -= _allocation;                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     _poolList.addr = _pool;                                                                                                                                                                     │
│                     _poolList.current = _current;                                                                                                                                                               │
│                     _poolList.available = _available;                                                                                                                                                           │
│                     _poolList.allocation = _allocation;                                                                                                                                                         │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         //Check pools that was not falling under the previous criteria, then adjust to meet the target credit allocation.                                                                                       │
│         for (uint256 i = 0; i < _length; i++) {                                                                                                                                                                 │
│             if (_poolList.addr != address(0)) {                                                                                                                                                                 │
│                 //Target credit allocation for a pool                                                                                                                                                           │
│                 uint256 _target = (_allocatable * _poolList.allocation) /                                                                                                                                       │
│                     _allocatablePoints;                                                                                                                                                                         │
│                 //get how much has been allocated for a pool                                                                                                                                                    │
│                 uint256 _current = _poolList.current;                                                                                                                                                           │
│                 //get how much liquidty is available to withdraw                                                                                                                                                │
│                 uint256 _available = _poolList.available;                                                                                                                                                       │
│                 //Withdraw or Deposit credit                                                                                                                                                                    │
│                 if (_current > _target && _available != 0) {                                                                                                                                                    │
│                     //if allocated credit is higher than the target, try to decrease                                                                                                                            │
│                     uint256 _decrease = _current - _target;                                                                                                                                                     │
│                     IPoolTemplate(_poolList.addr).withdrawCredit(_decrease);                                                                                                                                    │
│                     totalAllocatedCredit -= _decrease;                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 if (_current < _target) {                                                                                                                                                                       │
│                     //Sometimes we need to allocate more                                                                                                                                                        │
│                     uint256 _allocate = _target - _current;                                                                                                                                                     │
│                     IPoolTemplate(_poolList.addr).allocateCredit(_allocate);                                                                                                                                    │
│                     totalAllocatedCredit += _allocate;                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 if (_current == _target) {                                                                                                                                                                      │
│                     IPoolTemplate(_poolList.addr).allocateCredit(0);                                                                                                                                            │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function withdrawCredit(uint256 _credit)                                                                                                                                                                    │
│         external                                                                                                                                                                                                │
│         override                                                                                                                                                                                                │
│         returns (uint256 _pending)                                                                                                                                                                              │
│     {                                                                                                                                                                                                           │
│         IndexInfo storage _index = indicies;                                                                                                                                                                    │
│         uint256 _rewardPerCredit = rewardPerCredit;                                                                                                                                                             │
│         require(                                                                                                                                                                                                │
│             IRegistry(registry).isListed(msg.sender) &&                                                                                                                                                         │
│                 _index.credit >= _credit &&                                                                                                                                                                     │
│                 _credit <= availableBalance(),                                                                                                                                                                  │
│             "ERROR: WITHDRAW_CREDIT_BAD_CONDITIONS"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         //calculate acrrued premium                                                                                                                                                                             │
│         _pending = _sub(                                                                                                                                                                                        │
│             (_index.credit * _rewardPerCredit) / MAGIC_SCALE_1E6,                                                                                                                                               │
│             _index.rewardDebt                                                                                                                                                                                   │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         //Withdraw liquidity                                                                                                                                                                                    │
│         if (_credit > 0) {                                                                                                                                                                                      │
│             totalCredit -= _credit;                                                                                                                                                                             │
│             _index.credit -= _credit;                                                                                                                                                                           │
│             emit CreditDecrease(msg.sender, _credit);                                                                                                                                                           │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         //withdraw acrrued premium                                                                                                                                                                              │
│         if (_pending > 0) {                                                                                                                                                                                     │
│             vault.transferAttribution(_pending, msg.sender);                                                                                                                                                    │
│             attributionDebt -= _pending;                                                                                                                                                                        │
│             _index.rewardDebt =                                                                                                                                                                                 │
│                 (_index.credit * _rewardPerCredit) /                                                                                                                                                            │
│                 MAGIC_SCALE_1E6;                                                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function _adjustAlloc(uint256 _liquidity) internal {                                                                                                                                                        │
│         //Check current leverage rate and get target total credit allocation                                                                                                                                    │
│         uint256 _targetCredit = (targetLev * _liquidity) / MAGIC_SCALE_1E6;                                                                                                                                     │
│         uint256 _allocatable = _targetCredit;                                                                                                                                                                   │
│         uint256 _allocatablePoints = totalAllocPoint;                                                                                                                                                           │
│         uint256 _length = poolList.length;                                                                                                                                                                      │
│         PoolStatus[] memory _poolList = new PoolStatus[](_length);                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         //Check each pool and if current credit allocation > target && it is impossible to adjust, then withdraw all availablle credit                                                                          │
│         for (uint256 i = 0; i < _length; i++) {                                                                                                                                                                 │
│             address _pool = poolList;                                                                                                                                                                           │
│             if (_pool != address(0)) {                                                                                                                                                                          │
│                 uint256 _allocation = allocPoints[_pool];                                                                                                                                                       │
│                 //Target credit allocation for a pool                                                                                                                                                           │
│                 uint256 _target = (_targetCredit * _allocation) /                                                                                                                                               │
│                     _allocatablePoints;                                                                                                                                                                         │
│                 //get how much has been allocated for a pool                                                                                                                                                    │
│                 uint256 _current = IPoolTemplate(_pool).allocatedCredit(                                                                                                                                        │
│                     address(this)                                                                                                                                                                               │
│                 );                                                                                                                                                                                              │
│                 //get how much liquidty is available to withdraw                                                                                                                                                │
│                 uint256 _available = IPoolTemplate(_pool).availableBalance();                                                                                                                                   │
│                 //if needed to withdraw credit but unable, then withdraw all available.                                                                                                                         │
│                 //Otherwise, skip.                                                                                                                                                                              │
│                 if (                                                                                                                                                                                            │
│                     (_current > _target && _current - _target > _available) ||                                                                                                                                  │
│                     IPoolTemplate(_pool).paused() == true                                                                                                                                                       │
│                 ) {                                                                                                                                                                                             │
│                     IPoolTemplate(_pool).withdrawCredit(_available);                                                                                                                                            │
│                     totalAllocatedCredit -= _available;                                                                                                                                                         │
│                     _poolList.addr = address(0);                                                                                                                                                                │
│                     _allocatable -= _current - _available;                                                                                                                                                      │
│                     _allocatablePoints -= _allocation;                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     _poolList.addr = _pool;                                                                                                                                                                     │
│                     _poolList.current = _current;                                                                                                                                                               │
│                     _poolList.available = _available;                                                                                                                                                           │
│                     _poolList.allocation = _allocation;                                                                                                                                                         │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         //Check pools that was not falling under the previous criteria, then adjust to meet the target credit allocation.                                                                                       │
│         for (uint256 i = 0; i < _length; i++) {                                                                                                                                                                 │
│             if (_poolList.addr != address(0)) {                                                                                                                                                                 │
│                 //Target credit allocation for a pool                                                                                                                                                           │
│                 uint256 _target = (_allocatable * _poolList.allocation) /                                                                                                                                       │
│                     _allocatablePoints;                                                                                                                                                                         │
│                 //get how much has been allocated for a pool                                                                                                                                                    │
│                 uint256 _current = _poolList.current;                                                                                                                                                           │
│                 //get how much liquidty is available to withdraw                                                                                                                                                │
│                 uint256 _available = _poolList.available;                                                                                                                                                       │
│                 //Withdraw or Deposit credit                                                                                                                                                                    │
│                 if (_current > _target && _available != 0) {                                                                                                                                                    │
│                     //if allocated credit is higher than the target, try to decrease                                                                                                                            │
│                     uint256 _decrease = _current - _target;                                                                                                                                                     │
│                     IPoolTemplate(_poolList.addr).withdrawCredit(_decrease);                                                                                                                                    │
│                     totalAllocatedCredit -= _decrease;                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 if (_current < _target) {                                                                                                                                                                       │
│                     //Sometimes we need to allocate more                                                                                                                                                        │
│                     uint256 _allocate = _target - _current;                                                                                                                                                     │
│                     IPoolTemplate(_poolList.addr).allocateCredit(_allocate);                                                                                                                                    │
│                     totalAllocatedCredit += _allocate;                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 if (_current == _target) {                                                                                                                                                                      │
│                     IPoolTemplate(_poolList.addr).allocateCredit(0);                                                                                                                                            │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function withdrawCredit(uint256 _credit)                                                                                                                                                                    │
│         external                                                                                                                                                                                                │
│         override                                                                                                                                                                                                │
│         returns (uint256 _pending)                                                                                                                                                                              │
│     {                                                                                                                                                                                                           │
│         IndexInfo storage _index = indicies;                                                                                                                                                                    │
│         uint256 _rewardPerCredit = rewardPerCredit;                                                                                                                                                             │
│         require(                                                                                                                                                                                                │
│             IRegistry(registry).isListed(msg.sender) &&                                                                                                                                                         │
│                 _index.credit >= _credit &&                                                                                                                                                                     │
│                 _credit <= availableBalance(),                                                                                                                                                                  │
│             "ERROR: WITHDRAW_CREDIT_BAD_CONDITIONS"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         //calculate acrrued premium                                                                                                                                                                             │
│         _pending = _sub(                                                                                                                                                                                        │
│             (_index.credit * _rewardPerCredit) / MAGIC_SCALE_1E6,                                                                                                                                               │
│             _index.rewardDebt                                                                                                                                                                                   │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         //Withdraw liquidity                                                                                                                                                                                    │
│         if (_credit > 0) {                                                                                                                                                                                      │
│             totalCredit -= _credit;                                                                                                                                                                             │
│             _index.credit -= _credit;                                                                                                                                                                           │
│             emit CreditDecrease(msg.sender, _credit);                                                                                                                                                           │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         //withdraw acrrued premium                                                                                                                                                                              │
│         if (_pending > 0) {                                                                                                                                                                                     │
│             vault.transferAttribution(_pending, msg.sender);                                                                                                                                                    │
│             attributionDebt -= _pending;                                                                                                                                                                        │
│             _index.rewardDebt =                                                                                                                                                                                 │
│                 (_index.credit * _rewardPerCredit) /                                                                                                                                                            │
│                 MAGIC_SCALE_1E6;                                                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function insure(                                                                                                                                                                                            │
│         uint256 _amount,                                                                                                                                                                                        │
│         uint256 _maxCost,                                                                                                                                                                                       │
│         uint256 _span,                                                                                                                                                                                          │
│         bytes32 _target                                                                                                                                                                                         │
│     ) external returns (uint256) {                                                                                                                                                                              │
│         //Distribute premium and fee                                                                                                                                                                            │
│         uint256 _endTime = _span + block.timestamp;                                                                                                                                                             │
│         uint256 _premium = getPremium(_amount, _span);                                                                                                                                                          │
│         uint256 _fee = parameters.getFeeRate(msg.sender);                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             _amount <= availableBalance(),                                                                                                                                                                      │
│             "ERROR: INSURE_EXCEEDED_AVAILABLE_BALANCE"                                                                                                                                                          │
│         );                                                                                                                                                                                                      │
│         require(_premium <= _maxCost, "ERROR: INSURE_EXCEEDED_MAX_COST");                                                                                                                                       │
│         require(_span <= 365 days, "ERROR: INSURE_EXCEEDED_MAX_SPAN");                                                                                                                                          │
│         require(                                                                                                                                                                                                │
│             parameters.getMinDate(msg.sender) <= _span,                                                                                                                                                         │
│             "ERROR: INSURE_SPAN_BELOW_MIN"                                                                                                                                                                      │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             marketStatus == MarketStatus.Trading,                                                                                                                                                               │
│             "ERROR: INSURE_MARKET_PENDING"                                                                                                                                                                      │
│         );                                                                                                                                                                                                      │
│         require(paused == false, "ERROR: INSURE_MARKET_PAUSED");                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         //current liquidity                                                                                                                                                                                     │
│         uint256 _liquidity = totalLiquidity();                                                                                                                                                                  │
│         uint256 _totalCredit = totalCredit;                                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         //accrue premium/fee                                                                                                                                                                                    │
│         uint256[2] memory _newAttribution = vault.addValueBatch(                                                                                                                                                │
│             _premium,                                                                                                                                                                                           │
│             msg.sender,                                                                                                                                                                                         │
│             ,                                                                                                                                                                                                   │
│             [MAGIC_SCALE_1E6 - _fee, _fee]                                                                                                                                                                      │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         //Lock covered amount                                                                                                                                                                                   │
│         uint256 _id = allInsuranceCount;                                                                                                                                                                        │
│         lockedAmount += _amount;                                                                                                                                                                                │
│         Insurance memory _insurance = Insurance(                                                                                                                                                                │
│             _id,                                                                                                                                                                                                │
│             block.timestamp,                                                                                                                                                                                    │
│             _endTime,                                                                                                                                                                                           │
│             _amount,                                                                                                                                                                                            │
│             _target,                                                                                                                                                                                            │
│             msg.sender,                                                                                                                                                                                         │
│             true                                                                                                                                                                                                │
│         );                                                                                                                                                                                                      │
│         insurances[_id] = _insurance;                                                                                                                                                                           │
│         allInsuranceCount += 1;                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         //Calculate liquidity for index                                                                                                                                                                         │
│         if (_totalCredit > 0) {                                                                                                                                                                                 │
│             uint256 _attributionForIndex = (_newAttribution[0] * _totalCredit) /                                                                                                                                │
│                 _liquidity;                                                                                                                                                                                     │
│             attributionDebt += _attributionForIndex;                                                                                                                                                            │
│             rewardPerCredit += ((_attributionForIndex * MAGIC_SCALE_1E6) /                                                                                                                                      │
│                 _totalCredit);                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         emit Insured(                                                                                                                                                                                           │
│             _id,                                                                                                                                                                                                │
│             _amount,                                                                                                                                                                                            │
│             _target,                                                                                                                                                                                            │
│             block.timestamp,                                                                                                                                                                                    │
│             _endTime,                                                                                                                                                                                           │
│             msg.sender,                                                                                                                                                                                         │
│             _premium                                                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         return _id;                                                                                                                                                                                             │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function insure(                                                                                                                                                                                            │
│         uint256 _amount,                                                                                                                                                                                        │
│         uint256 _maxCost,                                                                                                                                                                                       │
│         uint256 _span,                                                                                                                                                                                          │
│         bytes32 _target                                                                                                                                                                                         │
│     ) external returns (uint256) {                                                                                                                                                                              │
│         //Distribute premium and fee                                                                                                                                                                            │
│         uint256 _endTime = _span + block.timestamp;                                                                                                                                                             │
│         uint256 _premium = getPremium(_amount, _span);                                                                                                                                                          │
│         uint256 _fee = parameters.getFeeRate(msg.sender);                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             _amount <= availableBalance(),                                                                                                                                                                      │
│             "ERROR: INSURE_EXCEEDED_AVAILABLE_BALANCE"                                                                                                                                                          │
│         );                                                                                                                                                                                                      │
│         require(_premium <= _maxCost, "ERROR: INSURE_EXCEEDED_MAX_COST");                                                                                                                                       │
│         require(_span <= 365 days, "ERROR: INSURE_EXCEEDED_MAX_SPAN");                                                                                                                                          │
│         require(                                                                                                                                                                                                │
│             parameters.getMinDate(msg.sender) <= _span,                                                                                                                                                         │
│             "ERROR: INSURE_SPAN_BELOW_MIN"                                                                                                                                                                      │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             marketStatus == MarketStatus.Trading,                                                                                                                                                               │
│             "ERROR: INSURE_MARKET_PENDING"                                                                                                                                                                      │
│         );                                                                                                                                                                                                      │
│         require(paused == false, "ERROR: INSURE_MARKET_PAUSED");                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         //current liquidity                                                                                                                                                                                     │
│         uint256 _liquidity = totalLiquidity();                                                                                                                                                                  │
│         uint256 _totalCredit = totalCredit;                                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         //accrue premium/fee                                                                                                                                                                                    │
│         uint256[2] memory _newAttribution = vault.addValueBatch(                                                                                                                                                │
│             _premium,                                                                                                                                                                                           │
│             msg.sender,                                                                                                                                                                                         │
│             ,                                                                                                                                                                                                   │
│             [MAGIC_SCALE_1E6 - _fee, _fee]                                                                                                                                                                      │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         //Lock covered amount                                                                                                                                                                                   │
│         uint256 _id = allInsuranceCount;                                                                                                                                                                        │
│         lockedAmount += _amount;                                                                                                                                                                                │
│         Insurance memory _insurance = Insurance(                                                                                                                                                                │
│             _id,                                                                                                                                                                                                │
│             block.timestamp,                                                                                                                                                                                    │
│             _endTime,                                                                                                                                                                                           │
│             _amount,                                                                                                                                                                                            │
│             _target,                                                                                                                                                                                            │
│             msg.sender,                                                                                                                                                                                         │
│             true                                                                                                                                                                                                │
│         );                                                                                                                                                                                                      │
│         insurances[_id] = _insurance;                                                                                                                                                                           │
│         allInsuranceCount += 1;                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         //Calculate liquidity for index                                                                                                                                                                         │
│         if (_totalCredit > 0) {                                                                                                                                                                                 │
│             uint256 _attributionForIndex = (_newAttribution[0] * _totalCredit) /                                                                                                                                │
│                 _liquidity;                                                                                                                                                                                     │
│             attributionDebt += _attributionForIndex;                                                                                                                                                            │
│             rewardPerCredit += ((_attributionForIndex * MAGIC_SCALE_1E6) /                                                                                                                                      │
│                 _totalCredit);                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         emit Insured(                                                                                                                                                                                           │
│             _id,                                                                                                                                                                                                │
│             _amount,                                                                                                                                                                                            │
│             _target,                                                                                                                                                                                            │
│             block.timestamp,                                                                                                                                                                                    │
│             _endTime,                                                                                                                                                                                           │
│             msg.sender,                                                                                                                                                                                         │
│             _premium                                                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         return _id;                                                                                                                                                                                             │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function resume() external {                                                                                                                                                                                │
│         require(                                                                                                                                                                                                │
│             marketStatus == MarketStatus.Payingout &&                                                                                                                                                           │
│                 pendingEnd < block.timestamp,                                                                                                                                                                   │
│             "ERROR: UNABLE_TO_RESUME"                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint256 _debt = vault.debts(address(this));                                                                                                                                                             │
│         uint256 _totalCredit = totalCredit;                                                                                                                                                                     │
│         uint256 _deductionFromIndex = (_debt * _totalCredit * MAGIC_SCALE_1E6) /                                                                                                                                │
│             totalLiquidity();                                                                                                                                                                                   │
│         uint256 _actualDeduction;                                                                                                                                                                               │
│         for (uint256 i = 0; i < indexList.length; i++) {                                                                                                                                                        │
│             address _index = indexList;                                                                                                                                                                         │
│             uint256 _credit = indicies[_index].credit;                                                                                                                                                          │
│             if (_credit > 0) {                                                                                                                                                                                  │
│                 uint256 _shareOfIndex = (_credit * MAGIC_SCALE_1E6) /                                                                                                                                           │
│                     _totalCredit;                                                                                                                                                                               │
│                 uint256 _redeemAmount = _divCeil(                                                                                                                                                               │
│                     _deductionFromIndex,                                                                                                                                                                        │
│                     _shareOfIndex                                                                                                                                                                               │
│                 );                                                                                                                                                                                              │
│                 _actualDeduction += IIndexTemplate(_index).compensate(                                                                                                                                          │
│                     _redeemAmount                                                                                                                                                                               │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 _deductionFromPool = _debt -                                                                                                                                                                    │
│             _deductionFromIndex /                                                                                                                                                                               │
│             MAGIC_SCALE_1E6;                                                                                                                                                                                    │
│         uint256 _shortage = _deductionFromIndex /                                                                                                                                                               │
│             MAGIC_SCALE_1E6 -                                                                                                                                                                                   │
│             _actualDeduction;                                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         if (_deductionFromPool > 0) {                                                                                                                                                                           │
│             vault.offsetDebt(_deductionFromPool, address(this));                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         vault.transferDebt(_shortage);                                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         marketStatus = MarketStatus.Trading;                                                                                                                                                                    │
│         emit MarketStatusChanged(MarketStatus.Trading);                                                                                                                                                         │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function valueOfUnderlying(address _owner)                                                                                                                                                                  │
│         public                                                                                                                                                                                                  │
│         view                                                                                                                                                                                                    │
│         override                                                                                                                                                                                                │
│         returns (uint256)                                                                                                                                                                                       │
│     {                                                                                                                                                                                                           │
│         uint256 _balance = balanceOf(_owner);                                                                                                                                                                   │
│         if (_balance == 0) {                                                                                                                                                                                    │
│             return 0;                                                                                                                                                                                           │
│         } else {                                                                                                                                                                                                │
│             return (_balance * originalLiquidity()) / totalSupply();                                                                                                                                            │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function worth(uint256 _value) public view returns (uint256 _amount) {                                                                                                                                      │
│         uint256 _supply = totalSupply();                                                                                                                                                                        │
│         uint256 _originalLiquidity = originalLiquidity();                                                                                                                                                       │
│         if (_supply > 0 && _originalLiquidity > 0) {                                                                                                                                                            │
│             _amount = (_value * _supply) / _originalLiquidity;                                                                                                                                                  │
│         } else if (_supply > 0 && _originalLiquidity == 0) {                                                                                                                                                    │
│             _amount = _value * _supply;                                                                                                                                                                         │
│         } else {                                                                                                                                                                                                │
│             _amount = _value;                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function _depositFrom(uint256 _amount, address _from)                                                                                                                                                       │
│         internal                                                                                                                                                                                                │
│         returns (uint256 _mintAmount)                                                                                                                                                                           │
│     {                                                                                                                                                                                                           │
│         require(                                                                                                                                                                                                │
│             marketStatus == MarketStatus.Trading && paused == false,                                                                                                                                            │
│             "ERROR: DEPOSIT_DISABLED"                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│         require(_amount > 0, "ERROR: DEPOSIT_ZERO");                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         _mintAmount = worth(_amount);                                                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         vault.addValue(_amount, _from, address(this));                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         emit Deposit(_from, _amount, _mintAmount);                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         //mint iToken                                                                                                                                                                                           │
│         _mint(_from, _mintAmount);                                                                                                                                                                              │
│     }                                                                                                                                                                                                           │
│     function worth(uint256 _value) public view returns (uint256 _amount) {                                                                                                                                      │
│         uint256 _supply = totalSupply();                                                                                                                                                                        │
│         uint256 _originalLiquidity = originalLiquidity();                                                                                                                                                       │
│         if (_supply > 0 && _originalLiquidity > 0) {                                                                                                                                                            │
│             _amount = (_value * _supply) / _originalLiquidity;                                                                                                                                                  │
│         } else if (_supply > 0 && _originalLiquidity == 0) {                                                                                                                                                    │
│             _amount = _value * _supply;                                                                                                                                                                         │
│         } else {                                                                                                                                                                                                │
│             _amount = _value;                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes",                                                                                                                                                                                                 │
│     "2": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price based on the market reserves/AMMprice/exchangeRate OR the custom token balanceOf/totalSupply/amount/liquidity calculation          │
│ Code:                                                                                                                                                                                                           │
│     function _depositFrom(uint256 _amount, address _from)                                                                                                                                                       │
│         internal                                                                                                                                                                                                │
│         returns (uint256 _mintAmount)                                                                                                                                                                           │
│     {                                                                                                                                                                                                           │
│         require(                                                                                                                                                                                                │
│             marketStatus == MarketStatus.Trading && paused == false,                                                                                                                                            │
│             "ERROR: DEPOSIT_DISABLED"                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│         require(_amount > 0, "ERROR: DEPOSIT_ZERO");                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         _mintAmount = worth(_amount);                                                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         vault.addValue(_amount, _from, address(this));                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         emit Deposit(_from, _amount, _mintAmount);                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         //mint iToken                                                                                                                                                                                           │
│         _mint(_from, _mintAmount);                                                                                                                                                                              │
│     }                                                                                                                                                                                                           │
│     function worth(uint256 _value) public view returns (uint256 _amount) {                                                                                                                                      │
│         uint256 _supply = totalSupply();                                                                                                                                                                        │
│         uint256 _originalLiquidity = originalLiquidity();                                                                                                                                                       │
│         if (_supply > 0 && _originalLiquidity > 0) {                                                                                                                                                            │
│             _amount = (_value * _supply) / _originalLiquidity;                                                                                                                                                  │
│         } else if (_supply > 0 && _originalLiquidity == 0) {                                                                                                                                                    │
│             _amount = _value * _supply;                                                                                                                                                                         │
│         } else {                                                                                                                                                                                                │
│             _amount = _value;                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function _depositFrom(uint256 _amount, address _from)                                                                                                                                                       │
│         internal                                                                                                                                                                                                │
│         returns (uint256 _mintAmount)                                                                                                                                                                           │
│     {                                                                                                                                                                                                           │
│         require(                                                                                                                                                                                                │
│             marketStatus == MarketStatus.Trading && paused == false,                                                                                                                                            │
│             "ERROR: DEPOSIT_DISABLED"                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│         require(_amount > 0, "ERROR: DEPOSIT_ZERO");                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         _mintAmount = worth(_amount);                                                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         vault.addValue(_amount, _from, address(this));                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         emit Deposit(_from, _amount, _mintAmount);                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         //mint iToken                                                                                                                                                                                           │
│         _mint(_from, _mintAmount);                                                                                                                                                                              │
│     }                                                                                                                                                                                                           │
│     function worth(uint256 _value) public view returns (uint256 _amount) {                                                                                                                                      │
│         uint256 _supply = totalSupply();                                                                                                                                                                        │
│         uint256 _originalLiquidity = originalLiquidity();                                                                                                                                                       │
│         if (_supply > 0 && _originalLiquidity > 0) {                                                                                                                                                            │
│             _amount = (_value * _supply) / _originalLiquidity;                                                                                                                                                  │
│         } else if (_supply > 0 && _originalLiquidity == 0) {                                                                                                                                                    │
│             _amount = _value * _supply;                                                                                                                                                                         │
│         } else {                                                                                                                                                                                                │
│             _amount = _value;                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function deposit(uint256 _amount) public returns (uint256 _mintAmount) {                                                                                                                                    │
│         require(                                                                                                                                                                                                │
│             marketStatus == MarketStatus.Trading && paused == false,                                                                                                                                            │
│             "ERROR: DEPOSIT_DISABLED"                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│         require(_amount > 0, "ERROR: DEPOSIT_ZERO");                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         _mintAmount = worth(_amount);                                                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         vault.addValue(_amount, msg.sender, address(this));                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         emit Deposit(msg.sender, _amount, _mintAmount);                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         //mint iToken                                                                                                                                                                                           │
│         _mint(msg.sender, _mintAmount);                                                                                                                                                                         │
│     }                                                                                                                                                                                                           │
│     function worth(uint256 _value) public view returns (uint256 _amount) {                                                                                                                                      │
│         uint256 _supply = totalSupply();                                                                                                                                                                        │
│         uint256 _originalLiquidity = originalLiquidity();                                                                                                                                                       │
│         if (_supply > 0 && _originalLiquidity > 0) {                                                                                                                                                            │
│             _amount = (_value * _supply) / _originalLiquidity;                                                                                                                                                  │
│         } else if (_supply > 0 && _originalLiquidity == 0) {                                                                                                                                                    │
│             _amount = _value * _supply;                                                                                                                                                                         │
│         } else {                                                                                                                                                                                                │
│             _amount = _value;                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes",                                                                                                                                                                                                 │
│     "2": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price based on the market reserves/AMMprice/exchangeRate OR the custom token balanceOf/totalSupply/amount/liquidity calculation          │
│ Code:                                                                                                                                                                                                           │
│     function deposit(uint256 _amount) public returns (uint256 _mintAmount) {                                                                                                                                    │
│         require(                                                                                                                                                                                                │
│             marketStatus == MarketStatus.Trading && paused == false,                                                                                                                                            │
│             "ERROR: DEPOSIT_DISABLED"                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│         require(_amount > 0, "ERROR: DEPOSIT_ZERO");                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         _mintAmount = worth(_amount);                                                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         vault.addValue(_amount, msg.sender, address(this));                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         emit Deposit(msg.sender, _amount, _mintAmount);                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         //mint iToken                                                                                                                                                                                           │
│         _mint(msg.sender, _mintAmount);                                                                                                                                                                         │
│     }                                                                                                                                                                                                           │
│     function worth(uint256 _value) public view returns (uint256 _amount) {                                                                                                                                      │
│         uint256 _supply = totalSupply();                                                                                                                                                                        │
│         uint256 _originalLiquidity = originalLiquidity();                                                                                                                                                       │
│         if (_supply > 0 && _originalLiquidity > 0) {                                                                                                                                                            │
│             _amount = (_value * _supply) / _originalLiquidity;                                                                                                                                                  │
│         } else if (_supply > 0 && _originalLiquidity == 0) {                                                                                                                                                    │
│             _amount = _value * _supply;                                                                                                                                                                         │
│         } else {                                                                                                                                                                                                │
│             _amount = _value;                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function deposit(uint256 _amount) public returns (uint256 _mintAmount) {                                                                                                                                    │
│         require(                                                                                                                                                                                                │
│             marketStatus == MarketStatus.Trading && paused == false,                                                                                                                                            │
│             "ERROR: DEPOSIT_DISABLED"                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│         require(_amount > 0, "ERROR: DEPOSIT_ZERO");                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         _mintAmount = worth(_amount);                                                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         vault.addValue(_amount, msg.sender, address(this));                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         emit Deposit(msg.sender, _amount, _mintAmount);                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         //mint iToken                                                                                                                                                                                           │
│         _mint(msg.sender, _mintAmount);                                                                                                                                                                         │
│     }                                                                                                                                                                                                           │
│     function worth(uint256 _value) public view returns (uint256 _amount) {                                                                                                                                      │
│         uint256 _supply = totalSupply();                                                                                                                                                                        │
│         uint256 _originalLiquidity = originalLiquidity();                                                                                                                                                       │
│         if (_supply > 0 && _originalLiquidity > 0) {                                                                                                                                                            │
│             _amount = (_value * _supply) / _originalLiquidity;                                                                                                                                                  │
│         } else if (_supply > 0 && _originalLiquidity == 0) {                                                                                                                                                    │
│             _amount = _value * _supply;                                                                                                                                                                         │
│         } else {                                                                                                                                                                                                │
│             _amount = _value;                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function _beforeTokenTransfer(                                                                                                                                                                              │
│         address from,                                                                                                                                                                                           │
│         address to,                                                                                                                                                                                             │
│         uint256 amount                                                                                                                                                                                          │
│     ) internal virtual override {                                                                                                                                                                               │
│         super._beforeTokenTransfer(from, to, amount);                                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         if (from != address(0)) {                                                                                                                                                                               │
│             uint256 _after = balanceOf(from) - amount;                                                                                                                                                          │
│             if (_after < withdrawalReq.amount) {                                                                                                                                                                │
│                 withdrawalReq.amount = _after;                                                                                                                                                                  │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function deposit(uint256 _amount) public returns (uint256 _mintAmount) {                                                                                                                                    │
│         require(locked == false && paused == false, "ERROR: DEPOSIT_DISABLED");                                                                                                                                 │
│         require(_amount > 0, "ERROR: DEPOSIT_ZERO");                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         uint256 _supply = totalSupply();                                                                                                                                                                        │
│         uint256 _totalLiquidity = totalLiquidity();                                                                                                                                                             │
│         vault.addValue(_amount, msg.sender, address(this));                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         if (_supply > 0 && _totalLiquidity > 0) {                                                                                                                                                               │
│             _mintAmount = (_amount * _supply) / _totalLiquidity;                                                                                                                                                │
│         } else if (_supply > 0 && _totalLiquidity == 0) {                                                                                                                                                       │
│             //when                                                                                                                                                                                              │
│             _mintAmount = _amount * _supply;                                                                                                                                                                    │
│         } else {                                                                                                                                                                                                │
│             _mintAmount = _amount;                                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│         emit Deposit(msg.sender, _amount, _mintAmount);                                                                                                                                                         │
│         //mint iToken                                                                                                                                                                                           │
│         _mint(msg.sender, _mintAmount);                                                                                                                                                                         │
│         uint256 _liquidityAfter = _totalLiquidity + _amount;                                                                                                                                                    │
│         uint256 _leverage = (totalAllocatedCredit * MAGIC_SCALE_1E6) /                                                                                                                                          │
│             _liquidityAfter;                                                                                                                                                                                    │
│         //execut adjustAlloc only when the leverage became below target - lower-slack                                                                                                                           │
│         if (targetLev - parameters.getLowerSlack(address(this)) > _leverage) {                                                                                                                                  │
│             _adjustAlloc(_liquidityAfter);                                                                                                                                                                      │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function deposit(uint256 _amount) public returns (uint256 _mintAmount) {                                                                                                                                    │
│         require(locked == false && paused == false, "ERROR: DEPOSIT_DISABLED");                                                                                                                                 │
│         require(_amount > 0, "ERROR: DEPOSIT_ZERO");                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         uint256 _supply = totalSupply();                                                                                                                                                                        │
│         uint256 _totalLiquidity = totalLiquidity();                                                                                                                                                             │
│         vault.addValue(_amount, msg.sender, address(this));                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         if (_supply > 0 && _totalLiquidity > 0) {                                                                                                                                                               │
│             _mintAmount = (_amount * _supply) / _totalLiquidity;                                                                                                                                                │
│         } else if (_supply > 0 && _totalLiquidity == 0) {                                                                                                                                                       │
│             //when                                                                                                                                                                                              │
│             _mintAmount = _amount * _supply;                                                                                                                                                                    │
│         } else {                                                                                                                                                                                                │
│             _mintAmount = _amount;                                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│         emit Deposit(msg.sender, _amount, _mintAmount);                                                                                                                                                         │
│         //mint iToken                                                                                                                                                                                           │
│         _mint(msg.sender, _mintAmount);                                                                                                                                                                         │
│         uint256 _liquidityAfter = _totalLiquidity + _amount;                                                                                                                                                    │
│         uint256 _leverage = (totalAllocatedCredit * MAGIC_SCALE_1E6) /                                                                                                                                          │
│             _liquidityAfter;                                                                                                                                                                                    │
│         //execut adjustAlloc only when the leverage became below target - lower-slack                                                                                                                           │
│         if (targetLev - parameters.getLowerSlack(address(this)) > _leverage) {                                                                                                                                  │
│             _adjustAlloc(_liquidityAfter);                                                                                                                                                                      │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function requestWithdraw(uint256 _amount) external {                                                                                                                                                        │
│         uint256 _balance = balanceOf(msg.sender);                                                                                                                                                               │
│         require(_balance >= _amount, "ERROR: REQUEST_EXCEED_BALANCE");                                                                                                                                          │
│         require(_amount > 0, "ERROR: REQUEST_ZERO");                                                                                                                                                            │
│         withdrawalReq.timestamp = block.timestamp;                                                                                                                                                              │
│         withdrawalReq.amount = _amount;                                                                                                                                                                         │
│         emit WithdrawRequested(msg.sender, _amount, block.timestamp);                                                                                                                                           │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ have inside code statements that update/accrue interest/exchange rate,                                                                                                                                          │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function withdraw(uint256 _amount) external returns (uint256 _retVal) {                                                                                                                                     │
│         //Calculate underlying value                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         uint256 _liquidty = totalLiquidity();                                                                                                                                                                   │
│         uint256 _lockup = parameters.getLockup(msg.sender);                                                                                                                                                     │
│         uint256 _requestTime = withdrawalReq.timestamp;                                                                                                                                                         │
│         _retVal = (_liquidty * _amount) / totalSupply();                                                                                                                                                        │
│         require(locked == false, "ERROR: WITHDRAWAL_PENDING");                                                                                                                                                  │
│         require(                                                                                                                                                                                                │
│             _requestTime + _lockup < block.timestamp,                                                                                                                                                           │
│             "ERROR: WITHDRAWAL_QUEUE"                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             _requestTime + _lockup + parameters.getWithdrawable(msg.sender) >                                                                                                                                   │
│                 block.timestamp,                                                                                                                                                                                │
│             "ERROR: WITHDRAWAL_NO_ACTIVE_REQUEST"                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             withdrawalReq.amount >= _amount,                                                                                                                                                                    │
│             "ERROR: WITHDRAWAL_EXCEEDED_REQUEST"                                                                                                                                                                │
│         );                                                                                                                                                                                                      │
│         require(_amount > 0, "ERROR: WITHDRAWAL_ZERO");                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             _retVal <= withdrawable(),                                                                                                                                                                          │
│             "ERROR: WITHDRAW_INSUFFICIENT_LIQUIDITY"                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         //reduce requested amount                                                                                                                                                                               │
│         withdrawalReq.amount -= _amount;                                                                                                                                                                        │
│         //Burn iToken                                                                                                                                                                                           │
│         _burn(msg.sender, _amount);                                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         //Check current leverage rate and get updated target total credit allocation                                                                                                                            │
│         uint256 _liquidityAfter = _liquidty - _retVal;                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         if (_liquidityAfter > 0) {                                                                                                                                                                              │
│             uint256 _leverage = (totalAllocatedCredit * MAGIC_SCALE_1E6) /                                                                                                                                      │
│                 _liquidityAfter;                                                                                                                                                                                │
│             //execute adjustAlloc only when the leverage became above target + upper-slack                                                                                                                      │
│             if (                                                                                                                                                                                                │
│                 targetLev + parameters.getUpperSlack(address(this)) < _leverage                                                                                                                                 │
│             ) {                                                                                                                                                                                                 │
│                 _adjustAlloc(_liquidityAfter);                                                                                                                                                                  │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             _adjustAlloc(0);                                                                                                                                                                                    │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         //Withdraw liquidity                                                                                                                                                                                    │
│         vault.withdrawValue(_retVal, msg.sender);                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         emit Withdraw(msg.sender, _amount, _retVal);                                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "Yes",                                                                                                                                                                                                 │
│     "3": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                      │
│ Code:                                                                                                                                                                                                           │
│     function withdraw(uint256 _amount) external returns (uint256 _retVal) {                                                                                                                                     │
│         //Calculate underlying value                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         uint256 _liquidty = totalLiquidity();                                                                                                                                                                   │
│         uint256 _lockup = parameters.getLockup(msg.sender);                                                                                                                                                     │
│         uint256 _requestTime = withdrawalReq.timestamp;                                                                                                                                                         │
│         _retVal = (_liquidty * _amount) / totalSupply();                                                                                                                                                        │
│         require(locked == false, "ERROR: WITHDRAWAL_PENDING");                                                                                                                                                  │
│         require(                                                                                                                                                                                                │
│             _requestTime + _lockup < block.timestamp,                                                                                                                                                           │
│             "ERROR: WITHDRAWAL_QUEUE"                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             _requestTime + _lockup + parameters.getWithdrawable(msg.sender) >                                                                                                                                   │
│                 block.timestamp,                                                                                                                                                                                │
│             "ERROR: WITHDRAWAL_NO_ACTIVE_REQUEST"                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             withdrawalReq.amount >= _amount,                                                                                                                                                                    │
│             "ERROR: WITHDRAWAL_EXCEEDED_REQUEST"                                                                                                                                                                │
│         );                                                                                                                                                                                                      │
│         require(_amount > 0, "ERROR: WITHDRAWAL_ZERO");                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             _retVal <= withdrawable(),                                                                                                                                                                          │
│             "ERROR: WITHDRAW_INSUFFICIENT_LIQUIDITY"                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         //reduce requested amount                                                                                                                                                                               │
│         withdrawalReq.amount -= _amount;                                                                                                                                                                        │
│         //Burn iToken                                                                                                                                                                                           │
│         _burn(msg.sender, _amount);                                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         //Check current leverage rate and get updated target total credit allocation                                                                                                                            │
│         uint256 _liquidityAfter = _liquidty - _retVal;                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         if (_liquidityAfter > 0) {                                                                                                                                                                              │
│             uint256 _leverage = (totalAllocatedCredit * MAGIC_SCALE_1E6) /                                                                                                                                      │
│                 _liquidityAfter;                                                                                                                                                                                │
│             //execute adjustAlloc only when the leverage became above target + upper-slack                                                                                                                      │
│             if (                                                                                                                                                                                                │
│                 targetLev + parameters.getUpperSlack(address(this)) < _leverage                                                                                                                                 │
│             ) {                                                                                                                                                                                                 │
│                 _adjustAlloc(_liquidityAfter);                                                                                                                                                                  │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             _adjustAlloc(0);                                                                                                                                                                                    │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         //Withdraw liquidity                                                                                                                                                                                    │
│         vault.withdrawValue(_retVal, msg.sender);                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         emit Withdraw(msg.sender, _amount, _retVal);                                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function withdraw(uint256 _amount) external returns (uint256 _retVal) {                                                                                                                                     │
│         //Calculate underlying value                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         uint256 _liquidty = totalLiquidity();                                                                                                                                                                   │
│         uint256 _lockup = parameters.getLockup(msg.sender);                                                                                                                                                     │
│         uint256 _requestTime = withdrawalReq.timestamp;                                                                                                                                                         │
│         _retVal = (_liquidty * _amount) / totalSupply();                                                                                                                                                        │
│         require(locked == false, "ERROR: WITHDRAWAL_PENDING");                                                                                                                                                  │
│         require(                                                                                                                                                                                                │
│             _requestTime + _lockup < block.timestamp,                                                                                                                                                           │
│             "ERROR: WITHDRAWAL_QUEUE"                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             _requestTime + _lockup + parameters.getWithdrawable(msg.sender) >                                                                                                                                   │
│                 block.timestamp,                                                                                                                                                                                │
│             "ERROR: WITHDRAWAL_NO_ACTIVE_REQUEST"                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             withdrawalReq.amount >= _amount,                                                                                                                                                                    │
│             "ERROR: WITHDRAWAL_EXCEEDED_REQUEST"                                                                                                                                                                │
│         );                                                                                                                                                                                                      │
│         require(_amount > 0, "ERROR: WITHDRAWAL_ZERO");                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             _retVal <= withdrawable(),                                                                                                                                                                          │
│             "ERROR: WITHDRAW_INSUFFICIENT_LIQUIDITY"                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         //reduce requested amount                                                                                                                                                                               │
│         withdrawalReq.amount -= _amount;                                                                                                                                                                        │
│         //Burn iToken                                                                                                                                                                                           │
│         _burn(msg.sender, _amount);                                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         //Check current leverage rate and get updated target total credit allocation                                                                                                                            │
│         uint256 _liquidityAfter = _liquidty - _retVal;                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         if (_liquidityAfter > 0) {                                                                                                                                                                              │
│             uint256 _leverage = (totalAllocatedCredit * MAGIC_SCALE_1E6) /                                                                                                                                      │
│                 _liquidityAfter;                                                                                                                                                                                │
│             //execute adjustAlloc only when the leverage became above target + upper-slack                                                                                                                      │
│             if (                                                                                                                                                                                                │
│                 targetLev + parameters.getUpperSlack(address(this)) < _leverage                                                                                                                                 │
│             ) {                                                                                                                                                                                                 │
│                 _adjustAlloc(_liquidityAfter);                                                                                                                                                                  │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             _adjustAlloc(0);                                                                                                                                                                                    │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         //Withdraw liquidity                                                                                                                                                                                    │
│         vault.withdrawValue(_retVal, msg.sender);                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         emit Withdraw(msg.sender, _amount, _retVal);                                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function withdrawable() public view returns (uint256 _retVal) {                                                                                                                                             │
│         uint256 _totalLiquidity = totalLiquidity();                                                                                                                                                             │
│         if(_totalLiquidity > 0){                                                                                                                                                                                │
│             uint256 _length = poolList.length;                                                                                                                                                                  │
│             uint256 _lowestAvailableRate = MAGIC_SCALE_1E6;                                                                                                                                                     │
│             uint256 _targetAllocPoint;                                                                                                                                                                          │
│             uint256 _targetLockedCreditScore;                                                                                                                                                                   │
│             //Check which pool has the lowest available rate and keep stats                                                                                                                                     │
│             for (uint256 i = 0; i < _length; i++) {                                                                                                                                                             │
│                 address _poolAddress = poolList;                                                                                                                                                                │
│                 uint256 _allocPoint = allocPoints[_poolAddress];                                                                                                                                                │
│                 if (_allocPoint > 0) {                                                                                                                                                                          │
│                     uint256 _allocated = IPoolTemplate(_poolAddress)                                                                                                                                            │
│                         .allocatedCredit(address(this));                                                                                                                                                        │
│                     uint256 _availableBalance = IPoolTemplate(_poolAddress)                                                                                                                                     │
│                         .availableBalance();                                                                                                                                                                    │
│                     //check if some portion of credit is locked                                                                                                                                                 │
│                     if (_allocated > _availableBalance) {                                                                                                                                                       │
│                         uint256 _availableRate = (_availableBalance *                                                                                                                                           │
│                             MAGIC_SCALE_1E6) / _allocated;                                                                                                                                                      │
│                         uint256 _lockedCredit = _allocated - _availableBalance;                                                                                                                                 │
│                         if (i == 0 || _availableRate < _lowestAvailableRate) {                                                                                                                                  │
│                             _lowestAvailableRate = _availableRate;                                                                                                                                              │
│                             _targetLockedCreditScore = _lockedCredit;                                                                                                                                           │
│                             _targetAllocPoint = _allocPoint;                                                                                                                                                    │
│                         }                                                                                                                                                                                       │
│                     }                                                                                                                                                                                           │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│             //Calculate the return value                                                                                                                                                                        │
│             if (_lowestAvailableRate == MAGIC_SCALE_1E6) {                                                                                                                                                      │
│                 _retVal = _totalLiquidity;                                                                                                                                                                      │
│             } else {                                                                                                                                                                                            │
│                 uint256 _necessaryAmount = _targetLockedCreditScore * totalAllocPoint /  _targetAllocPoint;                                                                                                     │
│                 _necessaryAmount = _necessaryAmount *  MAGIC_SCALE_1E6 / targetLev;                                                                                                                             │
│                 if(_necessaryAmount < _totalLiquidity){                                                                                                                                                         │
│                     _retVal = _totalLiquidity - _necessaryAmount;                                                                                                                                               │
│                 }else{                                                                                                                                                                                          │
│                     _retVal = 0;                                                                                                                                                                                │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function withdraw(uint256 _amount) external returns (uint256 _retVal) {                                                                                                                                     │
│         //Calculate underlying value                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         uint256 _liquidty = totalLiquidity();                                                                                                                                                                   │
│         uint256 _lockup = parameters.getLockup(msg.sender);                                                                                                                                                     │
│         uint256 _requestTime = withdrawalReq.timestamp;                                                                                                                                                         │
│         _retVal = (_liquidty * _amount) / totalSupply();                                                                                                                                                        │
│         require(locked == false, "ERROR: WITHDRAWAL_PENDING");                                                                                                                                                  │
│         require(                                                                                                                                                                                                │
│             _requestTime + _lockup < block.timestamp,                                                                                                                                                           │
│             "ERROR: WITHDRAWAL_QUEUE"                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             _requestTime + _lockup + parameters.getWithdrawable(msg.sender) >                                                                                                                                   │
│                 block.timestamp,                                                                                                                                                                                │
│             "ERROR: WITHDRAWAL_NO_ACTIVE_REQUEST"                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             withdrawalReq.amount >= _amount,                                                                                                                                                                    │
│             "ERROR: WITHDRAWAL_EXCEEDED_REQUEST"                                                                                                                                                                │
│         );                                                                                                                                                                                                      │
│         require(_amount > 0, "ERROR: WITHDRAWAL_ZERO");                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             _retVal <= withdrawable(),                                                                                                                                                                          │
│             "ERROR: WITHDRAW_INSUFFICIENT_LIQUIDITY"                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         //reduce requested amount                                                                                                                                                                               │
│         withdrawalReq.amount -= _amount;                                                                                                                                                                        │
│         //Burn iToken                                                                                                                                                                                           │
│         _burn(msg.sender, _amount);                                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         //Check current leverage rate and get updated target total credit allocation                                                                                                                            │
│         uint256 _liquidityAfter = _liquidty - _retVal;                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         if (_liquidityAfter > 0) {                                                                                                                                                                              │
│             uint256 _leverage = (totalAllocatedCredit * MAGIC_SCALE_1E6) /                                                                                                                                      │
│                 _liquidityAfter;                                                                                                                                                                                │
│             //execute adjustAlloc only when the leverage became above target + upper-slack                                                                                                                      │
│             if (                                                                                                                                                                                                │
│                 targetLev + parameters.getUpperSlack(address(this)) < _leverage                                                                                                                                 │
│             ) {                                                                                                                                                                                                 │
│                 _adjustAlloc(_liquidityAfter);                                                                                                                                                                  │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             _adjustAlloc(0);                                                                                                                                                                                    │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         //Withdraw liquidity                                                                                                                                                                                    │
│         vault.withdrawValue(_retVal, msg.sender);                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         emit Withdraw(msg.sender, _amount, _retVal);                                                                                                                                                            │
│     }                                                                                                                                                                                                           │
│     function withdrawable() public view returns (uint256 _retVal) {                                                                                                                                             │
│         uint256 _totalLiquidity = totalLiquidity();                                                                                                                                                             │
│         if(_totalLiquidity > 0){                                                                                                                                                                                │
│             uint256 _length = poolList.length;                                                                                                                                                                  │
│             uint256 _lowestAvailableRate = MAGIC_SCALE_1E6;                                                                                                                                                     │
│             uint256 _targetAllocPoint;                                                                                                                                                                          │
│             uint256 _targetLockedCreditScore;                                                                                                                                                                   │
│             //Check which pool has the lowest available rate and keep stats                                                                                                                                     │
│             for (uint256 i = 0; i < _length; i++) {                                                                                                                                                             │
│                 address _poolAddress = poolList;                                                                                                                                                                │
│                 uint256 _allocPoint = allocPoints[_poolAddress];                                                                                                                                                │
│                 if (_allocPoint > 0) {                                                                                                                                                                          │
│                     uint256 _allocated = IPoolTemplate(_poolAddress)                                                                                                                                            │
│                         .allocatedCredit(address(this));                                                                                                                                                        │
│                     uint256 _availableBalance = IPoolTemplate(_poolAddress)                                                                                                                                     │
│                         .availableBalance();                                                                                                                                                                    │
│                     //check if some portion of credit is locked                                                                                                                                                 │
│                     if (_allocated > _availableBalance) {                                                                                                                                                       │
│                         uint256 _availableRate = (_availableBalance *                                                                                                                                           │
│                             MAGIC_SCALE_1E6) / _allocated;                                                                                                                                                      │
│                         uint256 _lockedCredit = _allocated - _availableBalance;                                                                                                                                 │
│                         if (i == 0 || _availableRate < _lowestAvailableRate) {                                                                                                                                  │
│                             _lowestAvailableRate = _availableRate;                                                                                                                                              │
│                             _targetLockedCreditScore = _lockedCredit;                                                                                                                                           │
│                             _targetAllocPoint = _allocPoint;                                                                                                                                                    │
│                         }                                                                                                                                                                                       │
│                     }                                                                                                                                                                                           │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│             //Calculate the return value                                                                                                                                                                        │
│             if (_lowestAvailableRate == MAGIC_SCALE_1E6) {                                                                                                                                                      │
│                 _retVal = _totalLiquidity;                                                                                                                                                                      │
│             } else {                                                                                                                                                                                            │
│                 uint256 _necessaryAmount = _targetLockedCreditScore * totalAllocPoint /  _targetAllocPoint;                                                                                                     │
│                 _necessaryAmount = _necessaryAmount *  MAGIC_SCALE_1E6 / targetLev;                                                                                                                             │
│                 if(_necessaryAmount < _totalLiquidity){                                                                                                                                                         │
│                     _retVal = _totalLiquidity - _necessaryAmount;                                                                                                                                               │
│                 }else{                                                                                                                                                                                          │
│                     _retVal = 0;                                                                                                                                                                                │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function _adjustAlloc(uint256 _liquidity) internal {                                                                                                                                                        │
│         //Check current leverage rate and get target total credit allocation                                                                                                                                    │
│         uint256 _targetCredit = (targetLev * _liquidity) / MAGIC_SCALE_1E6;                                                                                                                                     │
│         uint256 _allocatable = _targetCredit;                                                                                                                                                                   │
│         uint256 _allocatablePoints = totalAllocPoint;                                                                                                                                                           │
│         uint256 _length = poolList.length;                                                                                                                                                                      │
│         PoolStatus[] memory _poolList = new PoolStatus[](_length);                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         //Check each pool and if current credit allocation > target && it is impossible to adjust, then withdraw all availablle credit                                                                          │
│         for (uint256 i = 0; i < _length; i++) {                                                                                                                                                                 │
│             address _pool = poolList;                                                                                                                                                                           │
│             if (_pool != address(0)) {                                                                                                                                                                          │
│                 uint256 _allocation = allocPoints[_pool];                                                                                                                                                       │
│                 //Target credit allocation for a pool                                                                                                                                                           │
│                 uint256 _target = (_targetCredit * _allocation) /                                                                                                                                               │
│                     _allocatablePoints;                                                                                                                                                                         │
│                 //get how much has been allocated for a pool                                                                                                                                                    │
│                 uint256 _current = IPoolTemplate(_pool).allocatedCredit(                                                                                                                                        │
│                     address(this)                                                                                                                                                                               │
│                 );                                                                                                                                                                                              │
│                 //get how much liquidty is available to withdraw                                                                                                                                                │
│                 uint256 _available = IPoolTemplate(_pool).availableBalance();                                                                                                                                   │
│                 //if needed to withdraw credit but unable, then withdraw all available.                                                                                                                         │
│                 //Otherwise, skip.                                                                                                                                                                              │
│                 if (                                                                                                                                                                                            │
│                     (_current > _target && _current - _target > _available) ||                                                                                                                                  │
│                     IPoolTemplate(_pool).paused() == true                                                                                                                                                       │
│                 ) {                                                                                                                                                                                             │
│                     IPoolTemplate(_pool).withdrawCredit(_available);                                                                                                                                            │
│                     totalAllocatedCredit -= _available;                                                                                                                                                         │
│                     _poolList.addr = address(0);                                                                                                                                                                │
│                     _allocatable -= _current - _available;                                                                                                                                                      │
│                     _allocatablePoints -= _allocation;                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     _poolList.addr = _pool;                                                                                                                                                                     │
│                     _poolList.current = _current;                                                                                                                                                               │
│                     _poolList.available = _available;                                                                                                                                                           │
│                     _poolList.allocation = _allocation;                                                                                                                                                         │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         //Check pools that was not falling under the previous criteria, then adjust to meet the target credit allocation.                                                                                       │
│         for (uint256 i = 0; i < _length; i++) {                                                                                                                                                                 │
│             if (_poolList.addr != address(0)) {                                                                                                                                                                 │
│                 //Target credit allocation for a pool                                                                                                                                                           │
│                 uint256 _target = (_allocatable * _poolList.allocation) /                                                                                                                                       │
│                     _allocatablePoints;                                                                                                                                                                         │
│                 //get how much has been allocated for a pool                                                                                                                                                    │
│                 uint256 _current = _poolList.current;                                                                                                                                                           │
│                 //get how much liquidty is available to withdraw                                                                                                                                                │
│                 uint256 _available = _poolList.available;                                                                                                                                                       │
│                 //Withdraw or Deposit credit                                                                                                                                                                    │
│                 if (_current > _target && _available != 0) {                                                                                                                                                    │
│                     //if allocated credit is higher than the target, try to decrease                                                                                                                            │
│                     uint256 _decrease = _current - _target;                                                                                                                                                     │
│                     IPoolTemplate(_poolList.addr).withdrawCredit(_decrease);                                                                                                                                    │
│                     totalAllocatedCredit -= _decrease;                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 if (_current < _target) {                                                                                                                                                                       │
│                     //Sometimes we need to allocate more                                                                                                                                                        │
│                     uint256 _allocate = _target - _current;                                                                                                                                                     │
│                     IPoolTemplate(_poolList.addr).allocateCredit(_allocate);                                                                                                                                    │
│                     totalAllocatedCredit += _allocate;                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 if (_current == _target) {                                                                                                                                                                      │
│                     IPoolTemplate(_poolList.addr).allocateCredit(0);                                                                                                                                            │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function withdraw(uint256 _amount) external returns (uint256 _retVal) {                                                                                                                                     │
│         //Calculate underlying value                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         uint256 _liquidty = totalLiquidity();                                                                                                                                                                   │
│         uint256 _lockup = parameters.getLockup(msg.sender);                                                                                                                                                     │
│         uint256 _requestTime = withdrawalReq.timestamp;                                                                                                                                                         │
│         _retVal = (_liquidty * _amount) / totalSupply();                                                                                                                                                        │
│         require(locked == false, "ERROR: WITHDRAWAL_PENDING");                                                                                                                                                  │
│         require(                                                                                                                                                                                                │
│             _requestTime + _lockup < block.timestamp,                                                                                                                                                           │
│             "ERROR: WITHDRAWAL_QUEUE"                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             _requestTime + _lockup + parameters.getWithdrawable(msg.sender) >                                                                                                                                   │
│                 block.timestamp,                                                                                                                                                                                │
│             "ERROR: WITHDRAWAL_NO_ACTIVE_REQUEST"                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             withdrawalReq.amount >= _amount,                                                                                                                                                                    │
│             "ERROR: WITHDRAWAL_EXCEEDED_REQUEST"                                                                                                                                                                │
│         );                                                                                                                                                                                                      │
│         require(_amount > 0, "ERROR: WITHDRAWAL_ZERO");                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             _retVal <= withdrawable(),                                                                                                                                                                          │
│             "ERROR: WITHDRAW_INSUFFICIENT_LIQUIDITY"                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         //reduce requested amount                                                                                                                                                                               │
│         withdrawalReq.amount -= _amount;                                                                                                                                                                        │
│         //Burn iToken                                                                                                                                                                                           │
│         _burn(msg.sender, _amount);                                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         //Check current leverage rate and get updated target total credit allocation                                                                                                                            │
│         uint256 _liquidityAfter = _liquidty - _retVal;                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         if (_liquidityAfter > 0) {                                                                                                                                                                              │
│             uint256 _leverage = (totalAllocatedCredit * MAGIC_SCALE_1E6) /                                                                                                                                      │
│                 _liquidityAfter;                                                                                                                                                                                │
│             //execute adjustAlloc only when the leverage became above target + upper-slack                                                                                                                      │
│             if (                                                                                                                                                                                                │
│                 targetLev + parameters.getUpperSlack(address(this)) < _leverage                                                                                                                                 │
│             ) {                                                                                                                                                                                                 │
│                 _adjustAlloc(_liquidityAfter);                                                                                                                                                                  │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             _adjustAlloc(0);                                                                                                                                                                                    │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         //Withdraw liquidity                                                                                                                                                                                    │
│         vault.withdrawValue(_retVal, msg.sender);                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         emit Withdraw(msg.sender, _amount, _retVal);                                                                                                                                                            │
│     }                                                                                                                                                                                                           │
│     function _adjustAlloc(uint256 _liquidity) internal {                                                                                                                                                        │
│         //Check current leverage rate and get target total credit allocation                                                                                                                                    │
│         uint256 _targetCredit = (targetLev * _liquidity) / MAGIC_SCALE_1E6;                                                                                                                                     │
│         uint256 _allocatable = _targetCredit;                                                                                                                                                                   │
│         uint256 _allocatablePoints = totalAllocPoint;                                                                                                                                                           │
│         uint256 _length = poolList.length;                                                                                                                                                                      │
│         PoolStatus[] memory _poolList = new PoolStatus[](_length);                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         //Check each pool and if current credit allocation > target && it is impossible to adjust, then withdraw all availablle credit                                                                          │
│         for (uint256 i = 0; i < _length; i++) {                                                                                                                                                                 │
│             address _pool = poolList;                                                                                                                                                                           │
│             if (_pool != address(0)) {                                                                                                                                                                          │
│                 uint256 _allocation = allocPoints[_pool];                                                                                                                                                       │
│                 //Target credit allocation for a pool                                                                                                                                                           │
│                 uint256 _target = (_targetCredit * _allocation) /                                                                                                                                               │
│                     _allocatablePoints;                                                                                                                                                                         │
│                 //get how much has been allocated for a pool                                                                                                                                                    │
│                 uint256 _current = IPoolTemplate(_pool).allocatedCredit(                                                                                                                                        │
│                     address(this)                                                                                                                                                                               │
│                 );                                                                                                                                                                                              │
│                 //get how much liquidty is available to withdraw                                                                                                                                                │
│                 uint256 _available = IPoolTemplate(_pool).availableBalance();                                                                                                                                   │
│                 //if needed to withdraw credit but unable, then withdraw all available.                                                                                                                         │
│                 //Otherwise, skip.                                                                                                                                                                              │
│                 if (                                                                                                                                                                                            │
│                     (_current > _target && _current - _target > _available) ||                                                                                                                                  │
│                     IPoolTemplate(_pool).paused() == true                                                                                                                                                       │
│                 ) {                                                                                                                                                                                             │
│                     IPoolTemplate(_pool).withdrawCredit(_available);                                                                                                                                            │
│                     totalAllocatedCredit -= _available;                                                                                                                                                         │
│                     _poolList.addr = address(0);                                                                                                                                                                │
│                     _allocatable -= _current - _available;                                                                                                                                                      │
│                     _allocatablePoints -= _allocation;                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     _poolList.addr = _pool;                                                                                                                                                                     │
│                     _poolList.current = _current;                                                                                                                                                               │
│                     _poolList.available = _available;                                                                                                                                                           │
│                     _poolList.allocation = _allocation;                                                                                                                                                         │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         //Check pools that was not falling under the previous criteria, then adjust to meet the target credit allocation.                                                                                       │
│         for (uint256 i = 0; i < _length; i++) {                                                                                                                                                                 │
│             if (_poolList.addr != address(0)) {                                                                                                                                                                 │
│                 //Target credit allocation for a pool                                                                                                                                                           │
│                 uint256 _target = (_allocatable * _poolList.allocation) /                                                                                                                                       │
│                     _allocatablePoints;                                                                                                                                                                         │
│                 //get how much has been allocated for a pool                                                                                                                                                    │
│                 uint256 _current = _poolList.current;                                                                                                                                                           │
│                 //get how much liquidty is available to withdraw                                                                                                                                                │
│                 uint256 _available = _poolList.available;                                                                                                                                                       │
│                 //Withdraw or Deposit credit                                                                                                                                                                    │
│                 if (_current > _target && _available != 0) {                                                                                                                                                    │
│                     //if allocated credit is higher than the target, try to decrease                                                                                                                            │
│                     uint256 _decrease = _current - _target;                                                                                                                                                     │
│                     IPoolTemplate(_poolList.addr).withdrawCredit(_decrease);                                                                                                                                    │
│                     totalAllocatedCredit -= _decrease;                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 if (_current < _target) {                                                                                                                                                                       │
│                     //Sometimes we need to allocate more                                                                                                                                                        │
│                     uint256 _allocate = _target - _current;                                                                                                                                                     │
│                     IPoolTemplate(_poolList.addr).allocateCredit(_allocate);                                                                                                                                    │
│                     totalAllocatedCredit += _allocate;                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 if (_current == _target) {                                                                                                                                                                      │
│                     IPoolTemplate(_poolList.addr).allocateCredit(0);                                                                                                                                            │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function deposit(uint256 _amount) public returns (uint256 _mintAmount) {                                                                                                                                    │
│         require(locked == false && paused == false, "ERROR: DEPOSIT_DISABLED");                                                                                                                                 │
│         require(_amount > 0, "ERROR: DEPOSIT_ZERO");                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         uint256 _supply = totalSupply();                                                                                                                                                                        │
│         uint256 _totalLiquidity = totalLiquidity();                                                                                                                                                             │
│         vault.addValue(_amount, msg.sender, address(this));                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         if (_supply > 0 && _totalLiquidity > 0) {                                                                                                                                                               │
│             _mintAmount = (_amount * _supply) / _totalLiquidity;                                                                                                                                                │
│         } else if (_supply > 0 && _totalLiquidity == 0) {                                                                                                                                                       │
│             //when                                                                                                                                                                                              │
│             _mintAmount = _amount * _supply;                                                                                                                                                                    │
│         } else {                                                                                                                                                                                                │
│             _mintAmount = _amount;                                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│         emit Deposit(msg.sender, _amount, _mintAmount);                                                                                                                                                         │
│         //mint iToken                                                                                                                                                                                           │
│         _mint(msg.sender, _mintAmount);                                                                                                                                                                         │
│         uint256 _liquidityAfter = _totalLiquidity + _amount;                                                                                                                                                    │
│         uint256 _leverage = (totalAllocatedCredit * MAGIC_SCALE_1E6) /                                                                                                                                          │
│             _liquidityAfter;                                                                                                                                                                                    │
│         //execut adjustAlloc only when the leverage became below target - lower-slack                                                                                                                           │
│         if (targetLev - parameters.getLowerSlack(address(this)) > _leverage) {                                                                                                                                  │
│             _adjustAlloc(_liquidityAfter);                                                                                                                                                                      │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function _adjustAlloc(uint256 _liquidity) internal {                                                                                                                                                        │
│         //Check current leverage rate and get target total credit allocation                                                                                                                                    │
│         uint256 _targetCredit = (targetLev * _liquidity) / MAGIC_SCALE_1E6;                                                                                                                                     │
│         uint256 _allocatable = _targetCredit;                                                                                                                                                                   │
│         uint256 _allocatablePoints = totalAllocPoint;                                                                                                                                                           │
│         uint256 _length = poolList.length;                                                                                                                                                                      │
│         PoolStatus[] memory _poolList = new PoolStatus[](_length);                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         //Check each pool and if current credit allocation > target && it is impossible to adjust, then withdraw all availablle credit                                                                          │
│         for (uint256 i = 0; i < _length; i++) {                                                                                                                                                                 │
│             address _pool = poolList;                                                                                                                                                                           │
│             if (_pool != address(0)) {                                                                                                                                                                          │
│                 uint256 _allocation = allocPoints[_pool];                                                                                                                                                       │
│                 //Target credit allocation for a pool                                                                                                                                                           │
│                 uint256 _target = (_targetCredit * _allocation) /                                                                                                                                               │
│                     _allocatablePoints;                                                                                                                                                                         │
│                 //get how much has been allocated for a pool                                                                                                                                                    │
│                 uint256 _current = IPoolTemplate(_pool).allocatedCredit(                                                                                                                                        │
│                     address(this)                                                                                                                                                                               │
│                 );                                                                                                                                                                                              │
│                 //get how much liquidty is available to withdraw                                                                                                                                                │
│                 uint256 _available = IPoolTemplate(_pool).availableBalance();                                                                                                                                   │
│                 //if needed to withdraw credit but unable, then withdraw all available.                                                                                                                         │
│                 //Otherwise, skip.                                                                                                                                                                              │
│                 if (                                                                                                                                                                                            │
│                     (_current > _target && _current - _target > _available) ||                                                                                                                                  │
│                     IPoolTemplate(_pool).paused() == true                                                                                                                                                       │
│                 ) {                                                                                                                                                                                             │
│                     IPoolTemplate(_pool).withdrawCredit(_available);                                                                                                                                            │
│                     totalAllocatedCredit -= _available;                                                                                                                                                         │
│                     _poolList.addr = address(0);                                                                                                                                                                │
│                     _allocatable -= _current - _available;                                                                                                                                                      │
│                     _allocatablePoints -= _allocation;                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     _poolList.addr = _pool;                                                                                                                                                                     │
│                     _poolList.current = _current;                                                                                                                                                               │
│                     _poolList.available = _available;                                                                                                                                                           │
│                     _poolList.allocation = _allocation;                                                                                                                                                         │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         //Check pools that was not falling under the previous criteria, then adjust to meet the target credit allocation.                                                                                       │
│         for (uint256 i = 0; i < _length; i++) {                                                                                                                                                                 │
│             if (_poolList.addr != address(0)) {                                                                                                                                                                 │
│                 //Target credit allocation for a pool                                                                                                                                                           │
│                 uint256 _target = (_allocatable * _poolList.allocation) /                                                                                                                                       │
│                     _allocatablePoints;                                                                                                                                                                         │
│                 //get how much has been allocated for a pool                                                                                                                                                    │
│                 uint256 _current = _poolList.current;                                                                                                                                                           │
│                 //get how much liquidty is available to withdraw                                                                                                                                                │
│                 uint256 _available = _poolList.available;                                                                                                                                                       │
│                 //Withdraw or Deposit credit                                                                                                                                                                    │
│                 if (_current > _target && _available != 0) {                                                                                                                                                    │
│                     //if allocated credit is higher than the target, try to decrease                                                                                                                            │
│                     uint256 _decrease = _current - _target;                                                                                                                                                     │
│                     IPoolTemplate(_poolList.addr).withdrawCredit(_decrease);                                                                                                                                    │
│                     totalAllocatedCredit -= _decrease;                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 if (_current < _target) {                                                                                                                                                                       │
│                     //Sometimes we need to allocate more                                                                                                                                                        │
│                     uint256 _allocate = _target - _current;                                                                                                                                                     │
│                     IPoolTemplate(_poolList.addr).allocateCredit(_allocate);                                                                                                                                    │
│                     totalAllocatedCredit += _allocate;                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 if (_current == _target) {                                                                                                                                                                      │
│                     IPoolTemplate(_poolList.addr).allocateCredit(0);                                                                                                                                            │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function deposit(uint256 _amount) public returns (uint256 _mintAmount) {                                                                                                                                    │
│         require(locked == false && paused == false, "ERROR: DEPOSIT_DISABLED");                                                                                                                                 │
│         require(_amount > 0, "ERROR: DEPOSIT_ZERO");                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         uint256 _supply = totalSupply();                                                                                                                                                                        │
│         uint256 _totalLiquidity = totalLiquidity();                                                                                                                                                             │
│         vault.addValue(_amount, msg.sender, address(this));                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         if (_supply > 0 && _totalLiquidity > 0) {                                                                                                                                                               │
│             _mintAmount = (_amount * _supply) / _totalLiquidity;                                                                                                                                                │
│         } else if (_supply > 0 && _totalLiquidity == 0) {                                                                                                                                                       │
│             //when                                                                                                                                                                                              │
│             _mintAmount = _amount * _supply;                                                                                                                                                                    │
│         } else {                                                                                                                                                                                                │
│             _mintAmount = _amount;                                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│         emit Deposit(msg.sender, _amount, _mintAmount);                                                                                                                                                         │
│         //mint iToken                                                                                                                                                                                           │
│         _mint(msg.sender, _mintAmount);                                                                                                                                                                         │
│         uint256 _liquidityAfter = _totalLiquidity + _amount;                                                                                                                                                    │
│         uint256 _leverage = (totalAllocatedCredit * MAGIC_SCALE_1E6) /                                                                                                                                          │
│             _liquidityAfter;                                                                                                                                                                                    │
│         //execut adjustAlloc only when the leverage became below target - lower-slack                                                                                                                           │
│         if (targetLev - parameters.getLowerSlack(address(this)) > _leverage) {                                                                                                                                  │
│             _adjustAlloc(_liquidityAfter);                                                                                                                                                                      │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function _adjustAlloc(uint256 _liquidity) internal {                                                                                                                                                        │
│         //Check current leverage rate and get target total credit allocation                                                                                                                                    │
│         uint256 _targetCredit = (targetLev * _liquidity) / MAGIC_SCALE_1E6;                                                                                                                                     │
│         uint256 _allocatable = _targetCredit;                                                                                                                                                                   │
│         uint256 _allocatablePoints = totalAllocPoint;                                                                                                                                                           │
│         uint256 _length = poolList.length;                                                                                                                                                                      │
│         PoolStatus[] memory _poolList = new PoolStatus[](_length);                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         //Check each pool and if current credit allocation > target && it is impossible to adjust, then withdraw all availablle credit                                                                          │
│         for (uint256 i = 0; i < _length; i++) {                                                                                                                                                                 │
│             address _pool = poolList;                                                                                                                                                                           │
│             if (_pool != address(0)) {                                                                                                                                                                          │
│                 uint256 _allocation = allocPoints[_pool];                                                                                                                                                       │
│                 //Target credit allocation for a pool                                                                                                                                                           │
│                 uint256 _target = (_targetCredit * _allocation) /                                                                                                                                               │
│                     _allocatablePoints;                                                                                                                                                                         │
│                 //get how much has been allocated for a pool                                                                                                                                                    │
│                 uint256 _current = IPoolTemplate(_pool).allocatedCredit(                                                                                                                                        │
│                     address(this)                                                                                                                                                                               │
│                 );                                                                                                                                                                                              │
│                 //get how much liquidty is available to withdraw                                                                                                                                                │
│                 uint256 _available = IPoolTemplate(_pool).availableBalance();                                                                                                                                   │
│                 //if needed to withdraw credit but unable, then withdraw all available.                                                                                                                         │
│                 //Otherwise, skip.                                                                                                                                                                              │
│                 if (                                                                                                                                                                                            │
│                     (_current > _target && _current - _target > _available) ||                                                                                                                                  │
│                     IPoolTemplate(_pool).paused() == true                                                                                                                                                       │
│                 ) {                                                                                                                                                                                             │
│                     IPoolTemplate(_pool).withdrawCredit(_available);                                                                                                                                            │
│                     totalAllocatedCredit -= _available;                                                                                                                                                         │
│                     _poolList.addr = address(0);                                                                                                                                                                │
│                     _allocatable -= _current - _available;                                                                                                                                                      │
│                     _allocatablePoints -= _allocation;                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     _poolList.addr = _pool;                                                                                                                                                                     │
│                     _poolList.current = _current;                                                                                                                                                               │
│                     _poolList.available = _available;                                                                                                                                                           │
│                     _poolList.allocation = _allocation;                                                                                                                                                         │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         //Check pools that was not falling under the previous criteria, then adjust to meet the target credit allocation.                                                                                       │
│         for (uint256 i = 0; i < _length; i++) {                                                                                                                                                                 │
│             if (_poolList.addr != address(0)) {                                                                                                                                                                 │
│                 //Target credit allocation for a pool                                                                                                                                                           │
│                 uint256 _target = (_allocatable * _poolList.allocation) /                                                                                                                                       │
│                     _allocatablePoints;                                                                                                                                                                         │
│                 //get how much has been allocated for a pool                                                                                                                                                    │
│                 uint256 _current = _poolList.current;                                                                                                                                                           │
│                 //get how much liquidty is available to withdraw                                                                                                                                                │
│                 uint256 _available = _poolList.available;                                                                                                                                                       │
│                 //Withdraw or Deposit credit                                                                                                                                                                    │
│                 if (_current > _target && _available != 0) {                                                                                                                                                    │
│                     //if allocated credit is higher than the target, try to decrease                                                                                                                            │
│                     uint256 _decrease = _current - _target;                                                                                                                                                     │
│                     IPoolTemplate(_poolList.addr).withdrawCredit(_decrease);                                                                                                                                    │
│                     totalAllocatedCredit -= _decrease;                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 if (_current < _target) {                                                                                                                                                                       │
│                     //Sometimes we need to allocate more                                                                                                                                                        │
│                     uint256 _allocate = _target - _current;                                                                                                                                                     │
│                     IPoolTemplate(_poolList.addr).allocateCredit(_allocate);                                                                                                                                    │
│                     totalAllocatedCredit += _allocate;                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 if (_current == _target) {                                                                                                                                                                      │
│                     IPoolTemplate(_poolList.addr).allocateCredit(0);                                                                                                                                            │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function compensate(uint256 _amount)                                                                                                                                                                        │
│         external                                                                                                                                                                                                │
│         override                                                                                                                                                                                                │
│         returns (uint256 _compensated)                                                                                                                                                                          │
│     {                                                                                                                                                                                                           │
│         require(                                                                                                                                                                                                │
│             allocPoints > 0,                                                                                                                                                                                    │
│             "ERROR_COMPENSATE_UNAUTHORIZED_CALLER"                                                                                                                                                              │
│         );                                                                                                                                                                                                      │
│         uint256 _value = vault.underlyingValue(address(this));                                                                                                                                                  │
│         if (_value >= _amount) {                                                                                                                                                                                │
│             //When the deposited value without earned premium is enough to cover                                                                                                                                │
│             vault.offsetDebt(_amount, msg.sender);                                                                                                                                                              │
│             //vault.transferValue(_amount, msg.sender);                                                                                                                                                         │
│             _compensated = _amount;                                                                                                                                                                             │
│         } else {                                                                                                                                                                                                │
│             //Withdraw credit to cashout the earnings                                                                                                                                                           │
│             uint256 _shortage;                                                                                                                                                                                  │
│             if (totalLiquidity() < _amount) {                                                                                                                                                                   │
│                 //Insolvency case                                                                                                                                                                               │
│                 _shortage = _amount - _value;                                                                                                                                                                   │
│                 uint256 _cds = ICDSTemplate(registry.getCDS(address(this)))                                                                                                                                     │
│                     .compensate(_shortage);                                                                                                                                                                     │
│                 _compensated = _value + _cds;                                                                                                                                                                   │
│             }                                                                                                                                                                                                   │
│             vault.offsetDebt(_compensated, msg.sender);                                                                                                                                                         │
│         }                                                                                                                                                                                                       │
│         adjustAlloc();                                                                                                                                                                                          │
│         emit Compensated(msg.sender, _compensated);                                                                                                                                                             │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function compensate(uint256 _amount)                                                                                                                                                                        │
│         external                                                                                                                                                                                                │
│         override                                                                                                                                                                                                │
│         returns (uint256 _compensated)                                                                                                                                                                          │
│     {                                                                                                                                                                                                           │
│         require(                                                                                                                                                                                                │
│             allocPoints > 0,                                                                                                                                                                                    │
│             "ERROR_COMPENSATE_UNAUTHORIZED_CALLER"                                                                                                                                                              │
│         );                                                                                                                                                                                                      │
│         uint256 _value = vault.underlyingValue(address(this));                                                                                                                                                  │
│         if (_value >= _amount) {                                                                                                                                                                                │
│             //When the deposited value without earned premium is enough to cover                                                                                                                                │
│             vault.offsetDebt(_amount, msg.sender);                                                                                                                                                              │
│             //vault.transferValue(_amount, msg.sender);                                                                                                                                                         │
│             _compensated = _amount;                                                                                                                                                                             │
│         } else {                                                                                                                                                                                                │
│             //Withdraw credit to cashout the earnings                                                                                                                                                           │
│             uint256 _shortage;                                                                                                                                                                                  │
│             if (totalLiquidity() < _amount) {                                                                                                                                                                   │
│                 //Insolvency case                                                                                                                                                                               │
│                 _shortage = _amount - _value;                                                                                                                                                                   │
│                 uint256 _cds = ICDSTemplate(registry.getCDS(address(this)))                                                                                                                                     │
│                     .compensate(_shortage);                                                                                                                                                                     │
│                 _compensated = _value + _cds;                                                                                                                                                                   │
│             }                                                                                                                                                                                                   │
│             vault.offsetDebt(_compensated, msg.sender);                                                                                                                                                         │
│         }                                                                                                                                                                                                       │
│         adjustAlloc();                                                                                                                                                                                          │
│         emit Compensated(msg.sender, _compensated);                                                                                                                                                             │
│     }                                                                                                                                                                                                           │
│     function compensate(uint256 _amount)                                                                                                                                                                        │
│         external                                                                                                                                                                                                │
│         override                                                                                                                                                                                                │
│         returns (uint256 _compensated)                                                                                                                                                                          │
│     {                                                                                                                                                                                                           │
│         require(                                                                                                                                                                                                │
│             allocPoints > 0,                                                                                                                                                                                    │
│             "ERROR_COMPENSATE_UNAUTHORIZED_CALLER"                                                                                                                                                              │
│         );                                                                                                                                                                                                      │
│         uint256 _value = vault.underlyingValue(address(this));                                                                                                                                                  │
│         if (_value >= _amount) {                                                                                                                                                                                │
│             //When the deposited value without earned premium is enough to cover                                                                                                                                │
│             vault.offsetDebt(_amount, msg.sender);                                                                                                                                                              │
│             //vault.transferValue(_amount, msg.sender);                                                                                                                                                         │
│             _compensated = _amount;                                                                                                                                                                             │
│         } else {                                                                                                                                                                                                │
│             //Withdraw credit to cashout the earnings                                                                                                                                                           │
│             uint256 _shortage;                                                                                                                                                                                  │
│             if (totalLiquidity() < _amount) {                                                                                                                                                                   │
│                 //Insolvency case                                                                                                                                                                               │
│                 _shortage = _amount - _value;                                                                                                                                                                   │
│                 uint256 _cds = ICDSTemplate(registry.getCDS(address(this)))                                                                                                                                     │
│                     .compensate(_shortage);                                                                                                                                                                     │
│                 _compensated = _value + _cds;                                                                                                                                                                   │
│             }                                                                                                                                                                                                   │
│             vault.offsetDebt(_compensated, msg.sender);                                                                                                                                                         │
│         }                                                                                                                                                                                                       │
│         adjustAlloc();                                                                                                                                                                                          │
│         emit Compensated(msg.sender, _compensated);                                                                                                                                                             │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function resume() external {                                                                                                                                                                                │
│         require(                                                                                                                                                                                                │
│             marketStatus == MarketStatus.Payingout &&                                                                                                                                                           │
│                 pendingEnd < block.timestamp,                                                                                                                                                                   │
│             "ERROR: UNABLE_TO_RESUME"                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint256 _debt = vault.debts(address(this));                                                                                                                                                             │
│         uint256 _totalCredit = totalCredit;                                                                                                                                                                     │
│         uint256 _deductionFromIndex = (_debt * _totalCredit * MAGIC_SCALE_1E6) /                                                                                                                                │
│             totalLiquidity();                                                                                                                                                                                   │
│         uint256 _actualDeduction;                                                                                                                                                                               │
│         for (uint256 i = 0; i < indexList.length; i++) {                                                                                                                                                        │
│             address _index = indexList;                                                                                                                                                                         │
│             uint256 _credit = indicies[_index].credit;                                                                                                                                                          │
│             if (_credit > 0) {                                                                                                                                                                                  │
│                 uint256 _shareOfIndex = (_credit * MAGIC_SCALE_1E6) /                                                                                                                                           │
│                     _totalCredit;                                                                                                                                                                               │
│                 uint256 _redeemAmount = _divCeil(                                                                                                                                                               │
│                     _deductionFromIndex,                                                                                                                                                                        │
│                     _shareOfIndex                                                                                                                                                                               │
│                 );                                                                                                                                                                                              │
│                 _actualDeduction += IIndexTemplate(_index).compensate(                                                                                                                                          │
│                     _redeemAmount                                                                                                                                                                               │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 _deductionFromPool = _debt -                                                                                                                                                                    │
│             _deductionFromIndex /                                                                                                                                                                               │
│             MAGIC_SCALE_1E6;                                                                                                                                                                                    │
│         uint256 _shortage = _deductionFromIndex /                                                                                                                                                               │
│             MAGIC_SCALE_1E6 -                                                                                                                                                                                   │
│             _actualDeduction;                                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         if (_deductionFromPool > 0) {                                                                                                                                                                           │
│             vault.offsetDebt(_deductionFromPool, address(this));                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         vault.transferDebt(_shortage);                                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         marketStatus = MarketStatus.Trading;                                                                                                                                                                    │
│         emit MarketStatusChanged(MarketStatus.Trading);                                                                                                                                                         │
│     }                                                                                                                                                                                                           │
│     function compensate(uint256 _amount)                                                                                                                                                                        │
│         external                                                                                                                                                                                                │
│         override                                                                                                                                                                                                │
│         returns (uint256 _compensated)                                                                                                                                                                          │
│     {                                                                                                                                                                                                           │
│         require(                                                                                                                                                                                                │
│             allocPoints > 0,                                                                                                                                                                                    │
│             "ERROR_COMPENSATE_UNAUTHORIZED_CALLER"                                                                                                                                                              │
│         );                                                                                                                                                                                                      │
│         uint256 _value = vault.underlyingValue(address(this));                                                                                                                                                  │
│         if (_value >= _amount) {                                                                                                                                                                                │
│             //When the deposited value without earned premium is enough to cover                                                                                                                                │
│             vault.offsetDebt(_amount, msg.sender);                                                                                                                                                              │
│             //vault.transferValue(_amount, msg.sender);                                                                                                                                                         │
│             _compensated = _amount;                                                                                                                                                                             │
│         } else {                                                                                                                                                                                                │
│             //Withdraw credit to cashout the earnings                                                                                                                                                           │
│             uint256 _shortage;                                                                                                                                                                                  │
│             if (totalLiquidity() < _amount) {                                                                                                                                                                   │
│                 //Insolvency case                                                                                                                                                                               │
│                 _shortage = _amount - _value;                                                                                                                                                                   │
│                 uint256 _cds = ICDSTemplate(registry.getCDS(address(this)))                                                                                                                                     │
│                     .compensate(_shortage);                                                                                                                                                                     │
│                 _compensated = _value + _cds;                                                                                                                                                                   │
│             }                                                                                                                                                                                                   │
│             vault.offsetDebt(_compensated, msg.sender);                                                                                                                                                         │
│         }                                                                                                                                                                                                       │
│         adjustAlloc();                                                                                                                                                                                          │
│         emit Compensated(msg.sender, _compensated);                                                                                                                                                             │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function valueOfUnderlying(address _owner) public view returns (uint256) {                                                                                                                                  │
│         uint256 _balance = balanceOf(_owner);                                                                                                                                                                   │
│         if (_balance == 0) {                                                                                                                                                                                    │
│             return 0;                                                                                                                                                                                           │
│         } else {                                                                                                                                                                                                │
│             return (_balance * totalLiquidity()) / totalSupply();                                                                                                                                               │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function _beforeTokenTransfer(                                                                                                                                                                              │
│         address from,                                                                                                                                                                                           │
│         address to,                                                                                                                                                                                             │
│         uint256 amount                                                                                                                                                                                          │
│     ) internal virtual override {                                                                                                                                                                               │
│         super._beforeTokenTransfer(from, to, amount);                                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         if (from != address(0)) {                                                                                                                                                                               │
│             uint256 _after = balanceOf(from) - amount;                                                                                                                                                          │
│             if (_after < withdrawalReq.amount) {                                                                                                                                                                │
│                 withdrawalReq.amount = _after;                                                                                                                                                                  │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function getCurrentPremiumRate(                                                                                                                                                                             │
│         uint256 _totalLiquidity,                                                                                                                                                                                │
│         uint256 _lockedAmount                                                                                                                                                                                   │
│     ) public view override returns (uint256) {                                                                                                                                                                  │
│         require(                                                                                                                                                                                                │
│             _totalLiquidity >= _lockedAmount,                                                                                                                                                                   │
│             "ERROR: _lockedAmount > _totalLiquidity"                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│         // utilization rate (0~1000000)                                                                                                                                                                         │
│         uint256 _util = (_lockedAmount * BASE) / _totalLiquidity;                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         // yearly premium rate                                                                                                                                                                                  │
│         uint256 _premiumRate;                                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         uint256 T_0 = _totalLiquidity;                                                                                                                                                                          │
│         if (T_0 > T_1) {                                                                                                                                                                                        │
│             T_0 = T_1;                                                                                                                                                                                          │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 a = (sqrt(                                                                                                                                                                                      │
│             (BASE_x2 * BASE_x2 * T_1 + 4 * k * T_0 * BASE_x2) / T_1                                                                                                                                             │
│         ) - BASE_x2) / 2; //a*BASE (in calc)                                                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         uint256 Q = (BASE - _util) + a / BASE; //x+a (in calc)                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         _premiumRate =                                                                                                                                                                                          │
│             365 *                                                                                                                                                                                               │
│             (k * T_0 * BASE - a * Q * T_1) +                                                                                                                                                                    │
│             Q *                                                                                                                                                                                                 │
│             (c - b) *                                                                                                                                                                                           │
│             (T_1 - T_0) *                                                                                                                                                                                       │
│             BASE +                                                                                                                                                                                              │
│             b *                                                                                                                                                                                                 │
│             Q *                                                                                                                                                                                                 │
│             T_1 *                                                                                                                                                                                               │
│             BASE;                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         _premiumRate = _premiumRate / Q / T_1 / BASE;                                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         //Return premium                                                                                                                                                                                        │
│         return _premiumRate;                                                                                                                                                                                    │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function getPremiumRate(                                                                                                                                                                                    │
│         uint256 _amount,                                                                                                                                                                                        │
│         uint256 _totalLiquidity,                                                                                                                                                                                │
│         uint256 _lockedAmount                                                                                                                                                                                   │
│     ) public view override returns (uint256) {                                                                                                                                                                  │
│         require(                                                                                                                                                                                                │
│             _amount + _lockedAmount <= _totalLiquidity,                                                                                                                                                         │
│             "exceed available balance"                                                                                                                                                                          │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (_totalLiquidity == 0 || _amount == 0) {                                                                                                                                                             │
│             return 0;                                                                                                                                                                                           │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 u1 = BASE - ((_lockedAmount * BASE) / _totalLiquidity); //util rate before. 1000000 = 100.000%                                                                                                  │
│         uint256 u2 = BASE -                                                                                                                                                                                     │
│             (((_lockedAmount + _amount) * BASE) / _totalLiquidity); //util rate after. 1000000 = 100.000%                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 T_0 = _totalLiquidity;                                                                                                                                                                          │
│         if (T_0 > T_1) {                                                                                                                                                                                        │
│             T_0 = T_1;                                                                                                                                                                                          │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 a = (sqrt(                                                                                                                                                                                      │
│             (BASE_x2 * BASE_x2 * T_1 + 4 * k * T_0 * BASE_x2) / T_1                                                                                                                                             │
│         ) - BASE_x2) / 2; //a*BASE (in calc)                                                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         Temp memory temp;                                                                                                                                                                                       │
│         temp.a = a.fromUInt();                                                                                                                                                                                  │
│         temp.BASE_temp = BASE.fromUInt();                                                                                                                                                                       │
│         temp.a = temp.a.div(temp.BASE_temp);                                                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         //calc 0=>u1 area                                                                                                                                                                                       │
│         temp.u = u1.fromUInt();                                                                                                                                                                                 │
│         int128 ln_u1 = (temp.u).add(temp.a).ln();                                                                                                                                                               │
│         uint256 ln_res_u1 = ln_u1.mulu(k); //k*ln(x+a) //very percise.                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         uint256 _premium_u1 = (365 * T_0 * ln_res_u1 * BASE) +                                                                                                                                                  │
│             u1 *                                                                                                                                                                                                │
│             ((T_1 - T_0) * c * BASE + T_0 * b * BASE) -                                                                                                                                                         │
│             T_1 *                                                                                                                                                                                               │
│             365 *                                                                                                                                                                                               │
│             a *                                                                                                                                                                                                 │
│             u1;                                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         //calc 0=>u2 area                                                                                                                                                                                       │
│         temp.u = u2.fromUInt();                                                                                                                                                                                 │
│         int128 ln_u2 = (temp.u).add(temp.a).ln();                                                                                                                                                               │
│         uint256 ln_res_u2 = ln_u2.mulu(k); //k*ln(x+a) //very percise.                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         uint256 _premium_u2 = (365 * T_0 * ln_res_u2 * BASE) +                                                                                                                                                  │
│             u2 *                                                                                                                                                                                                │
│             ((T_1 - T_0) * c * BASE + T_0 * b * BASE) -                                                                                                                                                         │
│             T_1 *                                                                                                                                                                                               │
│             365 *                                                                                                                                                                                               │
│             a *                                                                                                                                                                                                 │
│             u2;                                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         //(u1 area) - (u2 area) = premium rate between u1 and u2                                                                                                                                                │
│         uint256 premiumRate = _premium_u1 - _premium_u2;                                                                                                                                                        │
│         premiumRate = premiumRate / T_1 / (u1 - u2) / BASE;                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         return premiumRate;                                                                                                                                                                                     │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function getPremium(                                                                                                                                                                                        │
│         uint256 _amount,                                                                                                                                                                                        │
│         uint256 _term,                                                                                                                                                                                          │
│         uint256 _totalLiquidity,                                                                                                                                                                                │
│         uint256 _lockedAmount                                                                                                                                                                                   │
│     ) external view override returns (uint256) {                                                                                                                                                                │
│         require(_amount + _lockedAmount <= _totalLiquidity, "Amount exceeds.");                                                                                                                                 │
│         require(_totalLiquidity != 0, "_totalLiquidity cannnot be 0");                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         if (_amount == 0) {                                                                                                                                                                                     │
│             return 0;                                                                                                                                                                                           │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 premiumRate = getPremiumRate(                                                                                                                                                                   │
│             _amount,                                                                                                                                                                                            │
│             _totalLiquidity,                                                                                                                                                                                    │
│             _lockedAmount                                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint256 premium = (_amount * premiumRate * _term) / 365 days / BASE;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         return premium;                                                                                                                                                                                         │
│     }                                                                                                                                                                                                           │
│     function getPremiumRate(                                                                                                                                                                                    │
│         uint256 _amount,                                                                                                                                                                                        │
│         uint256 _totalLiquidity,                                                                                                                                                                                │
│         uint256 _lockedAmount                                                                                                                                                                                   │
│     ) public view override returns (uint256) {                                                                                                                                                                  │
│         require(                                                                                                                                                                                                │
│             _amount + _lockedAmount <= _totalLiquidity,                                                                                                                                                         │
│             "exceed available balance"                                                                                                                                                                          │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (_totalLiquidity == 0 || _amount == 0) {                                                                                                                                                             │
│             return 0;                                                                                                                                                                                           │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 u1 = BASE - ((_lockedAmount * BASE) / _totalLiquidity); //util rate before. 1000000 = 100.000%                                                                                                  │
│         uint256 u2 = BASE -                                                                                                                                                                                     │
│             (((_lockedAmount + _amount) * BASE) / _totalLiquidity); //util rate after. 1000000 = 100.000%                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 T_0 = _totalLiquidity;                                                                                                                                                                          │
│         if (T_0 > T_1) {                                                                                                                                                                                        │
│             T_0 = T_1;                                                                                                                                                                                          │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 a = (sqrt(                                                                                                                                                                                      │
│             (BASE_x2 * BASE_x2 * T_1 + 4 * k * T_0 * BASE_x2) / T_1                                                                                                                                             │
│         ) - BASE_x2) / 2; //a*BASE (in calc)                                                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         Temp memory temp;                                                                                                                                                                                       │
│         temp.a = a.fromUInt();                                                                                                                                                                                  │
│         temp.BASE_temp = BASE.fromUInt();                                                                                                                                                                       │
│         temp.a = temp.a.div(temp.BASE_temp);                                                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         //calc 0=>u1 area                                                                                                                                                                                       │
│         temp.u = u1.fromUInt();                                                                                                                                                                                 │
│         int128 ln_u1 = (temp.u).add(temp.a).ln();                                                                                                                                                               │
│         uint256 ln_res_u1 = ln_u1.mulu(k); //k*ln(x+a) //very percise.                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         uint256 _premium_u1 = (365 * T_0 * ln_res_u1 * BASE) +                                                                                                                                                  │
│             u1 *                                                                                                                                                                                                │
│             ((T_1 - T_0) * c * BASE + T_0 * b * BASE) -                                                                                                                                                         │
│             T_1 *                                                                                                                                                                                               │
│             365 *                                                                                                                                                                                               │
│             a *                                                                                                                                                                                                 │
│             u1;                                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         //calc 0=>u2 area                                                                                                                                                                                       │
│         temp.u = u2.fromUInt();                                                                                                                                                                                 │
│         int128 ln_u2 = (temp.u).add(temp.a).ln();                                                                                                                                                               │
│         uint256 ln_res_u2 = ln_u2.mulu(k); //k*ln(x+a) //very percise.                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         uint256 _premium_u2 = (365 * T_0 * ln_res_u2 * BASE) +                                                                                                                                                  │
│             u2 *                                                                                                                                                                                                │
│             ((T_1 - T_0) * c * BASE + T_0 * b * BASE) -                                                                                                                                                         │
│             T_1 *                                                                                                                                                                                               │
│             365 *                                                                                                                                                                                               │
│             a *                                                                                                                                                                                                 │
│             u2;                                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         //(u1 area) - (u2 area) = premium rate between u1 and u2                                                                                                                                                │
│         uint256 premiumRate = _premium_u1 - _premium_u2;                                                                                                                                                        │
│         premiumRate = premiumRate / T_1 / (u1 - u2) / BASE;                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         return premiumRate;                                                                                                                                                                                     │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function getPremium(                                                                                                                                                                                        │
│         uint256 _amount,                                                                                                                                                                                        │
│         uint256 _term,                                                                                                                                                                                          │
│         uint256 _totalLiquidity,                                                                                                                                                                                │
│         uint256 _lockedAmount                                                                                                                                                                                   │
│     ) external view override returns (uint256) {                                                                                                                                                                │
│         require(_amount + _lockedAmount <= _totalLiquidity, "Amount exceeds.");                                                                                                                                 │
│         require(_totalLiquidity != 0, "_totalLiquidity cannnot be 0");                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         if (_amount == 0) {                                                                                                                                                                                     │
│             return 0;                                                                                                                                                                                           │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 premiumRate = getPremiumRate(                                                                                                                                                                   │
│             _amount,                                                                                                                                                                                            │
│             _totalLiquidity,                                                                                                                                                                                    │
│             _lockedAmount                                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint256 premium = (_amount * premiumRate * _term) / 365 days / BASE;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         return premium;                                                                                                                                                                                         │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function insure(                                                                                                                                                                                            │
│         uint256 _amount,                                                                                                                                                                                        │
│         uint256 _maxCost,                                                                                                                                                                                       │
│         uint256 _span,                                                                                                                                                                                          │
│         bytes32 _target                                                                                                                                                                                         │
│     ) external returns (uint256) {                                                                                                                                                                              │
│         //Distribute premium and fee                                                                                                                                                                            │
│         uint256 _endTime = _span + block.timestamp;                                                                                                                                                             │
│         uint256 _premium = getPremium(_amount, _span);                                                                                                                                                          │
│         uint256 _fee = parameters.getFeeRate(msg.sender);                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             _amount <= availableBalance(),                                                                                                                                                                      │
│             "ERROR: INSURE_EXCEEDED_AVAILABLE_BALANCE"                                                                                                                                                          │
│         );                                                                                                                                                                                                      │
│         require(_premium <= _maxCost, "ERROR: INSURE_EXCEEDED_MAX_COST");                                                                                                                                       │
│         require(_span <= 365 days, "ERROR: INSURE_EXCEEDED_MAX_SPAN");                                                                                                                                          │
│         require(                                                                                                                                                                                                │
│             parameters.getMinDate(msg.sender) <= _span,                                                                                                                                                         │
│             "ERROR: INSURE_SPAN_BELOW_MIN"                                                                                                                                                                      │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             marketStatus == MarketStatus.Trading,                                                                                                                                                               │
│             "ERROR: INSURE_MARKET_PENDING"                                                                                                                                                                      │
│         );                                                                                                                                                                                                      │
│         require(paused == false, "ERROR: INSURE_MARKET_PAUSED");                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         //current liquidity                                                                                                                                                                                     │
│         uint256 _liquidity = totalLiquidity();                                                                                                                                                                  │
│         uint256 _totalCredit = totalCredit;                                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         //accrue premium/fee                                                                                                                                                                                    │
│         uint256[2] memory _newAttribution = vault.addValueBatch(                                                                                                                                                │
│             _premium,                                                                                                                                                                                           │
│             msg.sender,                                                                                                                                                                                         │
│             ,                                                                                                                                                                                                   │
│             [MAGIC_SCALE_1E6 - _fee, _fee]                                                                                                                                                                      │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         //Lock covered amount                                                                                                                                                                                   │
│         uint256 _id = allInsuranceCount;                                                                                                                                                                        │
│         lockedAmount += _amount;                                                                                                                                                                                │
│         Insurance memory _insurance = Insurance(                                                                                                                                                                │
│             _id,                                                                                                                                                                                                │
│             block.timestamp,                                                                                                                                                                                    │
│             _endTime,                                                                                                                                                                                           │
│             _amount,                                                                                                                                                                                            │
│             _target,                                                                                                                                                                                            │
│             msg.sender,                                                                                                                                                                                         │
│             true                                                                                                                                                                                                │
│         );                                                                                                                                                                                                      │
│         insurances[_id] = _insurance;                                                                                                                                                                           │
│         allInsuranceCount += 1;                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         //Calculate liquidity for index                                                                                                                                                                         │
│         if (_totalCredit > 0) {                                                                                                                                                                                 │
│             uint256 _attributionForIndex = (_newAttribution[0] * _totalCredit) /                                                                                                                                │
│                 _liquidity;                                                                                                                                                                                     │
│             attributionDebt += _attributionForIndex;                                                                                                                                                            │
│             rewardPerCredit += ((_attributionForIndex * MAGIC_SCALE_1E6) /                                                                                                                                      │
│                 _totalCredit);                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         emit Insured(                                                                                                                                                                                           │
│             _id,                                                                                                                                                                                                │
│             _amount,                                                                                                                                                                                            │
│             _target,                                                                                                                                                                                            │
│             block.timestamp,                                                                                                                                                                                    │
│             _endTime,                                                                                                                                                                                           │
│             msg.sender,                                                                                                                                                                                         │
│             _premium                                                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         return _id;                                                                                                                                                                                             │
│     }                                                                                                                                                                                                           │
│     function getPremium(                                                                                                                                                                                        │
│         uint256 _amount,                                                                                                                                                                                        │
│         uint256 _term,                                                                                                                                                                                          │
│         uint256 _totalLiquidity,                                                                                                                                                                                │
│         uint256 _lockedAmount                                                                                                                                                                                   │
│     ) external view override returns (uint256) {                                                                                                                                                                │
│         require(_amount + _lockedAmount <= _totalLiquidity, "Amount exceeds.");                                                                                                                                 │
│         require(_totalLiquidity != 0, "_totalLiquidity cannnot be 0");                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         if (_amount == 0) {                                                                                                                                                                                     │
│             return 0;                                                                                                                                                                                           │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 premiumRate = getPremiumRate(                                                                                                                                                                   │
│             _amount,                                                                                                                                                                                            │
│             _totalLiquidity,                                                                                                                                                                                    │
│             _lockedAmount                                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint256 premium = (_amount * premiumRate * _term) / 365 days / BASE;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         return premium;                                                                                                                                                                                         │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_mintAmount": "Holds the value of total minted share or amount"                                                                                                                                        │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "_supply": "Holds the total supply/liquidity AND is used by the conditional branch to determine the supply/liquidity is 0"                                                                              │
│     },                                                                                                                                                                                                          │
│     "VariableC": {                                                                                                                                                                                              │
│         "_amount": "Holds the value of the deposit/mint/add amount"                                                                                                                                             │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:38:01] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/contracts/CDSTemplate.sol, current function:  tasks.py:260
                             deposit, current vul: first-deposit                                                                                                                                                   
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "totalSupply()": "Variable holding the total supply of LP tokens",                                                                                                                                      │
│         "originalLiquidity()": "Variable holding the original liquidity value"                                                                                                                                  │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "_amount": "Variable holding the calculated value/price of LP token"                                                                                                                                    │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
                    ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/contracts/PoolTemplate.sol, current function: tasks.py:260
                             worth, current vul: price-manipulation                                                                                                                                                
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "marketStatus": "Variable holding the market status",                                                                                                                                                   │
│         "paused": "Variable holding the pause status"                                                                                                                                                           │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "_mintAmount": "Variable holding the calculated mint amount"                                                                                                                                            │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:38:02] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:357
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/contracts/PoolTemplate.sol, current function: tasks.py:359
                             worth, current vul: price-manipulation                                                                                                                                                
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:361
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 310, in simple_cli                                                                                       
                                 raise Exception(                                                                                                                                                                  
                             Exception: The description of variable did not pass the validation                                                                                                                    
                                                                                                                                                                                                                   
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "worth": "Function that holds the custom token balanceOf/totalSupply/amount/liquidity calculation"                                                                                                      │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "_mintAmount": "Variable that holds the calculated value/price of LP token"                                                                                                                             │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:38:03] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:357
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/contracts/PoolTemplate.sol, current function: tasks.py:359
                             worth, current vul: price-manipulation                                                                                                                                                
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:361
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 355, in simple_cli                                                                                       
                                 falcon_instance, function2_text)                                                                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_amount": "Holds the value of total minted share or amount"                                                                                                                                            │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "_supply": "Holds the total supply/liquidity AND is used by the conditional branch to determine the supply/liquidity is 0"                                                                              │
│     },                                                                                                                                                                                                          │
│     "VariableC": {                                                                                                                                                                                              │
│         "_value": "Holds the value of the deposit/mint/add amount"                                                                                                                                              │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:38:04] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/contracts/PoolTemplate.sol, current function: tasks.py:260
                             worth, current vul: first-deposit                                                                                                                                                     
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_mintAmount": "Holds the value of total minted share or amount"                                                                                                                                        │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "vault": "Holds the total supply/liquidity AND is used by the conditional branch to determine the supply/liquidity is 0"                                                                                │
│     },                                                                                                                                                                                                          │
│     "VariableC": {                                                                                                                                                                                              │
│         "_amount": "Holds the value of the deposit/mint/add amount"                                                                                                                                             │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:38:05] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:357
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/contracts/PoolTemplate.sol, current function: tasks.py:359
                             worth, current vul: first-deposit                                                                                                                                                     
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:361
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 355, in simple_cli                                                                                       
                                 falcon_instance, function2_text)                                                                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_mintAmount": "Holds the value of total minted share or amount"                                                                                                                                        │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "_totalLiquidity": "Holds the total supply/liquidity AND is used by the conditional branch to determine the supply/liquidity is 0"                                                                      │
│     },                                                                                                                                                                                                          │
│     "VariableC": {                                                                                                                                                                                              │
│         "_amount": "Holds the value of the deposit/mint/add amount"                                                                                                                                             │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:38:06] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/contracts/IndexTemplate.sol, current          tasks.py:260
                             function: deposit, current vul: first-deposit                                                                                                                                         
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to update/accrue interest/exchange rate? Answer only ZERO or ONE statement, cover the code with backquotes.                    │
│ Code:                                                                                                                                                                                                           │
│     function withdraw(uint256 _amount) external returns (uint256 _retVal) {                                                                                                                                     │
│         //Calculate underlying value                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         uint256 _liquidty = totalLiquidity();                                                                                                                                                                   │
│         uint256 _lockup = parameters.getLockup(msg.sender);                                                                                                                                                     │
│         uint256 _requestTime = withdrawalReq.timestamp;                                                                                                                                                         │
│         _retVal = (_liquidty * _amount) / totalSupply();                                                                                                                                                        │
│         require(locked == false, "ERROR: WITHDRAWAL_PENDING");                                                                                                                                                  │
│         require(                                                                                                                                                                                                │
│             _requestTime + _lockup < block.timestamp,                                                                                                                                                           │
│             "ERROR: WITHDRAWAL_QUEUE"                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             _requestTime + _lockup + parameters.getWithdrawable(msg.sender) >                                                                                                                                   │
│                 block.timestamp,                                                                                                                                                                                │
│             "ERROR: WITHDRAWAL_NO_ACTIVE_REQUEST"                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             withdrawalReq.amount >= _amount,                                                                                                                                                                    │
│             "ERROR: WITHDRAWAL_EXCEEDED_REQUEST"                                                                                                                                                                │
│         );                                                                                                                                                                                                      │
│         require(_amount > 0, "ERROR: WITHDRAWAL_ZERO");                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             _retVal <= withdrawable(),                                                                                                                                                                          │
│             "ERROR: WITHDRAW_INSUFFICIENT_LIQUIDITY"                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         //reduce requested amount                                                                                                                                                                               │
│         withdrawalReq.amount -= _amount;                                                                                                                                                                        │
│         //Burn iToken                                                                                                                                                                                           │
│         _burn(msg.sender, _amount);                                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         //Check current leverage rate and get updated target total credit allocation                                                                                                                            │
│         uint256 _liquidityAfter = _liquidty - _retVal;                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         if (_liquidityAfter > 0) {                                                                                                                                                                              │
│             uint256 _leverage = (totalAllocatedCredit * MAGIC_SCALE_1E6) /                                                                                                                                      │
│                 _liquidityAfter;                                                                                                                                                                                │
│             //execute adjustAlloc only when the leverage became above target + upper-slack                                                                                                                      │
│             if (                                                                                                                                                                                                │
│                 targetLev + parameters.getUpperSlack(address(this)) < _leverage                                                                                                                                 │
│             ) {                                                                                                                                                                                                 │
│                 _adjustAlloc(_liquidityAfter);                                                                                                                                                                  │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             _adjustAlloc(0);                                                                                                                                                                                    │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         //Withdraw liquidity                                                                                                                                                                                    │
│         vault.withdrawValue(_retVal, msg.sender);                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         emit Withdraw(msg.sender, _amount, _retVal);                                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ `'uint256 _liquidityAfter = _liquidty - _retVal;'`                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward? Answer only ZERO or ONE statement, cover the code with │
│ backquotes.                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function withdraw(uint256 _amount) external returns (uint256 _retVal) {                                                                                                                                     │
│         //Calculate underlying value                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         uint256 _liquidty = totalLiquidity();                                                                                                                                                                   │
│         uint256 _lockup = parameters.getLockup(msg.sender);                                                                                                                                                     │
│         uint256 _requestTime = withdrawalReq.timestamp;                                                                                                                                                         │
│         _retVal = (_liquidty * _amount) / totalSupply();                                                                                                                                                        │
│         require(locked == false, "ERROR: WITHDRAWAL_PENDING");                                                                                                                                                  │
│         require(                                                                                                                                                                                                │
│             _requestTime + _lockup < block.timestamp,                                                                                                                                                           │
│             "ERROR: WITHDRAWAL_QUEUE"                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             _requestTime + _lockup + parameters.getWithdrawable(msg.sender) >                                                                                                                                   │
│                 block.timestamp,                                                                                                                                                                                │
│             "ERROR: WITHDRAWAL_NO_ACTIVE_REQUEST"                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             withdrawalReq.amount >= _amount,                                                                                                                                                                    │
│             "ERROR: WITHDRAWAL_EXCEEDED_REQUEST"                                                                                                                                                                │
│         );                                                                                                                                                                                                      │
│         require(_amount > 0, "ERROR: WITHDRAWAL_ZERO");                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             _retVal <= withdrawable(),                                                                                                                                                                          │
│             "ERROR: WITHDRAW_INSUFFICIENT_LIQUIDITY"                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         //reduce requested amount                                                                                                                                                                               │
│         withdrawalReq.amount -= _amount;                                                                                                                                                                        │
│         //Burn iToken                                                                                                                                                                                           │
│         _burn(msg.sender, _amount);                                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         //Check current leverage rate and get updated target total credit allocation                                                                                                                            │
│         uint256 _liquidityAfter = _liquidty - _retVal;                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         if (_liquidityAfter > 0) {                                                                                                                                                                              │
│             uint256 _leverage = (totalAllocatedCredit * MAGIC_SCALE_1E6) /                                                                                                                                      │
│                 _liquidityAfter;                                                                                                                                                                                │
│             //execute adjustAlloc only when the leverage became above target + upper-slack                                                                                                                      │
│             if (                                                                                                                                                                                                │
│                 targetLev + parameters.getUpperSlack(address(this)) < _leverage                                                                                                                                 │
│             ) {                                                                                                                                                                                                 │
│                 _adjustAlloc(_liquidityAfter);                                                                                                                                                                  │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             _adjustAlloc(0);                                                                                                                                                                                    │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         //Withdraw liquidity                                                                                                                                                                                    │
│         vault.withdrawValue(_retVal, msg.sender);                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         emit Withdraw(msg.sender, _amount, _retVal);                                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ `_retVal = (_liquidty * _amount) / totalSupply();`                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:38:07] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/contracts/IndexTemplate.sol, current          tasks.py:260
                             function: withdraw, current vul: wrong-order-interest                                                                                                                                 
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_targetCredit": "Holds the value of total minted share or amount"                                                                                                                                      │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "totalAllocPoint": "Holds the total supply/liquidity AND is used by the conditional branch to determine the supply/liquidity is 0"                                                                      │
│     },                                                                                                                                                                                                          │
│     "VariableC": {                                                                                                                                                                                              │
│         "_available": "Holds the value of the deposit/mint/add amount"                                                                                                                                          │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:38:08] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/contracts/IndexTemplate.sol, current          tasks.py:260
                             function: _adjustAlloc, current vul: first-deposit                                                                                                                                    
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_mintAmount": "Holds the value of total minted share or amount"                                                                                                                                        │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "_totalLiquidity": "Holds the total supply/liquidity AND is used by the conditional branch to determine the supply/liquidity is 0"                                                                      │
│     },                                                                                                                                                                                                          │
│     "VariableC": {                                                                                                                                                                                              │
│         "_amount": "Holds the value of the deposit/mint/add amount"                                                                                                                                             │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:38:09] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:357
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-insure-main/contracts/IndexTemplate.sol, current          tasks.py:359
                             function: _adjustAlloc, current vul: first-deposit                                                                                                                                    
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:361
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 355, in simple_cli                                                                                       
                                 falcon_instance, function2_text)                                                                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
                      Scan Results                       
┏━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┓
┃ Type ┃ Description ┃ Affected Files ┃ Analysis Report ┃
┡━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━┩
└──────┴─────────────┴────────────────┴─────────────────┘
                   Summary                   
┏━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┓
┃ Key                  ┃ Value              ┃
┡━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━┩
│ Files                │ 25                 │
│ Contracts            │ 25                 │
│ Functions            │ 56                 │
│ Lines of Code        │ 4084               │
│ Used Time            │ 38.005127906799316 │
│ Estimated Cost (USD) │ 0.046041           │
└──────────────────────┴────────────────────┘
