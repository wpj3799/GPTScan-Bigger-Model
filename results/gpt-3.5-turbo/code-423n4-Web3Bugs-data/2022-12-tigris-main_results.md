

  .oooooo.    ooooooooo.   ooooooooooooo  .oooooo..o                                 
 d8P'  `Y8b   `888   `Y88. 8'   888   `8 d8P'    `Y8                                 
888            888   .d88'      888      Y88bo.       .ooooo.   .oooo.   ooo. .oo.   
888            888ooo88P'       888       `"Y8888o.  d88' `"Y8 `P  )88b  `888P"Y88b  
888     ooooo  888              888           `"Y88b 888        .oP"888   888   888  
`88.    .88'   888              888      oo     .d8P 888   .o8 d8(  888   888   888  
 `Y8bood8P'   o888o            o888o     8""88888P'  `Y8bod8P' `Y888""8o o888o o888o                                                        


                                                                   

[20:05:58] Loaded 10 rules                                                                                                                                                                             tasks.py:119
[12/08/24 20:05:58] INFO     CryticCompile: 'npx hardhat clean' running (wd: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main)               subprocess.py:41
[12/08/24 20:05:59] ERROR    CryticCompile: 'npx' returned non-zero exit code 1                                                                                                                    subprocess.py:60
                    ERROR    CryticCompile: An unexpected error occurred:                                                                                                                          subprocess.py:68
                             stderr: Error: Cannot find module '@nomicfoundation/hardhat-toolbox'                                                                                                                  
                             stderr: Require stack:                                                                                                                                                                
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/hardhat.config.js                                                    
                             stderr: -                                                                                                                                                                             
                             /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/core/config/config-loading.js                    
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/cli/cli.js                             
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/cli/bootstrap.js                       
                             stderr:     at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)                                                                                                   
                             stderr:     at Function._load (node:internal/modules/cjs/loader:1075:27)                                                                                                              
                             stderr:     at TracingChannel.traceSync (node:diagnostics_channel:322:14)                                                                                                             
                             stderr:     at wrapModuleLoad (node:internal/modules/cjs/loader:219:24)                                                                                                               
                             stderr:     at Module.require (node:internal/modules/cjs/loader:1340:12)                                                                                                              
                             stderr:     at require (node:internal/modules/helpers:138:16)                                                                                                                         
                             stderr:     at Object.<anonymous> (/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/hardhat.config.js:1:1)                      
                             stderr:     at Module._compile (node:internal/modules/cjs/loader:1565:14)                                                                                                             
                             stderr:     at Object..js (node:internal/modules/cjs/loader:1708:10)                                                                                                                  
                             stderr:     at Module.load (node:internal/modules/cjs/loader:1318:32) {                                                                                                               
                             stderr:   code: 'MODULE_NOT_FOUND',                                                                                                                                                   
                             stderr:   requireStack: [                                                                                                                                                             
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/hardhat.config.js',                                               
                             stderr:                                                                                                                                                                               
                             '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/core/config/config-loading.js',                 
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/cli/cli.js',                        
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/cli/bootstrap.js'                   
                             stderr:   ]                                                                                                                                                                           
                             stderr: }                                                                                                                                                                             
                    INFO     CryticCompile: 'npx hardhat clean --global' running (wd: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main)      subprocess.py:41
                    ERROR    CryticCompile: 'npx' returned non-zero exit code 1                                                                                                                    subprocess.py:60
                    ERROR    CryticCompile: An unexpected error occurred:                                                                                                                          subprocess.py:68
                             stderr: Error: Cannot find module '@nomicfoundation/hardhat-toolbox'                                                                                                                  
                             stderr: Require stack:                                                                                                                                                                
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/hardhat.config.js                                                    
                             stderr: -                                                                                                                                                                             
                             /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/core/config/config-loading.js                    
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/cli/cli.js                             
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/cli/bootstrap.js                       
                             stderr:     at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)                                                                                                   
                             stderr:     at Function._load (node:internal/modules/cjs/loader:1075:27)                                                                                                              
                             stderr:     at TracingChannel.traceSync (node:diagnostics_channel:322:14)                                                                                                             
                             stderr:     at wrapModuleLoad (node:internal/modules/cjs/loader:219:24)                                                                                                               
                             stderr:     at Module.require (node:internal/modules/cjs/loader:1340:12)                                                                                                              
                             stderr:     at require (node:internal/modules/helpers:138:16)                                                                                                                         
                             stderr:     at Object.<anonymous> (/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/hardhat.config.js:1:1)                      
                             stderr:     at Module._compile (node:internal/modules/cjs/loader:1565:14)                                                                                                             
                             stderr:     at Object..js (node:internal/modules/cjs/loader:1708:10)                                                                                                                  
                             stderr:     at Module.load (node:internal/modules/cjs/loader:1318:32) {                                                                                                               
                             stderr:   code: 'MODULE_NOT_FOUND',                                                                                                                                                   
                             stderr:   requireStack: [                                                                                                                                                             
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/hardhat.config.js',                                               
                             stderr:                                                                                                                                                                               
                             '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/core/config/config-loading.js',                 
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/cli/cli.js',                        
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/cli/bootstrap.js'                   
                             stderr:   ]                                                                                                                                                                           
                             stderr: }                                                                                                                                                                             
[12/08/24 20:06:00] INFO     CryticCompile: Problem executing hardhat: An unexpected error occurred:                                                                                                 hardhat.py:327
                             Error: Cannot find module '@nomicfoundation/hardhat-toolbox'                                                                                                                          
                             Require stack:                                                                                                                                                                        
                             - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/hardhat.config.js                                                            
                             - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/core/config/config-loading.js                  
                             - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/cli/cli.js                                     
                             - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/cli/bootstrap.js                               
                                 at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)                                                                                                           
                                 at Function._load (node:internal/modules/cjs/loader:1075:27)                                                                                                                      
                                 at TracingChannel.traceSync (node:diagnostics_channel:322:14)                                                                                                                     
                                 at wrapModuleLoad (node:internal/modules/cjs/loader:219:24)                                                                                                                       
                                 at Module.require (node:internal/modules/cjs/loader:1340:12)                                                                                                                      
                                 at require (node:internal/modules/helpers:138:16)                                                                                                                                 
                                 at Object.<anonymous> (/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/hardhat.config.js:1:1)                              
                                 at Module._compile (node:internal/modules/cjs/loader:1565:14)                                                                                                                     
                                 at Object..js (node:internal/modules/cjs/loader:1708:10)                                                                                                                          
                                 at Module.load (node:internal/modules/cjs/loader:1318:32) {                                                                                                                       
                               code: 'MODULE_NOT_FOUND',                                                                                                                                                           
                               requireStack: [                                                                                                                                                                     
                                 '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/hardhat.config.js',                                                       
                                 '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/core/config/config-loading.js               
                             ',                                                                                                                                                                                    
                                 '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/cli/cli.js',                                
                                 '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/cli/bootstrap.js'                           
                               ]                                                                                                                                                                                   
                             }                                                                                                                                                                                     
                                                                                                                                                                                                                   
                    INFO     CryticCompile: 'npx hardhat compile --force' running (wd: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main)     subprocess.py:41
                    ERROR    CryticCompile: 'npx' returned non-zero exit code 1                                                                                                                    subprocess.py:60
                    ERROR    CryticCompile: An unexpected error occurred:                                                                                                                          subprocess.py:68
                             stderr: Error: Cannot find module '@nomicfoundation/hardhat-toolbox'                                                                                                                  
                             stderr: Require stack:                                                                                                                                                                
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/hardhat.config.js                                                    
                             stderr: -                                                                                                                                                                             
                             /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/core/config/config-loading.js                    
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/cli/cli.js                             
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/cli/bootstrap.js                       
                             stderr:     at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)                                                                                                   
                             stderr:     at Function._load (node:internal/modules/cjs/loader:1075:27)                                                                                                              
                             stderr:     at TracingChannel.traceSync (node:diagnostics_channel:322:14)                                                                                                             
                             stderr:     at wrapModuleLoad (node:internal/modules/cjs/loader:219:24)                                                                                                               
                             stderr:     at Module.require (node:internal/modules/cjs/loader:1340:12)                                                                                                              
                             stderr:     at require (node:internal/modules/helpers:138:16)                                                                                                                         
                             stderr:     at Object.<anonymous> (/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/hardhat.config.js:1:1)                      
                             stderr:     at Module._compile (node:internal/modules/cjs/loader:1565:14)                                                                                                             
                             stderr:     at Object..js (node:internal/modules/cjs/loader:1708:10)                                                                                                                  
                             stderr:     at Module.load (node:internal/modules/cjs/loader:1318:32) {                                                                                                               
                             stderr:   code: 'MODULE_NOT_FOUND',                                                                                                                                                   
                             stderr:   requireStack: [                                                                                                                                                             
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/hardhat.config.js',                                               
                             stderr:                                                                                                                                                                               
                             '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/core/config/config-loading.js',                 
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/cli/cli.js',                        
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/node_modules/hardhat/internal/cli/bootstrap.js'                   
                             stderr:   ]                                                                                                                                                                           
                             stderr: }                                                                                                                                                                             
[20:06:00] Traceback (most recent call last):                                                                                                                                                          tasks.py:126
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/falcon/falcon.py", line 90, in __init__                                                                     
               crytic_compile = CryticCompile(target, **kwargs)                                                                                                                                                    
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/crytic_compile/crytic_compile.py", line 131, in __init__                                                    
               self._compile(**kwargs)                                                                                                                                                                             
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/crytic_compile/crytic_compile.py", line 553, in _compile                                                    
               self._platform.compile(self, **kwargs)                                                                                                                                                              
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/crytic_compile/platform/hardhat.py", line 183, in compile                                                   
               hardhat_like_parsing(crytic_compile, self._target, build_directory, hardhat_working_dir)                                                                                                            
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/crytic_compile/platform/hardhat.py", line 52, in hardhat_like_parsing                                       
               raise InvalidCompilation(txt)                                                                                                                                                                       
           crytic_compile.platform.exceptions.InvalidCompilation: Compilation failed. Can you run build command?                                                                                                   
           /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/artifacts/build-info is not a directory.                                                         
                                                                                                                                                                                                                   
           During handling of the above exception, another exception occurred:                                                                                                                                     
                                                                                                                                                                                                                   
           Traceback (most recent call last):                                                                                                                                                                      
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 124, in simple_cli                                                                                                         
               falcon_instance = compile_project(source_dir)                                                                                                                                                       
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 103, in compile_project                                                                                                    
               return falcon.Falcon(abs_path)                                                                                                                                                                      
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/falcon/falcon.py", line 94, in __init__                                                                     
               raise FalconError(f"Invalid compilation: \n{str(e)}")                                                                                                                                               
           falcon.exceptions.FalconError: Invalid compilation:                                                                                                                                                     
           Compilation failed. Can you run build command?                                                                                                                                                          
           /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/artifacts/build-info is not a directory.                                                         
                                                                                                                                                                                                                   
           Compile failed.                                                                                                                                                                             tasks.py:127
           Since the compilation is failed, some static analysis tool may not be enabled, which may cause lower precision and recall.                                                                  tasks.py:128
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function claimGovFees() public {                                                                                                                                                                            │
│         address[] memory assets = bondNFT.getAssets();                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         for (uint i=0; i < assets.length; i++) {                                                                                                                                                                │
│             uint balanceBefore = IERC20(assets).balanceOf(address(this));                                                                                                                                       │
│             IGovNFT(govNFT).claim(assets);                                                                                                                                                                      │
│             uint balanceAfter = IERC20(assets).balanceOf(address(this));                                                                                                                                        │
│             IERC20(assets).approve(address(bondNFT), type(uint256).max);                                                                                                                                        │
│             bondNFT.distribute(assets, balanceAfter - balanceBefore);                                                                                                                                           │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function claim(                                                                                                                                                                                             │
│         uint256 _id                                                                                                                                                                                             │
│     ) public returns (address) {                                                                                                                                                                                │
│         claimGovFees();                                                                                                                                                                                         │
│         (uint _amount, address _tigAsset) = bondNFT.claim(_id, msg.sender);                                                                                                                                     │
│         IERC20(_tigAsset).transfer(msg.sender, _amount);                                                                                                                                                        │
│         return _tigAsset;                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function claimGovFees() public {                                                                                                                                                                            │
│         address[] memory assets = bondNFT.getAssets();                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         for (uint i=0; i < assets.length; i++) {                                                                                                                                                                │
│             uint balanceBefore = IERC20(assets).balanceOf(address(this));                                                                                                                                       │
│             IGovNFT(govNFT).claim(assets);                                                                                                                                                                      │
│             uint balanceAfter = IERC20(assets).balanceOf(address(this));                                                                                                                                        │
│             IERC20(assets).approve(address(bondNFT), type(uint256).max);                                                                                                                                        │
│             bondNFT.distribute(assets, balanceAfter - balanceBefore);                                                                                                                                           │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function release(                                                                                                                                                                                           │
│         uint _id                                                                                                                                                                                                │
│     ) public {                                                                                                                                                                                                  │
│         claimGovFees();                                                                                                                                                                                         │
│         (uint amount, uint lockAmount, address asset, address _owner) = bondNFT.release(_id, msg.sender);                                                                                                       │
│         totalLocked -= lockAmount;                                                                                                                                                                              │
│         IERC20(asset).transfer(_owner, amount);                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
│     function claimGovFees() public {                                                                                                                                                                            │
│         address[] memory assets = bondNFT.getAssets();                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         for (uint i=0; i < assets.length; i++) {                                                                                                                                                                │
│             uint balanceBefore = IERC20(assets).balanceOf(address(this));                                                                                                                                       │
│             IGovNFT(govNFT).claim(assets);                                                                                                                                                                      │
│             uint balanceAfter = IERC20(assets).balanceOf(address(this));                                                                                                                                        │
│             IERC20(assets).approve(address(bondNFT), type(uint256).max);                                                                                                                                        │
│             bondNFT.distribute(assets, balanceAfter - balanceBefore);                                                                                                                                           │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function lock(                                                                                                                                                                                              │
│         address _asset,                                                                                                                                                                                         │
│         uint _amount,                                                                                                                                                                                           │
│         uint _period                                                                                                                                                                                            │
│     ) public {                                                                                                                                                                                                  │
│         require(_period <= maxPeriod, "MAX PERIOD");                                                                                                                                                            │
│         require(_period >= minPeriod, "MIN PERIOD");                                                                                                                                                            │
│         require(allowedAssets[_asset], "!asset");                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         claimGovFees();                                                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         IERC20(_asset).transferFrom(msg.sender, address(this), _amount);                                                                                                                                        │
│         totalLocked[_asset] += _amount;                                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         bondNFT.createLock( _asset, _amount, _period, msg.sender);                                                                                                                                              │
│     }                                                                                                                                                                                                           │
│     function claimGovFees() public {                                                                                                                                                                            │
│         address[] memory assets = bondNFT.getAssets();                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         for (uint i=0; i < assets.length; i++) {                                                                                                                                                                │
│             uint balanceBefore = IERC20(assets).balanceOf(address(this));                                                                                                                                       │
│             IGovNFT(govNFT).claim(assets);                                                                                                                                                                      │
│             uint balanceAfter = IERC20(assets).balanceOf(address(this));                                                                                                                                        │
│             IERC20(assets).approve(address(bondNFT), type(uint256).max);                                                                                                                                        │
│             bondNFT.distribute(assets, balanceAfter - balanceBefore);                                                                                                                                           │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function claimDebt(                                                                                                                                                                                         │
│         address _tigAsset                                                                                                                                                                                       │
│     ) external {                                                                                                                                                                                                │
│         claimGovFees();                                                                                                                                                                                         │
│         uint amount = bondNFT.claimDebt(msg.sender, _tigAsset);                                                                                                                                                 │
│         IERC20(_tigAsset).transfer(msg.sender, amount);                                                                                                                                                         │
│     }                                                                                                                                                                                                           │
│     function claimGovFees() public {                                                                                                                                                                            │
│         address[] memory assets = bondNFT.getAssets();                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         for (uint i=0; i < assets.length; i++) {                                                                                                                                                                │
│             uint balanceBefore = IERC20(assets).balanceOf(address(this));                                                                                                                                       │
│             IGovNFT(govNFT).claim(assets);                                                                                                                                                                      │
│             uint balanceAfter = IERC20(assets).balanceOf(address(this));                                                                                                                                        │
│             IERC20(assets).approve(address(bondNFT), type(uint256).max);                                                                                                                                        │
│             bondNFT.distribute(assets, balanceAfter - balanceBefore);                                                                                                                                           │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function trades(uint _id) public view returns (Trade memory) {                                                                                                                                              │
│         Trade memory _trade = _trades[_id];                                                                                                                                                                     │
│         _trade.trader = ownerOf(_id);                                                                                                                                                                           │
│         if (_trade.orderType > 0) return _trade;                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         int256 _pendingFunding;                                                                                                                                                                                 │
│         if (_trade.direction && longOi[_trade.asset][_trade.tigAsset] > 0) {                                                                                                                                    │
│             _pendingFunding = (int256(block.timestamp-lastUpdate[_trade.asset][_trade.tigAsset])*fundingDeltaPerSec[_trade.asset][_trade.tigAsset])*1e18/int256(longOi[_trade.asset][_trade.tigAsset]);         │
│             if (longOi[_trade.asset][_trade.tigAsset] > shortOi[_trade.asset][_trade.tigAsset]) {                                                                                                               │
│                 _pendingFunding = -_pendingFunding;                                                                                                                                                             │
│             } else {                                                                                                                                                                                            │
│                 _pendingFunding = _pendingFunding*int256(1e10-vaultFundingPercent[_trade.asset][_trade.tigAsset])/1e10;                                                                                         │
│             }                                                                                                                                                                                                   │
│         } else if (shortOi[_trade.asset][_trade.tigAsset] > 0) {                                                                                                                                                │
│             _pendingFunding = (int256(block.timestamp-lastUpdate[_trade.asset][_trade.tigAsset])*fundingDeltaPerSec[_trade.asset][_trade.tigAsset])*1e18/int256(shortOi[_trade.asset][_trade.tigAsset]);        │
│             if (shortOi[_trade.asset][_trade.tigAsset] > longOi[_trade.asset][_trade.tigAsset]) {                                                                                                               │
│                 _pendingFunding = -_pendingFunding;                                                                                                                                                             │
│             } else {                                                                                                                                                                                            │
│                 _pendingFunding = _pendingFunding*int256(1e10-vaultFundingPercent[_trade.asset][_trade.tigAsset])/1e10;                                                                                         │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         _trade.accInterest += (int256(_trade.margin*_trade.leverage/1e18)*(accInterestPerOi[_trade.asset][_trade.tigAsset][_trade.direction]+_pendingFunding)/1e18)-initId[_id];                                │
│                                                                                                                                                                                                                 │
│         return _trade;                                                                                                                                                                                          │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                      │
│ Code:                                                                                                                                                                                                           │
│     function trades(uint _id) public view returns (Trade memory) {                                                                                                                                              │
│         Trade memory _trade = _trades[_id];                                                                                                                                                                     │
│         _trade.trader = ownerOf(_id);                                                                                                                                                                           │
│         if (_trade.orderType > 0) return _trade;                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         int256 _pendingFunding;                                                                                                                                                                                 │
│         if (_trade.direction && longOi[_trade.asset][_trade.tigAsset] > 0) {                                                                                                                                    │
│             _pendingFunding = (int256(block.timestamp-lastUpdate[_trade.asset][_trade.tigAsset])*fundingDeltaPerSec[_trade.asset][_trade.tigAsset])*1e18/int256(longOi[_trade.asset][_trade.tigAsset]);         │
│             if (longOi[_trade.asset][_trade.tigAsset] > shortOi[_trade.asset][_trade.tigAsset]) {                                                                                                               │
│                 _pendingFunding = -_pendingFunding;                                                                                                                                                             │
│             } else {                                                                                                                                                                                            │
│                 _pendingFunding = _pendingFunding*int256(1e10-vaultFundingPercent[_trade.asset][_trade.tigAsset])/1e10;                                                                                         │
│             }                                                                                                                                                                                                   │
│         } else if (shortOi[_trade.asset][_trade.tigAsset] > 0) {                                                                                                                                                │
│             _pendingFunding = (int256(block.timestamp-lastUpdate[_trade.asset][_trade.tigAsset])*fundingDeltaPerSec[_trade.asset][_trade.tigAsset])*1e18/int256(shortOi[_trade.asset][_trade.tigAsset]);        │
│             if (shortOi[_trade.asset][_trade.tigAsset] > longOi[_trade.asset][_trade.tigAsset]) {                                                                                                               │
│                 _pendingFunding = -_pendingFunding;                                                                                                                                                             │
│             } else {                                                                                                                                                                                            │
│                 _pendingFunding = _pendingFunding*int256(1e10-vaultFundingPercent[_trade.asset][_trade.tigAsset])/1e10;                                                                                         │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         _trade.accInterest += (int256(_trade.margin*_trade.leverage/1e18)*(accInterestPerOi[_trade.asset][_trade.tigAsset][_trade.direction]+_pendingFunding)/1e18)-initId[_id];                                │
│                                                                                                                                                                                                                 │
│         return _trade;                                                                                                                                                                                          │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function updateFunding(uint256 _asset, address _tigAsset, uint256 _longOi, uint256 _shortOi, uint256 _baseFundingRate, uint _vaultFundingPercent) external onlyMinter {                                     │
│         if(longOi[_asset][_tigAsset] < shortOi[_asset][_tigAsset]) {                                                                                                                                            │
│             if (longOi[_asset][_tigAsset] > 0) {                                                                                                                                                                │
│                 accInterestPerOi[_asset][_tigAsset] +=                                                                                                                                                          │
│ ((int256(block.timestamp-lastUpdate[_asset][_tigAsset])*fundingDeltaPerSec[_asset][_tigAsset])*1e18/int256(longOi[_asset][_tigAsset]))*int256(1e10-vaultFundingPercent[_asset][_tigAsset])/1e10;                │
│             }                                                                                                                                                                                                   │
│             accInterestPerOi[_asset][_tigAsset] -= (int256(block.timestamp-lastUpdate[_asset][_tigAsset])*fundingDeltaPerSec[_asset][_tigAsset])*1e18/int256(shortOi[_asset][_tigAsset]);                       │
│                                                                                                                                                                                                                 │
│         } else if(longOi[_asset][_tigAsset] > shortOi[_asset][_tigAsset]) {                                                                                                                                     │
│             accInterestPerOi[_asset][_tigAsset] -= (int256(block.timestamp-lastUpdate[_asset][_tigAsset])*fundingDeltaPerSec[_asset][_tigAsset])*1e18/int256(longOi[_asset][_tigAsset]);                        │
│             if (shortOi[_asset][_tigAsset] > 0) {                                                                                                                                                               │
│                 accInterestPerOi[_asset][_tigAsset] +=                                                                                                                                                          │
│ ((int256(block.timestamp-lastUpdate[_asset][_tigAsset])*fundingDeltaPerSec[_asset][_tigAsset])*1e18/int256(shortOi[_asset][_tigAsset]))*int256(1e10-vaultFundingPercent[_asset][_tigAsset])/1e10;               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         lastUpdate[_asset][_tigAsset] = block.timestamp;                                                                                                                                                        │
│         int256 _oiDelta;                                                                                                                                                                                        │
│         if (_longOi > _shortOi) {                                                                                                                                                                               │
│             _oiDelta = int256(_longOi)-int256(_shortOi);                                                                                                                                                        │
│         } else {                                                                                                                                                                                                │
│             _oiDelta = int256(_shortOi)-int256(_longOi);                                                                                                                                                        │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         fundingDeltaPerSec[_asset][_tigAsset] = (_oiDelta*int256(_baseFundingRate)/int256(DIVISION_CONSTANT))/31536000;                                                                                         │
│         longOi[_asset][_tigAsset] = _longOi;                                                                                                                                                                    │
│         shortOi[_asset][_tigAsset] = _shortOi;                                                                                                                                                                  │
│         vaultFundingPercent[_asset][_tigAsset] = _vaultFundingPercent;                                                                                                                                          │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                      │
│ Code:                                                                                                                                                                                                           │
│     function updateFunding(uint256 _asset, address _tigAsset, uint256 _longOi, uint256 _shortOi, uint256 _baseFundingRate, uint _vaultFundingPercent) external onlyMinter {                                     │
│         if(longOi[_asset][_tigAsset] < shortOi[_asset][_tigAsset]) {                                                                                                                                            │
│             if (longOi[_asset][_tigAsset] > 0) {                                                                                                                                                                │
│                 accInterestPerOi[_asset][_tigAsset] +=                                                                                                                                                          │
│ ((int256(block.timestamp-lastUpdate[_asset][_tigAsset])*fundingDeltaPerSec[_asset][_tigAsset])*1e18/int256(longOi[_asset][_tigAsset]))*int256(1e10-vaultFundingPercent[_asset][_tigAsset])/1e10;                │
│             }                                                                                                                                                                                                   │
│             accInterestPerOi[_asset][_tigAsset] -= (int256(block.timestamp-lastUpdate[_asset][_tigAsset])*fundingDeltaPerSec[_asset][_tigAsset])*1e18/int256(shortOi[_asset][_tigAsset]);                       │
│                                                                                                                                                                                                                 │
│         } else if(longOi[_asset][_tigAsset] > shortOi[_asset][_tigAsset]) {                                                                                                                                     │
│             accInterestPerOi[_asset][_tigAsset] -= (int256(block.timestamp-lastUpdate[_asset][_tigAsset])*fundingDeltaPerSec[_asset][_tigAsset])*1e18/int256(longOi[_asset][_tigAsset]);                        │
│             if (shortOi[_asset][_tigAsset] > 0) {                                                                                                                                                               │
│                 accInterestPerOi[_asset][_tigAsset] +=                                                                                                                                                          │
│ ((int256(block.timestamp-lastUpdate[_asset][_tigAsset])*fundingDeltaPerSec[_asset][_tigAsset])*1e18/int256(shortOi[_asset][_tigAsset]))*int256(1e10-vaultFundingPercent[_asset][_tigAsset])/1e10;               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         lastUpdate[_asset][_tigAsset] = block.timestamp;                                                                                                                                                        │
│         int256 _oiDelta;                                                                                                                                                                                        │
│         if (_longOi > _shortOi) {                                                                                                                                                                               │
│             _oiDelta = int256(_longOi)-int256(_shortOi);                                                                                                                                                        │
│         } else {                                                                                                                                                                                                │
│             _oiDelta = int256(_shortOi)-int256(_longOi);                                                                                                                                                        │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         fundingDeltaPerSec[_asset][_tigAsset] = (_oiDelta*int256(_baseFundingRate)/int256(DIVISION_CONSTANT))/31536000;                                                                                         │
│         longOi[_asset][_tigAsset] = _longOi;                                                                                                                                                                    │
│         shortOi[_asset][_tigAsset] = _shortOi;                                                                                                                                                                  │
│         vaultFundingPercent[_asset][_tigAsset] = _vaultFundingPercent;                                                                                                                                          │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function mint(                                                                                                                                                                                              │
│         MintTrade memory _mintTrade                                                                                                                                                                             │
│     ) external onlyMinter {                                                                                                                                                                                     │
│         uint newTokenID = _tokenIds.current();                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         Trade storage newTrade = _trades;                                                                                                                                                                       │
│         newTrade.margin = _mintTrade.margin;                                                                                                                                                                    │
│         newTrade.leverage = _mintTrade.leverage;                                                                                                                                                                │
│         newTrade.asset = _mintTrade.asset;                                                                                                                                                                      │
│         newTrade.direction = _mintTrade.direction;                                                                                                                                                              │
│         newTrade.price = _mintTrade.price;                                                                                                                                                                      │
│         newTrade.tpPrice = _mintTrade.tp;                                                                                                                                                                       │
│         newTrade.slPrice = _mintTrade.sl;                                                                                                                                                                       │
│         newTrade.orderType = _mintTrade.orderType;                                                                                                                                                              │
│         newTrade.id = newTokenID;                                                                                                                                                                               │
│         newTrade.tigAsset = _mintTrade.tigAsset;                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         _safeMint(_mintTrade.account, newTokenID);                                                                                                                                                              │
│         if (_mintTrade.orderType > 0) {                                                                                                                                                                         │
│             _limitOrders[_mintTrade.asset].push(newTokenID);                                                                                                                                                    │
│             _limitOrderIndexes[_mintTrade.asset] = _limitOrders[_mintTrade.asset].length-1;                                                                                                                     │
│         } else {                                                                                                                                                                                                │
│             initId = accInterestPerOi[_mintTrade.asset][_mintTrade.tigAsset][_mintTrade.direction]*int256(_mintTrade.margin*_mintTrade.leverage/1e18)/1e18;                                                     │
│             _openPositions.push(newTokenID);                                                                                                                                                                    │
│             _openPositionsIndexes = _openPositions.length-1;                                                                                                                                                    │
│                                                                                                                                                                                                                 │
│             _assetOpenPositions[_mintTrade.asset].push(newTokenID);                                                                                                                                             │
│             _assetOpenPositionsIndexes[_mintTrade.asset] = _assetOpenPositions[_mintTrade.asset].length-1;                                                                                                      │
│         }                                                                                                                                                                                                       │
│         _tokenIds.increment();                                                                                                                                                                                  │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function executeLimitOrder(uint256 _id, uint256 _price, uint256 _newMargin) external onlyMinter {                                                                                                           │
│         Trade storage _trade = _trades[_id];                                                                                                                                                                    │
│         if (_trade.orderType == 0) {                                                                                                                                                                            │
│             return;                                                                                                                                                                                             │
│         }                                                                                                                                                                                                       │
│         _trade.orderType = 0;                                                                                                                                                                                   │
│         _trade.price = _price;                                                                                                                                                                                  │
│         _trade.margin = _newMargin;                                                                                                                                                                             │
│         uint _asset = _trade.asset;                                                                                                                                                                             │
│         _limitOrderIndexes[_asset][_limitOrders[_asset][_limitOrders[_asset].length-1]] = _limitOrderIndexes[_asset][_id];                                                                                      │
│         _limitOrders[_asset][_limitOrderIndexes[_asset][_id]] = _limitOrders[_asset][_limitOrders[_asset].length-1];                                                                                            │
│         delete _limitOrderIndexes[_asset][_id];                                                                                                                                                                 │
│         _limitOrders[_asset].pop();                                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         _openPositions.push(_id);                                                                                                                                                                               │
│         _openPositionsIndexes[_id] = _openPositions.length-1;                                                                                                                                                   │
│         _assetOpenPositions[_asset].push(_id);                                                                                                                                                                  │
│         _assetOpenPositionsIndexes[_asset][_id] = _assetOpenPositions[_asset].length-1;                                                                                                                         │
│                                                                                                                                                                                                                 │
│         initId[_id] = accInterestPerOi[_trade.asset][_trade.tigAsset][_trade.direction]*int256(_trade.margin*_trade.leverage/1e18)/1e18;                                                                        │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function addToPosition(uint256 _id, uint256 _newMargin, uint256 _newPrice) external onlyMinter {                                                                                                            │
│         _trades[_id].margin = _newMargin;                                                                                                                                                                       │
│         _trades[_id].price = _newPrice;                                                                                                                                                                         │
│         initId[_id] = accInterestPerOi[_trades[_id].asset][_trades[_id].tigAsset][_trades[_id].direction]*int256(_newMargin*_trades[_id].leverage/1e18)/1e18;                                                   │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function reducePosition(uint256 _id, uint256 _percent) external onlyMinter {                                                                                                                                │
│         _trades[_id].accInterest -= _trades[_id].accInterest*int256(_percent)/int256(DIVISION_CONSTANT);                                                                                                        │
│         _trades[_id].margin -= _trades[_id].margin*_percent/DIVISION_CONSTANT;                                                                                                                                  │
│         initId[_id] = accInterestPerOi[_trades[_id].asset][_trades[_id].tigAsset][_trades[_id].direction]*int256(_trades[_id].margin*_trades[_id].leverage/1e18)/1e18;                                          │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function userTrades(address _user) external view returns (uint[] memory) {                                                                                                                                  │
│         uint[] memory _ids = new uint[](balanceOf(_user));                                                                                                                                                      │
│         for (uint i=0; i<_ids.length; i++) {                                                                                                                                                                    │
│             _ids = tokenOfOwnerByIndex(_user, i);                                                                                                                                                               │
│         }                                                                                                                                                                                                       │
│         return _ids;                                                                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function _burn(uint256 tokenId) internal override {                                                                                                                                                         │
│         address owner = ownerOf(tokenId);                                                                                                                                                                       │
│         for (uint i=0; i<assetsLength(); i++) {                                                                                                                                                                 │
│             userDebt[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│             userDebt[assets] -= userPaid[assets]/balanceOf(owner);                                                                                                                                              │
│             userPaid[assets] -= userPaid[assets]/balanceOf(owner);                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│         super._burn(tokenId);                                                                                                                                                                                   │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function crossChain(                                                                                                                                                                                        │
│         uint16 _dstChainId,                                                                                                                                                                                     │
│         bytes memory _destination,                                                                                                                                                                              │
│         address _to,                                                                                                                                                                                            │
│         uint256[] memory tokenId                                                                                                                                                                                │
│     ) public payable {                                                                                                                                                                                          │
│         require(tokenId.length > 0, "Not bridging");                                                                                                                                                            │
│         for (uint i=0; i<tokenId.length; i++) {                                                                                                                                                                 │
│             require(_msgSender() == ownerOf(tokenId), "Not the owner");                                                                                                                                         │
│             // burn NFT                                                                                                                                                                                         │
│             _burn(tokenId);                                                                                                                                                                                     │
│         }                                                                                                                                                                                                       │
│         address targetAddress;                                                                                                                                                                                  │
│         assembly {                                                                                                                                                                                              │
│             targetAddress := mload(add(_destination, 20))                                                                                                                                                       │
│         }                                                                                                                                                                                                       │
│         require(isTrustedAddress[_dstChainId], "!Trusted");                                                                                                                                                     │
│         bytes memory payload = abi.encode(_to, tokenId);                                                                                                                                                        │
│         // encode adapterParams to specify more gas for the destination                                                                                                                                         │
│         uint16 version = 1;                                                                                                                                                                                     │
│         uint256 _gas = 500_000 + gas*tokenId.length;                                                                                                                                                            │
│         bytes memory adapterParams = abi.encodePacked(version, _gas);                                                                                                                                           │
│         (uint256 messageFee, ) = endpoint.estimateFees(                                                                                                                                                         │
│             _dstChainId,                                                                                                                                                                                        │
│             address(this),                                                                                                                                                                                      │
│             payload,                                                                                                                                                                                            │
│             false,                                                                                                                                                                                              │
│             adapterParams                                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             msg.value >= messageFee,                                                                                                                                                                            │
│             "Must send enough value to cover messageFee"                                                                                                                                                        │
│         );                                                                                                                                                                                                      │
│         endpoint.send{value: msg.value}(                                                                                                                                                                        │
│             _dstChainId,                                                                                                                                                                                        │
│             _destination,                                                                                                                                                                                       │
│             payload,                                                                                                                                                                                            │
│             payable(_msgSender()),                                                                                                                                                                              │
│             address(0x0),                                                                                                                                                                                       │
│             adapterParams                                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│     }                                                                                                                                                                                                           │
│     function _burn(uint256 tokenId) internal override {                                                                                                                                                         │
│         address owner = ownerOf(tokenId);                                                                                                                                                                       │
│         for (uint i=0; i<assetsLength(); i++) {                                                                                                                                                                 │
│             userDebt[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│             userDebt[assets] -= userPaid[assets]/balanceOf(owner);                                                                                                                                              │
│             userPaid[assets] -= userPaid[assets]/balanceOf(owner);                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│         super._burn(tokenId);                                                                                                                                                                                   │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function burn(uint _id) external onlyMinter {                                                                                                                                                               │
│         _burn(_id);                                                                                                                                                                                             │
│         uint _asset = _trades[_id].asset;                                                                                                                                                                       │
│         if (_trades[_id].orderType > 0) {                                                                                                                                                                       │
│             _limitOrderIndexes[_asset][_limitOrders[_asset][_limitOrders[_asset].length-1]] = _limitOrderIndexes[_asset][_id];                                                                                  │
│             _limitOrders[_asset][_limitOrderIndexes[_asset][_id]] = _limitOrders[_asset][_limitOrders[_asset].length-1];                                                                                        │
│             delete _limitOrderIndexes[_asset][_id];                                                                                                                                                             │
│             _limitOrders[_asset].pop();                                                                                                                                                                         │
│         } else {                                                                                                                                                                                                │
│             _assetOpenPositionsIndexes[_asset][_assetOpenPositions[_asset][_assetOpenPositions[_asset].length-1]] = _assetOpenPositionsIndexes[_asset][_id];                                                    │
│             _assetOpenPositions[_asset][_assetOpenPositionsIndexes[_asset][_id]] = _assetOpenPositions[_asset][_assetOpenPositions[_asset].length-1];                                                           │
│             delete _assetOpenPositionsIndexes[_asset][_id];                                                                                                                                                     │
│             _assetOpenPositions[_asset].pop();                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _openPositionsIndexes[_openPositions[_openPositions.length-1]] = _openPositionsIndexes[_id];                                                                                                        │
│             _openPositions[_openPositionsIndexes[_id]] = _openPositions[_openPositions.length-1];                                                                                                               │
│             delete _openPositionsIndexes[_id];                                                                                                                                                                  │
│             _openPositions.pop();                                                                                                                                                                               │
│         }                                                                                                                                                                                                       │
│         delete _trades[_id];                                                                                                                                                                                    │
│     }                                                                                                                                                                                                           │
│     function _burn(uint256 tokenId) internal override {                                                                                                                                                         │
│         address owner = ownerOf(tokenId);                                                                                                                                                                       │
│         for (uint i=0; i<assetsLength(); i++) {                                                                                                                                                                 │
│             userDebt[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│             userDebt[assets] -= userPaid[assets]/balanceOf(owner);                                                                                                                                              │
│             userPaid[assets] -= userPaid[assets]/balanceOf(owner);                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│         super._burn(tokenId);                                                                                                                                                                                   │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function crossChain(                                                                                                                                                                                        │
│         uint16 _dstChainId,                                                                                                                                                                                     │
│         bytes memory _destination,                                                                                                                                                                              │
│         address _to,                                                                                                                                                                                            │
│         uint256[] memory tokenId                                                                                                                                                                                │
│     ) public payable {                                                                                                                                                                                          │
│         require(tokenId.length > 0, "Not bridging");                                                                                                                                                            │
│         for (uint i=0; i<tokenId.length; i++) {                                                                                                                                                                 │
│             require(_msgSender() == ownerOf(tokenId), "Not the owner");                                                                                                                                         │
│             // burn NFT                                                                                                                                                                                         │
│             _burn(tokenId);                                                                                                                                                                                     │
│         }                                                                                                                                                                                                       │
│         address targetAddress;                                                                                                                                                                                  │
│         assembly {                                                                                                                                                                                              │
│             targetAddress := mload(add(_destination, 20))                                                                                                                                                       │
│         }                                                                                                                                                                                                       │
│         require(isTrustedAddress[_dstChainId], "!Trusted");                                                                                                                                                     │
│         bytes memory payload = abi.encode(_to, tokenId);                                                                                                                                                        │
│         // encode adapterParams to specify more gas for the destination                                                                                                                                         │
│         uint16 version = 1;                                                                                                                                                                                     │
│         uint256 _gas = 500_000 + gas*tokenId.length;                                                                                                                                                            │
│         bytes memory adapterParams = abi.encodePacked(version, _gas);                                                                                                                                           │
│         (uint256 messageFee, ) = endpoint.estimateFees(                                                                                                                                                         │
│             _dstChainId,                                                                                                                                                                                        │
│             address(this),                                                                                                                                                                                      │
│             payload,                                                                                                                                                                                            │
│             false,                                                                                                                                                                                              │
│             adapterParams                                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             msg.value >= messageFee,                                                                                                                                                                            │
│             "Must send enough value to cover messageFee"                                                                                                                                                        │
│         );                                                                                                                                                                                                      │
│         endpoint.send{value: msg.value}(                                                                                                                                                                        │
│             _dstChainId,                                                                                                                                                                                        │
│             _destination,                                                                                                                                                                                       │
│             payload,                                                                                                                                                                                            │
│             payable(_msgSender()),                                                                                                                                                                              │
│             address(0x0),                                                                                                                                                                                       │
│             adapterParams                                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│     }                                                                                                                                                                                                           │
│     function _burn(uint256 tokenId) internal override {                                                                                                                                                         │
│         address owner = ownerOf(tokenId);                                                                                                                                                                       │
│         for (uint i=0; i<assetsLength(); i++) {                                                                                                                                                                 │
│             userDebt[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│             userDebt[assets] -= userPaid[assets]/balanceOf(owner);                                                                                                                                              │
│             userPaid[assets] -= userPaid[assets]/balanceOf(owner);                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│         super._burn(tokenId);                                                                                                                                                                                   │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function release(                                                                                                                                                                                           │
│         uint _id,                                                                                                                                                                                               │
│         address _releaser                                                                                                                                                                                       │
│     ) external onlyManager() returns(uint amount, uint lockAmount, address asset, address _owner) {                                                                                                             │
│         Bond memory bond = idToBond(_id);                                                                                                                                                                       │
│         require(bond.expired, "!expire");                                                                                                                                                                       │
│         if (_releaser != bond.owner) {                                                                                                                                                                          │
│             unchecked {                                                                                                                                                                                         │
│                 require(bond.expireEpoch + 7 < epoch, "Bond owner priority");                                                                                                                                   │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         amount = bond.amount;                                                                                                                                                                                   │
│         unchecked {                                                                                                                                                                                             │
│             totalShares -= bond.shares;                                                                                                                                                                         │
│             (uint256 _claimAmount,) = claim(_id, bond.owner);                                                                                                                                                   │
│             amount += _claimAmount;                                                                                                                                                                             │
│         }                                                                                                                                                                                                       │
│         asset = bond.asset;                                                                                                                                                                                     │
│         lockAmount = bond.amount;                                                                                                                                                                               │
│         _owner = bond.owner;                                                                                                                                                                                    │
│         _burn(_id);                                                                                                                                                                                             │
│         emit Release(asset, lockAmount, _owner, _id);                                                                                                                                                           │
│     }                                                                                                                                                                                                           │
│     function _burn(uint256 tokenId) internal override {                                                                                                                                                         │
│         address owner = ownerOf(tokenId);                                                                                                                                                                       │
│         for (uint i=0; i<assetsLength(); i++) {                                                                                                                                                                 │
│             userDebt[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│             userDebt[assets] -= userPaid[assets]/balanceOf(owner);                                                                                                                                              │
│             userPaid[assets] -= userPaid[assets]/balanceOf(owner);                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│         super._burn(tokenId);                                                                                                                                                                                   │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function _transfer(                                                                                                                                                                                         │
│         address from,                                                                                                                                                                                           │
│         address to,                                                                                                                                                                                             │
│         uint256 tokenId                                                                                                                                                                                         │
│     ) internal override {                                                                                                                                                                                       │
│         require(ownerOf(tokenId) == from, "!Owner");                                                                                                                                                            │
│         for (uint i=0; i<assetsLength(); i++) {                                                                                                                                                                 │
│             userDebt[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│             userDebt[assets] -= userPaid[assets]/balanceOf(from);                                                                                                                                               │
│             userPaid[assets] -= userPaid[assets]/balanceOf(from);                                                                                                                                               │
│             userPaid[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│         }                                                                                                                                                                                                       │
│         super._transfer(from, to, tokenId);                                                                                                                                                                     │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function safeTransferMany(address _to, uint[] calldata _ids) external {                                                                                                                                     │
│         for (uint i=0; i<_ids.length; i++) {                                                                                                                                                                    │
│             _transfer(_msgSender(), _to, _ids);                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function _transfer(                                                                                                                                                                                         │
│         address from,                                                                                                                                                                                           │
│         address to,                                                                                                                                                                                             │
│         uint256 tokenId                                                                                                                                                                                         │
│     ) internal override {                                                                                                                                                                                       │
│         require(ownerOf(tokenId) == from, "!Owner");                                                                                                                                                            │
│         for (uint i=0; i<assetsLength(); i++) {                                                                                                                                                                 │
│             userDebt[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│             userDebt[assets] -= userPaid[assets]/balanceOf(from);                                                                                                                                               │
│             userPaid[assets] -= userPaid[assets]/balanceOf(from);                                                                                                                                               │
│             userPaid[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│         }                                                                                                                                                                                                       │
│         super._transfer(from, to, tokenId);                                                                                                                                                                     │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function safeTransferMany(address _to, uint[] calldata _ids) external {                                                                                                                                     │
│         for (uint i=0; i<_ids.length; i++) {                                                                                                                                                                    │
│             _transfer(_msgSender(), _to, _ids);                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function _transfer(                                                                                                                                                                                         │
│         address from,                                                                                                                                                                                           │
│         address to,                                                                                                                                                                                             │
│         uint256 tokenId                                                                                                                                                                                         │
│     ) internal override {                                                                                                                                                                                       │
│         require(ownerOf(tokenId) == from, "!Owner");                                                                                                                                                            │
│         for (uint i=0; i<assetsLength(); i++) {                                                                                                                                                                 │
│             userDebt[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│             userDebt[assets] -= userPaid[assets]/balanceOf(from);                                                                                                                                               │
│             userPaid[assets] -= userPaid[assets]/balanceOf(from);                                                                                                                                               │
│             userPaid[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│         }                                                                                                                                                                                                       │
│         super._transfer(from, to, tokenId);                                                                                                                                                                     │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function safeTransferMany(address _to, uint[] calldata _ids) external {                                                                                                                                     │
│         unchecked {                                                                                                                                                                                             │
│             for (uint i=0; i<_ids.length; i++) {                                                                                                                                                                │
│                 _transfer(_msgSender(), _to, _ids);                                                                                                                                                             │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function _transfer(                                                                                                                                                                                         │
│         address from,                                                                                                                                                                                           │
│         address to,                                                                                                                                                                                             │
│         uint256 tokenId                                                                                                                                                                                         │
│     ) internal override {                                                                                                                                                                                       │
│         require(ownerOf(tokenId) == from, "!Owner");                                                                                                                                                            │
│         for (uint i=0; i<assetsLength(); i++) {                                                                                                                                                                 │
│             userDebt[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│             userDebt[assets] -= userPaid[assets]/balanceOf(from);                                                                                                                                               │
│             userPaid[assets] -= userPaid[assets]/balanceOf(from);                                                                                                                                               │
│             userPaid[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│         }                                                                                                                                                                                                       │
│         super._transfer(from, to, tokenId);                                                                                                                                                                     │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function distribute(address _tigAsset, uint _amount) external {                                                                                                                                             │
│         if (assets.length == 0 || assets[assetsIndex[_tigAsset]] == address(0) || totalSupply() == 0 || !_allowedAsset[_tigAsset]) return;                                                                      │
│         try IERC20(_tigAsset).transferFrom(_msgSender(), address(this), _amount) {                                                                                                                              │
│             accRewardsPerNFT[_tigAsset] += _amount/totalSupply();                                                                                                                                               │
│         } catch {                                                                                                                                                                                               │
│             return;                                                                                                                                                                                             │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function balanceIds(address _user) external view returns (uint[] memory) {                                                                                                                                  │
│         uint[] memory _ids = new uint[](balanceOf(_user));                                                                                                                                                      │
│         for (uint i=0; i<_ids.length; i++) {                                                                                                                                                                    │
│             _ids = tokenOfOwnerByIndex(_user, i);                                                                                                                                                               │
│         }                                                                                                                                                                                                       │
│         return _ids;                                                                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function addToPosition(                                                                                                                                                                                     │
│         uint _id,                                                                                                                                                                                               │
│         uint _addMargin,                                                                                                                                                                                        │
│         PriceData calldata _priceData,                                                                                                                                                                          │
│         bytes calldata _signature,                                                                                                                                                                              │
│         address _stableVault,                                                                                                                                                                                   │
│         address _marginAsset,                                                                                                                                                                                   │
│         ERC20PermitData calldata _permitData,                                                                                                                                                                   │
│         address _trader                                                                                                                                                                                         │
│     )                                                                                                                                                                                                           │
│         external                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         _validateProxy(_trader);                                                                                                                                                                                │
│         _checkOwner(_id, _trader);                                                                                                                                                                              │
│         _checkDelay(_id, true);                                                                                                                                                                                 │
│         IPosition.Trade memory _trade = position.trades(_id);                                                                                                                                                   │
│         tradingExtension.validateTrade(_trade.asset, _trade.tigAsset, _trade.margin + _addMargin, _trade.leverage);                                                                                             │
│         _checkVault(_stableVault, _marginAsset);                                                                                                                                                                │
│         if (_trade.orderType != 0) revert("4"); //IsLimit                                                                                                                                                       │
│         uint _fee = _handleOpenFees(_trade.asset, _addMargin*_trade.leverage/1e18, _trader, _trade.tigAsset, false);                                                                                            │
│         _handleDeposit(                                                                                                                                                                                         │
│             _trade.tigAsset,                                                                                                                                                                                    │
│             _marginAsset,                                                                                                                                                                                       │
│             _addMargin - _fee,                                                                                                                                                                                  │
│             _stableVault,                                                                                                                                                                                       │
│             _permitData,                                                                                                                                                                                        │
│             _trader                                                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         position.setAccInterest(_id);                                                                                                                                                                           │
│         unchecked {                                                                                                                                                                                             │
│             (uint256 _price,) = tradingExtension.getVerifiedPrice(_trade.asset, _priceData, _signature, _trade.direction ? 1 : 2);                                                                              │
│             uint _positionSize = (_addMargin - _fee) * _trade.leverage / 1e18;                                                                                                                                  │
│             if (_trade.direction) {                                                                                                                                                                             │
│                 tradingExtension.modifyLongOi(_trade.asset, _trade.tigAsset, true, _positionSize);                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 tradingExtension.modifyShortOi(_trade.asset, _trade.tigAsset, true, _positionSize);                                                                                                             │
│             }                                                                                                                                                                                                   │
│             _updateFunding(_trade.asset, _trade.tigAsset);                                                                                                                                                      │
│             _addMargin -= _fee;                                                                                                                                                                                 │
│             uint _newMargin = _trade.margin + _addMargin;                                                                                                                                                       │
│             uint _newPrice = _trade.price*_trade.margin/_newMargin + _price*_addMargin/_newMargin;                                                                                                              │
│                                                                                                                                                                                                                 │
│             position.addToPosition(                                                                                                                                                                             │
│                 _trade.id,                                                                                                                                                                                      │
│                 _newMargin,                                                                                                                                                                                     │
│                 _newPrice                                                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             emit AddToPosition(_trade.id, _newMargin, _newPrice, _trade.trader);                                                                                                                                │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                      │
│ Code:                                                                                                                                                                                                           │
│     function addToPosition(                                                                                                                                                                                     │
│         uint _id,                                                                                                                                                                                               │
│         uint _addMargin,                                                                                                                                                                                        │
│         PriceData calldata _priceData,                                                                                                                                                                          │
│         bytes calldata _signature,                                                                                                                                                                              │
│         address _stableVault,                                                                                                                                                                                   │
│         address _marginAsset,                                                                                                                                                                                   │
│         ERC20PermitData calldata _permitData,                                                                                                                                                                   │
│         address _trader                                                                                                                                                                                         │
│     )                                                                                                                                                                                                           │
│         external                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         _validateProxy(_trader);                                                                                                                                                                                │
│         _checkOwner(_id, _trader);                                                                                                                                                                              │
│         _checkDelay(_id, true);                                                                                                                                                                                 │
│         IPosition.Trade memory _trade = position.trades(_id);                                                                                                                                                   │
│         tradingExtension.validateTrade(_trade.asset, _trade.tigAsset, _trade.margin + _addMargin, _trade.leverage);                                                                                             │
│         _checkVault(_stableVault, _marginAsset);                                                                                                                                                                │
│         if (_trade.orderType != 0) revert("4"); //IsLimit                                                                                                                                                       │
│         uint _fee = _handleOpenFees(_trade.asset, _addMargin*_trade.leverage/1e18, _trader, _trade.tigAsset, false);                                                                                            │
│         _handleDeposit(                                                                                                                                                                                         │
│             _trade.tigAsset,                                                                                                                                                                                    │
│             _marginAsset,                                                                                                                                                                                       │
│             _addMargin - _fee,                                                                                                                                                                                  │
│             _stableVault,                                                                                                                                                                                       │
│             _permitData,                                                                                                                                                                                        │
│             _trader                                                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         position.setAccInterest(_id);                                                                                                                                                                           │
│         unchecked {                                                                                                                                                                                             │
│             (uint256 _price,) = tradingExtension.getVerifiedPrice(_trade.asset, _priceData, _signature, _trade.direction ? 1 : 2);                                                                              │
│             uint _positionSize = (_addMargin - _fee) * _trade.leverage / 1e18;                                                                                                                                  │
│             if (_trade.direction) {                                                                                                                                                                             │
│                 tradingExtension.modifyLongOi(_trade.asset, _trade.tigAsset, true, _positionSize);                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 tradingExtension.modifyShortOi(_trade.asset, _trade.tigAsset, true, _positionSize);                                                                                                             │
│             }                                                                                                                                                                                                   │
│             _updateFunding(_trade.asset, _trade.tigAsset);                                                                                                                                                      │
│             _addMargin -= _fee;                                                                                                                                                                                 │
│             uint _newMargin = _trade.margin + _addMargin;                                                                                                                                                       │
│             uint _newPrice = _trade.price*_trade.margin/_newMargin + _price*_addMargin/_newMargin;                                                                                                              │
│                                                                                                                                                                                                                 │
│             position.addToPosition(                                                                                                                                                                             │
│                 _trade.id,                                                                                                                                                                                      │
│                 _newMargin,                                                                                                                                                                                     │
│                 _newPrice                                                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             emit AddToPosition(_trade.id, _newMargin, _newPrice, _trade.trader);                                                                                                                                │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function removeMargin(                                                                                                                                                                                      │
│         uint256 _id,                                                                                                                                                                                            │
│         address _stableVault,                                                                                                                                                                                   │
│         address _outputToken,                                                                                                                                                                                   │
│         uint256 _removeMargin,                                                                                                                                                                                  │
│         PriceData calldata _priceData,                                                                                                                                                                          │
│         bytes calldata _signature,                                                                                                                                                                              │
│         address _trader                                                                                                                                                                                         │
│     )                                                                                                                                                                                                           │
│         external                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         _validateProxy(_trader);                                                                                                                                                                                │
│         _checkOwner(_id, _trader);                                                                                                                                                                              │
│         _checkVault(_stableVault, _outputToken);                                                                                                                                                                │
│         IPosition.Trade memory _trade = position.trades(_id);                                                                                                                                                   │
│         if (_trade.orderType != 0) revert(); //IsLimit                                                                                                                                                          │
│         IPairsContract.Asset memory asset = pairsContract.idToAsset(_trade.asset);                                                                                                                              │
│         uint256 _newMargin = _trade.margin - _removeMargin;                                                                                                                                                     │
│         uint256 _newLeverage = _trade.margin * _trade.leverage / _newMargin;                                                                                                                                    │
│         if (_newLeverage > asset.maxLeverage) revert("!lev");                                                                                                                                                   │
│         (uint _assetPrice,) = tradingExtension.getVerifiedPrice(_trade.asset, _priceData, _signature, 0);                                                                                                       │
│         (,int256 _payout) = TradingLibrary.pnl(_trade.direction, _assetPrice, _trade.price, _newMargin, _newLeverage, _trade.accInterest);                                                                      │
│         unchecked {                                                                                                                                                                                             │
│             if (_payout <= int256(_newMargin*(DIVISION_CONSTANT-liqPercent)/DIVISION_CONSTANT)) revert LiqThreshold();                                                                                          │
│         }                                                                                                                                                                                                       │
│         position.modifyMargin(_trade.id, _newMargin, _newLeverage);                                                                                                                                             │
│         _handleWithdraw(_trade, _stableVault, _outputToken, _removeMargin);                                                                                                                                     │
│         emit MarginModified(_trade.id, _newMargin, _newLeverage, false, _trader);                                                                                                                               │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                      │
│ Code:                                                                                                                                                                                                           │
│     function removeMargin(                                                                                                                                                                                      │
│         uint256 _id,                                                                                                                                                                                            │
│         address _stableVault,                                                                                                                                                                                   │
│         address _outputToken,                                                                                                                                                                                   │
│         uint256 _removeMargin,                                                                                                                                                                                  │
│         PriceData calldata _priceData,                                                                                                                                                                          │
│         bytes calldata _signature,                                                                                                                                                                              │
│         address _trader                                                                                                                                                                                         │
│     )                                                                                                                                                                                                           │
│         external                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         _validateProxy(_trader);                                                                                                                                                                                │
│         _checkOwner(_id, _trader);                                                                                                                                                                              │
│         _checkVault(_stableVault, _outputToken);                                                                                                                                                                │
│         IPosition.Trade memory _trade = position.trades(_id);                                                                                                                                                   │
│         if (_trade.orderType != 0) revert(); //IsLimit                                                                                                                                                          │
│         IPairsContract.Asset memory asset = pairsContract.idToAsset(_trade.asset);                                                                                                                              │
│         uint256 _newMargin = _trade.margin - _removeMargin;                                                                                                                                                     │
│         uint256 _newLeverage = _trade.margin * _trade.leverage / _newMargin;                                                                                                                                    │
│         if (_newLeverage > asset.maxLeverage) revert("!lev");                                                                                                                                                   │
│         (uint _assetPrice,) = tradingExtension.getVerifiedPrice(_trade.asset, _priceData, _signature, 0);                                                                                                       │
│         (,int256 _payout) = TradingLibrary.pnl(_trade.direction, _assetPrice, _trade.price, _newMargin, _newLeverage, _trade.accInterest);                                                                      │
│         unchecked {                                                                                                                                                                                             │
│             if (_payout <= int256(_newMargin*(DIVISION_CONSTANT-liqPercent)/DIVISION_CONSTANT)) revert LiqThreshold();                                                                                          │
│         }                                                                                                                                                                                                       │
│         position.modifyMargin(_trade.id, _newMargin, _newLeverage);                                                                                                                                             │
│         _handleWithdraw(_trade, _stableVault, _outputToken, _removeMargin);                                                                                                                                     │
│         emit MarginModified(_trade.id, _newMargin, _newLeverage, false, _trader);                                                                                                                               │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function liquidatePosition(                                                                                                                                                                                 │
│         uint _id,                                                                                                                                                                                               │
│         PriceData calldata _priceData,                                                                                                                                                                          │
│         bytes calldata _signature                                                                                                                                                                               │
│     )                                                                                                                                                                                                           │
│         external                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         unchecked {                                                                                                                                                                                             │
│             tradingExtension._checkGas();                                                                                                                                                                       │
│             IPosition.Trade memory _trade = position.trades(_id);                                                                                                                                               │
│             if (_trade.orderType != 0) revert("4"); //IsLimit                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│             (uint256 _price,) = tradingExtension.getVerifiedPrice(_trade.asset, _priceData, _signature, 0);                                                                                                     │
│             (uint256 _positionSizeAfterPrice, int256 _payout) = TradingLibrary.pnl(_trade.direction, _price, _trade.price, _trade.margin, _trade.leverage, _trade.accInterest);                                 │
│             uint256 _positionSize = _trade.margin*_trade.leverage/1e18;                                                                                                                                         │
│             if (_payout > int256(_trade.margin*(DIVISION_CONSTANT-liqPercent)/DIVISION_CONSTANT)) revert NotLiquidatable();                                                                                     │
│             if (_trade.direction) {                                                                                                                                                                             │
│                 tradingExtension.modifyLongOi(_trade.asset, _trade.tigAsset, false, _positionSize);                                                                                                             │
│             } else {                                                                                                                                                                                            │
│                 tradingExtension.modifyShortOi(_trade.asset, _trade.tigAsset, false, _positionSize);                                                                                                            │
│             }                                                                                                                                                                                                   │
│             _updateFunding(_trade.asset, _trade.tigAsset);                                                                                                                                                      │
│             _handleCloseFees(_trade.asset, type(uint).max, _trade.tigAsset, _positionSizeAfterPrice, _trade.trader, true);                                                                                      │
│             position.burn(_id);                                                                                                                                                                                 │
│             emit PositionLiquidated(_id, _trade.trader, _msgSender());                                                                                                                                          │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function _closePosition(                                                                                                                                                                                    │
│         uint _id,                                                                                                                                                                                               │
│         uint _percent,                                                                                                                                                                                          │
│         uint _price,                                                                                                                                                                                            │
│         address _stableVault,                                                                                                                                                                                   │
│         address _outputToken,                                                                                                                                                                                   │
│         bool _isBot                                                                                                                                                                                             │
│     )                                                                                                                                                                                                           │
│         internal                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         (IPosition.Trade memory _trade, uint256 _positionSize, int256 _payout) = tradingExtension._closePosition(_id, _price, _percent);                                                                        │
│         position.setAccInterest(_id);                                                                                                                                                                           │
│         _updateFunding(_trade.asset, _trade.tigAsset);                                                                                                                                                          │
│         if (_percent < DIVISION_CONSTANT) {                                                                                                                                                                     │
│             if ((_trade.margin*_trade.leverage*(DIVISION_CONSTANT-_percent)/DIVISION_CONSTANT)/1e18 < tradingExtension.minPos(_trade.tigAsset)) revert("!size");                                                │
│             position.reducePosition(_id, _percent);                                                                                                                                                             │
│         } else {                                                                                                                                                                                                │
│             position.burn(_id);                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│         uint256 _toMint;                                                                                                                                                                                        │
│         if (_payout > 0) {                                                                                                                                                                                      │
│             unchecked {                                                                                                                                                                                         │
│                 _toMint = _handleCloseFees(_trade.asset, uint256(_payout)*_percent/DIVISION_CONSTANT, _trade.tigAsset, _positionSize*_percent/DIVISION_CONSTANT, _trade.trader, _isBot);                        │
│                 if (maxWinPercent > 0 && _toMint > _trade.margin*maxWinPercent/DIVISION_CONSTANT) {                                                                                                             │
│                     _toMint = _trade.margin*maxWinPercent/DIVISION_CONSTANT;                                                                                                                                    │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│             _handleWithdraw(_trade, _stableVault, _outputToken, _toMint);                                                                                                                                       │
│         }                                                                                                                                                                                                       │
│         emit PositionClosed(_id, _price, _percent, _toMint, _trade.trader, _isBot ? _msgSender() : _trade.trader);                                                                                              │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                      │
│ Code:                                                                                                                                                                                                           │
│     function _closePosition(                                                                                                                                                                                    │
│         uint _id,                                                                                                                                                                                               │
│         uint _percent,                                                                                                                                                                                          │
│         uint _price,                                                                                                                                                                                            │
│         address _stableVault,                                                                                                                                                                                   │
│         address _outputToken,                                                                                                                                                                                   │
│         bool _isBot                                                                                                                                                                                             │
│     )                                                                                                                                                                                                           │
│         internal                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         (IPosition.Trade memory _trade, uint256 _positionSize, int256 _payout) = tradingExtension._closePosition(_id, _price, _percent);                                                                        │
│         position.setAccInterest(_id);                                                                                                                                                                           │
│         _updateFunding(_trade.asset, _trade.tigAsset);                                                                                                                                                          │
│         if (_percent < DIVISION_CONSTANT) {                                                                                                                                                                     │
│             if ((_trade.margin*_trade.leverage*(DIVISION_CONSTANT-_percent)/DIVISION_CONSTANT)/1e18 < tradingExtension.minPos(_trade.tigAsset)) revert("!size");                                                │
│             position.reducePosition(_id, _percent);                                                                                                                                                             │
│         } else {                                                                                                                                                                                                │
│             position.burn(_id);                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│         uint256 _toMint;                                                                                                                                                                                        │
│         if (_payout > 0) {                                                                                                                                                                                      │
│             unchecked {                                                                                                                                                                                         │
│                 _toMint = _handleCloseFees(_trade.asset, uint256(_payout)*_percent/DIVISION_CONSTANT, _trade.tigAsset, _positionSize*_percent/DIVISION_CONSTANT, _trade.trader, _isBot);                        │
│                 if (maxWinPercent > 0 && _toMint > _trade.margin*maxWinPercent/DIVISION_CONSTANT) {                                                                                                             │
│                     _toMint = _trade.margin*maxWinPercent/DIVISION_CONSTANT;                                                                                                                                    │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│             _handleWithdraw(_trade, _stableVault, _outputToken, _toMint);                                                                                                                                       │
│         }                                                                                                                                                                                                       │
│         emit PositionClosed(_id, _price, _percent, _toMint, _trade.trader, _isBot ? _msgSender() : _trade.trader);                                                                                              │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function _handleDeposit(address _tigAsset, address _marginAsset, uint256 _margin, address _stableVault, ERC20PermitData calldata _permitData, address _trader) internal {                                   │
│         IStable tigAsset = IStable(_tigAsset);                                                                                                                                                                  │
│         if (_tigAsset != _marginAsset) {                                                                                                                                                                        │
│             if (_permitData.usePermit) {                                                                                                                                                                        │
│                 ERC20Permit(_marginAsset).permit(_trader, address(this), _permitData.amount, _permitData.deadline, _permitData.v, _permitData.r, _permitData.s);                                                │
│             }                                                                                                                                                                                                   │
│             uint256 _balBefore = tigAsset.balanceOf(address(this));                                                                                                                                             │
│             uint _marginDecMultiplier = 10**(18-ExtendedIERC20(_marginAsset).decimals());                                                                                                                       │
│             IERC20(_marginAsset).transferFrom(_trader, address(this), _margin/_marginDecMultiplier);                                                                                                            │
│             IERC20(_marginAsset).approve(_stableVault, type(uint).max);                                                                                                                                         │
│             IStableVault(_stableVault).deposit(_marginAsset, _margin/_marginDecMultiplier);                                                                                                                     │
│             if (tigAsset.balanceOf(address(this)) != _balBefore + _margin) revert BadDeposit();                                                                                                                 │
│             tigAsset.burnFrom(address(this), tigAsset.balanceOf(address(this)));                                                                                                                                │
│         } else {                                                                                                                                                                                                │
│             tigAsset.burnFrom(_trader, _margin);                                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function addMargin(                                                                                                                                                                                         │
│         uint256 _id,                                                                                                                                                                                            │
│         address _marginAsset,                                                                                                                                                                                   │
│         address _stableVault,                                                                                                                                                                                   │
│         uint256 _addMargin,                                                                                                                                                                                     │
│         ERC20PermitData calldata _permitData,                                                                                                                                                                   │
│         address _trader                                                                                                                                                                                         │
│     )                                                                                                                                                                                                           │
│         external                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         _validateProxy(_trader);                                                                                                                                                                                │
│         _checkOwner(_id, _trader);                                                                                                                                                                              │
│         _checkVault(_stableVault, _marginAsset);                                                                                                                                                                │
│         IPosition.Trade memory _trade = position.trades(_id);                                                                                                                                                   │
│         if (_trade.orderType != 0) revert(); //IsLimit                                                                                                                                                          │
│         IPairsContract.Asset memory asset = pairsContract.idToAsset(_trade.asset);                                                                                                                              │
│         _handleDeposit(_trade.tigAsset, _marginAsset, _addMargin, _stableVault, _permitData, _trader);                                                                                                          │
│         unchecked {                                                                                                                                                                                             │
│             uint256 _newMargin = _trade.margin + _addMargin;                                                                                                                                                    │
│             uint256 _newLeverage = _trade.margin * _trade.leverage / _newMargin;                                                                                                                                │
│             if (_newLeverage < asset.minLeverage) revert("!lev");                                                                                                                                               │
│             position.modifyMargin(_id, _newMargin, _newLeverage);                                                                                                                                               │
│             emit MarginModified(_id, _newMargin, _newLeverage, true, _trader);                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function _handleDeposit(address _tigAsset, address _marginAsset, uint256 _margin, address _stableVault, ERC20PermitData calldata _permitData, address _trader) internal {                                   │
│         IStable tigAsset = IStable(_tigAsset);                                                                                                                                                                  │
│         if (_tigAsset != _marginAsset) {                                                                                                                                                                        │
│             if (_permitData.usePermit) {                                                                                                                                                                        │
│                 ERC20Permit(_marginAsset).permit(_trader, address(this), _permitData.amount, _permitData.deadline, _permitData.v, _permitData.r, _permitData.s);                                                │
│             }                                                                                                                                                                                                   │
│             uint256 _balBefore = tigAsset.balanceOf(address(this));                                                                                                                                             │
│             uint _marginDecMultiplier = 10**(18-ExtendedIERC20(_marginAsset).decimals());                                                                                                                       │
│             IERC20(_marginAsset).transferFrom(_trader, address(this), _margin/_marginDecMultiplier);                                                                                                            │
│             IERC20(_marginAsset).approve(_stableVault, type(uint).max);                                                                                                                                         │
│             IStableVault(_stableVault).deposit(_marginAsset, _margin/_marginDecMultiplier);                                                                                                                     │
│             if (tigAsset.balanceOf(address(this)) != _balBefore + _margin) revert BadDeposit();                                                                                                                 │
│             tigAsset.burnFrom(address(this), tigAsset.balanceOf(address(this)));                                                                                                                                │
│         } else {                                                                                                                                                                                                │
│             tigAsset.burnFrom(_trader, _margin);                                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function addToPosition(                                                                                                                                                                                     │
│         uint _id,                                                                                                                                                                                               │
│         uint _addMargin,                                                                                                                                                                                        │
│         PriceData calldata _priceData,                                                                                                                                                                          │
│         bytes calldata _signature,                                                                                                                                                                              │
│         address _stableVault,                                                                                                                                                                                   │
│         address _marginAsset,                                                                                                                                                                                   │
│         ERC20PermitData calldata _permitData,                                                                                                                                                                   │
│         address _trader                                                                                                                                                                                         │
│     )                                                                                                                                                                                                           │
│         external                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         _validateProxy(_trader);                                                                                                                                                                                │
│         _checkOwner(_id, _trader);                                                                                                                                                                              │
│         _checkDelay(_id, true);                                                                                                                                                                                 │
│         IPosition.Trade memory _trade = position.trades(_id);                                                                                                                                                   │
│         tradingExtension.validateTrade(_trade.asset, _trade.tigAsset, _trade.margin + _addMargin, _trade.leverage);                                                                                             │
│         _checkVault(_stableVault, _marginAsset);                                                                                                                                                                │
│         if (_trade.orderType != 0) revert("4"); //IsLimit                                                                                                                                                       │
│         uint _fee = _handleOpenFees(_trade.asset, _addMargin*_trade.leverage/1e18, _trader, _trade.tigAsset, false);                                                                                            │
│         _handleDeposit(                                                                                                                                                                                         │
│             _trade.tigAsset,                                                                                                                                                                                    │
│             _marginAsset,                                                                                                                                                                                       │
│             _addMargin - _fee,                                                                                                                                                                                  │
│             _stableVault,                                                                                                                                                                                       │
│             _permitData,                                                                                                                                                                                        │
│             _trader                                                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         position.setAccInterest(_id);                                                                                                                                                                           │
│         unchecked {                                                                                                                                                                                             │
│             (uint256 _price,) = tradingExtension.getVerifiedPrice(_trade.asset, _priceData, _signature, _trade.direction ? 1 : 2);                                                                              │
│             uint _positionSize = (_addMargin - _fee) * _trade.leverage / 1e18;                                                                                                                                  │
│             if (_trade.direction) {                                                                                                                                                                             │
│                 tradingExtension.modifyLongOi(_trade.asset, _trade.tigAsset, true, _positionSize);                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 tradingExtension.modifyShortOi(_trade.asset, _trade.tigAsset, true, _positionSize);                                                                                                             │
│             }                                                                                                                                                                                                   │
│             _updateFunding(_trade.asset, _trade.tigAsset);                                                                                                                                                      │
│             _addMargin -= _fee;                                                                                                                                                                                 │
│             uint _newMargin = _trade.margin + _addMargin;                                                                                                                                                       │
│             uint _newPrice = _trade.price*_trade.margin/_newMargin + _price*_addMargin/_newMargin;                                                                                                              │
│                                                                                                                                                                                                                 │
│             position.addToPosition(                                                                                                                                                                             │
│                 _trade.id,                                                                                                                                                                                      │
│                 _newMargin,                                                                                                                                                                                     │
│                 _newPrice                                                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             emit AddToPosition(_trade.id, _newMargin, _newPrice, _trade.trader);                                                                                                                                │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function _handleDeposit(address _tigAsset, address _marginAsset, uint256 _margin, address _stableVault, ERC20PermitData calldata _permitData, address _trader) internal {                                   │
│         IStable tigAsset = IStable(_tigAsset);                                                                                                                                                                  │
│         if (_tigAsset != _marginAsset) {                                                                                                                                                                        │
│             if (_permitData.usePermit) {                                                                                                                                                                        │
│                 ERC20Permit(_marginAsset).permit(_trader, address(this), _permitData.amount, _permitData.deadline, _permitData.v, _permitData.r, _permitData.s);                                                │
│             }                                                                                                                                                                                                   │
│             uint256 _balBefore = tigAsset.balanceOf(address(this));                                                                                                                                             │
│             uint _marginDecMultiplier = 10**(18-ExtendedIERC20(_marginAsset).decimals());                                                                                                                       │
│             IERC20(_marginAsset).transferFrom(_trader, address(this), _margin/_marginDecMultiplier);                                                                                                            │
│             IERC20(_marginAsset).approve(_stableVault, type(uint).max);                                                                                                                                         │
│             IStableVault(_stableVault).deposit(_marginAsset, _margin/_marginDecMultiplier);                                                                                                                     │
│             if (tigAsset.balanceOf(address(this)) != _balBefore + _margin) revert BadDeposit();                                                                                                                 │
│             tigAsset.burnFrom(address(this), tigAsset.balanceOf(address(this)));                                                                                                                                │
│         } else {                                                                                                                                                                                                │
│             tigAsset.burnFrom(_trader, _margin);                                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function initiateLimitOrder(                                                                                                                                                                                │
│         TradeInfo calldata _tradeInfo,                                                                                                                                                                          │
│         uint256 _orderType, // 1 limit, 2 stop                                                                                                                                                                  │
│         uint256 _price,                                                                                                                                                                                         │
│         ERC20PermitData calldata _permitData,                                                                                                                                                                   │
│         address _trader                                                                                                                                                                                         │
│     )                                                                                                                                                                                                           │
│         external                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         _validateProxy(_trader);                                                                                                                                                                                │
│         address _tigAsset = IStableVault(_tradeInfo.stableVault).stable();                                                                                                                                      │
│         tradingExtension.validateTrade(_tradeInfo.asset, _tigAsset, _tradeInfo.margin, _tradeInfo.leverage);                                                                                                    │
│         _checkVault(_tradeInfo.stableVault, _tradeInfo.marginAsset);                                                                                                                                            │
│         if (_orderType == 0) revert("5");                                                                                                                                                                       │
│         if (_price == 0) revert NoPrice();                                                                                                                                                                      │
│         tradingExtension._setReferral(_tradeInfo.referral, _trader);                                                                                                                                            │
│         _handleDeposit(_tigAsset, _tradeInfo.marginAsset, _tradeInfo.margin, _tradeInfo.stableVault, _permitData, _trader);                                                                                     │
│         _checkSl(_tradeInfo.slPrice, _tradeInfo.direction, _price);                                                                                                                                             │
│         uint256 _id = position.getCount();                                                                                                                                                                      │
│         position.mint(                                                                                                                                                                                          │
│             IPosition.MintTrade(                                                                                                                                                                                │
│                 _trader,                                                                                                                                                                                        │
│                 _tradeInfo.margin,                                                                                                                                                                              │
│                 _tradeInfo.leverage,                                                                                                                                                                            │
│                 _tradeInfo.asset,                                                                                                                                                                               │
│                 _tradeInfo.direction,                                                                                                                                                                           │
│                 _price,                                                                                                                                                                                         │
│                 _tradeInfo.tpPrice,                                                                                                                                                                             │
│                 _tradeInfo.slPrice,                                                                                                                                                                             │
│                 _orderType,                                                                                                                                                                                     │
│                 _tigAsset                                                                                                                                                                                       │
│             )                                                                                                                                                                                                   │
│         );                                                                                                                                                                                                      │
│         limitDelay[_id] = block.timestamp + 4;                                                                                                                                                                  │
│         emit PositionOpened(_tradeInfo, _orderType, _price, _id, _trader, _tradeInfo.margin);                                                                                                                   │
│     }                                                                                                                                                                                                           │
│     function _handleDeposit(address _tigAsset, address _marginAsset, uint256 _margin, address _stableVault, ERC20PermitData calldata _permitData, address _trader) internal {                                   │
│         IStable tigAsset = IStable(_tigAsset);                                                                                                                                                                  │
│         if (_tigAsset != _marginAsset) {                                                                                                                                                                        │
│             if (_permitData.usePermit) {                                                                                                                                                                        │
│                 ERC20Permit(_marginAsset).permit(_trader, address(this), _permitData.amount, _permitData.deadline, _permitData.v, _permitData.r, _permitData.s);                                                │
│             }                                                                                                                                                                                                   │
│             uint256 _balBefore = tigAsset.balanceOf(address(this));                                                                                                                                             │
│             uint _marginDecMultiplier = 10**(18-ExtendedIERC20(_marginAsset).decimals());                                                                                                                       │
│             IERC20(_marginAsset).transferFrom(_trader, address(this), _margin/_marginDecMultiplier);                                                                                                            │
│             IERC20(_marginAsset).approve(_stableVault, type(uint).max);                                                                                                                                         │
│             IStableVault(_stableVault).deposit(_marginAsset, _margin/_marginDecMultiplier);                                                                                                                     │
│             if (tigAsset.balanceOf(address(this)) != _balBefore + _margin) revert BadDeposit();                                                                                                                 │
│             tigAsset.burnFrom(address(this), tigAsset.balanceOf(address(this)));                                                                                                                                │
│         } else {                                                                                                                                                                                                │
│             tigAsset.burnFrom(_trader, _margin);                                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function initiateMarketOrder(                                                                                                                                                                               │
│         TradeInfo calldata _tradeInfo,                                                                                                                                                                          │
│         PriceData calldata _priceData,                                                                                                                                                                          │
│         bytes calldata _signature,                                                                                                                                                                              │
│         ERC20PermitData calldata _permitData,                                                                                                                                                                   │
│         address _trader                                                                                                                                                                                         │
│     )                                                                                                                                                                                                           │
│         external                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         _validateProxy(_trader);                                                                                                                                                                                │
│         _checkDelay(position.getCount(), true);                                                                                                                                                                 │
│         _checkVault(_tradeInfo.stableVault, _tradeInfo.marginAsset);                                                                                                                                            │
│         address _tigAsset = IStableVault(_tradeInfo.stableVault).stable();                                                                                                                                      │
│         tradingExtension.validateTrade(_tradeInfo.asset, _tigAsset, _tradeInfo.margin, _tradeInfo.leverage);                                                                                                    │
│         tradingExtension._setReferral(_tradeInfo.referral, _trader);                                                                                                                                            │
│         uint256 _marginAfterFees = _tradeInfo.margin - _handleOpenFees(_tradeInfo.asset, _tradeInfo.margin*_tradeInfo.leverage/1e18, _trader, _tigAsset, false);                                                │
│         uint256 _positionSize = _marginAfterFees * _tradeInfo.leverage / 1e18;                                                                                                                                  │
│         _handleDeposit(_tigAsset, _tradeInfo.marginAsset, _tradeInfo.margin, _tradeInfo.stableVault, _permitData, _trader);                                                                                     │
│         uint256 _isLong = _tradeInfo.direction ? 1 : 2;                                                                                                                                                         │
│         (uint256 _price,) = tradingExtension.getVerifiedPrice(_tradeInfo.asset, _priceData, _signature, _isLong);                                                                                               │
│         IPosition.MintTrade memory _mintTrade = IPosition.MintTrade(                                                                                                                                            │
│             _trader,                                                                                                                                                                                            │
│             _marginAfterFees,                                                                                                                                                                                   │
│             _tradeInfo.leverage,                                                                                                                                                                                │
│             _tradeInfo.asset,                                                                                                                                                                                   │
│             _tradeInfo.direction,                                                                                                                                                                               │
│             _price,                                                                                                                                                                                             │
│             _tradeInfo.tpPrice,                                                                                                                                                                                 │
│             _tradeInfo.slPrice,                                                                                                                                                                                 │
│             0,                                                                                                                                                                                                  │
│             _tigAsset                                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│         _checkSl(_tradeInfo.slPrice, _tradeInfo.direction, _price);                                                                                                                                             │
│         unchecked {                                                                                                                                                                                             │
│             if (_tradeInfo.direction) {                                                                                                                                                                         │
│                 tradingExtension.modifyLongOi(_tradeInfo.asset, _tigAsset, true, _positionSize);                                                                                                                │
│             } else {                                                                                                                                                                                            │
│                 tradingExtension.modifyShortOi(_tradeInfo.asset, _tigAsset, true, _positionSize);                                                                                                               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         _updateFunding(_tradeInfo.asset, _tigAsset);                                                                                                                                                            │
│         position.mint(                                                                                                                                                                                          │
│             _mintTrade                                                                                                                                                                                          │
│         );                                                                                                                                                                                                      │
│         unchecked {                                                                                                                                                                                             │
│             emit PositionOpened(_tradeInfo, 0, _price, position.getCount()-1, _trader, _marginAfterFees);                                                                                                       │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function _handleDeposit(address _tigAsset, address _marginAsset, uint256 _margin, address _stableVault, ERC20PermitData calldata _permitData, address _trader) internal {                                   │
│         IStable tigAsset = IStable(_tigAsset);                                                                                                                                                                  │
│         if (_tigAsset != _marginAsset) {                                                                                                                                                                        │
│             if (_permitData.usePermit) {                                                                                                                                                                        │
│                 ERC20Permit(_marginAsset).permit(_trader, address(this), _permitData.amount, _permitData.deadline, _permitData.v, _permitData.r, _permitData.s);                                                │
│             }                                                                                                                                                                                                   │
│             uint256 _balBefore = tigAsset.balanceOf(address(this));                                                                                                                                             │
│             uint _marginDecMultiplier = 10**(18-ExtendedIERC20(_marginAsset).decimals());                                                                                                                       │
│             IERC20(_marginAsset).transferFrom(_trader, address(this), _margin/_marginDecMultiplier);                                                                                                            │
│             IERC20(_marginAsset).approve(_stableVault, type(uint).max);                                                                                                                                         │
│             IStableVault(_stableVault).deposit(_marginAsset, _margin/_marginDecMultiplier);                                                                                                                     │
│             if (tigAsset.balanceOf(address(this)) != _balBefore + _margin) revert BadDeposit();                                                                                                                 │
│             tigAsset.burnFrom(address(this), tigAsset.balanceOf(address(this)));                                                                                                                                │
│         } else {                                                                                                                                                                                                │
│             tigAsset.burnFrom(_trader, _margin);                                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function _handleWithdraw(IPosition.Trade memory _trade, address _stableVault, address _outputToken, uint _toMint) internal {                                                                                │
│         IStable(_trade.tigAsset).mintFor(address(this), _toMint);                                                                                                                                               │
│         if (_outputToken == _trade.tigAsset) {                                                                                                                                                                  │
│             IERC20(_outputToken).transfer(_trade.trader, _toMint);                                                                                                                                              │
│         } else {                                                                                                                                                                                                │
│             uint256 _balBefore = IERC20(_outputToken).balanceOf(address(this));                                                                                                                                 │
│             IStableVault(_stableVault).withdraw(_outputToken, _toMint);                                                                                                                                         │
│             if (IERC20(_outputToken).balanceOf(address(this)) != _balBefore + _toMint/(10**(18-ExtendedIERC20(_outputToken).decimals()))) revert BadWithdraw();                                                 │
│             IERC20(_outputToken).transfer(_trade.trader, IERC20(_outputToken).balanceOf(address(this)) - _balBefore);                                                                                           │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function removeMargin(                                                                                                                                                                                      │
│         uint256 _id,                                                                                                                                                                                            │
│         address _stableVault,                                                                                                                                                                                   │
│         address _outputToken,                                                                                                                                                                                   │
│         uint256 _removeMargin,                                                                                                                                                                                  │
│         PriceData calldata _priceData,                                                                                                                                                                          │
│         bytes calldata _signature,                                                                                                                                                                              │
│         address _trader                                                                                                                                                                                         │
│     )                                                                                                                                                                                                           │
│         external                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         _validateProxy(_trader);                                                                                                                                                                                │
│         _checkOwner(_id, _trader);                                                                                                                                                                              │
│         _checkVault(_stableVault, _outputToken);                                                                                                                                                                │
│         IPosition.Trade memory _trade = position.trades(_id);                                                                                                                                                   │
│         if (_trade.orderType != 0) revert(); //IsLimit                                                                                                                                                          │
│         IPairsContract.Asset memory asset = pairsContract.idToAsset(_trade.asset);                                                                                                                              │
│         uint256 _newMargin = _trade.margin - _removeMargin;                                                                                                                                                     │
│         uint256 _newLeverage = _trade.margin * _trade.leverage / _newMargin;                                                                                                                                    │
│         if (_newLeverage > asset.maxLeverage) revert("!lev");                                                                                                                                                   │
│         (uint _assetPrice,) = tradingExtension.getVerifiedPrice(_trade.asset, _priceData, _signature, 0);                                                                                                       │
│         (,int256 _payout) = TradingLibrary.pnl(_trade.direction, _assetPrice, _trade.price, _newMargin, _newLeverage, _trade.accInterest);                                                                      │
│         unchecked {                                                                                                                                                                                             │
│             if (_payout <= int256(_newMargin*(DIVISION_CONSTANT-liqPercent)/DIVISION_CONSTANT)) revert LiqThreshold();                                                                                          │
│         }                                                                                                                                                                                                       │
│         position.modifyMargin(_trade.id, _newMargin, _newLeverage);                                                                                                                                             │
│         _handleWithdraw(_trade, _stableVault, _outputToken, _removeMargin);                                                                                                                                     │
│         emit MarginModified(_trade.id, _newMargin, _newLeverage, false, _trader);                                                                                                                               │
│     }                                                                                                                                                                                                           │
│     function _handleWithdraw(IPosition.Trade memory _trade, address _stableVault, address _outputToken, uint _toMint) internal {                                                                                │
│         IStable(_trade.tigAsset).mintFor(address(this), _toMint);                                                                                                                                               │
│         if (_outputToken == _trade.tigAsset) {                                                                                                                                                                  │
│             IERC20(_outputToken).transfer(_trade.trader, _toMint);                                                                                                                                              │
│         } else {                                                                                                                                                                                                │
│             uint256 _balBefore = IERC20(_outputToken).balanceOf(address(this));                                                                                                                                 │
│             IStableVault(_stableVault).withdraw(_outputToken, _toMint);                                                                                                                                         │
│             if (IERC20(_outputToken).balanceOf(address(this)) != _balBefore + _toMint/(10**(18-ExtendedIERC20(_outputToken).decimals()))) revert BadWithdraw();                                                 │
│             IERC20(_outputToken).transfer(_trade.trader, IERC20(_outputToken).balanceOf(address(this)) - _balBefore);                                                                                           │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function _closePosition(                                                                                                                                                                                    │
│         uint _id,                                                                                                                                                                                               │
│         uint _percent,                                                                                                                                                                                          │
│         uint _price,                                                                                                                                                                                            │
│         address _stableVault,                                                                                                                                                                                   │
│         address _outputToken,                                                                                                                                                                                   │
│         bool _isBot                                                                                                                                                                                             │
│     )                                                                                                                                                                                                           │
│         internal                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         (IPosition.Trade memory _trade, uint256 _positionSize, int256 _payout) = tradingExtension._closePosition(_id, _price, _percent);                                                                        │
│         position.setAccInterest(_id);                                                                                                                                                                           │
│         _updateFunding(_trade.asset, _trade.tigAsset);                                                                                                                                                          │
│         if (_percent < DIVISION_CONSTANT) {                                                                                                                                                                     │
│             if ((_trade.margin*_trade.leverage*(DIVISION_CONSTANT-_percent)/DIVISION_CONSTANT)/1e18 < tradingExtension.minPos(_trade.tigAsset)) revert("!size");                                                │
│             position.reducePosition(_id, _percent);                                                                                                                                                             │
│         } else {                                                                                                                                                                                                │
│             position.burn(_id);                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│         uint256 _toMint;                                                                                                                                                                                        │
│         if (_payout > 0) {                                                                                                                                                                                      │
│             unchecked {                                                                                                                                                                                         │
│                 _toMint = _handleCloseFees(_trade.asset, uint256(_payout)*_percent/DIVISION_CONSTANT, _trade.tigAsset, _positionSize*_percent/DIVISION_CONSTANT, _trade.trader, _isBot);                        │
│                 if (maxWinPercent > 0 && _toMint > _trade.margin*maxWinPercent/DIVISION_CONSTANT) {                                                                                                             │
│                     _toMint = _trade.margin*maxWinPercent/DIVISION_CONSTANT;                                                                                                                                    │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│             _handleWithdraw(_trade, _stableVault, _outputToken, _toMint);                                                                                                                                       │
│         }                                                                                                                                                                                                       │
│         emit PositionClosed(_id, _price, _percent, _toMint, _trade.trader, _isBot ? _msgSender() : _trade.trader);                                                                                              │
│     }                                                                                                                                                                                                           │
│     function _handleWithdraw(IPosition.Trade memory _trade, address _stableVault, address _outputToken, uint _toMint) internal {                                                                                │
│         IStable(_trade.tigAsset).mintFor(address(this), _toMint);                                                                                                                                               │
│         if (_outputToken == _trade.tigAsset) {                                                                                                                                                                  │
│             IERC20(_outputToken).transfer(_trade.trader, _toMint);                                                                                                                                              │
│         } else {                                                                                                                                                                                                │
│             uint256 _balBefore = IERC20(_outputToken).balanceOf(address(this));                                                                                                                                 │
│             IStableVault(_stableVault).withdraw(_outputToken, _toMint);                                                                                                                                         │
│             if (IERC20(_outputToken).balanceOf(address(this)) != _balBefore + _toMint/(10**(18-ExtendedIERC20(_outputToken).decimals()))) revert BadWithdraw();                                                 │
│             IERC20(_outputToken).transfer(_trade.trader, IERC20(_outputToken).balanceOf(address(this)) - _balBefore);                                                                                           │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function _handleOpenFees(                                                                                                                                                                                   │
│         uint _asset,                                                                                                                                                                                            │
│         uint _positionSize,                                                                                                                                                                                     │
│         address _trader,                                                                                                                                                                                        │
│         address _tigAsset,                                                                                                                                                                                      │
│         bool _isBot                                                                                                                                                                                             │
│     )                                                                                                                                                                                                           │
│         internal                                                                                                                                                                                                │
│         returns (uint _feePaid)                                                                                                                                                                                 │
│     {                                                                                                                                                                                                           │
│         IPairsContract.Asset memory asset = pairsContract.idToAsset(_asset);                                                                                                                                    │
│         Fees memory _fees = openFees;                                                                                                                                                                           │
│         unchecked {                                                                                                                                                                                             │
│             _fees.daoFees = _fees.daoFees * asset.feeMultiplier / DIVISION_CONSTANT;                                                                                                                            │
│             _fees.burnFees = _fees.burnFees * asset.feeMultiplier / DIVISION_CONSTANT;                                                                                                                          │
│             _fees.referralFees = _fees.referralFees * asset.feeMultiplier / DIVISION_CONSTANT;                                                                                                                  │
│             _fees.botFees = _fees.botFees * asset.feeMultiplier / DIVISION_CONSTANT;                                                                                                                            │
│         }                                                                                                                                                                                                       │
│         address _referrer = tradingExtension.getRef(_trader); //referrals.getReferral(referrals.getReferred(_trader));                                                                                          │
│         if (_referrer != address(0)) {                                                                                                                                                                          │
│             unchecked {                                                                                                                                                                                         │
│                 IStable(_tigAsset).mintFor(                                                                                                                                                                     │
│                     _referrer,                                                                                                                                                                                  │
│                     _positionSize                                                                                                                                                                               │
│                     * _fees.referralFees // get referral fee%                                                                                                                                                   │
│                     / DIVISION_CONSTANT // divide by 100%                                                                                                                                                       │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│             _fees.daoFees = _fees.daoFees - _fees.referralFees*2;                                                                                                                                               │
│         }                                                                                                                                                                                                       │
│         if (_isBot) {                                                                                                                                                                                           │
│             unchecked {                                                                                                                                                                                         │
│                 IStable(_tigAsset).mintFor(                                                                                                                                                                     │
│                     _msgSender(),                                                                                                                                                                               │
│                     _positionSize                                                                                                                                                                               │
│                     * _fees.botFees // get bot fee%                                                                                                                                                             │
│                     / DIVISION_CONSTANT // divide by 100%                                                                                                                                                       │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│             _fees.daoFees = _fees.daoFees - _fees.botFees;                                                                                                                                                      │
│         } else {                                                                                                                                                                                                │
│             _fees.botFees = 0;                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│         unchecked {                                                                                                                                                                                             │
│             uint _daoFeesPaid = _positionSize * _fees.daoFees / DIVISION_CONSTANT;                                                                                                                              │
│             _feePaid =                                                                                                                                                                                          │
│                 _positionSize                                                                                                                                                                                   │
│                 * (_fees.burnFees + _fees.botFees) // get total fee%                                                                                                                                            │
│                 / DIVISION_CONSTANT // divide by 100%                                                                                                                                                           │
│                 + _daoFeesPaid;                                                                                                                                                                                 │
│             emit FeesDistributed(                                                                                                                                                                               │
│                 _tigAsset,                                                                                                                                                                                      │
│                 _daoFeesPaid,                                                                                                                                                                                   │
│                 _positionSize * _fees.burnFees / DIVISION_CONSTANT,                                                                                                                                             │
│                 _referrer != address(0) ? _positionSize * _fees.referralFees / DIVISION_CONSTANT : 0,                                                                                                           │
│                 _positionSize * _fees.botFees / DIVISION_CONSTANT,                                                                                                                                              │
│                 _referrer                                                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│             IStable(_tigAsset).mintFor(address(this), _daoFeesPaid);                                                                                                                                            │
│         }                                                                                                                                                                                                       │
│         gov.distribute(_tigAsset, IStable(_tigAsset).balanceOf(address(this)));                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function executeLimitOrder(                                                                                                                                                                                 │
│         uint _id,                                                                                                                                                                                               │
│         PriceData calldata _priceData,                                                                                                                                                                          │
│         bytes calldata _signature                                                                                                                                                                               │
│     )                                                                                                                                                                                                           │
│         external                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         unchecked {                                                                                                                                                                                             │
│             _checkDelay(_id, true);                                                                                                                                                                             │
│             tradingExtension._checkGas();                                                                                                                                                                       │
│             if (tradingExtension.paused()) revert TradingPaused();                                                                                                                                              │
│             require(block.timestamp >= limitDelay[_id]);                                                                                                                                                        │
│             IPosition.Trade memory trade = position.trades(_id);                                                                                                                                                │
│             uint _fee = _handleOpenFees(trade.asset, trade.margin*trade.leverage/1e18, trade.trader, trade.tigAsset, true);                                                                                     │
│             (uint256 _price, uint256 _spread) = tradingExtension.getVerifiedPrice(trade.asset, _priceData, _signature, 0);                                                                                      │
│             if (trade.orderType == 0) revert("5");                                                                                                                                                              │
│             if (_price > trade.price+trade.price*limitOrderPriceRange/DIVISION_CONSTANT || _price < trade.price-trade.price*limitOrderPriceRange/DIVISION_CONSTANT) revert("6"); //LimitNotMet                  │
│             if (trade.direction && trade.orderType == 1) {                                                                                                                                                      │
│                 if (trade.price < _price) revert("6"); //LimitNotMet                                                                                                                                            │
│             } else if (!trade.direction && trade.orderType == 1) {                                                                                                                                              │
│                 if (trade.price > _price) revert("6"); //LimitNotMet                                                                                                                                            │
│             } else if (!trade.direction && trade.orderType == 2) {                                                                                                                                              │
│                 if (trade.price < _price) revert("6"); //LimitNotMet                                                                                                                                            │
│                 trade.price = _price;                                                                                                                                                                           │
│             } else {                                                                                                                                                                                            │
│                 if (trade.price > _price) revert("6"); //LimitNotMet                                                                                                                                            │
│                 trade.price = _price;                                                                                                                                                                           │
│             }                                                                                                                                                                                                   │
│             if(trade.direction) {                                                                                                                                                                               │
│                 trade.price += trade.price * _spread / DIVISION_CONSTANT;                                                                                                                                       │
│             } else {                                                                                                                                                                                            │
│                 trade.price -= trade.price * _spread / DIVISION_CONSTANT;                                                                                                                                       │
│             }                                                                                                                                                                                                   │
│             if (trade.direction) {                                                                                                                                                                              │
│                 tradingExtension.modifyLongOi(trade.asset, trade.tigAsset, true, trade.margin*trade.leverage/1e18);                                                                                             │
│             } else {                                                                                                                                                                                            │
│                 tradingExtension.modifyShortOi(trade.asset, trade.tigAsset, true, trade.margin*trade.leverage/1e18);                                                                                            │
│             }                                                                                                                                                                                                   │
│             _updateFunding(trade.asset, trade.tigAsset);                                                                                                                                                        │
│             position.executeLimitOrder(_id, trade.price, trade.margin - _fee);                                                                                                                                  │
│             emit LimitOrderExecuted(trade.asset, trade.direction, trade.price, trade.leverage, trade.margin - _fee, _id, trade.trader, _msgSender());                                                           │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function _handleOpenFees(                                                                                                                                                                                   │
│         uint _asset,                                                                                                                                                                                            │
│         uint _positionSize,                                                                                                                                                                                     │
│         address _trader,                                                                                                                                                                                        │
│         address _tigAsset,                                                                                                                                                                                      │
│         bool _isBot                                                                                                                                                                                             │
│     )                                                                                                                                                                                                           │
│         internal                                                                                                                                                                                                │
│         returns (uint _feePaid)                                                                                                                                                                                 │
│     {                                                                                                                                                                                                           │
│         IPairsContract.Asset memory asset = pairsContract.idToAsset(_asset);                                                                                                                                    │
│         Fees memory _fees = openFees;                                                                                                                                                                           │
│         unchecked {                                                                                                                                                                                             │
│             _fees.daoFees = _fees.daoFees * asset.feeMultiplier / DIVISION_CONSTANT;                                                                                                                            │
│             _fees.burnFees = _fees.burnFees * asset.feeMultiplier / DIVISION_CONSTANT;                                                                                                                          │
│             _fees.referralFees = _fees.referralFees * asset.feeMultiplier / DIVISION_CONSTANT;                                                                                                                  │
│             _fees.botFees = _fees.botFees * asset.feeMultiplier / DIVISION_CONSTANT;                                                                                                                            │
│         }                                                                                                                                                                                                       │
│         address _referrer = tradingExtension.getRef(_trader); //referrals.getReferral(referrals.getReferred(_trader));                                                                                          │
│         if (_referrer != address(0)) {                                                                                                                                                                          │
│             unchecked {                                                                                                                                                                                         │
│                 IStable(_tigAsset).mintFor(                                                                                                                                                                     │
│                     _referrer,                                                                                                                                                                                  │
│                     _positionSize                                                                                                                                                                               │
│                     * _fees.referralFees // get referral fee%                                                                                                                                                   │
│                     / DIVISION_CONSTANT // divide by 100%                                                                                                                                                       │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│             _fees.daoFees = _fees.daoFees - _fees.referralFees*2;                                                                                                                                               │
│         }                                                                                                                                                                                                       │
│         if (_isBot) {                                                                                                                                                                                           │
│             unchecked {                                                                                                                                                                                         │
│                 IStable(_tigAsset).mintFor(                                                                                                                                                                     │
│                     _msgSender(),                                                                                                                                                                               │
│                     _positionSize                                                                                                                                                                               │
│                     * _fees.botFees // get bot fee%                                                                                                                                                             │
│                     / DIVISION_CONSTANT // divide by 100%                                                                                                                                                       │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│             _fees.daoFees = _fees.daoFees - _fees.botFees;                                                                                                                                                      │
│         } else {                                                                                                                                                                                                │
│             _fees.botFees = 0;                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│         unchecked {                                                                                                                                                                                             │
│             uint _daoFeesPaid = _positionSize * _fees.daoFees / DIVISION_CONSTANT;                                                                                                                              │
│             _feePaid =                                                                                                                                                                                          │
│                 _positionSize                                                                                                                                                                                   │
│                 * (_fees.burnFees + _fees.botFees) // get total fee%                                                                                                                                            │
│                 / DIVISION_CONSTANT // divide by 100%                                                                                                                                                           │
│                 + _daoFeesPaid;                                                                                                                                                                                 │
│             emit FeesDistributed(                                                                                                                                                                               │
│                 _tigAsset,                                                                                                                                                                                      │
│                 _daoFeesPaid,                                                                                                                                                                                   │
│                 _positionSize * _fees.burnFees / DIVISION_CONSTANT,                                                                                                                                             │
│                 _referrer != address(0) ? _positionSize * _fees.referralFees / DIVISION_CONSTANT : 0,                                                                                                           │
│                 _positionSize * _fees.botFees / DIVISION_CONSTANT,                                                                                                                                              │
│                 _referrer                                                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│             IStable(_tigAsset).mintFor(address(this), _daoFeesPaid);                                                                                                                                            │
│         }                                                                                                                                                                                                       │
│         gov.distribute(_tigAsset, IStable(_tigAsset).balanceOf(address(this)));                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function addToPosition(                                                                                                                                                                                     │
│         uint _id,                                                                                                                                                                                               │
│         uint _addMargin,                                                                                                                                                                                        │
│         PriceData calldata _priceData,                                                                                                                                                                          │
│         bytes calldata _signature,                                                                                                                                                                              │
│         address _stableVault,                                                                                                                                                                                   │
│         address _marginAsset,                                                                                                                                                                                   │
│         ERC20PermitData calldata _permitData,                                                                                                                                                                   │
│         address _trader                                                                                                                                                                                         │
│     )                                                                                                                                                                                                           │
│         external                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         _validateProxy(_trader);                                                                                                                                                                                │
│         _checkOwner(_id, _trader);                                                                                                                                                                              │
│         _checkDelay(_id, true);                                                                                                                                                                                 │
│         IPosition.Trade memory _trade = position.trades(_id);                                                                                                                                                   │
│         tradingExtension.validateTrade(_trade.asset, _trade.tigAsset, _trade.margin + _addMargin, _trade.leverage);                                                                                             │
│         _checkVault(_stableVault, _marginAsset);                                                                                                                                                                │
│         if (_trade.orderType != 0) revert("4"); //IsLimit                                                                                                                                                       │
│         uint _fee = _handleOpenFees(_trade.asset, _addMargin*_trade.leverage/1e18, _trader, _trade.tigAsset, false);                                                                                            │
│         _handleDeposit(                                                                                                                                                                                         │
│             _trade.tigAsset,                                                                                                                                                                                    │
│             _marginAsset,                                                                                                                                                                                       │
│             _addMargin - _fee,                                                                                                                                                                                  │
│             _stableVault,                                                                                                                                                                                       │
│             _permitData,                                                                                                                                                                                        │
│             _trader                                                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         position.setAccInterest(_id);                                                                                                                                                                           │
│         unchecked {                                                                                                                                                                                             │
│             (uint256 _price,) = tradingExtension.getVerifiedPrice(_trade.asset, _priceData, _signature, _trade.direction ? 1 : 2);                                                                              │
│             uint _positionSize = (_addMargin - _fee) * _trade.leverage / 1e18;                                                                                                                                  │
│             if (_trade.direction) {                                                                                                                                                                             │
│                 tradingExtension.modifyLongOi(_trade.asset, _trade.tigAsset, true, _positionSize);                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 tradingExtension.modifyShortOi(_trade.asset, _trade.tigAsset, true, _positionSize);                                                                                                             │
│             }                                                                                                                                                                                                   │
│             _updateFunding(_trade.asset, _trade.tigAsset);                                                                                                                                                      │
│             _addMargin -= _fee;                                                                                                                                                                                 │
│             uint _newMargin = _trade.margin + _addMargin;                                                                                                                                                       │
│             uint _newPrice = _trade.price*_trade.margin/_newMargin + _price*_addMargin/_newMargin;                                                                                                              │
│                                                                                                                                                                                                                 │
│             position.addToPosition(                                                                                                                                                                             │
│                 _trade.id,                                                                                                                                                                                      │
│                 _newMargin,                                                                                                                                                                                     │
│                 _newPrice                                                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             emit AddToPosition(_trade.id, _newMargin, _newPrice, _trade.trader);                                                                                                                                │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function _handleOpenFees(                                                                                                                                                                                   │
│         uint _asset,                                                                                                                                                                                            │
│         uint _positionSize,                                                                                                                                                                                     │
│         address _trader,                                                                                                                                                                                        │
│         address _tigAsset,                                                                                                                                                                                      │
│         bool _isBot                                                                                                                                                                                             │
│     )                                                                                                                                                                                                           │
│         internal                                                                                                                                                                                                │
│         returns (uint _feePaid)                                                                                                                                                                                 │
│     {                                                                                                                                                                                                           │
│         IPairsContract.Asset memory asset = pairsContract.idToAsset(_asset);                                                                                                                                    │
│         Fees memory _fees = openFees;                                                                                                                                                                           │
│         unchecked {                                                                                                                                                                                             │
│             _fees.daoFees = _fees.daoFees * asset.feeMultiplier / DIVISION_CONSTANT;                                                                                                                            │
│             _fees.burnFees = _fees.burnFees * asset.feeMultiplier / DIVISION_CONSTANT;                                                                                                                          │
│             _fees.referralFees = _fees.referralFees * asset.feeMultiplier / DIVISION_CONSTANT;                                                                                                                  │
│             _fees.botFees = _fees.botFees * asset.feeMultiplier / DIVISION_CONSTANT;                                                                                                                            │
│         }                                                                                                                                                                                                       │
│         address _referrer = tradingExtension.getRef(_trader); //referrals.getReferral(referrals.getReferred(_trader));                                                                                          │
│         if (_referrer != address(0)) {                                                                                                                                                                          │
│             unchecked {                                                                                                                                                                                         │
│                 IStable(_tigAsset).mintFor(                                                                                                                                                                     │
│                     _referrer,                                                                                                                                                                                  │
│                     _positionSize                                                                                                                                                                               │
│                     * _fees.referralFees // get referral fee%                                                                                                                                                   │
│                     / DIVISION_CONSTANT // divide by 100%                                                                                                                                                       │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│             _fees.daoFees = _fees.daoFees - _fees.referralFees*2;                                                                                                                                               │
│         }                                                                                                                                                                                                       │
│         if (_isBot) {                                                                                                                                                                                           │
│             unchecked {                                                                                                                                                                                         │
│                 IStable(_tigAsset).mintFor(                                                                                                                                                                     │
│                     _msgSender(),                                                                                                                                                                               │
│                     _positionSize                                                                                                                                                                               │
│                     * _fees.botFees // get bot fee%                                                                                                                                                             │
│                     / DIVISION_CONSTANT // divide by 100%                                                                                                                                                       │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│             _fees.daoFees = _fees.daoFees - _fees.botFees;                                                                                                                                                      │
│         } else {                                                                                                                                                                                                │
│             _fees.botFees = 0;                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│         unchecked {                                                                                                                                                                                             │
│             uint _daoFeesPaid = _positionSize * _fees.daoFees / DIVISION_CONSTANT;                                                                                                                              │
│             _feePaid =                                                                                                                                                                                          │
│                 _positionSize                                                                                                                                                                                   │
│                 * (_fees.burnFees + _fees.botFees) // get total fee%                                                                                                                                            │
│                 / DIVISION_CONSTANT // divide by 100%                                                                                                                                                           │
│                 + _daoFeesPaid;                                                                                                                                                                                 │
│             emit FeesDistributed(                                                                                                                                                                               │
│                 _tigAsset,                                                                                                                                                                                      │
│                 _daoFeesPaid,                                                                                                                                                                                   │
│                 _positionSize * _fees.burnFees / DIVISION_CONSTANT,                                                                                                                                             │
│                 _referrer != address(0) ? _positionSize * _fees.referralFees / DIVISION_CONSTANT : 0,                                                                                                           │
│                 _positionSize * _fees.botFees / DIVISION_CONSTANT,                                                                                                                                              │
│                 _referrer                                                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│             IStable(_tigAsset).mintFor(address(this), _daoFeesPaid);                                                                                                                                            │
│         }                                                                                                                                                                                                       │
│         gov.distribute(_tigAsset, IStable(_tigAsset).balanceOf(address(this)));                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function initiateMarketOrder(                                                                                                                                                                               │
│         TradeInfo calldata _tradeInfo,                                                                                                                                                                          │
│         PriceData calldata _priceData,                                                                                                                                                                          │
│         bytes calldata _signature,                                                                                                                                                                              │
│         ERC20PermitData calldata _permitData,                                                                                                                                                                   │
│         address _trader                                                                                                                                                                                         │
│     )                                                                                                                                                                                                           │
│         external                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         _validateProxy(_trader);                                                                                                                                                                                │
│         _checkDelay(position.getCount(), true);                                                                                                                                                                 │
│         _checkVault(_tradeInfo.stableVault, _tradeInfo.marginAsset);                                                                                                                                            │
│         address _tigAsset = IStableVault(_tradeInfo.stableVault).stable();                                                                                                                                      │
│         tradingExtension.validateTrade(_tradeInfo.asset, _tigAsset, _tradeInfo.margin, _tradeInfo.leverage);                                                                                                    │
│         tradingExtension._setReferral(_tradeInfo.referral, _trader);                                                                                                                                            │
│         uint256 _marginAfterFees = _tradeInfo.margin - _handleOpenFees(_tradeInfo.asset, _tradeInfo.margin*_tradeInfo.leverage/1e18, _trader, _tigAsset, false);                                                │
│         uint256 _positionSize = _marginAfterFees * _tradeInfo.leverage / 1e18;                                                                                                                                  │
│         _handleDeposit(_tigAsset, _tradeInfo.marginAsset, _tradeInfo.margin, _tradeInfo.stableVault, _permitData, _trader);                                                                                     │
│         uint256 _isLong = _tradeInfo.direction ? 1 : 2;                                                                                                                                                         │
│         (uint256 _price,) = tradingExtension.getVerifiedPrice(_tradeInfo.asset, _priceData, _signature, _isLong);                                                                                               │
│         IPosition.MintTrade memory _mintTrade = IPosition.MintTrade(                                                                                                                                            │
│             _trader,                                                                                                                                                                                            │
│             _marginAfterFees,                                                                                                                                                                                   │
│             _tradeInfo.leverage,                                                                                                                                                                                │
│             _tradeInfo.asset,                                                                                                                                                                                   │
│             _tradeInfo.direction,                                                                                                                                                                               │
│             _price,                                                                                                                                                                                             │
│             _tradeInfo.tpPrice,                                                                                                                                                                                 │
│             _tradeInfo.slPrice,                                                                                                                                                                                 │
│             0,                                                                                                                                                                                                  │
│             _tigAsset                                                                                                                                                                                           │
│         );                                                                                                                                                                                                      │
│         _checkSl(_tradeInfo.slPrice, _tradeInfo.direction, _price);                                                                                                                                             │
│         unchecked {                                                                                                                                                                                             │
│             if (_tradeInfo.direction) {                                                                                                                                                                         │
│                 tradingExtension.modifyLongOi(_tradeInfo.asset, _tigAsset, true, _positionSize);                                                                                                                │
│             } else {                                                                                                                                                                                            │
│                 tradingExtension.modifyShortOi(_tradeInfo.asset, _tigAsset, true, _positionSize);                                                                                                               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         _updateFunding(_tradeInfo.asset, _tigAsset);                                                                                                                                                            │
│         position.mint(                                                                                                                                                                                          │
│             _mintTrade                                                                                                                                                                                          │
│         );                                                                                                                                                                                                      │
│         unchecked {                                                                                                                                                                                             │
│             emit PositionOpened(_tradeInfo, 0, _price, position.getCount()-1, _trader, _marginAfterFees);                                                                                                       │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function _handleOpenFees(                                                                                                                                                                                   │
│         uint _asset,                                                                                                                                                                                            │
│         uint _positionSize,                                                                                                                                                                                     │
│         address _trader,                                                                                                                                                                                        │
│         address _tigAsset,                                                                                                                                                                                      │
│         bool _isBot                                                                                                                                                                                             │
│     )                                                                                                                                                                                                           │
│         internal                                                                                                                                                                                                │
│         returns (uint _feePaid)                                                                                                                                                                                 │
│     {                                                                                                                                                                                                           │
│         IPairsContract.Asset memory asset = pairsContract.idToAsset(_asset);                                                                                                                                    │
│         Fees memory _fees = openFees;                                                                                                                                                                           │
│         unchecked {                                                                                                                                                                                             │
│             _fees.daoFees = _fees.daoFees * asset.feeMultiplier / DIVISION_CONSTANT;                                                                                                                            │
│             _fees.burnFees = _fees.burnFees * asset.feeMultiplier / DIVISION_CONSTANT;                                                                                                                          │
│             _fees.referralFees = _fees.referralFees * asset.feeMultiplier / DIVISION_CONSTANT;                                                                                                                  │
│             _fees.botFees = _fees.botFees * asset.feeMultiplier / DIVISION_CONSTANT;                                                                                                                            │
│         }                                                                                                                                                                                                       │
│         address _referrer = tradingExtension.getRef(_trader); //referrals.getReferral(referrals.getReferred(_trader));                                                                                          │
│         if (_referrer != address(0)) {                                                                                                                                                                          │
│             unchecked {                                                                                                                                                                                         │
│                 IStable(_tigAsset).mintFor(                                                                                                                                                                     │
│                     _referrer,                                                                                                                                                                                  │
│                     _positionSize                                                                                                                                                                               │
│                     * _fees.referralFees // get referral fee%                                                                                                                                                   │
│                     / DIVISION_CONSTANT // divide by 100%                                                                                                                                                       │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│             _fees.daoFees = _fees.daoFees - _fees.referralFees*2;                                                                                                                                               │
│         }                                                                                                                                                                                                       │
│         if (_isBot) {                                                                                                                                                                                           │
│             unchecked {                                                                                                                                                                                         │
│                 IStable(_tigAsset).mintFor(                                                                                                                                                                     │
│                     _msgSender(),                                                                                                                                                                               │
│                     _positionSize                                                                                                                                                                               │
│                     * _fees.botFees // get bot fee%                                                                                                                                                             │
│                     / DIVISION_CONSTANT // divide by 100%                                                                                                                                                       │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│             _fees.daoFees = _fees.daoFees - _fees.botFees;                                                                                                                                                      │
│         } else {                                                                                                                                                                                                │
│             _fees.botFees = 0;                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│         unchecked {                                                                                                                                                                                             │
│             uint _daoFeesPaid = _positionSize * _fees.daoFees / DIVISION_CONSTANT;                                                                                                                              │
│             _feePaid =                                                                                                                                                                                          │
│                 _positionSize                                                                                                                                                                                   │
│                 * (_fees.burnFees + _fees.botFees) // get total fee%                                                                                                                                            │
│                 / DIVISION_CONSTANT // divide by 100%                                                                                                                                                           │
│                 + _daoFeesPaid;                                                                                                                                                                                 │
│             emit FeesDistributed(                                                                                                                                                                               │
│                 _tigAsset,                                                                                                                                                                                      │
│                 _daoFeesPaid,                                                                                                                                                                                   │
│                 _positionSize * _fees.burnFees / DIVISION_CONSTANT,                                                                                                                                             │
│                 _referrer != address(0) ? _positionSize * _fees.referralFees / DIVISION_CONSTANT : 0,                                                                                                           │
│                 _positionSize * _fees.botFees / DIVISION_CONSTANT,                                                                                                                                              │
│                 _referrer                                                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│             IStable(_tigAsset).mintFor(address(this), _daoFeesPaid);                                                                                                                                            │
│         }                                                                                                                                                                                                       │
│         gov.distribute(_tigAsset, IStable(_tigAsset).balanceOf(address(this)));                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function balanceIds(address _user) public view returns (uint[] memory) {                                                                                                                                    │
│         uint[] memory _ids = new uint[](balanceOf(_user));                                                                                                                                                      │
│         unchecked {                                                                                                                                                                                             │
│             for (uint i=0; i<_ids.length; i++) {                                                                                                                                                                │
│                 _ids = tokenOfOwnerByIndex(_user, i);                                                                                                                                                           │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         return _ids;                                                                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function _burn(uint256 tokenId) internal override {                                                                                                                                                         │
│         address owner = ownerOf(tokenId);                                                                                                                                                                       │
│         for (uint i=0; i<assetsLength(); i++) {                                                                                                                                                                 │
│             userDebt[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│             userDebt[assets] -= userPaid[assets]/balanceOf(owner);                                                                                                                                              │
│             userPaid[assets] -= userPaid[assets]/balanceOf(owner);                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│         super._burn(tokenId);                                                                                                                                                                                   │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function crossChain(                                                                                                                                                                                        │
│         uint16 _dstChainId,                                                                                                                                                                                     │
│         bytes memory _destination,                                                                                                                                                                              │
│         address _to,                                                                                                                                                                                            │
│         uint256[] memory tokenId                                                                                                                                                                                │
│     ) public payable {                                                                                                                                                                                          │
│         require(tokenId.length > 0, "Not bridging");                                                                                                                                                            │
│         for (uint i=0; i<tokenId.length; i++) {                                                                                                                                                                 │
│             require(_msgSender() == ownerOf(tokenId), "Not the owner");                                                                                                                                         │
│             // burn NFT                                                                                                                                                                                         │
│             _burn(tokenId);                                                                                                                                                                                     │
│         }                                                                                                                                                                                                       │
│         address targetAddress;                                                                                                                                                                                  │
│         assembly {                                                                                                                                                                                              │
│             targetAddress := mload(add(_destination, 20))                                                                                                                                                       │
│         }                                                                                                                                                                                                       │
│         require(isTrustedAddress[_dstChainId], "!Trusted");                                                                                                                                                     │
│         bytes memory payload = abi.encode(_to, tokenId);                                                                                                                                                        │
│         // encode adapterParams to specify more gas for the destination                                                                                                                                         │
│         uint16 version = 1;                                                                                                                                                                                     │
│         uint256 _gas = 500_000 + gas*tokenId.length;                                                                                                                                                            │
│         bytes memory adapterParams = abi.encodePacked(version, _gas);                                                                                                                                           │
│         (uint256 messageFee, ) = endpoint.estimateFees(                                                                                                                                                         │
│             _dstChainId,                                                                                                                                                                                        │
│             address(this),                                                                                                                                                                                      │
│             payload,                                                                                                                                                                                            │
│             false,                                                                                                                                                                                              │
│             adapterParams                                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             msg.value >= messageFee,                                                                                                                                                                            │
│             "Must send enough value to cover messageFee"                                                                                                                                                        │
│         );                                                                                                                                                                                                      │
│         endpoint.send{value: msg.value}(                                                                                                                                                                        │
│             _dstChainId,                                                                                                                                                                                        │
│             _destination,                                                                                                                                                                                       │
│             payload,                                                                                                                                                                                            │
│             payable(_msgSender()),                                                                                                                                                                              │
│             address(0x0),                                                                                                                                                                                       │
│             adapterParams                                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│     }                                                                                                                                                                                                           │
│     function _burn(uint256 tokenId) internal override {                                                                                                                                                         │
│         address owner = ownerOf(tokenId);                                                                                                                                                                       │
│         for (uint i=0; i<assetsLength(); i++) {                                                                                                                                                                 │
│             userDebt[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│             userDebt[assets] -= userPaid[assets]/balanceOf(owner);                                                                                                                                              │
│             userPaid[assets] -= userPaid[assets]/balanceOf(owner);                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│         super._burn(tokenId);                                                                                                                                                                                   │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function burn(uint _id) external onlyMinter {                                                                                                                                                               │
│         _burn(_id);                                                                                                                                                                                             │
│         uint _asset = _trades[_id].asset;                                                                                                                                                                       │
│         if (_trades[_id].orderType > 0) {                                                                                                                                                                       │
│             _limitOrderIndexes[_asset][_limitOrders[_asset][_limitOrders[_asset].length-1]] = _limitOrderIndexes[_asset][_id];                                                                                  │
│             _limitOrders[_asset][_limitOrderIndexes[_asset][_id]] = _limitOrders[_asset][_limitOrders[_asset].length-1];                                                                                        │
│             delete _limitOrderIndexes[_asset][_id];                                                                                                                                                             │
│             _limitOrders[_asset].pop();                                                                                                                                                                         │
│         } else {                                                                                                                                                                                                │
│             _assetOpenPositionsIndexes[_asset][_assetOpenPositions[_asset][_assetOpenPositions[_asset].length-1]] = _assetOpenPositionsIndexes[_asset][_id];                                                    │
│             _assetOpenPositions[_asset][_assetOpenPositionsIndexes[_asset][_id]] = _assetOpenPositions[_asset][_assetOpenPositions[_asset].length-1];                                                           │
│             delete _assetOpenPositionsIndexes[_asset][_id];                                                                                                                                                     │
│             _assetOpenPositions[_asset].pop();                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _openPositionsIndexes[_openPositions[_openPositions.length-1]] = _openPositionsIndexes[_id];                                                                                                        │
│             _openPositions[_openPositionsIndexes[_id]] = _openPositions[_openPositions.length-1];                                                                                                               │
│             delete _openPositionsIndexes[_id];                                                                                                                                                                  │
│             _openPositions.pop();                                                                                                                                                                               │
│         }                                                                                                                                                                                                       │
│         delete _trades[_id];                                                                                                                                                                                    │
│     }                                                                                                                                                                                                           │
│     function _burn(uint256 tokenId) internal override {                                                                                                                                                         │
│         address owner = ownerOf(tokenId);                                                                                                                                                                       │
│         for (uint i=0; i<assetsLength(); i++) {                                                                                                                                                                 │
│             userDebt[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│             userDebt[assets] -= userPaid[assets]/balanceOf(owner);                                                                                                                                              │
│             userPaid[assets] -= userPaid[assets]/balanceOf(owner);                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│         super._burn(tokenId);                                                                                                                                                                                   │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function crossChain(                                                                                                                                                                                        │
│         uint16 _dstChainId,                                                                                                                                                                                     │
│         bytes memory _destination,                                                                                                                                                                              │
│         address _to,                                                                                                                                                                                            │
│         uint256[] memory tokenId                                                                                                                                                                                │
│     ) public payable {                                                                                                                                                                                          │
│         require(tokenId.length > 0, "Not bridging");                                                                                                                                                            │
│         for (uint i=0; i<tokenId.length; i++) {                                                                                                                                                                 │
│             require(_msgSender() == ownerOf(tokenId), "Not the owner");                                                                                                                                         │
│             // burn NFT                                                                                                                                                                                         │
│             _burn(tokenId);                                                                                                                                                                                     │
│         }                                                                                                                                                                                                       │
│         address targetAddress;                                                                                                                                                                                  │
│         assembly {                                                                                                                                                                                              │
│             targetAddress := mload(add(_destination, 20))                                                                                                                                                       │
│         }                                                                                                                                                                                                       │
│         require(isTrustedAddress[_dstChainId], "!Trusted");                                                                                                                                                     │
│         bytes memory payload = abi.encode(_to, tokenId);                                                                                                                                                        │
│         // encode adapterParams to specify more gas for the destination                                                                                                                                         │
│         uint16 version = 1;                                                                                                                                                                                     │
│         uint256 _gas = 500_000 + gas*tokenId.length;                                                                                                                                                            │
│         bytes memory adapterParams = abi.encodePacked(version, _gas);                                                                                                                                           │
│         (uint256 messageFee, ) = endpoint.estimateFees(                                                                                                                                                         │
│             _dstChainId,                                                                                                                                                                                        │
│             address(this),                                                                                                                                                                                      │
│             payload,                                                                                                                                                                                            │
│             false,                                                                                                                                                                                              │
│             adapterParams                                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             msg.value >= messageFee,                                                                                                                                                                            │
│             "Must send enough value to cover messageFee"                                                                                                                                                        │
│         );                                                                                                                                                                                                      │
│         endpoint.send{value: msg.value}(                                                                                                                                                                        │
│             _dstChainId,                                                                                                                                                                                        │
│             _destination,                                                                                                                                                                                       │
│             payload,                                                                                                                                                                                            │
│             payable(_msgSender()),                                                                                                                                                                              │
│             address(0x0),                                                                                                                                                                                       │
│             adapterParams                                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│     }                                                                                                                                                                                                           │
│     function _burn(uint256 tokenId) internal override {                                                                                                                                                         │
│         address owner = ownerOf(tokenId);                                                                                                                                                                       │
│         for (uint i=0; i<assetsLength(); i++) {                                                                                                                                                                 │
│             userDebt[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│             userDebt[assets] -= userPaid[assets]/balanceOf(owner);                                                                                                                                              │
│             userPaid[assets] -= userPaid[assets]/balanceOf(owner);                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│         super._burn(tokenId);                                                                                                                                                                                   │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function release(                                                                                                                                                                                           │
│         uint _id,                                                                                                                                                                                               │
│         address _releaser                                                                                                                                                                                       │
│     ) external onlyManager() returns(uint amount, uint lockAmount, address asset, address _owner) {                                                                                                             │
│         Bond memory bond = idToBond(_id);                                                                                                                                                                       │
│         require(bond.expired, "!expire");                                                                                                                                                                       │
│         if (_releaser != bond.owner) {                                                                                                                                                                          │
│             unchecked {                                                                                                                                                                                         │
│                 require(bond.expireEpoch + 7 < epoch, "Bond owner priority");                                                                                                                                   │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         amount = bond.amount;                                                                                                                                                                                   │
│         unchecked {                                                                                                                                                                                             │
│             totalShares -= bond.shares;                                                                                                                                                                         │
│             (uint256 _claimAmount,) = claim(_id, bond.owner);                                                                                                                                                   │
│             amount += _claimAmount;                                                                                                                                                                             │
│         }                                                                                                                                                                                                       │
│         asset = bond.asset;                                                                                                                                                                                     │
│         lockAmount = bond.amount;                                                                                                                                                                               │
│         _owner = bond.owner;                                                                                                                                                                                    │
│         _burn(_id);                                                                                                                                                                                             │
│         emit Release(asset, lockAmount, _owner, _id);                                                                                                                                                           │
│     }                                                                                                                                                                                                           │
│     function _burn(uint256 tokenId) internal override {                                                                                                                                                         │
│         address owner = ownerOf(tokenId);                                                                                                                                                                       │
│         for (uint i=0; i<assetsLength(); i++) {                                                                                                                                                                 │
│             userDebt[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│             userDebt[assets] -= userPaid[assets]/balanceOf(owner);                                                                                                                                              │
│             userPaid[assets] -= userPaid[assets]/balanceOf(owner);                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│         super._burn(tokenId);                                                                                                                                                                                   │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function _transfer(                                                                                                                                                                                         │
│         address from,                                                                                                                                                                                           │
│         address to,                                                                                                                                                                                             │
│         uint256 tokenId                                                                                                                                                                                         │
│     ) internal override {                                                                                                                                                                                       │
│         require(ownerOf(tokenId) == from, "!Owner");                                                                                                                                                            │
│         for (uint i=0; i<assetsLength(); i++) {                                                                                                                                                                 │
│             userDebt[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│             userDebt[assets] -= userPaid[assets]/balanceOf(from);                                                                                                                                               │
│             userPaid[assets] -= userPaid[assets]/balanceOf(from);                                                                                                                                               │
│             userPaid[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│         }                                                                                                                                                                                                       │
│         super._transfer(from, to, tokenId);                                                                                                                                                                     │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function safeTransferMany(address _to, uint[] calldata _ids) external {                                                                                                                                     │
│         for (uint i=0; i<_ids.length; i++) {                                                                                                                                                                    │
│             _transfer(_msgSender(), _to, _ids);                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function _transfer(                                                                                                                                                                                         │
│         address from,                                                                                                                                                                                           │
│         address to,                                                                                                                                                                                             │
│         uint256 tokenId                                                                                                                                                                                         │
│     ) internal override {                                                                                                                                                                                       │
│         require(ownerOf(tokenId) == from, "!Owner");                                                                                                                                                            │
│         for (uint i=0; i<assetsLength(); i++) {                                                                                                                                                                 │
│             userDebt[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│             userDebt[assets] -= userPaid[assets]/balanceOf(from);                                                                                                                                               │
│             userPaid[assets] -= userPaid[assets]/balanceOf(from);                                                                                                                                               │
│             userPaid[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│         }                                                                                                                                                                                                       │
│         super._transfer(from, to, tokenId);                                                                                                                                                                     │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function safeTransferMany(address _to, uint[] calldata _ids) external {                                                                                                                                     │
│         for (uint i=0; i<_ids.length; i++) {                                                                                                                                                                    │
│             _transfer(_msgSender(), _to, _ids);                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function _transfer(                                                                                                                                                                                         │
│         address from,                                                                                                                                                                                           │
│         address to,                                                                                                                                                                                             │
│         uint256 tokenId                                                                                                                                                                                         │
│     ) internal override {                                                                                                                                                                                       │
│         require(ownerOf(tokenId) == from, "!Owner");                                                                                                                                                            │
│         for (uint i=0; i<assetsLength(); i++) {                                                                                                                                                                 │
│             userDebt[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│             userDebt[assets] -= userPaid[assets]/balanceOf(from);                                                                                                                                               │
│             userPaid[assets] -= userPaid[assets]/balanceOf(from);                                                                                                                                               │
│             userPaid[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│         }                                                                                                                                                                                                       │
│         super._transfer(from, to, tokenId);                                                                                                                                                                     │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function safeTransferMany(address _to, uint[] calldata _ids) external {                                                                                                                                     │
│         unchecked {                                                                                                                                                                                             │
│             for (uint i=0; i<_ids.length; i++) {                                                                                                                                                                │
│                 _transfer(_msgSender(), _to, _ids);                                                                                                                                                             │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function _transfer(                                                                                                                                                                                         │
│         address from,                                                                                                                                                                                           │
│         address to,                                                                                                                                                                                             │
│         uint256 tokenId                                                                                                                                                                                         │
│     ) internal override {                                                                                                                                                                                       │
│         require(ownerOf(tokenId) == from, "!Owner");                                                                                                                                                            │
│         for (uint i=0; i<assetsLength(); i++) {                                                                                                                                                                 │
│             userDebt[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│             userDebt[assets] -= userPaid[assets]/balanceOf(from);                                                                                                                                               │
│             userPaid[assets] -= userPaid[assets]/balanceOf(from);                                                                                                                                               │
│             userPaid[assets] += accRewardsPerNFT[assets];                                                                                                                                                       │
│         }                                                                                                                                                                                                       │
│         super._transfer(from, to, tokenId);                                                                                                                                                                     │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function distribute(address _tigAsset, uint _amount) external {                                                                                                                                             │
│         if (assets.length == 0 || assets[assetsIndex[_tigAsset]] == address(0) || totalSupply() == 0 || !_allowedAsset[_tigAsset]) return;                                                                      │
│         try IERC20(_tigAsset).transferFrom(_msgSender(), address(this), _amount) {                                                                                                                              │
│             accRewardsPerNFT[_tigAsset] += _amount/totalSupply();                                                                                                                                               │
│         } catch {                                                                                                                                                                                               │
│             return;                                                                                                                                                                                             │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ Code:                                                                                                                                                                                                           │
│     function balanceIds(address _user) external view returns (uint[] memory) {                                                                                                                                  │
│         uint[] memory _ids = new uint[](balanceOf(_user));                                                                                                                                                      │
│         for (uint i=0; i<_ids.length; i++) {                                                                                                                                                                    │
│             _ids = tokenOfOwnerByIndex(_user, i);                                                                                                                                                               │
│         }                                                                                                                                                                                                       │
│         return _ids;                                                                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function _closePosition(                                                                                                                                                                                    │
│         uint _id,                                                                                                                                                                                               │
│         uint _price,                                                                                                                                                                                            │
│         uint _percent                                                                                                                                                                                           │
│     ) external onlyProtocol returns (IPosition.Trade memory _trade, uint256 _positionSize, int256 _payout) {                                                                                                    │
│         _trade = position.trades(_id);                                                                                                                                                                          │
│         (_positionSize, _payout) = TradingLibrary.pnl(_trade.direction, _price, _trade.price, _trade.margin, _trade.leverage, _trade.accInterest);                                                              │
│                                                                                                                                                                                                                 │
│         unchecked {                                                                                                                                                                                             │
│             if (_trade.direction) {                                                                                                                                                                             │
│                 modifyLongOi(_trade.asset, _trade.tigAsset, false, (_trade.margin*_trade.leverage/1e18)*_percent/DIVISION_CONSTANT);                                                                            │
│             } else {                                                                                                                                                                                            │
│                 modifyShortOi(_trade.asset, _trade.tigAsset, false, (_trade.margin*_trade.leverage/1e18)*_percent/DIVISION_CONSTANT);                                                                           │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function pnl(bool _direction, uint _currentPrice, uint _price, uint _margin, uint _leverage, int256 accInterest) external pure returns (uint256 _positionSize, int256 _payout) {                            │
│         unchecked {                                                                                                                                                                                             │
│             uint _initPositionSize = _margin * _leverage / 1e18;                                                                                                                                                │
│             if (_direction && _currentPrice >= _price) {                                                                                                                                                        │
│                 _payout = int256(_margin) + int256(_initPositionSize * (1e18 * _currentPrice / _price - 1e18)/1e18) + accInterest;                                                                              │
│             } else if (_direction && _currentPrice < _price) {                                                                                                                                                  │
│                 _payout = int256(_margin) - int256(_initPositionSize * (1e18 - 1e18 * _currentPrice / _price)/1e18) + accInterest;                                                                              │
│             } else if (!_direction && _currentPrice <= _price) {                                                                                                                                                │
│                 _payout = int256(_margin) + int256(_initPositionSize * (1e18 - 1e18 * _currentPrice / _price)/1e18) + accInterest;                                                                              │
│             } else {                                                                                                                                                                                            │
│                 _payout = int256(_margin) - int256(_initPositionSize * (1e18 * _currentPrice / _price - 1e18)/1e18) + accInterest;                                                                              │
│             }                                                                                                                                                                                                   │
│             _positionSize = _initPositionSize * _currentPrice / _price;                                                                                                                                         │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                      │
│ Code:                                                                                                                                                                                                           │
│     function pnl(bool _direction, uint _currentPrice, uint _price, uint _margin, uint _leverage, int256 accInterest) external pure returns (uint256 _positionSize, int256 _payout) {                            │
│         unchecked {                                                                                                                                                                                             │
│             uint _initPositionSize = _margin * _leverage / 1e18;                                                                                                                                                │
│             if (_direction && _currentPrice >= _price) {                                                                                                                                                        │
│                 _payout = int256(_margin) + int256(_initPositionSize * (1e18 * _currentPrice / _price - 1e18)/1e18) + accInterest;                                                                              │
│             } else if (_direction && _currentPrice < _price) {                                                                                                                                                  │
│                 _payout = int256(_margin) - int256(_initPositionSize * (1e18 - 1e18 * _currentPrice / _price)/1e18) + accInterest;                                                                              │
│             } else if (!_direction && _currentPrice <= _price) {                                                                                                                                                │
│                 _payout = int256(_margin) + int256(_initPositionSize * (1e18 - 1e18 * _currentPrice / _price)/1e18) + accInterest;                                                                              │
│             } else {                                                                                                                                                                                            │
│                 _payout = int256(_margin) - int256(_initPositionSize * (1e18 * _currentPrice / _price - 1e18)/1e18) + accInterest;                                                                              │
│             }                                                                                                                                                                                                   │
│             _positionSize = _initPositionSize * _currentPrice / _price;                                                                                                                                         │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to update/accrue interest/exchange rate? Answer only ZERO or ONE statement, cover the code with backquotes.                    │
│ Code:                                                                                                                                                                                                           │
│     function trades(uint _id) public view returns (Trade memory) {                                                                                                                                              │
│         Trade memory _trade = _trades[_id];                                                                                                                                                                     │
│         _trade.trader = ownerOf(_id);                                                                                                                                                                           │
│         if (_trade.orderType > 0) return _trade;                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         int256 _pendingFunding;                                                                                                                                                                                 │
│         if (_trade.direction && longOi[_trade.asset][_trade.tigAsset] > 0) {                                                                                                                                    │
│             _pendingFunding = (int256(block.timestamp-lastUpdate[_trade.asset][_trade.tigAsset])*fundingDeltaPerSec[_trade.asset][_trade.tigAsset])*1e18/int256(longOi[_trade.asset][_trade.tigAsset]);         │
│             if (longOi[_trade.asset][_trade.tigAsset] > shortOi[_trade.asset][_trade.tigAsset]) {                                                                                                               │
│                 _pendingFunding = -_pendingFunding;                                                                                                                                                             │
│             } else {                                                                                                                                                                                            │
│                 _pendingFunding = _pendingFunding*int256(1e10-vaultFundingPercent[_trade.asset][_trade.tigAsset])/1e10;                                                                                         │
│             }                                                                                                                                                                                                   │
│         } else if (shortOi[_trade.asset][_trade.tigAsset] > 0) {                                                                                                                                                │
│             _pendingFunding = (int256(block.timestamp-lastUpdate[_trade.asset][_trade.tigAsset])*fundingDeltaPerSec[_trade.asset][_trade.tigAsset])*1e18/int256(shortOi[_trade.asset][_trade.tigAsset]);        │
│             if (shortOi[_trade.asset][_trade.tigAsset] > longOi[_trade.asset][_trade.tigAsset]) {                                                                                                               │
│                 _pendingFunding = -_pendingFunding;                                                                                                                                                             │
│             } else {                                                                                                                                                                                            │
│                 _pendingFunding = _pendingFunding*int256(1e10-vaultFundingPercent[_trade.asset][_trade.tigAsset])/1e10;                                                                                         │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         _trade.accInterest += (int256(_trade.margin*_trade.leverage/1e18)*(accInterestPerOi[_trade.asset][_trade.tigAsset][_trade.direction]+_pendingFunding)/1e18)-initId[_id];                                │
│                                                                                                                                                                                                                 │
│         return _trade;                                                                                                                                                                                          │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to update/accrue interest/exchange rate is the statement inside the `if (_trade.direction && longOi[_trade.asset][_trade.tigAsset] > 0)` block.                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward? Answer only ZERO or ONE statement, cover the code with │
│ backquotes.                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function trades(uint _id) public view returns (Trade memory) {                                                                                                                                              │
│         Trade memory _trade = _trades[_id];                                                                                                                                                                     │
│         _trade.trader = ownerOf(_id);                                                                                                                                                                           │
│         if (_trade.orderType > 0) return _trade;                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         int256 _pendingFunding;                                                                                                                                                                                 │
│         if (_trade.direction && longOi[_trade.asset][_trade.tigAsset] > 0) {                                                                                                                                    │
│             _pendingFunding = (int256(block.timestamp-lastUpdate[_trade.asset][_trade.tigAsset])*fundingDeltaPerSec[_trade.asset][_trade.tigAsset])*1e18/int256(longOi[_trade.asset][_trade.tigAsset]);         │
│             if (longOi[_trade.asset][_trade.tigAsset] > shortOi[_trade.asset][_trade.tigAsset]) {                                                                                                               │
│                 _pendingFunding = -_pendingFunding;                                                                                                                                                             │
│             } else {                                                                                                                                                                                            │
│                 _pendingFunding = _pendingFunding*int256(1e10-vaultFundingPercent[_trade.asset][_trade.tigAsset])/1e10;                                                                                         │
│             }                                                                                                                                                                                                   │
│         } else if (shortOi[_trade.asset][_trade.tigAsset] > 0) {                                                                                                                                                │
│             _pendingFunding = (int256(block.timestamp-lastUpdate[_trade.asset][_trade.tigAsset])*fundingDeltaPerSec[_trade.asset][_trade.tigAsset])*1e18/int256(shortOi[_trade.asset][_trade.tigAsset]);        │
│             if (shortOi[_trade.asset][_trade.tigAsset] > longOi[_trade.asset][_trade.tigAsset]) {                                                                                                               │
│                 _pendingFunding = -_pendingFunding;                                                                                                                                                             │
│             } else {                                                                                                                                                                                            │
│                 _pendingFunding = _pendingFunding*int256(1e10-vaultFundingPercent[_trade.asset][_trade.tigAsset])/1e10;                                                                                         │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         _trade.accInterest += (int256(_trade.margin*_trade.leverage/1e18)*(accInterestPerOi[_trade.asset][_trade.tigAsset][_trade.direction]+_pendingFunding)/1e18)-initId[_id];                                │
│                                                                                                                                                                                                                 │
│         return _trade;                                                                                                                                                                                          │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward is `"_trade.accInterest +=                                                                                           │
│ (int256(_trade.margin*_trade.leverage/1e18)*(accInterestPerOi[_trade.asset][_trade.tigAsset][_trade.direction]+_pendingFunding)/1e18)-initId[_id];"`.                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 20:06:31] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/contracts/Position.sol, current function:     tasks.py:260
                             trades, current vul: wrong-order-interest                                                                                                                                             
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to update/accrue interest/exchange rate? Answer only ZERO or ONE statement, cover the code with backquotes.                    │
│ Code:                                                                                                                                                                                                           │
│     function updateFunding(uint256 _asset, address _tigAsset, uint256 _longOi, uint256 _shortOi, uint256 _baseFundingRate, uint _vaultFundingPercent) external onlyMinter {                                     │
│         if(longOi[_asset][_tigAsset] < shortOi[_asset][_tigAsset]) {                                                                                                                                            │
│             if (longOi[_asset][_tigAsset] > 0) {                                                                                                                                                                │
│                 accInterestPerOi[_asset][_tigAsset] +=                                                                                                                                                          │
│ ((int256(block.timestamp-lastUpdate[_asset][_tigAsset])*fundingDeltaPerSec[_asset][_tigAsset])*1e18/int256(longOi[_asset][_tigAsset]))*int256(1e10-vaultFundingPercent[_asset][_tigAsset])/1e10;                │
│             }                                                                                                                                                                                                   │
│             accInterestPerOi[_asset][_tigAsset] -= (int256(block.timestamp-lastUpdate[_asset][_tigAsset])*fundingDeltaPerSec[_asset][_tigAsset])*1e18/int256(shortOi[_asset][_tigAsset]);                       │
│                                                                                                                                                                                                                 │
│         } else if(longOi[_asset][_tigAsset] > shortOi[_asset][_tigAsset]) {                                                                                                                                     │
│             accInterestPerOi[_asset][_tigAsset] -= (int256(block.timestamp-lastUpdate[_asset][_tigAsset])*fundingDeltaPerSec[_asset][_tigAsset])*1e18/int256(longOi[_asset][_tigAsset]);                        │
│             if (shortOi[_asset][_tigAsset] > 0) {                                                                                                                                                               │
│                 accInterestPerOi[_asset][_tigAsset] +=                                                                                                                                                          │
│ ((int256(block.timestamp-lastUpdate[_asset][_tigAsset])*fundingDeltaPerSec[_asset][_tigAsset])*1e18/int256(shortOi[_asset][_tigAsset]))*int256(1e10-vaultFundingPercent[_asset][_tigAsset])/1e10;               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         lastUpdate[_asset][_tigAsset] = block.timestamp;                                                                                                                                                        │
│         int256 _oiDelta;                                                                                                                                                                                        │
│         if (_longOi > _shortOi) {                                                                                                                                                                               │
│             _oiDelta = int256(_longOi)-int256(_shortOi);                                                                                                                                                        │
│         } else {                                                                                                                                                                                                │
│             _oiDelta = int256(_shortOi)-int256(_longOi);                                                                                                                                                        │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         fundingDeltaPerSec[_asset][_tigAsset] = (_oiDelta*int256(_baseFundingRate)/int256(DIVISION_CONSTANT))/31536000;                                                                                         │
│         longOi[_asset][_tigAsset] = _longOi;                                                                                                                                                                    │
│         shortOi[_asset][_tigAsset] = _shortOi;                                                                                                                                                                  │
│         vaultFundingPercent[_asset][_tigAsset] = _vaultFundingPercent;                                                                                                                                          │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to update/accrue interest/exchange rate is `accInterestPerOi[_asset][_tigAsset] +=                                                                                                          │
│ ((int256(block.timestamp-lastUpdate[_asset][_tigAsset])*fundingDeltaPerSec[_asset][_tigAsset])*1e18/int256(longOi[_asset][_tigAsset]))*int256(1e10-vaultFundingPercent[_asset][_tigAsset])/1e10;`               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward? Answer only ZERO or ONE statement, cover the code with │
│ backquotes.                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function updateFunding(uint256 _asset, address _tigAsset, uint256 _longOi, uint256 _shortOi, uint256 _baseFundingRate, uint _vaultFundingPercent) external onlyMinter {                                     │
│         if(longOi[_asset][_tigAsset] < shortOi[_asset][_tigAsset]) {                                                                                                                                            │
│             if (longOi[_asset][_tigAsset] > 0) {                                                                                                                                                                │
│                 accInterestPerOi[_asset][_tigAsset] +=                                                                                                                                                          │
│ ((int256(block.timestamp-lastUpdate[_asset][_tigAsset])*fundingDeltaPerSec[_asset][_tigAsset])*1e18/int256(longOi[_asset][_tigAsset]))*int256(1e10-vaultFundingPercent[_asset][_tigAsset])/1e10;                │
│             }                                                                                                                                                                                                   │
│             accInterestPerOi[_asset][_tigAsset] -= (int256(block.timestamp-lastUpdate[_asset][_tigAsset])*fundingDeltaPerSec[_asset][_tigAsset])*1e18/int256(shortOi[_asset][_tigAsset]);                       │
│                                                                                                                                                                                                                 │
│         } else if(longOi[_asset][_tigAsset] > shortOi[_asset][_tigAsset]) {                                                                                                                                     │
│             accInterestPerOi[_asset][_tigAsset] -= (int256(block.timestamp-lastUpdate[_asset][_tigAsset])*fundingDeltaPerSec[_asset][_tigAsset])*1e18/int256(longOi[_asset][_tigAsset]);                        │
│             if (shortOi[_asset][_tigAsset] > 0) {                                                                                                                                                               │
│                 accInterestPerOi[_asset][_tigAsset] +=                                                                                                                                                          │
│ ((int256(block.timestamp-lastUpdate[_asset][_tigAsset])*fundingDeltaPerSec[_asset][_tigAsset])*1e18/int256(shortOi[_asset][_tigAsset]))*int256(1e10-vaultFundingPercent[_asset][_tigAsset])/1e10;               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         lastUpdate[_asset][_tigAsset] = block.timestamp;                                                                                                                                                        │
│         int256 _oiDelta;                                                                                                                                                                                        │
│         if (_longOi > _shortOi) {                                                                                                                                                                               │
│             _oiDelta = int256(_longOi)-int256(_shortOi);                                                                                                                                                        │
│         } else {                                                                                                                                                                                                │
│             _oiDelta = int256(_shortOi)-int256(_longOi);                                                                                                                                                        │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         fundingDeltaPerSec[_asset][_tigAsset] = (_oiDelta*int256(_baseFundingRate)/int256(DIVISION_CONSTANT))/31536000;                                                                                         │
│         longOi[_asset][_tigAsset] = _longOi;                                                                                                                                                                    │
│         shortOi[_asset][_tigAsset] = _shortOi;                                                                                                                                                                  │
│         vaultFundingPercent[_asset][_tigAsset] = _vaultFundingPercent;                                                                                                                                          │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ `accInterestPerOi[_asset][_tigAsset] +=                                                                                                                                                                         │
│ ((int256(block.timestamp-lastUpdate[_asset][_tigAsset])*fundingDeltaPerSec[_asset][_tigAsset])*1e18/int256(longOi[_asset][_tigAsset]))*int256(1e10-vaultFundingPercent[_asset][_tigAsset])/1e10;`               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 20:06:33] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/contracts/Position.sol, current function:     tasks.py:260
                             updateFunding, current vul: wrong-order-interest                                                                                                                                      
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to update/accrue interest/exchange rate? Answer only ZERO or ONE statement, cover the code with backquotes.                    │
│ Code:                                                                                                                                                                                                           │
│     function addToPosition(                                                                                                                                                                                     │
│         uint _id,                                                                                                                                                                                               │
│         uint _addMargin,                                                                                                                                                                                        │
│         PriceData calldata _priceData,                                                                                                                                                                          │
│         bytes calldata _signature,                                                                                                                                                                              │
│         address _stableVault,                                                                                                                                                                                   │
│         address _marginAsset,                                                                                                                                                                                   │
│         ERC20PermitData calldata _permitData,                                                                                                                                                                   │
│         address _trader                                                                                                                                                                                         │
│     )                                                                                                                                                                                                           │
│         external                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         _validateProxy(_trader);                                                                                                                                                                                │
│         _checkOwner(_id, _trader);                                                                                                                                                                              │
│         _checkDelay(_id, true);                                                                                                                                                                                 │
│         IPosition.Trade memory _trade = position.trades(_id);                                                                                                                                                   │
│         tradingExtension.validateTrade(_trade.asset, _trade.tigAsset, _trade.margin + _addMargin, _trade.leverage);                                                                                             │
│         _checkVault(_stableVault, _marginAsset);                                                                                                                                                                │
│         if (_trade.orderType != 0) revert("4"); //IsLimit                                                                                                                                                       │
│         uint _fee = _handleOpenFees(_trade.asset, _addMargin*_trade.leverage/1e18, _trader, _trade.tigAsset, false);                                                                                            │
│         _handleDeposit(                                                                                                                                                                                         │
│             _trade.tigAsset,                                                                                                                                                                                    │
│             _marginAsset,                                                                                                                                                                                       │
│             _addMargin - _fee,                                                                                                                                                                                  │
│             _stableVault,                                                                                                                                                                                       │
│             _permitData,                                                                                                                                                                                        │
│             _trader                                                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         position.setAccInterest(_id);                                                                                                                                                                           │
│         unchecked {                                                                                                                                                                                             │
│             (uint256 _price,) = tradingExtension.getVerifiedPrice(_trade.asset, _priceData, _signature, _trade.direction ? 1 : 2);                                                                              │
│             uint _positionSize = (_addMargin - _fee) * _trade.leverage / 1e18;                                                                                                                                  │
│             if (_trade.direction) {                                                                                                                                                                             │
│                 tradingExtension.modifyLongOi(_trade.asset, _trade.tigAsset, true, _positionSize);                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 tradingExtension.modifyShortOi(_trade.asset, _trade.tigAsset, true, _positionSize);                                                                                                             │
│             }                                                                                                                                                                                                   │
│             _updateFunding(_trade.asset, _trade.tigAsset);                                                                                                                                                      │
│             _addMargin -= _fee;                                                                                                                                                                                 │
│             uint _newMargin = _trade.margin + _addMargin;                                                                                                                                                       │
│             uint _newPrice = _trade.price*_trade.margin/_newMargin + _price*_addMargin/_newMargin;                                                                                                              │
│                                                                                                                                                                                                                 │
│             position.addToPosition(                                                                                                                                                                             │
│                 _trade.id,                                                                                                                                                                                      │
│                 _newMargin,                                                                                                                                                                                     │
│                 _newPrice                                                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             emit AddToPosition(_trade.id, _newMargin, _newPrice, _trade.trader);                                                                                                                                │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to update/accrue interest/exchange rate is `position.setAccInterest(_id);`.                                                                                                                 │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward? Answer only ZERO or ONE statement, cover the code with │
│ backquotes.                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function addToPosition(                                                                                                                                                                                     │
│         uint _id,                                                                                                                                                                                               │
│         uint _addMargin,                                                                                                                                                                                        │
│         PriceData calldata _priceData,                                                                                                                                                                          │
│         bytes calldata _signature,                                                                                                                                                                              │
│         address _stableVault,                                                                                                                                                                                   │
│         address _marginAsset,                                                                                                                                                                                   │
│         ERC20PermitData calldata _permitData,                                                                                                                                                                   │
│         address _trader                                                                                                                                                                                         │
│     )                                                                                                                                                                                                           │
│         external                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         _validateProxy(_trader);                                                                                                                                                                                │
│         _checkOwner(_id, _trader);                                                                                                                                                                              │
│         _checkDelay(_id, true);                                                                                                                                                                                 │
│         IPosition.Trade memory _trade = position.trades(_id);                                                                                                                                                   │
│         tradingExtension.validateTrade(_trade.asset, _trade.tigAsset, _trade.margin + _addMargin, _trade.leverage);                                                                                             │
│         _checkVault(_stableVault, _marginAsset);                                                                                                                                                                │
│         if (_trade.orderType != 0) revert("4"); //IsLimit                                                                                                                                                       │
│         uint _fee = _handleOpenFees(_trade.asset, _addMargin*_trade.leverage/1e18, _trader, _trade.tigAsset, false);                                                                                            │
│         _handleDeposit(                                                                                                                                                                                         │
│             _trade.tigAsset,                                                                                                                                                                                    │
│             _marginAsset,                                                                                                                                                                                       │
│             _addMargin - _fee,                                                                                                                                                                                  │
│             _stableVault,                                                                                                                                                                                       │
│             _permitData,                                                                                                                                                                                        │
│             _trader                                                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         position.setAccInterest(_id);                                                                                                                                                                           │
│         unchecked {                                                                                                                                                                                             │
│             (uint256 _price,) = tradingExtension.getVerifiedPrice(_trade.asset, _priceData, _signature, _trade.direction ? 1 : 2);                                                                              │
│             uint _positionSize = (_addMargin - _fee) * _trade.leverage / 1e18;                                                                                                                                  │
│             if (_trade.direction) {                                                                                                                                                                             │
│                 tradingExtension.modifyLongOi(_trade.asset, _trade.tigAsset, true, _positionSize);                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 tradingExtension.modifyShortOi(_trade.asset, _trade.tigAsset, true, _positionSize);                                                                                                             │
│             }                                                                                                                                                                                                   │
│             _updateFunding(_trade.asset, _trade.tigAsset);                                                                                                                                                      │
│             _addMargin -= _fee;                                                                                                                                                                                 │
│             uint _newMargin = _trade.margin + _addMargin;                                                                                                                                                       │
│             uint _newPrice = _trade.price*_trade.margin/_newMargin + _price*_addMargin/_newMargin;                                                                                                              │
│                                                                                                                                                                                                                 │
│             position.addToPosition(                                                                                                                                                                             │
│                 _trade.id,                                                                                                                                                                                      │
│                 _newMargin,                                                                                                                                                                                     │
│                 _newPrice                                                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             emit AddToPosition(_trade.id, _newMargin, _newPrice, _trade.trader);                                                                                                                                │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ `position.addToPosition(                                                                                                                                                                                        │
│                 _trade.id,                                                                                                                                                                                      │
│                 _newMargin,                                                                                                                                                                                     │
│                 _newPrice                                                                                                                                                                                       │
│             );`                                                                                                                                                                                                 │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 20:06:34] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/contracts/Trading.sol, current function:      tasks.py:260
                             addToPosition, current vul: wrong-order-interest                                                                                                                                      
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to update/accrue interest/exchange rate? Answer only ZERO or ONE statement, cover the code with backquotes.                    │
│ Code:                                                                                                                                                                                                           │
│     function removeMargin(                                                                                                                                                                                      │
│         uint256 _id,                                                                                                                                                                                            │
│         address _stableVault,                                                                                                                                                                                   │
│         address _outputToken,                                                                                                                                                                                   │
│         uint256 _removeMargin,                                                                                                                                                                                  │
│         PriceData calldata _priceData,                                                                                                                                                                          │
│         bytes calldata _signature,                                                                                                                                                                              │
│         address _trader                                                                                                                                                                                         │
│     )                                                                                                                                                                                                           │
│         external                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         _validateProxy(_trader);                                                                                                                                                                                │
│         _checkOwner(_id, _trader);                                                                                                                                                                              │
│         _checkVault(_stableVault, _outputToken);                                                                                                                                                                │
│         IPosition.Trade memory _trade = position.trades(_id);                                                                                                                                                   │
│         if (_trade.orderType != 0) revert(); //IsLimit                                                                                                                                                          │
│         IPairsContract.Asset memory asset = pairsContract.idToAsset(_trade.asset);                                                                                                                              │
│         uint256 _newMargin = _trade.margin - _removeMargin;                                                                                                                                                     │
│         uint256 _newLeverage = _trade.margin * _trade.leverage / _newMargin;                                                                                                                                    │
│         if (_newLeverage > asset.maxLeverage) revert("!lev");                                                                                                                                                   │
│         (uint _assetPrice,) = tradingExtension.getVerifiedPrice(_trade.asset, _priceData, _signature, 0);                                                                                                       │
│         (,int256 _payout) = TradingLibrary.pnl(_trade.direction, _assetPrice, _trade.price, _newMargin, _newLeverage, _trade.accInterest);                                                                      │
│         unchecked {                                                                                                                                                                                             │
│             if (_payout <= int256(_newMargin*(DIVISION_CONSTANT-liqPercent)/DIVISION_CONSTANT)) revert LiqThreshold();                                                                                          │
│         }                                                                                                                                                                                                       │
│         position.modifyMargin(_trade.id, _newMargin, _newLeverage);                                                                                                                                             │
│         _handleWithdraw(_trade, _stableVault, _outputToken, _removeMargin);                                                                                                                                     │
│         emit MarginModified(_trade.id, _newMargin, _newLeverage, false, _trader);                                                                                                                               │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to update/accrue interest/exchange rate is `position.modifyMargin(_trade.id, _newMargin, _newLeverage);`.                                                                                   │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward? Answer only ZERO or ONE statement, cover the code with │
│ backquotes.                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function removeMargin(                                                                                                                                                                                      │
│         uint256 _id,                                                                                                                                                                                            │
│         address _stableVault,                                                                                                                                                                                   │
│         address _outputToken,                                                                                                                                                                                   │
│         uint256 _removeMargin,                                                                                                                                                                                  │
│         PriceData calldata _priceData,                                                                                                                                                                          │
│         bytes calldata _signature,                                                                                                                                                                              │
│         address _trader                                                                                                                                                                                         │
│     )                                                                                                                                                                                                           │
│         external                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         _validateProxy(_trader);                                                                                                                                                                                │
│         _checkOwner(_id, _trader);                                                                                                                                                                              │
│         _checkVault(_stableVault, _outputToken);                                                                                                                                                                │
│         IPosition.Trade memory _trade = position.trades(_id);                                                                                                                                                   │
│         if (_trade.orderType != 0) revert(); //IsLimit                                                                                                                                                          │
│         IPairsContract.Asset memory asset = pairsContract.idToAsset(_trade.asset);                                                                                                                              │
│         uint256 _newMargin = _trade.margin - _removeMargin;                                                                                                                                                     │
│         uint256 _newLeverage = _trade.margin * _trade.leverage / _newMargin;                                                                                                                                    │
│         if (_newLeverage > asset.maxLeverage) revert("!lev");                                                                                                                                                   │
│         (uint _assetPrice,) = tradingExtension.getVerifiedPrice(_trade.asset, _priceData, _signature, 0);                                                                                                       │
│         (,int256 _payout) = TradingLibrary.pnl(_trade.direction, _assetPrice, _trade.price, _newMargin, _newLeverage, _trade.accInterest);                                                                      │
│         unchecked {                                                                                                                                                                                             │
│             if (_payout <= int256(_newMargin*(DIVISION_CONSTANT-liqPercent)/DIVISION_CONSTANT)) revert LiqThreshold();                                                                                          │
│         }                                                                                                                                                                                                       │
│         position.modifyMargin(_trade.id, _newMargin, _newLeverage);                                                                                                                                             │
│         _handleWithdraw(_trade, _stableVault, _outputToken, _removeMargin);                                                                                                                                     │
│         emit MarginModified(_trade.id, _newMargin, _newLeverage, false, _trader);                                                                                                                               │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ `uint256 _newMargin = _trade.margin - _removeMargin;`                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 20:06:35] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/contracts/Trading.sol, current function:      tasks.py:260
                             removeMargin, current vul: wrong-order-interest                                                                                                                                       
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to update/accrue interest/exchange rate? Answer only ZERO or ONE statement, cover the code with backquotes.                    │
│ Code:                                                                                                                                                                                                           │
│     function _closePosition(                                                                                                                                                                                    │
│         uint _id,                                                                                                                                                                                               │
│         uint _percent,                                                                                                                                                                                          │
│         uint _price,                                                                                                                                                                                            │
│         address _stableVault,                                                                                                                                                                                   │
│         address _outputToken,                                                                                                                                                                                   │
│         bool _isBot                                                                                                                                                                                             │
│     )                                                                                                                                                                                                           │
│         internal                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         (IPosition.Trade memory _trade, uint256 _positionSize, int256 _payout) = tradingExtension._closePosition(_id, _price, _percent);                                                                        │
│         position.setAccInterest(_id);                                                                                                                                                                           │
│         _updateFunding(_trade.asset, _trade.tigAsset);                                                                                                                                                          │
│         if (_percent < DIVISION_CONSTANT) {                                                                                                                                                                     │
│             if ((_trade.margin*_trade.leverage*(DIVISION_CONSTANT-_percent)/DIVISION_CONSTANT)/1e18 < tradingExtension.minPos(_trade.tigAsset)) revert("!size");                                                │
│             position.reducePosition(_id, _percent);                                                                                                                                                             │
│         } else {                                                                                                                                                                                                │
│             position.burn(_id);                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│         uint256 _toMint;                                                                                                                                                                                        │
│         if (_payout > 0) {                                                                                                                                                                                      │
│             unchecked {                                                                                                                                                                                         │
│                 _toMint = _handleCloseFees(_trade.asset, uint256(_payout)*_percent/DIVISION_CONSTANT, _trade.tigAsset, _positionSize*_percent/DIVISION_CONSTANT, _trade.trader, _isBot);                        │
│                 if (maxWinPercent > 0 && _toMint > _trade.margin*maxWinPercent/DIVISION_CONSTANT) {                                                                                                             │
│                     _toMint = _trade.margin*maxWinPercent/DIVISION_CONSTANT;                                                                                                                                    │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│             _handleWithdraw(_trade, _stableVault, _outputToken, _toMint);                                                                                                                                       │
│         }                                                                                                                                                                                                       │
│         emit PositionClosed(_id, _price, _percent, _toMint, _trade.trader, _isBot ? _msgSender() : _trade.trader);                                                                                              │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to update/accrue interest/exchange rate is `position.setAccInterest(_id);`.                                                                                                                 │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward? Answer only ZERO or ONE statement, cover the code with │
│ backquotes.                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function _closePosition(                                                                                                                                                                                    │
│         uint _id,                                                                                                                                                                                               │
│         uint _percent,                                                                                                                                                                                          │
│         uint _price,                                                                                                                                                                                            │
│         address _stableVault,                                                                                                                                                                                   │
│         address _outputToken,                                                                                                                                                                                   │
│         bool _isBot                                                                                                                                                                                             │
│     )                                                                                                                                                                                                           │
│         internal                                                                                                                                                                                                │
│     {                                                                                                                                                                                                           │
│         (IPosition.Trade memory _trade, uint256 _positionSize, int256 _payout) = tradingExtension._closePosition(_id, _price, _percent);                                                                        │
│         position.setAccInterest(_id);                                                                                                                                                                           │
│         _updateFunding(_trade.asset, _trade.tigAsset);                                                                                                                                                          │
│         if (_percent < DIVISION_CONSTANT) {                                                                                                                                                                     │
│             if ((_trade.margin*_trade.leverage*(DIVISION_CONSTANT-_percent)/DIVISION_CONSTANT)/1e18 < tradingExtension.minPos(_trade.tigAsset)) revert("!size");                                                │
│             position.reducePosition(_id, _percent);                                                                                                                                                             │
│         } else {                                                                                                                                                                                                │
│             position.burn(_id);                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│         uint256 _toMint;                                                                                                                                                                                        │
│         if (_payout > 0) {                                                                                                                                                                                      │
│             unchecked {                                                                                                                                                                                         │
│                 _toMint = _handleCloseFees(_trade.asset, uint256(_payout)*_percent/DIVISION_CONSTANT, _trade.tigAsset, _positionSize*_percent/DIVISION_CONSTANT, _trade.trader, _isBot);                        │
│                 if (maxWinPercent > 0 && _toMint > _trade.margin*maxWinPercent/DIVISION_CONSTANT) {                                                                                                             │
│                     _toMint = _trade.margin*maxWinPercent/DIVISION_CONSTANT;                                                                                                                                    │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│             _handleWithdraw(_trade, _stableVault, _outputToken, _toMint);                                                                                                                                       │
│         }                                                                                                                                                                                                       │
│         emit PositionClosed(_id, _price, _percent, _toMint, _trade.trader, _isBot ? _msgSender() : _trade.trader);                                                                                              │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward is `position.setAccInterest(_id);`.                                                                                  │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 20:06:36] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/contracts/Trading.sol, current function:      tasks.py:260
                             _closePosition, current vul: wrong-order-interest                                                                                                                                     
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to update/accrue interest/exchange rate? Answer only ZERO or ONE statement, cover the code with backquotes.                    │
│ Code:                                                                                                                                                                                                           │
│     function pnl(bool _direction, uint _currentPrice, uint _price, uint _margin, uint _leverage, int256 accInterest) external pure returns (uint256 _positionSize, int256 _payout) {                            │
│         unchecked {                                                                                                                                                                                             │
│             uint _initPositionSize = _margin * _leverage / 1e18;                                                                                                                                                │
│             if (_direction && _currentPrice >= _price) {                                                                                                                                                        │
│                 _payout = int256(_margin) + int256(_initPositionSize * (1e18 * _currentPrice / _price - 1e18)/1e18) + accInterest;                                                                              │
│             } else if (_direction && _currentPrice < _price) {                                                                                                                                                  │
│                 _payout = int256(_margin) - int256(_initPositionSize * (1e18 - 1e18 * _currentPrice / _price)/1e18) + accInterest;                                                                              │
│             } else if (!_direction && _currentPrice <= _price) {                                                                                                                                                │
│                 _payout = int256(_margin) + int256(_initPositionSize * (1e18 - 1e18 * _currentPrice / _price)/1e18) + accInterest;                                                                              │
│             } else {                                                                                                                                                                                            │
│                 _payout = int256(_margin) - int256(_initPositionSize * (1e18 * _currentPrice / _price - 1e18)/1e18) + accInterest;                                                                              │
│             }                                                                                                                                                                                                   │
│             _positionSize = _initPositionSize * _currentPrice / _price;                                                                                                                                         │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to update/accrue interest/exchange rate is `accInterest`.                                                                                                                                   │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
                    ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-12-tigris-main/contracts/utils/TradingLibrary.sol, current   tasks.py:260
                             function: pnl, current vul: wrong-order-interest                                                                                                                                      
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
                      Scan Results                       
┏━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┓
┃ Type ┃ Description ┃ Affected Files ┃ Analysis Report ┃
┡━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━┩
└──────┴─────────────┴────────────────┴─────────────────┘
                   Summary                   
┏━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┓
┃ Key                  ┃ Value              ┃
┡━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━┩
│ Files                │ 28                 │
│ Contracts            │ 38                 │
│ Functions            │ 88                 │
│ Lines of Code        │ 4068               │
│ Used Time            │ 38.258347034454346 │
│ Estimated Cost (USD) │ 0.0524455          │
└──────────────────────┴────────────────────┘
