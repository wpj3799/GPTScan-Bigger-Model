

  .oooooo.    ooooooooo.   ooooooooooooo  .oooooo..o                                 
 d8P'  `Y8b   `888   `Y88. 8'   888   `8 d8P'    `Y8                                 
888            888   .d88'      888      Y88bo.       .ooooo.   .oooo.   ooo. .oo.   
888            888ooo88P'       888       `"Y8888o.  d88' `"Y8 `P  )88b  `888P"Y88b  
888     ooooo  888              888           `"Y88b 888        .oP"888   888   888  
`88.    .88'   888              888      oo     .d8P 888   .o8 d8(  888   888   888  
 `Y8bood8P'   o888o            o888o     8""88888P'  `Y8bod8P' `Y888""8o o888o o888o                                                        


                                                                   

[19:36:17] Loaded 10 rules                                                                                                                                                                             tasks.py:119
[12/08/24 19:36:17] INFO     CryticCompile: 'npx hardhat clean' running (wd: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-elasticswap-main)          subprocess.py:41
[12/08/24 19:36:19] ERROR    CryticCompile: 'npx' returned non-zero exit code 127                                                                                                                  subprocess.py:60
                    ERROR    CryticCompile: sh: 1: hardhat: not found                                                                                                                              subprocess.py:68
                    INFO     CryticCompile: 'npx hardhat clean --global' running (wd: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-elasticswap-main) subprocess.py:41
[12/08/24 19:36:21] ERROR    CryticCompile: 'npx' returned non-zero exit code 127                                                                                                                  subprocess.py:60
                    ERROR    CryticCompile: sh: 1: hardhat: not found                                                                                                                              subprocess.py:68
[12/08/24 19:36:23] INFO     CryticCompile: Problem executing hardhat: sh: 1: hardhat: not found                                                                                                     hardhat.py:327
                                                                                                                                                                                                                   
                    INFO     CryticCompile: 'npx hardhat compile --force' running (wd:                                                                                                             subprocess.py:41
                             /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-elasticswap-main)                                                                          
[12/08/24 19:36:25] ERROR    CryticCompile: 'npx' returned non-zero exit code 127                                                                                                                  subprocess.py:60
                    ERROR    CryticCompile: sh: 1: hardhat: not found                                                                                                                              subprocess.py:68
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve calculating swap/liquidity or adding liquidity, and there is asset exchanges or price queries,                                                                                               │
│ have code statements that get or calculate LP token's value/price                                                                                                                                               │
│ have inside code statements that update/accrue interest/exchange rate,                                                                                                                                          │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function addLiquidity(                                                                                                                                                                                      │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         address _liquidityTokenRecipient,                                                                                                                                                                       │
│         uint256 _expirationTimestamp                                                                                                                                                                            │
│     ) external nonReentrant() {                                                                                                                                                                                 │
│         isNotExpired(_expirationTimestamp);                                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         MathLib.TokenQtys memory tokenQtys =                                                                                                                                                                    │
│             MathLib.calculateAddLiquidityQuantities(                                                                                                                                                            │
│                 _baseTokenQtyDesired,                                                                                                                                                                           │
│                 _quoteTokenQtyDesired,                                                                                                                                                                          │
│                 _baseTokenQtyMin,                                                                                                                                                                               │
│                 _quoteTokenQtyMin,                                                                                                                                                                              │
│                 IERC20(baseToken).balanceOf(address(this)),                                                                                                                                                     │
│                 IERC20(quoteToken).balanceOf(address(this)),                                                                                                                                                    │
│                 this.totalSupply(),                                                                                                                                                                             │
│                 internalBalances                                                                                                                                                                                │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         internalBalances.kLast =                                                                                                                                                                                │
│             internalBalances.baseTokenReserveQty *                                                                                                                                                              │
│             internalBalances.quoteTokenReserveQty;                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         if (tokenQtys.liquidityTokenFeeQty > 0) {                                                                                                                                                               │
│             // mint liquidity tokens to fee address for k growth.                                                                                                                                               │
│             _mint(                                                                                                                                                                                              │
│                 IExchangeFactory(exchangeFactoryAddress).feeAddress(),                                                                                                                                          │
│                 tokenQtys.liquidityTokenFeeQty                                                                                                                                                                  │
│             );                                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│         _mint(_liquidityTokenRecipient, tokenQtys.liquidityTokenQty); // mint liquidity tokens to recipient                                                                                                     │
│                                                                                                                                                                                                                 │
│         if (tokenQtys.baseTokenQty != 0) {                                                                                                                                                                      │
│             bool isExchangeEmpty =                                                                                                                                                                              │
│                 IERC20(baseToken).balanceOf(address(this)) == 0;                                                                                                                                                │
│                                                                                                                                                                                                                 │
│             // transfer base tokens to Exchange                                                                                                                                                                 │
│             IERC20(baseToken).safeTransferFrom(                                                                                                                                                                 │
│                 msg.sender,                                                                                                                                                                                     │
│                 address(this),                                                                                                                                                                                  │
│                 tokenQtys.baseTokenQty                                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             if (isExchangeEmpty) {                                                                                                                                                                              │
│                 require(                                                                                                                                                                                        │
│                     IERC20(baseToken).balanceOf(address(this)) ==                                                                                                                                               │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                     "Exchange: FEE_ON_TRANSFER_NOT_SUPPORTED"                                                                                                                                                   │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         if (tokenQtys.quoteTokenQty != 0) {                                                                                                                                                                     │
│             // transfer quote tokens to Exchange                                                                                                                                                                │
│             IERC20(quoteToken).safeTransferFrom(                                                                                                                                                                │
│                 msg.sender,                                                                                                                                                                                     │
│                 address(this),                                                                                                                                                                                  │
│                 tokenQtys.quoteTokenQty                                                                                                                                                                         │
│             );                                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         emit AddLiquidity(                                                                                                                                                                                      │
│             msg.sender,                                                                                                                                                                                         │
│             tokenQtys.baseTokenQty,                                                                                                                                                                             │
│             tokenQtys.quoteTokenQty                                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes",                                                                                                                                                                                                 │
│     "2": "No",                                                                                                                                                                                                  │
│     "3": "No",                                                                                                                                                                                                  │
│     "4": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve calculating swap/liquidity or adding liquidity, and there is asset exchanges or price queries, but this operation could be attacked by slippage/Sandwich Attack due to no slip limit/minimum │
│ value check                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function addLiquidity(                                                                                                                                                                                      │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         address _liquidityTokenRecipient,                                                                                                                                                                       │
│         uint256 _expirationTimestamp                                                                                                                                                                            │
│     ) external nonReentrant() {                                                                                                                                                                                 │
│         isNotExpired(_expirationTimestamp);                                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         MathLib.TokenQtys memory tokenQtys =                                                                                                                                                                    │
│             MathLib.calculateAddLiquidityQuantities(                                                                                                                                                            │
│                 _baseTokenQtyDesired,                                                                                                                                                                           │
│                 _quoteTokenQtyDesired,                                                                                                                                                                          │
│                 _baseTokenQtyMin,                                                                                                                                                                               │
│                 _quoteTokenQtyMin,                                                                                                                                                                              │
│                 IERC20(baseToken).balanceOf(address(this)),                                                                                                                                                     │
│                 IERC20(quoteToken).balanceOf(address(this)),                                                                                                                                                    │
│                 this.totalSupply(),                                                                                                                                                                             │
│                 internalBalances                                                                                                                                                                                │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         internalBalances.kLast =                                                                                                                                                                                │
│             internalBalances.baseTokenReserveQty *                                                                                                                                                              │
│             internalBalances.quoteTokenReserveQty;                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         if (tokenQtys.liquidityTokenFeeQty > 0) {                                                                                                                                                               │
│             // mint liquidity tokens to fee address for k growth.                                                                                                                                               │
│             _mint(                                                                                                                                                                                              │
│                 IExchangeFactory(exchangeFactoryAddress).feeAddress(),                                                                                                                                          │
│                 tokenQtys.liquidityTokenFeeQty                                                                                                                                                                  │
│             );                                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│         _mint(_liquidityTokenRecipient, tokenQtys.liquidityTokenQty); // mint liquidity tokens to recipient                                                                                                     │
│                                                                                                                                                                                                                 │
│         if (tokenQtys.baseTokenQty != 0) {                                                                                                                                                                      │
│             bool isExchangeEmpty =                                                                                                                                                                              │
│                 IERC20(baseToken).balanceOf(address(this)) == 0;                                                                                                                                                │
│                                                                                                                                                                                                                 │
│             // transfer base tokens to Exchange                                                                                                                                                                 │
│             IERC20(baseToken).safeTransferFrom(                                                                                                                                                                 │
│                 msg.sender,                                                                                                                                                                                     │
│                 address(this),                                                                                                                                                                                  │
│                 tokenQtys.baseTokenQty                                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             if (isExchangeEmpty) {                                                                                                                                                                              │
│                 require(                                                                                                                                                                                        │
│                     IERC20(baseToken).balanceOf(address(this)) ==                                                                                                                                               │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                     "Exchange: FEE_ON_TRANSFER_NOT_SUPPORTED"                                                                                                                                                   │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         if (tokenQtys.quoteTokenQty != 0) {                                                                                                                                                                     │
│             // transfer quote tokens to Exchange                                                                                                                                                                │
│             IERC20(quoteToken).safeTransferFrom(                                                                                                                                                                │
│                 msg.sender,                                                                                                                                                                                     │
│                 address(this),                                                                                                                                                                                  │
│                 tokenQtys.quoteTokenQty                                                                                                                                                                         │
│             );                                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         emit AddLiquidity(                                                                                                                                                                                      │
│             msg.sender,                                                                                                                                                                                         │
│             tokenQtys.baseTokenQty,                                                                                                                                                                             │
│             tokenQtys.quoteTokenQty                                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function addLiquidity(                                                                                                                                                                                      │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         address _liquidityTokenRecipient,                                                                                                                                                                       │
│         uint256 _expirationTimestamp                                                                                                                                                                            │
│     ) external nonReentrant() {                                                                                                                                                                                 │
│         isNotExpired(_expirationTimestamp);                                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         MathLib.TokenQtys memory tokenQtys =                                                                                                                                                                    │
│             MathLib.calculateAddLiquidityQuantities(                                                                                                                                                            │
│                 _baseTokenQtyDesired,                                                                                                                                                                           │
│                 _quoteTokenQtyDesired,                                                                                                                                                                          │
│                 _baseTokenQtyMin,                                                                                                                                                                               │
│                 _quoteTokenQtyMin,                                                                                                                                                                              │
│                 IERC20(baseToken).balanceOf(address(this)),                                                                                                                                                     │
│                 IERC20(quoteToken).balanceOf(address(this)),                                                                                                                                                    │
│                 this.totalSupply(),                                                                                                                                                                             │
│                 internalBalances                                                                                                                                                                                │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         internalBalances.kLast =                                                                                                                                                                                │
│             internalBalances.baseTokenReserveQty *                                                                                                                                                              │
│             internalBalances.quoteTokenReserveQty;                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         if (tokenQtys.liquidityTokenFeeQty > 0) {                                                                                                                                                               │
│             // mint liquidity tokens to fee address for k growth.                                                                                                                                               │
│             _mint(                                                                                                                                                                                              │
│                 IExchangeFactory(exchangeFactoryAddress).feeAddress(),                                                                                                                                          │
│                 tokenQtys.liquidityTokenFeeQty                                                                                                                                                                  │
│             );                                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│         _mint(_liquidityTokenRecipient, tokenQtys.liquidityTokenQty); // mint liquidity tokens to recipient                                                                                                     │
│                                                                                                                                                                                                                 │
│         if (tokenQtys.baseTokenQty != 0) {                                                                                                                                                                      │
│             bool isExchangeEmpty =                                                                                                                                                                              │
│                 IERC20(baseToken).balanceOf(address(this)) == 0;                                                                                                                                                │
│                                                                                                                                                                                                                 │
│             // transfer base tokens to Exchange                                                                                                                                                                 │
│             IERC20(baseToken).safeTransferFrom(                                                                                                                                                                 │
│                 msg.sender,                                                                                                                                                                                     │
│                 address(this),                                                                                                                                                                                  │
│                 tokenQtys.baseTokenQty                                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             if (isExchangeEmpty) {                                                                                                                                                                              │
│                 require(                                                                                                                                                                                        │
│                     IERC20(baseToken).balanceOf(address(this)) ==                                                                                                                                               │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                     "Exchange: FEE_ON_TRANSFER_NOT_SUPPORTED"                                                                                                                                                   │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         if (tokenQtys.quoteTokenQty != 0) {                                                                                                                                                                     │
│             // transfer quote tokens to Exchange                                                                                                                                                                │
│             IERC20(quoteToken).safeTransferFrom(                                                                                                                                                                │
│                 msg.sender,                                                                                                                                                                                     │
│                 address(this),                                                                                                                                                                                  │
│                 tokenQtys.quoteTokenQty                                                                                                                                                                         │
│             );                                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         emit AddLiquidity(                                                                                                                                                                                      │
│             msg.sender,                                                                                                                                                                                         │
│             tokenQtys.baseTokenQty,                                                                                                                                                                             │
│             tokenQtys.quoteTokenQty                                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve calculating swap/liquidity or adding liquidity, and there is asset exchanges or price queries,                                                                                               │
│ have code statements that get or calculate LP token's value/price                                                                                                                                               │
│ have inside code statements that update/accrue interest/exchange rate,                                                                                                                                          │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function removeLiquidity(                                                                                                                                                                                   │
│         uint256 _liquidityTokenQty,                                                                                                                                                                             │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         address _tokenRecipient,                                                                                                                                                                                │
│         uint256 _expirationTimestamp                                                                                                                                                                            │
│     ) external nonReentrant() {                                                                                                                                                                                 │
│         isNotExpired(_expirationTimestamp);                                                                                                                                                                     │
│         require(this.totalSupply() > 0, "Exchange: INSUFFICIENT_LIQUIDITY");                                                                                                                                    │
│         require(                                                                                                                                                                                                │
│             _baseTokenQtyMin > 0 && _quoteTokenQtyMin > 0,                                                                                                                                                      │
│             "Exchange: MINS_MUST_BE_GREATER_THAN_ZERO"                                                                                                                                                          │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint256 baseTokenReserveQty =                                                                                                                                                                           │
│             IERC20(baseToken).balanceOf(address(this));                                                                                                                                                         │
│         uint256 quoteTokenReserveQty =                                                                                                                                                                          │
│             IERC20(quoteToken).balanceOf(address(this));                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         uint256 totalSupplyOfLiquidityTokens = this.totalSupply();                                                                                                                                              │
│         // calculate any DAO fees here.                                                                                                                                                                         │
│         uint256 liquidityTokenFeeQty =                                                                                                                                                                          │
│             MathLib.calculateLiquidityTokenFees(                                                                                                                                                                │
│                 totalSupplyOfLiquidityTokens,                                                                                                                                                                   │
│                 internalBalances                                                                                                                                                                                │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // we need to factor this quantity in to any total supply before redemption                                                                                                                             │
│         totalSupplyOfLiquidityTokens += liquidityTokenFeeQty;                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         uint256 baseTokenQtyToReturn =                                                                                                                                                                          │
│             (_liquidityTokenQty * baseTokenReserveQty) /                                                                                                                                                        │
│                 totalSupplyOfLiquidityTokens;                                                                                                                                                                   │
│         uint256 quoteTokenQtyToReturn =                                                                                                                                                                         │
│             (_liquidityTokenQty * quoteTokenReserveQty) /                                                                                                                                                       │
│                 totalSupplyOfLiquidityTokens;                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             baseTokenQtyToReturn >= _baseTokenQtyMin,                                                                                                                                                           │
│             "Exchange: INSUFFICIENT_BASE_QTY"                                                                                                                                                                   │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             quoteTokenQtyToReturn >= _quoteTokenQtyMin,                                                                                                                                                         │
│             "Exchange: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                                  │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // this ensure that we are removing the equivalent amount of decay                                                                                                                                      │
│         // when this person exits.                                                                                                                                                                              │
│         uint256 baseTokenQtyToRemoveFromInternalAccounting =                                                                                                                                                    │
│             (_liquidityTokenQty * internalBalances.baseTokenReserveQty) /                                                                                                                                       │
│                 totalSupplyOfLiquidityTokens;                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         internalBalances                                                                                                                                                                                        │
│             .baseTokenReserveQty -= baseTokenQtyToRemoveFromInternalAccounting;                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         // We should ensure no possible overflow here.                                                                                                                                                          │
│         if (quoteTokenQtyToReturn > internalBalances.quoteTokenReserveQty) {                                                                                                                                    │
│             internalBalances.quoteTokenReserveQty = 0;                                                                                                                                                          │
│         } else {                                                                                                                                                                                                │
│             internalBalances.quoteTokenReserveQty -= quoteTokenQtyToReturn;                                                                                                                                     │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         internalBalances.kLast =                                                                                                                                                                                │
│             internalBalances.baseTokenReserveQty *                                                                                                                                                              │
│             internalBalances.quoteTokenReserveQty;                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         if (liquidityTokenFeeQty > 0) {                                                                                                                                                                         │
│             _mint(                                                                                                                                                                                              │
│                 IExchangeFactory(exchangeFactoryAddress).feeAddress(),                                                                                                                                          │
│                 liquidityTokenFeeQty                                                                                                                                                                            │
│             );                                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         _burn(msg.sender, _liquidityTokenQty);                                                                                                                                                                  │
│         IERC20(baseToken).safeTransfer(_tokenRecipient, baseTokenQtyToReturn);                                                                                                                                  │
│         IERC20(quoteToken).safeTransfer(_tokenRecipient, quoteTokenQtyToReturn);                                                                                                                                │
│         emit RemoveLiquidity(                                                                                                                                                                                   │
│             msg.sender,                                                                                                                                                                                         │
│             baseTokenQtyToReturn,                                                                                                                                                                               │
│             quoteTokenQtyToReturn                                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes",                                                                                                                                                                                                 │
│     "2": "No",                                                                                                                                                                                                  │
│     "3": "No",                                                                                                                                                                                                  │
│     "4": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve calculating swap/liquidity or adding liquidity, and there is asset exchanges or price queries, but this operation could be attacked by slippage/Sandwich Attack due to no slip limit/minimum │
│ value check                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function removeLiquidity(                                                                                                                                                                                   │
│         uint256 _liquidityTokenQty,                                                                                                                                                                             │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         address _tokenRecipient,                                                                                                                                                                                │
│         uint256 _expirationTimestamp                                                                                                                                                                            │
│     ) external nonReentrant() {                                                                                                                                                                                 │
│         isNotExpired(_expirationTimestamp);                                                                                                                                                                     │
│         require(this.totalSupply() > 0, "Exchange: INSUFFICIENT_LIQUIDITY");                                                                                                                                    │
│         require(                                                                                                                                                                                                │
│             _baseTokenQtyMin > 0 && _quoteTokenQtyMin > 0,                                                                                                                                                      │
│             "Exchange: MINS_MUST_BE_GREATER_THAN_ZERO"                                                                                                                                                          │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint256 baseTokenReserveQty =                                                                                                                                                                           │
│             IERC20(baseToken).balanceOf(address(this));                                                                                                                                                         │
│         uint256 quoteTokenReserveQty =                                                                                                                                                                          │
│             IERC20(quoteToken).balanceOf(address(this));                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         uint256 totalSupplyOfLiquidityTokens = this.totalSupply();                                                                                                                                              │
│         // calculate any DAO fees here.                                                                                                                                                                         │
│         uint256 liquidityTokenFeeQty =                                                                                                                                                                          │
│             MathLib.calculateLiquidityTokenFees(                                                                                                                                                                │
│                 totalSupplyOfLiquidityTokens,                                                                                                                                                                   │
│                 internalBalances                                                                                                                                                                                │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // we need to factor this quantity in to any total supply before redemption                                                                                                                             │
│         totalSupplyOfLiquidityTokens += liquidityTokenFeeQty;                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         uint256 baseTokenQtyToReturn =                                                                                                                                                                          │
│             (_liquidityTokenQty * baseTokenReserveQty) /                                                                                                                                                        │
│                 totalSupplyOfLiquidityTokens;                                                                                                                                                                   │
│         uint256 quoteTokenQtyToReturn =                                                                                                                                                                         │
│             (_liquidityTokenQty * quoteTokenReserveQty) /                                                                                                                                                       │
│                 totalSupplyOfLiquidityTokens;                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             baseTokenQtyToReturn >= _baseTokenQtyMin,                                                                                                                                                           │
│             "Exchange: INSUFFICIENT_BASE_QTY"                                                                                                                                                                   │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             quoteTokenQtyToReturn >= _quoteTokenQtyMin,                                                                                                                                                         │
│             "Exchange: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                                  │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // this ensure that we are removing the equivalent amount of decay                                                                                                                                      │
│         // when this person exits.                                                                                                                                                                              │
│         uint256 baseTokenQtyToRemoveFromInternalAccounting =                                                                                                                                                    │
│             (_liquidityTokenQty * internalBalances.baseTokenReserveQty) /                                                                                                                                       │
│                 totalSupplyOfLiquidityTokens;                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         internalBalances                                                                                                                                                                                        │
│             .baseTokenReserveQty -= baseTokenQtyToRemoveFromInternalAccounting;                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         // We should ensure no possible overflow here.                                                                                                                                                          │
│         if (quoteTokenQtyToReturn > internalBalances.quoteTokenReserveQty) {                                                                                                                                    │
│             internalBalances.quoteTokenReserveQty = 0;                                                                                                                                                          │
│         } else {                                                                                                                                                                                                │
│             internalBalances.quoteTokenReserveQty -= quoteTokenQtyToReturn;                                                                                                                                     │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         internalBalances.kLast =                                                                                                                                                                                │
│             internalBalances.baseTokenReserveQty *                                                                                                                                                              │
│             internalBalances.quoteTokenReserveQty;                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         if (liquidityTokenFeeQty > 0) {                                                                                                                                                                         │
│             _mint(                                                                                                                                                                                              │
│                 IExchangeFactory(exchangeFactoryAddress).feeAddress(),                                                                                                                                          │
│                 liquidityTokenFeeQty                                                                                                                                                                            │
│             );                                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         _burn(msg.sender, _liquidityTokenQty);                                                                                                                                                                  │
│         IERC20(baseToken).safeTransfer(_tokenRecipient, baseTokenQtyToReturn);                                                                                                                                  │
│         IERC20(quoteToken).safeTransfer(_tokenRecipient, quoteTokenQtyToReturn);                                                                                                                                │
│         emit RemoveLiquidity(                                                                                                                                                                                   │
│             msg.sender,                                                                                                                                                                                         │
│             baseTokenQtyToReturn,                                                                                                                                                                               │
│             quoteTokenQtyToReturn                                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function removeLiquidity(                                                                                                                                                                                   │
│         uint256 _liquidityTokenQty,                                                                                                                                                                             │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         address _tokenRecipient,                                                                                                                                                                                │
│         uint256 _expirationTimestamp                                                                                                                                                                            │
│     ) external nonReentrant() {                                                                                                                                                                                 │
│         isNotExpired(_expirationTimestamp);                                                                                                                                                                     │
│         require(this.totalSupply() > 0, "Exchange: INSUFFICIENT_LIQUIDITY");                                                                                                                                    │
│         require(                                                                                                                                                                                                │
│             _baseTokenQtyMin > 0 && _quoteTokenQtyMin > 0,                                                                                                                                                      │
│             "Exchange: MINS_MUST_BE_GREATER_THAN_ZERO"                                                                                                                                                          │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint256 baseTokenReserveQty =                                                                                                                                                                           │
│             IERC20(baseToken).balanceOf(address(this));                                                                                                                                                         │
│         uint256 quoteTokenReserveQty =                                                                                                                                                                          │
│             IERC20(quoteToken).balanceOf(address(this));                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         uint256 totalSupplyOfLiquidityTokens = this.totalSupply();                                                                                                                                              │
│         // calculate any DAO fees here.                                                                                                                                                                         │
│         uint256 liquidityTokenFeeQty =                                                                                                                                                                          │
│             MathLib.calculateLiquidityTokenFees(                                                                                                                                                                │
│                 totalSupplyOfLiquidityTokens,                                                                                                                                                                   │
│                 internalBalances                                                                                                                                                                                │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // we need to factor this quantity in to any total supply before redemption                                                                                                                             │
│         totalSupplyOfLiquidityTokens += liquidityTokenFeeQty;                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         uint256 baseTokenQtyToReturn =                                                                                                                                                                          │
│             (_liquidityTokenQty * baseTokenReserveQty) /                                                                                                                                                        │
│                 totalSupplyOfLiquidityTokens;                                                                                                                                                                   │
│         uint256 quoteTokenQtyToReturn =                                                                                                                                                                         │
│             (_liquidityTokenQty * quoteTokenReserveQty) /                                                                                                                                                       │
│                 totalSupplyOfLiquidityTokens;                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             baseTokenQtyToReturn >= _baseTokenQtyMin,                                                                                                                                                           │
│             "Exchange: INSUFFICIENT_BASE_QTY"                                                                                                                                                                   │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             quoteTokenQtyToReturn >= _quoteTokenQtyMin,                                                                                                                                                         │
│             "Exchange: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                                  │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // this ensure that we are removing the equivalent amount of decay                                                                                                                                      │
│         // when this person exits.                                                                                                                                                                              │
│         uint256 baseTokenQtyToRemoveFromInternalAccounting =                                                                                                                                                    │
│             (_liquidityTokenQty * internalBalances.baseTokenReserveQty) /                                                                                                                                       │
│                 totalSupplyOfLiquidityTokens;                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         internalBalances                                                                                                                                                                                        │
│             .baseTokenReserveQty -= baseTokenQtyToRemoveFromInternalAccounting;                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         // We should ensure no possible overflow here.                                                                                                                                                          │
│         if (quoteTokenQtyToReturn > internalBalances.quoteTokenReserveQty) {                                                                                                                                    │
│             internalBalances.quoteTokenReserveQty = 0;                                                                                                                                                          │
│         } else {                                                                                                                                                                                                │
│             internalBalances.quoteTokenReserveQty -= quoteTokenQtyToReturn;                                                                                                                                     │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         internalBalances.kLast =                                                                                                                                                                                │
│             internalBalances.baseTokenReserveQty *                                                                                                                                                              │
│             internalBalances.quoteTokenReserveQty;                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         if (liquidityTokenFeeQty > 0) {                                                                                                                                                                         │
│             _mint(                                                                                                                                                                                              │
│                 IExchangeFactory(exchangeFactoryAddress).feeAddress(),                                                                                                                                          │
│                 liquidityTokenFeeQty                                                                                                                                                                            │
│             );                                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         _burn(msg.sender, _liquidityTokenQty);                                                                                                                                                                  │
│         IERC20(baseToken).safeTransfer(_tokenRecipient, baseTokenQtyToReturn);                                                                                                                                  │
│         IERC20(quoteToken).safeTransfer(_tokenRecipient, quoteTokenQtyToReturn);                                                                                                                                │
│         emit RemoveLiquidity(                                                                                                                                                                                   │
│             msg.sender,                                                                                                                                                                                         │
│             baseTokenQtyToReturn,                                                                                                                                                                               │
│             quoteTokenQtyToReturn                                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function swapBaseTokenForQuoteToken(                                                                                                                                                                        │
│         uint256 _baseTokenQty,                                                                                                                                                                                  │
│         uint256 _minQuoteTokenQty,                                                                                                                                                                              │
│         uint256 _expirationTimestamp                                                                                                                                                                            │
│     ) external nonReentrant() {                                                                                                                                                                                 │
│         isNotExpired(_expirationTimestamp);                                                                                                                                                                     │
│         require(                                                                                                                                                                                                │
│             _baseTokenQty > 0 && _minQuoteTokenQty > 0,                                                                                                                                                         │
│             "Exchange: INSUFFICIENT_TOKEN_QTY"                                                                                                                                                                  │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint256 quoteTokenQty =                                                                                                                                                                                 │
│             MathLib.calculateQuoteTokenQty(                                                                                                                                                                     │
│                 _baseTokenQty,                                                                                                                                                                                  │
│                 _minQuoteTokenQty,                                                                                                                                                                              │
│                 TOTAL_LIQUIDITY_FEE,                                                                                                                                                                            │
│                 internalBalances                                                                                                                                                                                │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         IERC20(baseToken).safeTransferFrom(                                                                                                                                                                     │
│             msg.sender,                                                                                                                                                                                         │
│             address(this),                                                                                                                                                                                      │
│             _baseTokenQty                                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         IERC20(quoteToken).safeTransfer(msg.sender, quoteTokenQty);                                                                                                                                             │
│         emit Swap(msg.sender, _baseTokenQty, 0, 0, quoteTokenQty);                                                                                                                                              │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function swapBaseTokenForQuoteToken(                                                                                                                                                                        │
│         uint256 _baseTokenQty,                                                                                                                                                                                  │
│         uint256 _minQuoteTokenQty,                                                                                                                                                                              │
│         uint256 _expirationTimestamp                                                                                                                                                                            │
│     ) external nonReentrant() {                                                                                                                                                                                 │
│         isNotExpired(_expirationTimestamp);                                                                                                                                                                     │
│         require(                                                                                                                                                                                                │
│             _baseTokenQty > 0 && _minQuoteTokenQty > 0,                                                                                                                                                         │
│             "Exchange: INSUFFICIENT_TOKEN_QTY"                                                                                                                                                                  │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint256 quoteTokenQty =                                                                                                                                                                                 │
│             MathLib.calculateQuoteTokenQty(                                                                                                                                                                     │
│                 _baseTokenQty,                                                                                                                                                                                  │
│                 _minQuoteTokenQty,                                                                                                                                                                              │
│                 TOTAL_LIQUIDITY_FEE,                                                                                                                                                                            │
│                 internalBalances                                                                                                                                                                                │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         IERC20(baseToken).safeTransferFrom(                                                                                                                                                                     │
│             msg.sender,                                                                                                                                                                                         │
│             address(this),                                                                                                                                                                                      │
│             _baseTokenQty                                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         IERC20(quoteToken).safeTransfer(msg.sender, quoteTokenQty);                                                                                                                                             │
│         emit Swap(msg.sender, _baseTokenQty, 0, 0, quoteTokenQty);                                                                                                                                              │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ have inside code statements that update/accrue interest/exchange rate,                                                                                                                                          │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function swapQuoteTokenForBaseToken(                                                                                                                                                                        │
│         uint256 _quoteTokenQty,                                                                                                                                                                                 │
│         uint256 _minBaseTokenQty,                                                                                                                                                                               │
│         uint256 _expirationTimestamp                                                                                                                                                                            │
│     ) external nonReentrant() {                                                                                                                                                                                 │
│         isNotExpired(_expirationTimestamp);                                                                                                                                                                     │
│         require(                                                                                                                                                                                                │
│             _quoteTokenQty > 0 && _minBaseTokenQty > 0,                                                                                                                                                         │
│             "Exchange: INSUFFICIENT_TOKEN_QTY"                                                                                                                                                                  │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint256 baseTokenQty =                                                                                                                                                                                  │
│             MathLib.calculateBaseTokenQty(                                                                                                                                                                      │
│                 _quoteTokenQty,                                                                                                                                                                                 │
│                 _minBaseTokenQty,                                                                                                                                                                               │
│                 IERC20(baseToken).balanceOf(address(this)),                                                                                                                                                     │
│                 TOTAL_LIQUIDITY_FEE,                                                                                                                                                                            │
│                 internalBalances                                                                                                                                                                                │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         IERC20(quoteToken).safeTransferFrom(                                                                                                                                                                    │
│             msg.sender,                                                                                                                                                                                         │
│             address(this),                                                                                                                                                                                      │
│             _quoteTokenQty                                                                                                                                                                                      │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         IERC20(baseToken).safeTransfer(msg.sender, baseTokenQty);                                                                                                                                               │
│         emit Swap(msg.sender, 0, _quoteTokenQty, baseTokenQty, 0);                                                                                                                                              │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "No",                                                                                                                                                                                                  │
│     "3": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function createNewExchange(                                                                                                                                                                                 │
│         string memory _name,                                                                                                                                                                                    │
│         string memory _symbol,                                                                                                                                                                                  │
│         address _baseToken,                                                                                                                                                                                     │
│         address _quoteToken                                                                                                                                                                                     │
│     ) external {                                                                                                                                                                                                │
│         require(_baseToken != _quoteToken, "ExchangeFactory: IDENTICAL_TOKENS");                                                                                                                                │
│         require(                                                                                                                                                                                                │
│             _baseToken != address(0) && _quoteToken != address(0),                                                                                                                                              │
│             "ExchangeFactory: INVALID_TOKEN_ADDRESS"                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             exchangeAddressByTokenAddress[_baseToken][_quoteToken] ==                                                                                                                                           │
│                 address(0),                                                                                                                                                                                     │
│             "ExchangeFactory: DUPLICATE_EXCHANGE"                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         Exchange exchange =                                                                                                                                                                                     │
│             new Exchange(                                                                                                                                                                                       │
│                 _name,                                                                                                                                                                                          │
│                 _symbol,                                                                                                                                                                                        │
│                 _baseToken,                                                                                                                                                                                     │
│                 _quoteToken,                                                                                                                                                                                    │
│                 address(this)                                                                                                                                                                                   │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         exchangeAddressByTokenAddress[_baseToken][_quoteToken] = address(                                                                                                                                       │
│             exchange                                                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│         isValidExchangeAddress = true;                                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         emit NewExchange(msg.sender, address(exchange));                                                                                                                                                        │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                                     │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         uint256 _tokenQtyAToAdd,                                                                                                                                                                                │
│         uint256 _internalTokenAReserveQty,                                                                                                                                                                      │
│         uint256 _tokenBDecayChange,                                                                                                                                                                             │
│         uint256 _tokenBDecay                                                                                                                                                                                    │
│     ) public pure returns (uint256 liquidityTokenQty) {                                                                                                                                                         │
│         // gamma = deltaY / Y' / 2 * (deltaX / alphaDecay')                                                                                                                                                     │
│         uint256 wGamma =                                                                                                                                                                                        │
│             wDiv(                                                                                                                                                                                               │
│                 (                                                                                                                                                                                               │
│                     wMul(                                                                                                                                                                                       │
│                         wDiv(_tokenQtyAToAdd, _internalTokenAReserveQty),                                                                                                                                       │
│                         _tokenBDecayChange * WAD                                                                                                                                                                │
│                     )                                                                                                                                                                                           │
│                 ),                                                                                                                                                                                              │
│                 _tokenBDecay                                                                                                                                                                                    │
│             ) /                                                                                                                                                                                                 │
│                 WAD /                                                                                                                                                                                           │
│                 2;                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         liquidityTokenQty =                                                                                                                                                                                     │
│             wDiv(                                                                                                                                                                                               │
│                 wMul(_totalSupplyOfLiquidityTokens * WAD, wGamma),                                                                                                                                              │
│                 WAD - wGamma                                                                                                                                                                                    │
│             ) /                                                                                                                                                                                                 │
│             WAD;                                                                                                                                                                                                │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddBaseTokenLiquidityQuantities(                                                                                                                                                          │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances memory _internalBalances                                                                                                                                                               │
│     ) public pure returns (uint256 baseTokenQty, uint256 liquidityTokenQty) {                                                                                                                                   │
│         uint256 maxBaseTokenQty =                                                                                                                                                                               │
│             _internalBalances.baseTokenReserveQty - _baseTokenReserveQty;                                                                                                                                       │
│         require(                                                                                                                                                                                                │
│             _baseTokenQtyMin < maxBaseTokenQty,                                                                                                                                                                 │
│             "MathLib: INSUFFICIENT_DECAY"                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (_baseTokenQtyDesired > maxBaseTokenQty) {                                                                                                                                                           │
│             baseTokenQty = maxBaseTokenQty;                                                                                                                                                                     │
│         } else {                                                                                                                                                                                                │
│             baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // determine the quote token qty decay change quoted on our current ratios                                                                                                                              │
│         uint256 wInternalQuoteToBaseTokenRatio =                                                                                                                                                                │
│             wDiv(                                                                                                                                                                                               │
│                 _internalBalances.quoteTokenReserveQty,                                                                                                                                                         │
│                 _internalBalances.baseTokenReserveQty                                                                                                                                                           │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // NOTE we need this function to use the same                                                                                                                                                           │
│         // rounding scheme as wDiv in order to avoid a case                                                                                                                                                     │
│         // in which a user is trying to resolve decay in which                                                                                                                                                  │
│         // quoteTokenQtyDecayChange ends up being 0 and we are stuck in                                                                                                                                         │
│         // a bad state.                                                                                                                                                                                         │
│         uint256 quoteTokenQtyDecayChange =                                                                                                                                                                      │
│             roundToNearest(                                                                                                                                                                                     │
│                 (baseTokenQty * wInternalQuoteToBaseTokenRatio),                                                                                                                                                │
│                 MathLib.WAD                                                                                                                                                                                     │
│             ) / WAD;                                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             quoteTokenQtyDecayChange > 0,                                                                                                                                                                       │
│             "MathLib: INSUFFICIENT_CHANGE_IN_DECAY"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // we can now calculate the total amount of quote token decay                                                                                                                                           │
│         uint256 quoteTokenDecay =                                                                                                                                                                               │
│             (maxBaseTokenQty * wInternalQuoteToBaseTokenRatio) / WAD;                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         // this may be redundant quoted on the above math, but will check to ensure the decay wasn't so small                                                                                                   │
│         // that it was <1 and rounded down to 0 saving the caller some gas                                                                                                                                      │
│         // also could fix a potential revert due to div by zero.                                                                                                                                                │
│         require(quoteTokenDecay > 0, "MathLib: NO_QUOTE_DECAY");                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // we are not changing anything about our internal accounting here. We are simply adding tokens                                                                                                         │
│         // to make our internal account "right"...or rather getting the external balances to match our internal                                                                                                 │
│         // quoteTokenReserveQty += quoteTokenQtyDecayChange;                                                                                                                                                    │
│         // baseTokenReserveQty += baseTokenQty;                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         // calculate the number of liquidity tokens to return to user using:                                                                                                                                    │
│         liquidityTokenQty = calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             baseTokenQty,                                                                                                                                                                                       │
│             _internalBalances.baseTokenReserveQty,                                                                                                                                                              │
│             quoteTokenQtyDecayChange,                                                                                                                                                                           │
│             quoteTokenDecay                                                                                                                                                                                     │
│         );                                                                                                                                                                                                      │
│         return (baseTokenQty, liquidityTokenQty);                                                                                                                                                               │
│     }                                                                                                                                                                                                           │
│     function calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                                     │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         uint256 _tokenQtyAToAdd,                                                                                                                                                                                │
│         uint256 _internalTokenAReserveQty,                                                                                                                                                                      │
│         uint256 _tokenBDecayChange,                                                                                                                                                                             │
│         uint256 _tokenBDecay                                                                                                                                                                                    │
│     ) public pure returns (uint256 liquidityTokenQty) {                                                                                                                                                         │
│         // gamma = deltaY / Y' / 2 * (deltaX / alphaDecay')                                                                                                                                                     │
│         uint256 wGamma =                                                                                                                                                                                        │
│             wDiv(                                                                                                                                                                                               │
│                 (                                                                                                                                                                                               │
│                     wMul(                                                                                                                                                                                       │
│                         wDiv(_tokenQtyAToAdd, _internalTokenAReserveQty),                                                                                                                                       │
│                         _tokenBDecayChange * WAD                                                                                                                                                                │
│                     )                                                                                                                                                                                           │
│                 ),                                                                                                                                                                                              │
│                 _tokenBDecay                                                                                                                                                                                    │
│             ) /                                                                                                                                                                                                 │
│                 WAD /                                                                                                                                                                                           │
│                 2;                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         liquidityTokenQty =                                                                                                                                                                                     │
│             wDiv(                                                                                                                                                                                               │
│                 wMul(_totalSupplyOfLiquidityTokens * WAD, wGamma),                                                                                                                                              │
│                 WAD - wGamma                                                                                                                                                                                    │
│             ) /                                                                                                                                                                                                 │
│             WAD;                                                                                                                                                                                                │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes",                                                                                                                                                                                                 │
│     "2": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price based on the market reserves/AMMprice/exchangeRate OR the custom token balanceOf/totalSupply/amount/liquidity calculation          │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddBaseTokenLiquidityQuantities(                                                                                                                                                          │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances memory _internalBalances                                                                                                                                                               │
│     ) public pure returns (uint256 baseTokenQty, uint256 liquidityTokenQty) {                                                                                                                                   │
│         uint256 maxBaseTokenQty =                                                                                                                                                                               │
│             _internalBalances.baseTokenReserveQty - _baseTokenReserveQty;                                                                                                                                       │
│         require(                                                                                                                                                                                                │
│             _baseTokenQtyMin < maxBaseTokenQty,                                                                                                                                                                 │
│             "MathLib: INSUFFICIENT_DECAY"                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (_baseTokenQtyDesired > maxBaseTokenQty) {                                                                                                                                                           │
│             baseTokenQty = maxBaseTokenQty;                                                                                                                                                                     │
│         } else {                                                                                                                                                                                                │
│             baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // determine the quote token qty decay change quoted on our current ratios                                                                                                                              │
│         uint256 wInternalQuoteToBaseTokenRatio =                                                                                                                                                                │
│             wDiv(                                                                                                                                                                                               │
│                 _internalBalances.quoteTokenReserveQty,                                                                                                                                                         │
│                 _internalBalances.baseTokenReserveQty                                                                                                                                                           │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // NOTE we need this function to use the same                                                                                                                                                           │
│         // rounding scheme as wDiv in order to avoid a case                                                                                                                                                     │
│         // in which a user is trying to resolve decay in which                                                                                                                                                  │
│         // quoteTokenQtyDecayChange ends up being 0 and we are stuck in                                                                                                                                         │
│         // a bad state.                                                                                                                                                                                         │
│         uint256 quoteTokenQtyDecayChange =                                                                                                                                                                      │
│             roundToNearest(                                                                                                                                                                                     │
│                 (baseTokenQty * wInternalQuoteToBaseTokenRatio),                                                                                                                                                │
│                 MathLib.WAD                                                                                                                                                                                     │
│             ) / WAD;                                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             quoteTokenQtyDecayChange > 0,                                                                                                                                                                       │
│             "MathLib: INSUFFICIENT_CHANGE_IN_DECAY"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // we can now calculate the total amount of quote token decay                                                                                                                                           │
│         uint256 quoteTokenDecay =                                                                                                                                                                               │
│             (maxBaseTokenQty * wInternalQuoteToBaseTokenRatio) / WAD;                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         // this may be redundant quoted on the above math, but will check to ensure the decay wasn't so small                                                                                                   │
│         // that it was <1 and rounded down to 0 saving the caller some gas                                                                                                                                      │
│         // also could fix a potential revert due to div by zero.                                                                                                                                                │
│         require(quoteTokenDecay > 0, "MathLib: NO_QUOTE_DECAY");                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // we are not changing anything about our internal accounting here. We are simply adding tokens                                                                                                         │
│         // to make our internal account "right"...or rather getting the external balances to match our internal                                                                                                 │
│         // quoteTokenReserveQty += quoteTokenQtyDecayChange;                                                                                                                                                    │
│         // baseTokenReserveQty += baseTokenQty;                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         // calculate the number of liquidity tokens to return to user using:                                                                                                                                    │
│         liquidityTokenQty = calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             baseTokenQty,                                                                                                                                                                                       │
│             _internalBalances.baseTokenReserveQty,                                                                                                                                                              │
│             quoteTokenQtyDecayChange,                                                                                                                                                                           │
│             quoteTokenDecay                                                                                                                                                                                     │
│         );                                                                                                                                                                                                      │
│         return (baseTokenQty, liquidityTokenQty);                                                                                                                                                               │
│     }                                                                                                                                                                                                           │
│     function calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                                     │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         uint256 _tokenQtyAToAdd,                                                                                                                                                                                │
│         uint256 _internalTokenAReserveQty,                                                                                                                                                                      │
│         uint256 _tokenBDecayChange,                                                                                                                                                                             │
│         uint256 _tokenBDecay                                                                                                                                                                                    │
│     ) public pure returns (uint256 liquidityTokenQty) {                                                                                                                                                         │
│         // gamma = deltaY / Y' / 2 * (deltaX / alphaDecay')                                                                                                                                                     │
│         uint256 wGamma =                                                                                                                                                                                        │
│             wDiv(                                                                                                                                                                                               │
│                 (                                                                                                                                                                                               │
│                     wMul(                                                                                                                                                                                       │
│                         wDiv(_tokenQtyAToAdd, _internalTokenAReserveQty),                                                                                                                                       │
│                         _tokenBDecayChange * WAD                                                                                                                                                                │
│                     )                                                                                                                                                                                           │
│                 ),                                                                                                                                                                                              │
│                 _tokenBDecay                                                                                                                                                                                    │
│             ) /                                                                                                                                                                                                 │
│                 WAD /                                                                                                                                                                                           │
│                 2;                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         liquidityTokenQty =                                                                                                                                                                                     │
│             wDiv(                                                                                                                                                                                               │
│                 wMul(_totalSupplyOfLiquidityTokens * WAD, wGamma),                                                                                                                                              │
│                 WAD - wGamma                                                                                                                                                                                    │
│             ) /                                                                                                                                                                                                 │
│             WAD;                                                                                                                                                                                                │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddBaseTokenLiquidityQuantities(                                                                                                                                                          │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances memory _internalBalances                                                                                                                                                               │
│     ) public pure returns (uint256 baseTokenQty, uint256 liquidityTokenQty) {                                                                                                                                   │
│         uint256 maxBaseTokenQty =                                                                                                                                                                               │
│             _internalBalances.baseTokenReserveQty - _baseTokenReserveQty;                                                                                                                                       │
│         require(                                                                                                                                                                                                │
│             _baseTokenQtyMin < maxBaseTokenQty,                                                                                                                                                                 │
│             "MathLib: INSUFFICIENT_DECAY"                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (_baseTokenQtyDesired > maxBaseTokenQty) {                                                                                                                                                           │
│             baseTokenQty = maxBaseTokenQty;                                                                                                                                                                     │
│         } else {                                                                                                                                                                                                │
│             baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // determine the quote token qty decay change quoted on our current ratios                                                                                                                              │
│         uint256 wInternalQuoteToBaseTokenRatio =                                                                                                                                                                │
│             wDiv(                                                                                                                                                                                               │
│                 _internalBalances.quoteTokenReserveQty,                                                                                                                                                         │
│                 _internalBalances.baseTokenReserveQty                                                                                                                                                           │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // NOTE we need this function to use the same                                                                                                                                                           │
│         // rounding scheme as wDiv in order to avoid a case                                                                                                                                                     │
│         // in which a user is trying to resolve decay in which                                                                                                                                                  │
│         // quoteTokenQtyDecayChange ends up being 0 and we are stuck in                                                                                                                                         │
│         // a bad state.                                                                                                                                                                                         │
│         uint256 quoteTokenQtyDecayChange =                                                                                                                                                                      │
│             roundToNearest(                                                                                                                                                                                     │
│                 (baseTokenQty * wInternalQuoteToBaseTokenRatio),                                                                                                                                                │
│                 MathLib.WAD                                                                                                                                                                                     │
│             ) / WAD;                                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             quoteTokenQtyDecayChange > 0,                                                                                                                                                                       │
│             "MathLib: INSUFFICIENT_CHANGE_IN_DECAY"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // we can now calculate the total amount of quote token decay                                                                                                                                           │
│         uint256 quoteTokenDecay =                                                                                                                                                                               │
│             (maxBaseTokenQty * wInternalQuoteToBaseTokenRatio) / WAD;                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         // this may be redundant quoted on the above math, but will check to ensure the decay wasn't so small                                                                                                   │
│         // that it was <1 and rounded down to 0 saving the caller some gas                                                                                                                                      │
│         // also could fix a potential revert due to div by zero.                                                                                                                                                │
│         require(quoteTokenDecay > 0, "MathLib: NO_QUOTE_DECAY");                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // we are not changing anything about our internal accounting here. We are simply adding tokens                                                                                                         │
│         // to make our internal account "right"...or rather getting the external balances to match our internal                                                                                                 │
│         // quoteTokenReserveQty += quoteTokenQtyDecayChange;                                                                                                                                                    │
│         // baseTokenReserveQty += baseTokenQty;                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         // calculate the number of liquidity tokens to return to user using:                                                                                                                                    │
│         liquidityTokenQty = calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             baseTokenQty,                                                                                                                                                                                       │
│             _internalBalances.baseTokenReserveQty,                                                                                                                                                              │
│             quoteTokenQtyDecayChange,                                                                                                                                                                           │
│             quoteTokenDecay                                                                                                                                                                                     │
│         );                                                                                                                                                                                                      │
│         return (baseTokenQty, liquidityTokenQty);                                                                                                                                                               │
│     }                                                                                                                                                                                                           │
│     function calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                                     │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         uint256 _tokenQtyAToAdd,                                                                                                                                                                                │
│         uint256 _internalTokenAReserveQty,                                                                                                                                                                      │
│         uint256 _tokenBDecayChange,                                                                                                                                                                             │
│         uint256 _tokenBDecay                                                                                                                                                                                    │
│     ) public pure returns (uint256 liquidityTokenQty) {                                                                                                                                                         │
│         // gamma = deltaY / Y' / 2 * (deltaX / alphaDecay')                                                                                                                                                     │
│         uint256 wGamma =                                                                                                                                                                                        │
│             wDiv(                                                                                                                                                                                               │
│                 (                                                                                                                                                                                               │
│                     wMul(                                                                                                                                                                                       │
│                         wDiv(_tokenQtyAToAdd, _internalTokenAReserveQty),                                                                                                                                       │
│                         _tokenBDecayChange * WAD                                                                                                                                                                │
│                     )                                                                                                                                                                                           │
│                 ),                                                                                                                                                                                              │
│                 _tokenBDecay                                                                                                                                                                                    │
│             ) /                                                                                                                                                                                                 │
│                 WAD /                                                                                                                                                                                           │
│                 2;                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         liquidityTokenQty =                                                                                                                                                                                     │
│             wDiv(                                                                                                                                                                                               │
│                 wMul(_totalSupplyOfLiquidityTokens * WAD, wGamma),                                                                                                                                              │
│                 WAD - wGamma                                                                                                                                                                                    │
│             ) /                                                                                                                                                                                                 │
│             WAD;                                                                                                                                                                                                │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                                         │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (uint256 quoteTokenQty, uint256 liquidityTokenQty) {                                                                                                                                       │
│         uint256 baseTokenDecay =                                                                                                                                                                                │
│             _baseTokenReserveQty - _internalBalances.baseTokenReserveQty;                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // determine max amount of quote token that can be added to offset the current decay                                                                                                                    │
│         uint256 wInternalBaseTokenToQuoteTokenRatio =                                                                                                                                                           │
│             wDiv(                                                                                                                                                                                               │
│                 _internalBalances.baseTokenReserveQty,                                                                                                                                                          │
│                 _internalBalances.quoteTokenReserveQty                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // alphaDecay / omega (A/B)                                                                                                                                                                             │
│         uint256 maxQuoteTokenQty =                                                                                                                                                                              │
│             wDiv(baseTokenDecay, wInternalBaseTokenToQuoteTokenRatio);                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             _quoteTokenQtyMin < maxQuoteTokenQty,                                                                                                                                                               │
│             "MathLib: INSUFFICIENT_DECAY"                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (_quoteTokenQtyDesired > maxQuoteTokenQty) {                                                                                                                                                         │
│             quoteTokenQty = maxQuoteTokenQty;                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 baseTokenQtyDecayChange =                                                                                                                                                                       │
│             roundToNearest(                                                                                                                                                                                     │
│                 (quoteTokenQty * wInternalBaseTokenToQuoteTokenRatio),                                                                                                                                          │
│                 WAD                                                                                                                                                                                             │
│             ) / WAD;                                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             baseTokenQtyDecayChange > 0,                                                                                                                                                                        │
│             "MathLib: INSUFFICIENT_CHANGE_IN_DECAY"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         //x += alphaDecayChange                                                                                                                                                                                 │
│         //y += deltaBeta                                                                                                                                                                                        │
│         _internalBalances.baseTokenReserveQty += baseTokenQtyDecayChange;                                                                                                                                       │
│         _internalBalances.quoteTokenReserveQty += quoteTokenQty;                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // calculate the number of liquidity tokens to return to user using                                                                                                                                     │
│         liquidityTokenQty = calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             quoteTokenQty,                                                                                                                                                                                      │
│             _internalBalances.quoteTokenReserveQty,                                                                                                                                                             │
│             baseTokenQtyDecayChange,                                                                                                                                                                            │
│             baseTokenDecay                                                                                                                                                                                      │
│         );                                                                                                                                                                                                      │
│         return (quoteTokenQty, liquidityTokenQty);                                                                                                                                                              │
│     }                                                                                                                                                                                                           │
│     function calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                                     │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         uint256 _tokenQtyAToAdd,                                                                                                                                                                                │
│         uint256 _internalTokenAReserveQty,                                                                                                                                                                      │
│         uint256 _tokenBDecayChange,                                                                                                                                                                             │
│         uint256 _tokenBDecay                                                                                                                                                                                    │
│     ) public pure returns (uint256 liquidityTokenQty) {                                                                                                                                                         │
│         // gamma = deltaY / Y' / 2 * (deltaX / alphaDecay')                                                                                                                                                     │
│         uint256 wGamma =                                                                                                                                                                                        │
│             wDiv(                                                                                                                                                                                               │
│                 (                                                                                                                                                                                               │
│                     wMul(                                                                                                                                                                                       │
│                         wDiv(_tokenQtyAToAdd, _internalTokenAReserveQty),                                                                                                                                       │
│                         _tokenBDecayChange * WAD                                                                                                                                                                │
│                     )                                                                                                                                                                                           │
│                 ),                                                                                                                                                                                              │
│                 _tokenBDecay                                                                                                                                                                                    │
│             ) /                                                                                                                                                                                                 │
│                 WAD /                                                                                                                                                                                           │
│                 2;                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         liquidityTokenQty =                                                                                                                                                                                     │
│             wDiv(                                                                                                                                                                                               │
│                 wMul(_totalSupplyOfLiquidityTokens * WAD, wGamma),                                                                                                                                              │
│                 WAD - wGamma                                                                                                                                                                                    │
│             ) /                                                                                                                                                                                                 │
│             WAD;                                                                                                                                                                                                │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes",                                                                                                                                                                                                 │
│     "2": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price based on the market reserves/AMMprice/exchangeRate OR the custom token balanceOf/totalSupply/amount/liquidity calculation          │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                                         │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (uint256 quoteTokenQty, uint256 liquidityTokenQty) {                                                                                                                                       │
│         uint256 baseTokenDecay =                                                                                                                                                                                │
│             _baseTokenReserveQty - _internalBalances.baseTokenReserveQty;                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // determine max amount of quote token that can be added to offset the current decay                                                                                                                    │
│         uint256 wInternalBaseTokenToQuoteTokenRatio =                                                                                                                                                           │
│             wDiv(                                                                                                                                                                                               │
│                 _internalBalances.baseTokenReserveQty,                                                                                                                                                          │
│                 _internalBalances.quoteTokenReserveQty                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // alphaDecay / omega (A/B)                                                                                                                                                                             │
│         uint256 maxQuoteTokenQty =                                                                                                                                                                              │
│             wDiv(baseTokenDecay, wInternalBaseTokenToQuoteTokenRatio);                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             _quoteTokenQtyMin < maxQuoteTokenQty,                                                                                                                                                               │
│             "MathLib: INSUFFICIENT_DECAY"                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (_quoteTokenQtyDesired > maxQuoteTokenQty) {                                                                                                                                                         │
│             quoteTokenQty = maxQuoteTokenQty;                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 baseTokenQtyDecayChange =                                                                                                                                                                       │
│             roundToNearest(                                                                                                                                                                                     │
│                 (quoteTokenQty * wInternalBaseTokenToQuoteTokenRatio),                                                                                                                                          │
│                 WAD                                                                                                                                                                                             │
│             ) / WAD;                                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             baseTokenQtyDecayChange > 0,                                                                                                                                                                        │
│             "MathLib: INSUFFICIENT_CHANGE_IN_DECAY"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         //x += alphaDecayChange                                                                                                                                                                                 │
│         //y += deltaBeta                                                                                                                                                                                        │
│         _internalBalances.baseTokenReserveQty += baseTokenQtyDecayChange;                                                                                                                                       │
│         _internalBalances.quoteTokenReserveQty += quoteTokenQty;                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // calculate the number of liquidity tokens to return to user using                                                                                                                                     │
│         liquidityTokenQty = calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             quoteTokenQty,                                                                                                                                                                                      │
│             _internalBalances.quoteTokenReserveQty,                                                                                                                                                             │
│             baseTokenQtyDecayChange,                                                                                                                                                                            │
│             baseTokenDecay                                                                                                                                                                                      │
│         );                                                                                                                                                                                                      │
│         return (quoteTokenQty, liquidityTokenQty);                                                                                                                                                              │
│     }                                                                                                                                                                                                           │
│     function calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                                     │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         uint256 _tokenQtyAToAdd,                                                                                                                                                                                │
│         uint256 _internalTokenAReserveQty,                                                                                                                                                                      │
│         uint256 _tokenBDecayChange,                                                                                                                                                                             │
│         uint256 _tokenBDecay                                                                                                                                                                                    │
│     ) public pure returns (uint256 liquidityTokenQty) {                                                                                                                                                         │
│         // gamma = deltaY / Y' / 2 * (deltaX / alphaDecay')                                                                                                                                                     │
│         uint256 wGamma =                                                                                                                                                                                        │
│             wDiv(                                                                                                                                                                                               │
│                 (                                                                                                                                                                                               │
│                     wMul(                                                                                                                                                                                       │
│                         wDiv(_tokenQtyAToAdd, _internalTokenAReserveQty),                                                                                                                                       │
│                         _tokenBDecayChange * WAD                                                                                                                                                                │
│                     )                                                                                                                                                                                           │
│                 ),                                                                                                                                                                                              │
│                 _tokenBDecay                                                                                                                                                                                    │
│             ) /                                                                                                                                                                                                 │
│                 WAD /                                                                                                                                                                                           │
│                 2;                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         liquidityTokenQty =                                                                                                                                                                                     │
│             wDiv(                                                                                                                                                                                               │
│                 wMul(_totalSupplyOfLiquidityTokens * WAD, wGamma),                                                                                                                                              │
│                 WAD - wGamma                                                                                                                                                                                    │
│             ) /                                                                                                                                                                                                 │
│             WAD;                                                                                                                                                                                                │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                                         │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (uint256 quoteTokenQty, uint256 liquidityTokenQty) {                                                                                                                                       │
│         uint256 baseTokenDecay =                                                                                                                                                                                │
│             _baseTokenReserveQty - _internalBalances.baseTokenReserveQty;                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // determine max amount of quote token that can be added to offset the current decay                                                                                                                    │
│         uint256 wInternalBaseTokenToQuoteTokenRatio =                                                                                                                                                           │
│             wDiv(                                                                                                                                                                                               │
│                 _internalBalances.baseTokenReserveQty,                                                                                                                                                          │
│                 _internalBalances.quoteTokenReserveQty                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // alphaDecay / omega (A/B)                                                                                                                                                                             │
│         uint256 maxQuoteTokenQty =                                                                                                                                                                              │
│             wDiv(baseTokenDecay, wInternalBaseTokenToQuoteTokenRatio);                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             _quoteTokenQtyMin < maxQuoteTokenQty,                                                                                                                                                               │
│             "MathLib: INSUFFICIENT_DECAY"                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (_quoteTokenQtyDesired > maxQuoteTokenQty) {                                                                                                                                                         │
│             quoteTokenQty = maxQuoteTokenQty;                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 baseTokenQtyDecayChange =                                                                                                                                                                       │
│             roundToNearest(                                                                                                                                                                                     │
│                 (quoteTokenQty * wInternalBaseTokenToQuoteTokenRatio),                                                                                                                                          │
│                 WAD                                                                                                                                                                                             │
│             ) / WAD;                                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             baseTokenQtyDecayChange > 0,                                                                                                                                                                        │
│             "MathLib: INSUFFICIENT_CHANGE_IN_DECAY"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         //x += alphaDecayChange                                                                                                                                                                                 │
│         //y += deltaBeta                                                                                                                                                                                        │
│         _internalBalances.baseTokenReserveQty += baseTokenQtyDecayChange;                                                                                                                                       │
│         _internalBalances.quoteTokenReserveQty += quoteTokenQty;                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // calculate the number of liquidity tokens to return to user using                                                                                                                                     │
│         liquidityTokenQty = calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             quoteTokenQty,                                                                                                                                                                                      │
│             _internalBalances.quoteTokenReserveQty,                                                                                                                                                             │
│             baseTokenQtyDecayChange,                                                                                                                                                                            │
│             baseTokenDecay                                                                                                                                                                                      │
│         );                                                                                                                                                                                                      │
│         return (quoteTokenQty, liquidityTokenQty);                                                                                                                                                              │
│     }                                                                                                                                                                                                           │
│     function calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                                     │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         uint256 _tokenQtyAToAdd,                                                                                                                                                                                │
│         uint256 _internalTokenAReserveQty,                                                                                                                                                                      │
│         uint256 _tokenBDecayChange,                                                                                                                                                                             │
│         uint256 _tokenBDecay                                                                                                                                                                                    │
│     ) public pure returns (uint256 liquidityTokenQty) {                                                                                                                                                         │
│         // gamma = deltaY / Y' / 2 * (deltaX / alphaDecay')                                                                                                                                                     │
│         uint256 wGamma =                                                                                                                                                                                        │
│             wDiv(                                                                                                                                                                                               │
│                 (                                                                                                                                                                                               │
│                     wMul(                                                                                                                                                                                       │
│                         wDiv(_tokenQtyAToAdd, _internalTokenAReserveQty),                                                                                                                                       │
│                         _tokenBDecayChange * WAD                                                                                                                                                                │
│                     )                                                                                                                                                                                           │
│                 ),                                                                                                                                                                                              │
│                 _tokenBDecay                                                                                                                                                                                    │
│             ) /                                                                                                                                                                                                 │
│                 WAD /                                                                                                                                                                                           │
│                 2;                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         liquidityTokenQty =                                                                                                                                                                                     │
│             wDiv(                                                                                                                                                                                               │
│                 wMul(_totalSupplyOfLiquidityTokens * WAD, wGamma),                                                                                                                                              │
│                 WAD - wGamma                                                                                                                                                                                    │
│             ) /                                                                                                                                                                                                 │
│             WAD;                                                                                                                                                                                                │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve calculating swap/liquidity or adding liquidity, and there is asset exchanges or price queries,                                                                                               │
│ have code statements that get or calculate LP token's value/price                                                                                                                                               │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                                         │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (uint256 quoteTokenQty, uint256 liquidityTokenQty) {                                                                                                                                       │
│         uint256 baseTokenDecay =                                                                                                                                                                                │
│             _baseTokenReserveQty - _internalBalances.baseTokenReserveQty;                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // determine max amount of quote token that can be added to offset the current decay                                                                                                                    │
│         uint256 wInternalBaseTokenToQuoteTokenRatio =                                                                                                                                                           │
│             wDiv(                                                                                                                                                                                               │
│                 _internalBalances.baseTokenReserveQty,                                                                                                                                                          │
│                 _internalBalances.quoteTokenReserveQty                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // alphaDecay / omega (A/B)                                                                                                                                                                             │
│         uint256 maxQuoteTokenQty =                                                                                                                                                                              │
│             wDiv(baseTokenDecay, wInternalBaseTokenToQuoteTokenRatio);                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             _quoteTokenQtyMin < maxQuoteTokenQty,                                                                                                                                                               │
│             "MathLib: INSUFFICIENT_DECAY"                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (_quoteTokenQtyDesired > maxQuoteTokenQty) {                                                                                                                                                         │
│             quoteTokenQty = maxQuoteTokenQty;                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 baseTokenQtyDecayChange =                                                                                                                                                                       │
│             roundToNearest(                                                                                                                                                                                     │
│                 (quoteTokenQty * wInternalBaseTokenToQuoteTokenRatio),                                                                                                                                          │
│                 WAD                                                                                                                                                                                             │
│             ) / WAD;                                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             baseTokenQtyDecayChange > 0,                                                                                                                                                                        │
│             "MathLib: INSUFFICIENT_CHANGE_IN_DECAY"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         //x += alphaDecayChange                                                                                                                                                                                 │
│         //y += deltaBeta                                                                                                                                                                                        │
│         _internalBalances.baseTokenReserveQty += baseTokenQtyDecayChange;                                                                                                                                       │
│         _internalBalances.quoteTokenReserveQty += quoteTokenQty;                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // calculate the number of liquidity tokens to return to user using                                                                                                                                     │
│         liquidityTokenQty = calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             quoteTokenQty,                                                                                                                                                                                      │
│             _internalBalances.quoteTokenReserveQty,                                                                                                                                                             │
│             baseTokenQtyDecayChange,                                                                                                                                                                            │
│             baseTokenDecay                                                                                                                                                                                      │
│         );                                                                                                                                                                                                      │
│         return (quoteTokenQty, liquidityTokenQty);                                                                                                                                                              │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes",                                                                                                                                                                                                 │
│     "2": "No",                                                                                                                                                                                                  │
│     "3": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve calculating swap/liquidity or adding liquidity, and there is asset exchanges or price queries, but this operation could be attacked by slippage/Sandwich Attack due to no slip limit/minimum │
│ value check                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                                         │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (uint256 quoteTokenQty, uint256 liquidityTokenQty) {                                                                                                                                       │
│         uint256 baseTokenDecay =                                                                                                                                                                                │
│             _baseTokenReserveQty - _internalBalances.baseTokenReserveQty;                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // determine max amount of quote token that can be added to offset the current decay                                                                                                                    │
│         uint256 wInternalBaseTokenToQuoteTokenRatio =                                                                                                                                                           │
│             wDiv(                                                                                                                                                                                               │
│                 _internalBalances.baseTokenReserveQty,                                                                                                                                                          │
│                 _internalBalances.quoteTokenReserveQty                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // alphaDecay / omega (A/B)                                                                                                                                                                             │
│         uint256 maxQuoteTokenQty =                                                                                                                                                                              │
│             wDiv(baseTokenDecay, wInternalBaseTokenToQuoteTokenRatio);                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             _quoteTokenQtyMin < maxQuoteTokenQty,                                                                                                                                                               │
│             "MathLib: INSUFFICIENT_DECAY"                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (_quoteTokenQtyDesired > maxQuoteTokenQty) {                                                                                                                                                         │
│             quoteTokenQty = maxQuoteTokenQty;                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 baseTokenQtyDecayChange =                                                                                                                                                                       │
│             roundToNearest(                                                                                                                                                                                     │
│                 (quoteTokenQty * wInternalBaseTokenToQuoteTokenRatio),                                                                                                                                          │
│                 WAD                                                                                                                                                                                             │
│             ) / WAD;                                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             baseTokenQtyDecayChange > 0,                                                                                                                                                                        │
│             "MathLib: INSUFFICIENT_CHANGE_IN_DECAY"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         //x += alphaDecayChange                                                                                                                                                                                 │
│         //y += deltaBeta                                                                                                                                                                                        │
│         _internalBalances.baseTokenReserveQty += baseTokenQtyDecayChange;                                                                                                                                       │
│         _internalBalances.quoteTokenReserveQty += quoteTokenQty;                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // calculate the number of liquidity tokens to return to user using                                                                                                                                     │
│         liquidityTokenQty = calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             quoteTokenQty,                                                                                                                                                                                      │
│             _internalBalances.quoteTokenReserveQty,                                                                                                                                                             │
│             baseTokenQtyDecayChange,                                                                                                                                                                            │
│             baseTokenDecay                                                                                                                                                                                      │
│         );                                                                                                                                                                                                      │
│         return (quoteTokenQty, liquidityTokenQty);                                                                                                                                                              │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                                         │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (uint256 quoteTokenQty, uint256 liquidityTokenQty) {                                                                                                                                       │
│         uint256 baseTokenDecay =                                                                                                                                                                                │
│             _baseTokenReserveQty - _internalBalances.baseTokenReserveQty;                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // determine max amount of quote token that can be added to offset the current decay                                                                                                                    │
│         uint256 wInternalBaseTokenToQuoteTokenRatio =                                                                                                                                                           │
│             wDiv(                                                                                                                                                                                               │
│                 _internalBalances.baseTokenReserveQty,                                                                                                                                                          │
│                 _internalBalances.quoteTokenReserveQty                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // alphaDecay / omega (A/B)                                                                                                                                                                             │
│         uint256 maxQuoteTokenQty =                                                                                                                                                                              │
│             wDiv(baseTokenDecay, wInternalBaseTokenToQuoteTokenRatio);                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             _quoteTokenQtyMin < maxQuoteTokenQty,                                                                                                                                                               │
│             "MathLib: INSUFFICIENT_DECAY"                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (_quoteTokenQtyDesired > maxQuoteTokenQty) {                                                                                                                                                         │
│             quoteTokenQty = maxQuoteTokenQty;                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 baseTokenQtyDecayChange =                                                                                                                                                                       │
│             roundToNearest(                                                                                                                                                                                     │
│                 (quoteTokenQty * wInternalBaseTokenToQuoteTokenRatio),                                                                                                                                          │
│                 WAD                                                                                                                                                                                             │
│             ) / WAD;                                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             baseTokenQtyDecayChange > 0,                                                                                                                                                                        │
│             "MathLib: INSUFFICIENT_CHANGE_IN_DECAY"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         //x += alphaDecayChange                                                                                                                                                                                 │
│         //y += deltaBeta                                                                                                                                                                                        │
│         _internalBalances.baseTokenReserveQty += baseTokenQtyDecayChange;                                                                                                                                       │
│         _internalBalances.quoteTokenReserveQty += quoteTokenQty;                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // calculate the number of liquidity tokens to return to user using                                                                                                                                     │
│         liquidityTokenQty = calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             quoteTokenQty,                                                                                                                                                                                      │
│             _internalBalances.quoteTokenReserveQty,                                                                                                                                                             │
│             baseTokenQtyDecayChange,                                                                                                                                                                            │
│             baseTokenDecay                                                                                                                                                                                      │
│         );                                                                                                                                                                                                      │
│         return (quoteTokenQty, liquidityTokenQty);                                                                                                                                                              │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve calculating swap/liquidity or adding liquidity, and there is asset exchanges or price queries,                                                                                               │
│ have code statements that get or calculate LP token's value/price                                                                                                                                               │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddLiquidityQuantities(                                                                                                                                                                   │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (TokenQtys memory tokenQtys) {                                                                                                                                                             │
│         if (_totalSupplyOfLiquidityTokens > 0) {                                                                                                                                                                │
│             // we have outstanding liquidity tokens present and an existing price curve                                                                                                                         │
│                                                                                                                                                                                                                 │
│             tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                       │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // we need to take this amount (that will be minted) into account for below calculations                                                                                                            │
│             _totalSupplyOfLiquidityTokens += tokenQtys.liquidityTokenFeeQty;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│             // confirm that we have no beta or alpha decay present                                                                                                                                              │
│             // if we do, we need to resolve that first                                                                                                                                                          │
│             if (                                                                                                                                                                                                │
│                 isSufficientDecayPresent(                                                                                                                                                                       │
│                     _baseTokenReserveQty,                                                                                                                                                                       │
│                     _internalBalances                                                                                                                                                                           │
│                 )                                                                                                                                                                                               │
│             ) {                                                                                                                                                                                                 │
│                 // decay is present and needs to be dealt with by the caller.                                                                                                                                   │
│                                                                                                                                                                                                                 │
│                 uint256 baseTokenQtyFromDecay;                                                                                                                                                                  │
│                 uint256 quoteTokenQtyFromDecay;                                                                                                                                                                 │
│                 uint256 liquidityTokenQtyFromDecay;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     _baseTokenReserveQty > _internalBalances.baseTokenReserveQty                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // we have more base token than expected (base token decay) due to rebase up                                                                                                                │
│                     // we first need to handle this situation by requiring this user                                                                                                                            │
│                     // to add quote tokens                                                                                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         quoteTokenQtyFromDecay,                                                                                                                                                                 │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                              │
│                         _quoteTokenQtyDesired,                                                                                                                                                                  │
│                         0, // there is no minimum for this particular call since we may use quote tokens later.                                                                                                 │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // we have less base token than expected (quote token decay) due to a rebase down                                                                                                           │
│                     // we first need to handle this by adding base tokens to offset this.                                                                                                                       │
│                     (                                                                                                                                                                                           │
│                         baseTokenQtyFromDecay,                                                                                                                                                                  │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddBaseTokenLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired,                                                                                                                                                                   │
│                         0, // there is no minimum for this particular call since we may use base tokens later.                                                                                                  │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     quoteTokenQtyFromDecay < _quoteTokenQtyDesired &&                                                                                                                                           │
│                     baseTokenQtyFromDecay < _baseTokenQtyDesired                                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // the user still has qty that they desire to contribute to the exchange for liquidity                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                         tokenQtys.quoteTokenQty,                                                                                                                                                                │
│                         tokenQtys.liquidityTokenQty                                                                                                                                                             │
│                     ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired - baseTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                                 │
│                         _quoteTokenQtyDesired - quoteTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                               │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         _quoteTokenReserveQty + quoteTokenQtyFromDecay,                                                                                                                                         │
│                         _totalSupplyOfLiquidityTokens +                                                                                                                                                         │
│                             liquidityTokenQtyFromDecay,                                                                                                                                                         │
│                         _internalBalances // NOTE: these balances have already been updated when we did the decay math.                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 tokenQtys.baseTokenQty += baseTokenQtyFromDecay;                                                                                                                                                │
│                 tokenQtys.quoteTokenQty += quoteTokenQtyFromDecay;                                                                                                                                              │
│                 tokenQtys.liquidityTokenQty += liquidityTokenQtyFromDecay;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.baseTokenQty >= _baseTokenQtyMin,                                                                                                                                                 │
│                     "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                            │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.quoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                               │
│                     "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 // the user is just doing a simple double asset entry / providing both base and quote.                                                                                                          │
│                 (                                                                                                                                                                                               │
│                     tokenQtys.baseTokenQty,                                                                                                                                                                     │
│                     tokenQtys.quoteTokenQty,                                                                                                                                                                    │
│                     tokenQtys.liquidityTokenQty                                                                                                                                                                 │
│                 ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                                   │
│                     _baseTokenQtyDesired,                                                                                                                                                                       │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _baseTokenQtyMin,                                                                                                                                                                           │
│                     _quoteTokenQtyMin,                                                                                                                                                                          │
│                     _quoteTokenReserveQty,                                                                                                                                                                      │
│                     _totalSupplyOfLiquidityTokens,                                                                                                                                                              │
│                     _internalBalances                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // this user will set the initial pricing curve                                                                                                                                                     │
│             require(                                                                                                                                                                                            │
│                 _baseTokenQtyDesired > 0,                                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY_DESIRED"                                                                                                                                                        │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 _quoteTokenQtyDesired > 0,                                                                                                                                                                      │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY_DESIRED"                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             tokenQtys.baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                      │
│             tokenQtys.quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                    │
│             tokenQtys.liquidityTokenQty = sqrt(                                                                                                                                                                 │
│                 _baseTokenQtyDesired * _quoteTokenQtyDesired                                                                                                                                                    │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _internalBalances.baseTokenReserveQty += tokenQtys.baseTokenQty;                                                                                                                                    │
│             _internalBalances.quoteTokenReserveQty += tokenQtys.quoteTokenQty;                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                                         │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (uint256 quoteTokenQty, uint256 liquidityTokenQty) {                                                                                                                                       │
│         uint256 baseTokenDecay =                                                                                                                                                                                │
│             _baseTokenReserveQty - _internalBalances.baseTokenReserveQty;                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // determine max amount of quote token that can be added to offset the current decay                                                                                                                    │
│         uint256 wInternalBaseTokenToQuoteTokenRatio =                                                                                                                                                           │
│             wDiv(                                                                                                                                                                                               │
│                 _internalBalances.baseTokenReserveQty,                                                                                                                                                          │
│                 _internalBalances.quoteTokenReserveQty                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // alphaDecay / omega (A/B)                                                                                                                                                                             │
│         uint256 maxQuoteTokenQty =                                                                                                                                                                              │
│             wDiv(baseTokenDecay, wInternalBaseTokenToQuoteTokenRatio);                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             _quoteTokenQtyMin < maxQuoteTokenQty,                                                                                                                                                               │
│             "MathLib: INSUFFICIENT_DECAY"                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (_quoteTokenQtyDesired > maxQuoteTokenQty) {                                                                                                                                                         │
│             quoteTokenQty = maxQuoteTokenQty;                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 baseTokenQtyDecayChange =                                                                                                                                                                       │
│             roundToNearest(                                                                                                                                                                                     │
│                 (quoteTokenQty * wInternalBaseTokenToQuoteTokenRatio),                                                                                                                                          │
│                 WAD                                                                                                                                                                                             │
│             ) / WAD;                                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             baseTokenQtyDecayChange > 0,                                                                                                                                                                        │
│             "MathLib: INSUFFICIENT_CHANGE_IN_DECAY"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         //x += alphaDecayChange                                                                                                                                                                                 │
│         //y += deltaBeta                                                                                                                                                                                        │
│         _internalBalances.baseTokenReserveQty += baseTokenQtyDecayChange;                                                                                                                                       │
│         _internalBalances.quoteTokenReserveQty += quoteTokenQty;                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // calculate the number of liquidity tokens to return to user using                                                                                                                                     │
│         liquidityTokenQty = calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             quoteTokenQty,                                                                                                                                                                                      │
│             _internalBalances.quoteTokenReserveQty,                                                                                                                                                             │
│             baseTokenQtyDecayChange,                                                                                                                                                                            │
│             baseTokenDecay                                                                                                                                                                                      │
│         );                                                                                                                                                                                                      │
│         return (quoteTokenQty, liquidityTokenQty);                                                                                                                                                              │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│         "1": "Yes",                                                                                                                                                                                             │
│         "2": "No",                                                                                                                                                                                              │
│         "3": "Yes"                                                                                                                                                                                              │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve calculating swap/liquidity or adding liquidity, and there is asset exchanges or price queries, but this operation could be attacked by slippage/Sandwich Attack due to no slip limit/minimum │
│ value check                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddLiquidityQuantities(                                                                                                                                                                   │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (TokenQtys memory tokenQtys) {                                                                                                                                                             │
│         if (_totalSupplyOfLiquidityTokens > 0) {                                                                                                                                                                │
│             // we have outstanding liquidity tokens present and an existing price curve                                                                                                                         │
│                                                                                                                                                                                                                 │
│             tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                       │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // we need to take this amount (that will be minted) into account for below calculations                                                                                                            │
│             _totalSupplyOfLiquidityTokens += tokenQtys.liquidityTokenFeeQty;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│             // confirm that we have no beta or alpha decay present                                                                                                                                              │
│             // if we do, we need to resolve that first                                                                                                                                                          │
│             if (                                                                                                                                                                                                │
│                 isSufficientDecayPresent(                                                                                                                                                                       │
│                     _baseTokenReserveQty,                                                                                                                                                                       │
│                     _internalBalances                                                                                                                                                                           │
│                 )                                                                                                                                                                                               │
│             ) {                                                                                                                                                                                                 │
│                 // decay is present and needs to be dealt with by the caller.                                                                                                                                   │
│                                                                                                                                                                                                                 │
│                 uint256 baseTokenQtyFromDecay;                                                                                                                                                                  │
│                 uint256 quoteTokenQtyFromDecay;                                                                                                                                                                 │
│                 uint256 liquidityTokenQtyFromDecay;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     _baseTokenReserveQty > _internalBalances.baseTokenReserveQty                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // we have more base token than expected (base token decay) due to rebase up                                                                                                                │
│                     // we first need to handle this situation by requiring this user                                                                                                                            │
│                     // to add quote tokens                                                                                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         quoteTokenQtyFromDecay,                                                                                                                                                                 │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                              │
│                         _quoteTokenQtyDesired,                                                                                                                                                                  │
│                         0, // there is no minimum for this particular call since we may use quote tokens later.                                                                                                 │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // we have less base token than expected (quote token decay) due to a rebase down                                                                                                           │
│                     // we first need to handle this by adding base tokens to offset this.                                                                                                                       │
│                     (                                                                                                                                                                                           │
│                         baseTokenQtyFromDecay,                                                                                                                                                                  │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddBaseTokenLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired,                                                                                                                                                                   │
│                         0, // there is no minimum for this particular call since we may use base tokens later.                                                                                                  │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     quoteTokenQtyFromDecay < _quoteTokenQtyDesired &&                                                                                                                                           │
│                     baseTokenQtyFromDecay < _baseTokenQtyDesired                                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // the user still has qty that they desire to contribute to the exchange for liquidity                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                         tokenQtys.quoteTokenQty,                                                                                                                                                                │
│                         tokenQtys.liquidityTokenQty                                                                                                                                                             │
│                     ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired - baseTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                                 │
│                         _quoteTokenQtyDesired - quoteTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                               │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         _quoteTokenReserveQty + quoteTokenQtyFromDecay,                                                                                                                                         │
│                         _totalSupplyOfLiquidityTokens +                                                                                                                                                         │
│                             liquidityTokenQtyFromDecay,                                                                                                                                                         │
│                         _internalBalances // NOTE: these balances have already been updated when we did the decay math.                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 tokenQtys.baseTokenQty += baseTokenQtyFromDecay;                                                                                                                                                │
│                 tokenQtys.quoteTokenQty += quoteTokenQtyFromDecay;                                                                                                                                              │
│                 tokenQtys.liquidityTokenQty += liquidityTokenQtyFromDecay;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.baseTokenQty >= _baseTokenQtyMin,                                                                                                                                                 │
│                     "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                            │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.quoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                               │
│                     "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 // the user is just doing a simple double asset entry / providing both base and quote.                                                                                                          │
│                 (                                                                                                                                                                                               │
│                     tokenQtys.baseTokenQty,                                                                                                                                                                     │
│                     tokenQtys.quoteTokenQty,                                                                                                                                                                    │
│                     tokenQtys.liquidityTokenQty                                                                                                                                                                 │
│                 ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                                   │
│                     _baseTokenQtyDesired,                                                                                                                                                                       │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _baseTokenQtyMin,                                                                                                                                                                           │
│                     _quoteTokenQtyMin,                                                                                                                                                                          │
│                     _quoteTokenReserveQty,                                                                                                                                                                      │
│                     _totalSupplyOfLiquidityTokens,                                                                                                                                                              │
│                     _internalBalances                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // this user will set the initial pricing curve                                                                                                                                                     │
│             require(                                                                                                                                                                                            │
│                 _baseTokenQtyDesired > 0,                                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY_DESIRED"                                                                                                                                                        │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 _quoteTokenQtyDesired > 0,                                                                                                                                                                      │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY_DESIRED"                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             tokenQtys.baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                      │
│             tokenQtys.quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                    │
│             tokenQtys.liquidityTokenQty = sqrt(                                                                                                                                                                 │
│                 _baseTokenQtyDesired * _quoteTokenQtyDesired                                                                                                                                                    │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _internalBalances.baseTokenReserveQty += tokenQtys.baseTokenQty;                                                                                                                                    │
│             _internalBalances.quoteTokenReserveQty += tokenQtys.quoteTokenQty;                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                                         │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (uint256 quoteTokenQty, uint256 liquidityTokenQty) {                                                                                                                                       │
│         uint256 baseTokenDecay =                                                                                                                                                                                │
│             _baseTokenReserveQty - _internalBalances.baseTokenReserveQty;                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // determine max amount of quote token that can be added to offset the current decay                                                                                                                    │
│         uint256 wInternalBaseTokenToQuoteTokenRatio =                                                                                                                                                           │
│             wDiv(                                                                                                                                                                                               │
│                 _internalBalances.baseTokenReserveQty,                                                                                                                                                          │
│                 _internalBalances.quoteTokenReserveQty                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // alphaDecay / omega (A/B)                                                                                                                                                                             │
│         uint256 maxQuoteTokenQty =                                                                                                                                                                              │
│             wDiv(baseTokenDecay, wInternalBaseTokenToQuoteTokenRatio);                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             _quoteTokenQtyMin < maxQuoteTokenQty,                                                                                                                                                               │
│             "MathLib: INSUFFICIENT_DECAY"                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (_quoteTokenQtyDesired > maxQuoteTokenQty) {                                                                                                                                                         │
│             quoteTokenQty = maxQuoteTokenQty;                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 baseTokenQtyDecayChange =                                                                                                                                                                       │
│             roundToNearest(                                                                                                                                                                                     │
│                 (quoteTokenQty * wInternalBaseTokenToQuoteTokenRatio),                                                                                                                                          │
│                 WAD                                                                                                                                                                                             │
│             ) / WAD;                                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             baseTokenQtyDecayChange > 0,                                                                                                                                                                        │
│             "MathLib: INSUFFICIENT_CHANGE_IN_DECAY"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         //x += alphaDecayChange                                                                                                                                                                                 │
│         //y += deltaBeta                                                                                                                                                                                        │
│         _internalBalances.baseTokenReserveQty += baseTokenQtyDecayChange;                                                                                                                                       │
│         _internalBalances.quoteTokenReserveQty += quoteTokenQty;                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // calculate the number of liquidity tokens to return to user using                                                                                                                                     │
│         liquidityTokenQty = calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             quoteTokenQty,                                                                                                                                                                                      │
│             _internalBalances.quoteTokenReserveQty,                                                                                                                                                             │
│             baseTokenQtyDecayChange,                                                                                                                                                                            │
│             baseTokenDecay                                                                                                                                                                                      │
│         );                                                                                                                                                                                                      │
│         return (quoteTokenQty, liquidityTokenQty);                                                                                                                                                              │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddLiquidityQuantities(                                                                                                                                                                   │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (TokenQtys memory tokenQtys) {                                                                                                                                                             │
│         if (_totalSupplyOfLiquidityTokens > 0) {                                                                                                                                                                │
│             // we have outstanding liquidity tokens present and an existing price curve                                                                                                                         │
│                                                                                                                                                                                                                 │
│             tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                       │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // we need to take this amount (that will be minted) into account for below calculations                                                                                                            │
│             _totalSupplyOfLiquidityTokens += tokenQtys.liquidityTokenFeeQty;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│             // confirm that we have no beta or alpha decay present                                                                                                                                              │
│             // if we do, we need to resolve that first                                                                                                                                                          │
│             if (                                                                                                                                                                                                │
│                 isSufficientDecayPresent(                                                                                                                                                                       │
│                     _baseTokenReserveQty,                                                                                                                                                                       │
│                     _internalBalances                                                                                                                                                                           │
│                 )                                                                                                                                                                                               │
│             ) {                                                                                                                                                                                                 │
│                 // decay is present and needs to be dealt with by the caller.                                                                                                                                   │
│                                                                                                                                                                                                                 │
│                 uint256 baseTokenQtyFromDecay;                                                                                                                                                                  │
│                 uint256 quoteTokenQtyFromDecay;                                                                                                                                                                 │
│                 uint256 liquidityTokenQtyFromDecay;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     _baseTokenReserveQty > _internalBalances.baseTokenReserveQty                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // we have more base token than expected (base token decay) due to rebase up                                                                                                                │
│                     // we first need to handle this situation by requiring this user                                                                                                                            │
│                     // to add quote tokens                                                                                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         quoteTokenQtyFromDecay,                                                                                                                                                                 │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                              │
│                         _quoteTokenQtyDesired,                                                                                                                                                                  │
│                         0, // there is no minimum for this particular call since we may use quote tokens later.                                                                                                 │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // we have less base token than expected (quote token decay) due to a rebase down                                                                                                           │
│                     // we first need to handle this by adding base tokens to offset this.                                                                                                                       │
│                     (                                                                                                                                                                                           │
│                         baseTokenQtyFromDecay,                                                                                                                                                                  │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddBaseTokenLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired,                                                                                                                                                                   │
│                         0, // there is no minimum for this particular call since we may use base tokens later.                                                                                                  │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     quoteTokenQtyFromDecay < _quoteTokenQtyDesired &&                                                                                                                                           │
│                     baseTokenQtyFromDecay < _baseTokenQtyDesired                                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // the user still has qty that they desire to contribute to the exchange for liquidity                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                         tokenQtys.quoteTokenQty,                                                                                                                                                                │
│                         tokenQtys.liquidityTokenQty                                                                                                                                                             │
│                     ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired - baseTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                                 │
│                         _quoteTokenQtyDesired - quoteTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                               │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         _quoteTokenReserveQty + quoteTokenQtyFromDecay,                                                                                                                                         │
│                         _totalSupplyOfLiquidityTokens +                                                                                                                                                         │
│                             liquidityTokenQtyFromDecay,                                                                                                                                                         │
│                         _internalBalances // NOTE: these balances have already been updated when we did the decay math.                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 tokenQtys.baseTokenQty += baseTokenQtyFromDecay;                                                                                                                                                │
│                 tokenQtys.quoteTokenQty += quoteTokenQtyFromDecay;                                                                                                                                              │
│                 tokenQtys.liquidityTokenQty += liquidityTokenQtyFromDecay;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.baseTokenQty >= _baseTokenQtyMin,                                                                                                                                                 │
│                     "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                            │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.quoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                               │
│                     "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 // the user is just doing a simple double asset entry / providing both base and quote.                                                                                                          │
│                 (                                                                                                                                                                                               │
│                     tokenQtys.baseTokenQty,                                                                                                                                                                     │
│                     tokenQtys.quoteTokenQty,                                                                                                                                                                    │
│                     tokenQtys.liquidityTokenQty                                                                                                                                                                 │
│                 ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                                   │
│                     _baseTokenQtyDesired,                                                                                                                                                                       │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _baseTokenQtyMin,                                                                                                                                                                           │
│                     _quoteTokenQtyMin,                                                                                                                                                                          │
│                     _quoteTokenReserveQty,                                                                                                                                                                      │
│                     _totalSupplyOfLiquidityTokens,                                                                                                                                                              │
│                     _internalBalances                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // this user will set the initial pricing curve                                                                                                                                                     │
│             require(                                                                                                                                                                                            │
│                 _baseTokenQtyDesired > 0,                                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY_DESIRED"                                                                                                                                                        │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 _quoteTokenQtyDesired > 0,                                                                                                                                                                      │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY_DESIRED"                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             tokenQtys.baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                      │
│             tokenQtys.quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                    │
│             tokenQtys.liquidityTokenQty = sqrt(                                                                                                                                                                 │
│                 _baseTokenQtyDesired * _quoteTokenQtyDesired                                                                                                                                                    │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _internalBalances.baseTokenReserveQty += tokenQtys.baseTokenQty;                                                                                                                                    │
│             _internalBalances.quoteTokenReserveQty += tokenQtys.quoteTokenQty;                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                                         │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (uint256 quoteTokenQty, uint256 liquidityTokenQty) {                                                                                                                                       │
│         uint256 baseTokenDecay =                                                                                                                                                                                │
│             _baseTokenReserveQty - _internalBalances.baseTokenReserveQty;                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // determine max amount of quote token that can be added to offset the current decay                                                                                                                    │
│         uint256 wInternalBaseTokenToQuoteTokenRatio =                                                                                                                                                           │
│             wDiv(                                                                                                                                                                                               │
│                 _internalBalances.baseTokenReserveQty,                                                                                                                                                          │
│                 _internalBalances.quoteTokenReserveQty                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // alphaDecay / omega (A/B)                                                                                                                                                                             │
│         uint256 maxQuoteTokenQty =                                                                                                                                                                              │
│             wDiv(baseTokenDecay, wInternalBaseTokenToQuoteTokenRatio);                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             _quoteTokenQtyMin < maxQuoteTokenQty,                                                                                                                                                               │
│             "MathLib: INSUFFICIENT_DECAY"                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (_quoteTokenQtyDesired > maxQuoteTokenQty) {                                                                                                                                                         │
│             quoteTokenQty = maxQuoteTokenQty;                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         uint256 baseTokenQtyDecayChange =                                                                                                                                                                       │
│             roundToNearest(                                                                                                                                                                                     │
│                 (quoteTokenQty * wInternalBaseTokenToQuoteTokenRatio),                                                                                                                                          │
│                 WAD                                                                                                                                                                                             │
│             ) / WAD;                                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             baseTokenQtyDecayChange > 0,                                                                                                                                                                        │
│             "MathLib: INSUFFICIENT_CHANGE_IN_DECAY"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         //x += alphaDecayChange                                                                                                                                                                                 │
│         //y += deltaBeta                                                                                                                                                                                        │
│         _internalBalances.baseTokenReserveQty += baseTokenQtyDecayChange;                                                                                                                                       │
│         _internalBalances.quoteTokenReserveQty += quoteTokenQty;                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // calculate the number of liquidity tokens to return to user using                                                                                                                                     │
│         liquidityTokenQty = calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             quoteTokenQty,                                                                                                                                                                                      │
│             _internalBalances.quoteTokenReserveQty,                                                                                                                                                             │
│             baseTokenQtyDecayChange,                                                                                                                                                                            │
│             baseTokenDecay                                                                                                                                                                                      │
│         );                                                                                                                                                                                                      │
│         return (quoteTokenQty, liquidityTokenQty);                                                                                                                                                              │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve calculating swap/liquidity or adding liquidity, and there is asset exchanges or price queries,                                                                                               │
│ have code statements that get or calculate LP token's value/price                                                                                                                                               │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddBaseTokenLiquidityQuantities(                                                                                                                                                          │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances memory _internalBalances                                                                                                                                                               │
│     ) public pure returns (uint256 baseTokenQty, uint256 liquidityTokenQty) {                                                                                                                                   │
│         uint256 maxBaseTokenQty =                                                                                                                                                                               │
│             _internalBalances.baseTokenReserveQty - _baseTokenReserveQty;                                                                                                                                       │
│         require(                                                                                                                                                                                                │
│             _baseTokenQtyMin < maxBaseTokenQty,                                                                                                                                                                 │
│             "MathLib: INSUFFICIENT_DECAY"                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (_baseTokenQtyDesired > maxBaseTokenQty) {                                                                                                                                                           │
│             baseTokenQty = maxBaseTokenQty;                                                                                                                                                                     │
│         } else {                                                                                                                                                                                                │
│             baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // determine the quote token qty decay change quoted on our current ratios                                                                                                                              │
│         uint256 wInternalQuoteToBaseTokenRatio =                                                                                                                                                                │
│             wDiv(                                                                                                                                                                                               │
│                 _internalBalances.quoteTokenReserveQty,                                                                                                                                                         │
│                 _internalBalances.baseTokenReserveQty                                                                                                                                                           │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // NOTE we need this function to use the same                                                                                                                                                           │
│         // rounding scheme as wDiv in order to avoid a case                                                                                                                                                     │
│         // in which a user is trying to resolve decay in which                                                                                                                                                  │
│         // quoteTokenQtyDecayChange ends up being 0 and we are stuck in                                                                                                                                         │
│         // a bad state.                                                                                                                                                                                         │
│         uint256 quoteTokenQtyDecayChange =                                                                                                                                                                      │
│             roundToNearest(                                                                                                                                                                                     │
│                 (baseTokenQty * wInternalQuoteToBaseTokenRatio),                                                                                                                                                │
│                 MathLib.WAD                                                                                                                                                                                     │
│             ) / WAD;                                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             quoteTokenQtyDecayChange > 0,                                                                                                                                                                       │
│             "MathLib: INSUFFICIENT_CHANGE_IN_DECAY"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // we can now calculate the total amount of quote token decay                                                                                                                                           │
│         uint256 quoteTokenDecay =                                                                                                                                                                               │
│             (maxBaseTokenQty * wInternalQuoteToBaseTokenRatio) / WAD;                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         // this may be redundant quoted on the above math, but will check to ensure the decay wasn't so small                                                                                                   │
│         // that it was <1 and rounded down to 0 saving the caller some gas                                                                                                                                      │
│         // also could fix a potential revert due to div by zero.                                                                                                                                                │
│         require(quoteTokenDecay > 0, "MathLib: NO_QUOTE_DECAY");                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // we are not changing anything about our internal accounting here. We are simply adding tokens                                                                                                         │
│         // to make our internal account "right"...or rather getting the external balances to match our internal                                                                                                 │
│         // quoteTokenReserveQty += quoteTokenQtyDecayChange;                                                                                                                                                    │
│         // baseTokenReserveQty += baseTokenQty;                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         // calculate the number of liquidity tokens to return to user using:                                                                                                                                    │
│         liquidityTokenQty = calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             baseTokenQty,                                                                                                                                                                                       │
│             _internalBalances.baseTokenReserveQty,                                                                                                                                                              │
│             quoteTokenQtyDecayChange,                                                                                                                                                                           │
│             quoteTokenDecay                                                                                                                                                                                     │
│         );                                                                                                                                                                                                      │
│         return (baseTokenQty, liquidityTokenQty);                                                                                                                                                               │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes",                                                                                                                                                                                                 │
│     "2": "No",                                                                                                                                                                                                  │
│     "3": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve calculating swap/liquidity or adding liquidity, and there is asset exchanges or price queries, but this operation could be attacked by slippage/Sandwich Attack due to no slip limit/minimum │
│ value check                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddBaseTokenLiquidityQuantities(                                                                                                                                                          │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances memory _internalBalances                                                                                                                                                               │
│     ) public pure returns (uint256 baseTokenQty, uint256 liquidityTokenQty) {                                                                                                                                   │
│         uint256 maxBaseTokenQty =                                                                                                                                                                               │
│             _internalBalances.baseTokenReserveQty - _baseTokenReserveQty;                                                                                                                                       │
│         require(                                                                                                                                                                                                │
│             _baseTokenQtyMin < maxBaseTokenQty,                                                                                                                                                                 │
│             "MathLib: INSUFFICIENT_DECAY"                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (_baseTokenQtyDesired > maxBaseTokenQty) {                                                                                                                                                           │
│             baseTokenQty = maxBaseTokenQty;                                                                                                                                                                     │
│         } else {                                                                                                                                                                                                │
│             baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // determine the quote token qty decay change quoted on our current ratios                                                                                                                              │
│         uint256 wInternalQuoteToBaseTokenRatio =                                                                                                                                                                │
│             wDiv(                                                                                                                                                                                               │
│                 _internalBalances.quoteTokenReserveQty,                                                                                                                                                         │
│                 _internalBalances.baseTokenReserveQty                                                                                                                                                           │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // NOTE we need this function to use the same                                                                                                                                                           │
│         // rounding scheme as wDiv in order to avoid a case                                                                                                                                                     │
│         // in which a user is trying to resolve decay in which                                                                                                                                                  │
│         // quoteTokenQtyDecayChange ends up being 0 and we are stuck in                                                                                                                                         │
│         // a bad state.                                                                                                                                                                                         │
│         uint256 quoteTokenQtyDecayChange =                                                                                                                                                                      │
│             roundToNearest(                                                                                                                                                                                     │
│                 (baseTokenQty * wInternalQuoteToBaseTokenRatio),                                                                                                                                                │
│                 MathLib.WAD                                                                                                                                                                                     │
│             ) / WAD;                                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             quoteTokenQtyDecayChange > 0,                                                                                                                                                                       │
│             "MathLib: INSUFFICIENT_CHANGE_IN_DECAY"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // we can now calculate the total amount of quote token decay                                                                                                                                           │
│         uint256 quoteTokenDecay =                                                                                                                                                                               │
│             (maxBaseTokenQty * wInternalQuoteToBaseTokenRatio) / WAD;                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         // this may be redundant quoted on the above math, but will check to ensure the decay wasn't so small                                                                                                   │
│         // that it was <1 and rounded down to 0 saving the caller some gas                                                                                                                                      │
│         // also could fix a potential revert due to div by zero.                                                                                                                                                │
│         require(quoteTokenDecay > 0, "MathLib: NO_QUOTE_DECAY");                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // we are not changing anything about our internal accounting here. We are simply adding tokens                                                                                                         │
│         // to make our internal account "right"...or rather getting the external balances to match our internal                                                                                                 │
│         // quoteTokenReserveQty += quoteTokenQtyDecayChange;                                                                                                                                                    │
│         // baseTokenReserveQty += baseTokenQty;                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         // calculate the number of liquidity tokens to return to user using:                                                                                                                                    │
│         liquidityTokenQty = calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             baseTokenQty,                                                                                                                                                                                       │
│             _internalBalances.baseTokenReserveQty,                                                                                                                                                              │
│             quoteTokenQtyDecayChange,                                                                                                                                                                           │
│             quoteTokenDecay                                                                                                                                                                                     │
│         );                                                                                                                                                                                                      │
│         return (baseTokenQty, liquidityTokenQty);                                                                                                                                                               │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddBaseTokenLiquidityQuantities(                                                                                                                                                          │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances memory _internalBalances                                                                                                                                                               │
│     ) public pure returns (uint256 baseTokenQty, uint256 liquidityTokenQty) {                                                                                                                                   │
│         uint256 maxBaseTokenQty =                                                                                                                                                                               │
│             _internalBalances.baseTokenReserveQty - _baseTokenReserveQty;                                                                                                                                       │
│         require(                                                                                                                                                                                                │
│             _baseTokenQtyMin < maxBaseTokenQty,                                                                                                                                                                 │
│             "MathLib: INSUFFICIENT_DECAY"                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (_baseTokenQtyDesired > maxBaseTokenQty) {                                                                                                                                                           │
│             baseTokenQty = maxBaseTokenQty;                                                                                                                                                                     │
│         } else {                                                                                                                                                                                                │
│             baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // determine the quote token qty decay change quoted on our current ratios                                                                                                                              │
│         uint256 wInternalQuoteToBaseTokenRatio =                                                                                                                                                                │
│             wDiv(                                                                                                                                                                                               │
│                 _internalBalances.quoteTokenReserveQty,                                                                                                                                                         │
│                 _internalBalances.baseTokenReserveQty                                                                                                                                                           │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // NOTE we need this function to use the same                                                                                                                                                           │
│         // rounding scheme as wDiv in order to avoid a case                                                                                                                                                     │
│         // in which a user is trying to resolve decay in which                                                                                                                                                  │
│         // quoteTokenQtyDecayChange ends up being 0 and we are stuck in                                                                                                                                         │
│         // a bad state.                                                                                                                                                                                         │
│         uint256 quoteTokenQtyDecayChange =                                                                                                                                                                      │
│             roundToNearest(                                                                                                                                                                                     │
│                 (baseTokenQty * wInternalQuoteToBaseTokenRatio),                                                                                                                                                │
│                 MathLib.WAD                                                                                                                                                                                     │
│             ) / WAD;                                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             quoteTokenQtyDecayChange > 0,                                                                                                                                                                       │
│             "MathLib: INSUFFICIENT_CHANGE_IN_DECAY"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // we can now calculate the total amount of quote token decay                                                                                                                                           │
│         uint256 quoteTokenDecay =                                                                                                                                                                               │
│             (maxBaseTokenQty * wInternalQuoteToBaseTokenRatio) / WAD;                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         // this may be redundant quoted on the above math, but will check to ensure the decay wasn't so small                                                                                                   │
│         // that it was <1 and rounded down to 0 saving the caller some gas                                                                                                                                      │
│         // also could fix a potential revert due to div by zero.                                                                                                                                                │
│         require(quoteTokenDecay > 0, "MathLib: NO_QUOTE_DECAY");                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // we are not changing anything about our internal accounting here. We are simply adding tokens                                                                                                         │
│         // to make our internal account "right"...or rather getting the external balances to match our internal                                                                                                 │
│         // quoteTokenReserveQty += quoteTokenQtyDecayChange;                                                                                                                                                    │
│         // baseTokenReserveQty += baseTokenQty;                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         // calculate the number of liquidity tokens to return to user using:                                                                                                                                    │
│         liquidityTokenQty = calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             baseTokenQty,                                                                                                                                                                                       │
│             _internalBalances.baseTokenReserveQty,                                                                                                                                                              │
│             quoteTokenQtyDecayChange,                                                                                                                                                                           │
│             quoteTokenDecay                                                                                                                                                                                     │
│         );                                                                                                                                                                                                      │
│         return (baseTokenQty, liquidityTokenQty);                                                                                                                                                               │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve calculating swap/liquidity or adding liquidity, and there is asset exchanges or price queries,                                                                                               │
│ have code statements that get or calculate LP token's value/price                                                                                                                                               │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddLiquidityQuantities(                                                                                                                                                                   │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (TokenQtys memory tokenQtys) {                                                                                                                                                             │
│         if (_totalSupplyOfLiquidityTokens > 0) {                                                                                                                                                                │
│             // we have outstanding liquidity tokens present and an existing price curve                                                                                                                         │
│                                                                                                                                                                                                                 │
│             tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                       │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // we need to take this amount (that will be minted) into account for below calculations                                                                                                            │
│             _totalSupplyOfLiquidityTokens += tokenQtys.liquidityTokenFeeQty;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│             // confirm that we have no beta or alpha decay present                                                                                                                                              │
│             // if we do, we need to resolve that first                                                                                                                                                          │
│             if (                                                                                                                                                                                                │
│                 isSufficientDecayPresent(                                                                                                                                                                       │
│                     _baseTokenReserveQty,                                                                                                                                                                       │
│                     _internalBalances                                                                                                                                                                           │
│                 )                                                                                                                                                                                               │
│             ) {                                                                                                                                                                                                 │
│                 // decay is present and needs to be dealt with by the caller.                                                                                                                                   │
│                                                                                                                                                                                                                 │
│                 uint256 baseTokenQtyFromDecay;                                                                                                                                                                  │
│                 uint256 quoteTokenQtyFromDecay;                                                                                                                                                                 │
│                 uint256 liquidityTokenQtyFromDecay;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     _baseTokenReserveQty > _internalBalances.baseTokenReserveQty                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // we have more base token than expected (base token decay) due to rebase up                                                                                                                │
│                     // we first need to handle this situation by requiring this user                                                                                                                            │
│                     // to add quote tokens                                                                                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         quoteTokenQtyFromDecay,                                                                                                                                                                 │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                              │
│                         _quoteTokenQtyDesired,                                                                                                                                                                  │
│                         0, // there is no minimum for this particular call since we may use quote tokens later.                                                                                                 │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // we have less base token than expected (quote token decay) due to a rebase down                                                                                                           │
│                     // we first need to handle this by adding base tokens to offset this.                                                                                                                       │
│                     (                                                                                                                                                                                           │
│                         baseTokenQtyFromDecay,                                                                                                                                                                  │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddBaseTokenLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired,                                                                                                                                                                   │
│                         0, // there is no minimum for this particular call since we may use base tokens later.                                                                                                  │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     quoteTokenQtyFromDecay < _quoteTokenQtyDesired &&                                                                                                                                           │
│                     baseTokenQtyFromDecay < _baseTokenQtyDesired                                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // the user still has qty that they desire to contribute to the exchange for liquidity                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                         tokenQtys.quoteTokenQty,                                                                                                                                                                │
│                         tokenQtys.liquidityTokenQty                                                                                                                                                             │
│                     ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired - baseTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                                 │
│                         _quoteTokenQtyDesired - quoteTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                               │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         _quoteTokenReserveQty + quoteTokenQtyFromDecay,                                                                                                                                         │
│                         _totalSupplyOfLiquidityTokens +                                                                                                                                                         │
│                             liquidityTokenQtyFromDecay,                                                                                                                                                         │
│                         _internalBalances // NOTE: these balances have already been updated when we did the decay math.                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 tokenQtys.baseTokenQty += baseTokenQtyFromDecay;                                                                                                                                                │
│                 tokenQtys.quoteTokenQty += quoteTokenQtyFromDecay;                                                                                                                                              │
│                 tokenQtys.liquidityTokenQty += liquidityTokenQtyFromDecay;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.baseTokenQty >= _baseTokenQtyMin,                                                                                                                                                 │
│                     "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                            │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.quoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                               │
│                     "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 // the user is just doing a simple double asset entry / providing both base and quote.                                                                                                          │
│                 (                                                                                                                                                                                               │
│                     tokenQtys.baseTokenQty,                                                                                                                                                                     │
│                     tokenQtys.quoteTokenQty,                                                                                                                                                                    │
│                     tokenQtys.liquidityTokenQty                                                                                                                                                                 │
│                 ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                                   │
│                     _baseTokenQtyDesired,                                                                                                                                                                       │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _baseTokenQtyMin,                                                                                                                                                                           │
│                     _quoteTokenQtyMin,                                                                                                                                                                          │
│                     _quoteTokenReserveQty,                                                                                                                                                                      │
│                     _totalSupplyOfLiquidityTokens,                                                                                                                                                              │
│                     _internalBalances                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // this user will set the initial pricing curve                                                                                                                                                     │
│             require(                                                                                                                                                                                            │
│                 _baseTokenQtyDesired > 0,                                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY_DESIRED"                                                                                                                                                        │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 _quoteTokenQtyDesired > 0,                                                                                                                                                                      │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY_DESIRED"                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             tokenQtys.baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                      │
│             tokenQtys.quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                    │
│             tokenQtys.liquidityTokenQty = sqrt(                                                                                                                                                                 │
│                 _baseTokenQtyDesired * _quoteTokenQtyDesired                                                                                                                                                    │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _internalBalances.baseTokenReserveQty += tokenQtys.baseTokenQty;                                                                                                                                    │
│             _internalBalances.quoteTokenReserveQty += tokenQtys.quoteTokenQty;                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function calculateAddBaseTokenLiquidityQuantities(                                                                                                                                                          │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances memory _internalBalances                                                                                                                                                               │
│     ) public pure returns (uint256 baseTokenQty, uint256 liquidityTokenQty) {                                                                                                                                   │
│         uint256 maxBaseTokenQty =                                                                                                                                                                               │
│             _internalBalances.baseTokenReserveQty - _baseTokenReserveQty;                                                                                                                                       │
│         require(                                                                                                                                                                                                │
│             _baseTokenQtyMin < maxBaseTokenQty,                                                                                                                                                                 │
│             "MathLib: INSUFFICIENT_DECAY"                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (_baseTokenQtyDesired > maxBaseTokenQty) {                                                                                                                                                           │
│             baseTokenQty = maxBaseTokenQty;                                                                                                                                                                     │
│         } else {                                                                                                                                                                                                │
│             baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // determine the quote token qty decay change quoted on our current ratios                                                                                                                              │
│         uint256 wInternalQuoteToBaseTokenRatio =                                                                                                                                                                │
│             wDiv(                                                                                                                                                                                               │
│                 _internalBalances.quoteTokenReserveQty,                                                                                                                                                         │
│                 _internalBalances.baseTokenReserveQty                                                                                                                                                           │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // NOTE we need this function to use the same                                                                                                                                                           │
│         // rounding scheme as wDiv in order to avoid a case                                                                                                                                                     │
│         // in which a user is trying to resolve decay in which                                                                                                                                                  │
│         // quoteTokenQtyDecayChange ends up being 0 and we are stuck in                                                                                                                                         │
│         // a bad state.                                                                                                                                                                                         │
│         uint256 quoteTokenQtyDecayChange =                                                                                                                                                                      │
│             roundToNearest(                                                                                                                                                                                     │
│                 (baseTokenQty * wInternalQuoteToBaseTokenRatio),                                                                                                                                                │
│                 MathLib.WAD                                                                                                                                                                                     │
│             ) / WAD;                                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             quoteTokenQtyDecayChange > 0,                                                                                                                                                                       │
│             "MathLib: INSUFFICIENT_CHANGE_IN_DECAY"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // we can now calculate the total amount of quote token decay                                                                                                                                           │
│         uint256 quoteTokenDecay =                                                                                                                                                                               │
│             (maxBaseTokenQty * wInternalQuoteToBaseTokenRatio) / WAD;                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         // this may be redundant quoted on the above math, but will check to ensure the decay wasn't so small                                                                                                   │
│         // that it was <1 and rounded down to 0 saving the caller some gas                                                                                                                                      │
│         // also could fix a potential revert due to div by zero.                                                                                                                                                │
│         require(quoteTokenDecay > 0, "MathLib: NO_QUOTE_DECAY");                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // we are not changing anything about our internal accounting here. We are simply adding tokens                                                                                                         │
│         // to make our internal account "right"...or rather getting the external balances to match our internal                                                                                                 │
│         // quoteTokenReserveQty += quoteTokenQtyDecayChange;                                                                                                                                                    │
│         // baseTokenReserveQty += baseTokenQty;                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         // calculate the number of liquidity tokens to return to user using:                                                                                                                                    │
│         liquidityTokenQty = calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             baseTokenQty,                                                                                                                                                                                       │
│             _internalBalances.baseTokenReserveQty,                                                                                                                                                              │
│             quoteTokenQtyDecayChange,                                                                                                                                                                           │
│             quoteTokenDecay                                                                                                                                                                                     │
│         );                                                                                                                                                                                                      │
│         return (baseTokenQty, liquidityTokenQty);                                                                                                                                                               │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│         "1": "Yes",                                                                                                                                                                                             │
│         "2": "No",                                                                                                                                                                                              │
│         "3": "Yes"                                                                                                                                                                                              │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve calculating swap/liquidity or adding liquidity, and there is asset exchanges or price queries, but this operation could be attacked by slippage/Sandwich Attack due to no slip limit/minimum │
│ value check                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddLiquidityQuantities(                                                                                                                                                                   │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (TokenQtys memory tokenQtys) {                                                                                                                                                             │
│         if (_totalSupplyOfLiquidityTokens > 0) {                                                                                                                                                                │
│             // we have outstanding liquidity tokens present and an existing price curve                                                                                                                         │
│                                                                                                                                                                                                                 │
│             tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                       │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // we need to take this amount (that will be minted) into account for below calculations                                                                                                            │
│             _totalSupplyOfLiquidityTokens += tokenQtys.liquidityTokenFeeQty;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│             // confirm that we have no beta or alpha decay present                                                                                                                                              │
│             // if we do, we need to resolve that first                                                                                                                                                          │
│             if (                                                                                                                                                                                                │
│                 isSufficientDecayPresent(                                                                                                                                                                       │
│                     _baseTokenReserveQty,                                                                                                                                                                       │
│                     _internalBalances                                                                                                                                                                           │
│                 )                                                                                                                                                                                               │
│             ) {                                                                                                                                                                                                 │
│                 // decay is present and needs to be dealt with by the caller.                                                                                                                                   │
│                                                                                                                                                                                                                 │
│                 uint256 baseTokenQtyFromDecay;                                                                                                                                                                  │
│                 uint256 quoteTokenQtyFromDecay;                                                                                                                                                                 │
│                 uint256 liquidityTokenQtyFromDecay;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     _baseTokenReserveQty > _internalBalances.baseTokenReserveQty                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // we have more base token than expected (base token decay) due to rebase up                                                                                                                │
│                     // we first need to handle this situation by requiring this user                                                                                                                            │
│                     // to add quote tokens                                                                                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         quoteTokenQtyFromDecay,                                                                                                                                                                 │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                              │
│                         _quoteTokenQtyDesired,                                                                                                                                                                  │
│                         0, // there is no minimum for this particular call since we may use quote tokens later.                                                                                                 │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // we have less base token than expected (quote token decay) due to a rebase down                                                                                                           │
│                     // we first need to handle this by adding base tokens to offset this.                                                                                                                       │
│                     (                                                                                                                                                                                           │
│                         baseTokenQtyFromDecay,                                                                                                                                                                  │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddBaseTokenLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired,                                                                                                                                                                   │
│                         0, // there is no minimum for this particular call since we may use base tokens later.                                                                                                  │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     quoteTokenQtyFromDecay < _quoteTokenQtyDesired &&                                                                                                                                           │
│                     baseTokenQtyFromDecay < _baseTokenQtyDesired                                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // the user still has qty that they desire to contribute to the exchange for liquidity                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                         tokenQtys.quoteTokenQty,                                                                                                                                                                │
│                         tokenQtys.liquidityTokenQty                                                                                                                                                             │
│                     ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired - baseTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                                 │
│                         _quoteTokenQtyDesired - quoteTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                               │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         _quoteTokenReserveQty + quoteTokenQtyFromDecay,                                                                                                                                         │
│                         _totalSupplyOfLiquidityTokens +                                                                                                                                                         │
│                             liquidityTokenQtyFromDecay,                                                                                                                                                         │
│                         _internalBalances // NOTE: these balances have already been updated when we did the decay math.                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 tokenQtys.baseTokenQty += baseTokenQtyFromDecay;                                                                                                                                                │
│                 tokenQtys.quoteTokenQty += quoteTokenQtyFromDecay;                                                                                                                                              │
│                 tokenQtys.liquidityTokenQty += liquidityTokenQtyFromDecay;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.baseTokenQty >= _baseTokenQtyMin,                                                                                                                                                 │
│                     "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                            │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.quoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                               │
│                     "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 // the user is just doing a simple double asset entry / providing both base and quote.                                                                                                          │
│                 (                                                                                                                                                                                               │
│                     tokenQtys.baseTokenQty,                                                                                                                                                                     │
│                     tokenQtys.quoteTokenQty,                                                                                                                                                                    │
│                     tokenQtys.liquidityTokenQty                                                                                                                                                                 │
│                 ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                                   │
│                     _baseTokenQtyDesired,                                                                                                                                                                       │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _baseTokenQtyMin,                                                                                                                                                                           │
│                     _quoteTokenQtyMin,                                                                                                                                                                          │
│                     _quoteTokenReserveQty,                                                                                                                                                                      │
│                     _totalSupplyOfLiquidityTokens,                                                                                                                                                              │
│                     _internalBalances                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // this user will set the initial pricing curve                                                                                                                                                     │
│             require(                                                                                                                                                                                            │
│                 _baseTokenQtyDesired > 0,                                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY_DESIRED"                                                                                                                                                        │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 _quoteTokenQtyDesired > 0,                                                                                                                                                                      │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY_DESIRED"                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             tokenQtys.baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                      │
│             tokenQtys.quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                    │
│             tokenQtys.liquidityTokenQty = sqrt(                                                                                                                                                                 │
│                 _baseTokenQtyDesired * _quoteTokenQtyDesired                                                                                                                                                    │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _internalBalances.baseTokenReserveQty += tokenQtys.baseTokenQty;                                                                                                                                    │
│             _internalBalances.quoteTokenReserveQty += tokenQtys.quoteTokenQty;                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function calculateAddBaseTokenLiquidityQuantities(                                                                                                                                                          │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances memory _internalBalances                                                                                                                                                               │
│     ) public pure returns (uint256 baseTokenQty, uint256 liquidityTokenQty) {                                                                                                                                   │
│         uint256 maxBaseTokenQty =                                                                                                                                                                               │
│             _internalBalances.baseTokenReserveQty - _baseTokenReserveQty;                                                                                                                                       │
│         require(                                                                                                                                                                                                │
│             _baseTokenQtyMin < maxBaseTokenQty,                                                                                                                                                                 │
│             "MathLib: INSUFFICIENT_DECAY"                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (_baseTokenQtyDesired > maxBaseTokenQty) {                                                                                                                                                           │
│             baseTokenQty = maxBaseTokenQty;                                                                                                                                                                     │
│         } else {                                                                                                                                                                                                │
│             baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // determine the quote token qty decay change quoted on our current ratios                                                                                                                              │
│         uint256 wInternalQuoteToBaseTokenRatio =                                                                                                                                                                │
│             wDiv(                                                                                                                                                                                               │
│                 _internalBalances.quoteTokenReserveQty,                                                                                                                                                         │
│                 _internalBalances.baseTokenReserveQty                                                                                                                                                           │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // NOTE we need this function to use the same                                                                                                                                                           │
│         // rounding scheme as wDiv in order to avoid a case                                                                                                                                                     │
│         // in which a user is trying to resolve decay in which                                                                                                                                                  │
│         // quoteTokenQtyDecayChange ends up being 0 and we are stuck in                                                                                                                                         │
│         // a bad state.                                                                                                                                                                                         │
│         uint256 quoteTokenQtyDecayChange =                                                                                                                                                                      │
│             roundToNearest(                                                                                                                                                                                     │
│                 (baseTokenQty * wInternalQuoteToBaseTokenRatio),                                                                                                                                                │
│                 MathLib.WAD                                                                                                                                                                                     │
│             ) / WAD;                                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             quoteTokenQtyDecayChange > 0,                                                                                                                                                                       │
│             "MathLib: INSUFFICIENT_CHANGE_IN_DECAY"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // we can now calculate the total amount of quote token decay                                                                                                                                           │
│         uint256 quoteTokenDecay =                                                                                                                                                                               │
│             (maxBaseTokenQty * wInternalQuoteToBaseTokenRatio) / WAD;                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         // this may be redundant quoted on the above math, but will check to ensure the decay wasn't so small                                                                                                   │
│         // that it was <1 and rounded down to 0 saving the caller some gas                                                                                                                                      │
│         // also could fix a potential revert due to div by zero.                                                                                                                                                │
│         require(quoteTokenDecay > 0, "MathLib: NO_QUOTE_DECAY");                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // we are not changing anything about our internal accounting here. We are simply adding tokens                                                                                                         │
│         // to make our internal account "right"...or rather getting the external balances to match our internal                                                                                                 │
│         // quoteTokenReserveQty += quoteTokenQtyDecayChange;                                                                                                                                                    │
│         // baseTokenReserveQty += baseTokenQty;                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         // calculate the number of liquidity tokens to return to user using:                                                                                                                                    │
│         liquidityTokenQty = calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             baseTokenQty,                                                                                                                                                                                       │
│             _internalBalances.baseTokenReserveQty,                                                                                                                                                              │
│             quoteTokenQtyDecayChange,                                                                                                                                                                           │
│             quoteTokenDecay                                                                                                                                                                                     │
│         );                                                                                                                                                                                                      │
│         return (baseTokenQty, liquidityTokenQty);                                                                                                                                                               │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddLiquidityQuantities(                                                                                                                                                                   │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (TokenQtys memory tokenQtys) {                                                                                                                                                             │
│         if (_totalSupplyOfLiquidityTokens > 0) {                                                                                                                                                                │
│             // we have outstanding liquidity tokens present and an existing price curve                                                                                                                         │
│                                                                                                                                                                                                                 │
│             tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                       │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // we need to take this amount (that will be minted) into account for below calculations                                                                                                            │
│             _totalSupplyOfLiquidityTokens += tokenQtys.liquidityTokenFeeQty;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│             // confirm that we have no beta or alpha decay present                                                                                                                                              │
│             // if we do, we need to resolve that first                                                                                                                                                          │
│             if (                                                                                                                                                                                                │
│                 isSufficientDecayPresent(                                                                                                                                                                       │
│                     _baseTokenReserveQty,                                                                                                                                                                       │
│                     _internalBalances                                                                                                                                                                           │
│                 )                                                                                                                                                                                               │
│             ) {                                                                                                                                                                                                 │
│                 // decay is present and needs to be dealt with by the caller.                                                                                                                                   │
│                                                                                                                                                                                                                 │
│                 uint256 baseTokenQtyFromDecay;                                                                                                                                                                  │
│                 uint256 quoteTokenQtyFromDecay;                                                                                                                                                                 │
│                 uint256 liquidityTokenQtyFromDecay;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     _baseTokenReserveQty > _internalBalances.baseTokenReserveQty                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // we have more base token than expected (base token decay) due to rebase up                                                                                                                │
│                     // we first need to handle this situation by requiring this user                                                                                                                            │
│                     // to add quote tokens                                                                                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         quoteTokenQtyFromDecay,                                                                                                                                                                 │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                              │
│                         _quoteTokenQtyDesired,                                                                                                                                                                  │
│                         0, // there is no minimum for this particular call since we may use quote tokens later.                                                                                                 │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // we have less base token than expected (quote token decay) due to a rebase down                                                                                                           │
│                     // we first need to handle this by adding base tokens to offset this.                                                                                                                       │
│                     (                                                                                                                                                                                           │
│                         baseTokenQtyFromDecay,                                                                                                                                                                  │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddBaseTokenLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired,                                                                                                                                                                   │
│                         0, // there is no minimum for this particular call since we may use base tokens later.                                                                                                  │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     quoteTokenQtyFromDecay < _quoteTokenQtyDesired &&                                                                                                                                           │
│                     baseTokenQtyFromDecay < _baseTokenQtyDesired                                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // the user still has qty that they desire to contribute to the exchange for liquidity                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                         tokenQtys.quoteTokenQty,                                                                                                                                                                │
│                         tokenQtys.liquidityTokenQty                                                                                                                                                             │
│                     ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired - baseTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                                 │
│                         _quoteTokenQtyDesired - quoteTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                               │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         _quoteTokenReserveQty + quoteTokenQtyFromDecay,                                                                                                                                         │
│                         _totalSupplyOfLiquidityTokens +                                                                                                                                                         │
│                             liquidityTokenQtyFromDecay,                                                                                                                                                         │
│                         _internalBalances // NOTE: these balances have already been updated when we did the decay math.                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 tokenQtys.baseTokenQty += baseTokenQtyFromDecay;                                                                                                                                                │
│                 tokenQtys.quoteTokenQty += quoteTokenQtyFromDecay;                                                                                                                                              │
│                 tokenQtys.liquidityTokenQty += liquidityTokenQtyFromDecay;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.baseTokenQty >= _baseTokenQtyMin,                                                                                                                                                 │
│                     "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                            │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.quoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                               │
│                     "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 // the user is just doing a simple double asset entry / providing both base and quote.                                                                                                          │
│                 (                                                                                                                                                                                               │
│                     tokenQtys.baseTokenQty,                                                                                                                                                                     │
│                     tokenQtys.quoteTokenQty,                                                                                                                                                                    │
│                     tokenQtys.liquidityTokenQty                                                                                                                                                                 │
│                 ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                                   │
│                     _baseTokenQtyDesired,                                                                                                                                                                       │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _baseTokenQtyMin,                                                                                                                                                                           │
│                     _quoteTokenQtyMin,                                                                                                                                                                          │
│                     _quoteTokenReserveQty,                                                                                                                                                                      │
│                     _totalSupplyOfLiquidityTokens,                                                                                                                                                              │
│                     _internalBalances                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // this user will set the initial pricing curve                                                                                                                                                     │
│             require(                                                                                                                                                                                            │
│                 _baseTokenQtyDesired > 0,                                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY_DESIRED"                                                                                                                                                        │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 _quoteTokenQtyDesired > 0,                                                                                                                                                                      │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY_DESIRED"                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             tokenQtys.baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                      │
│             tokenQtys.quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                    │
│             tokenQtys.liquidityTokenQty = sqrt(                                                                                                                                                                 │
│                 _baseTokenQtyDesired * _quoteTokenQtyDesired                                                                                                                                                    │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _internalBalances.baseTokenReserveQty += tokenQtys.baseTokenQty;                                                                                                                                    │
│             _internalBalances.quoteTokenReserveQty += tokenQtys.quoteTokenQty;                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function calculateAddBaseTokenLiquidityQuantities(                                                                                                                                                          │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances memory _internalBalances                                                                                                                                                               │
│     ) public pure returns (uint256 baseTokenQty, uint256 liquidityTokenQty) {                                                                                                                                   │
│         uint256 maxBaseTokenQty =                                                                                                                                                                               │
│             _internalBalances.baseTokenReserveQty - _baseTokenReserveQty;                                                                                                                                       │
│         require(                                                                                                                                                                                                │
│             _baseTokenQtyMin < maxBaseTokenQty,                                                                                                                                                                 │
│             "MathLib: INSUFFICIENT_DECAY"                                                                                                                                                                       │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         if (_baseTokenQtyDesired > maxBaseTokenQty) {                                                                                                                                                           │
│             baseTokenQty = maxBaseTokenQty;                                                                                                                                                                     │
│         } else {                                                                                                                                                                                                │
│             baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // determine the quote token qty decay change quoted on our current ratios                                                                                                                              │
│         uint256 wInternalQuoteToBaseTokenRatio =                                                                                                                                                                │
│             wDiv(                                                                                                                                                                                               │
│                 _internalBalances.quoteTokenReserveQty,                                                                                                                                                         │
│                 _internalBalances.baseTokenReserveQty                                                                                                                                                           │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         // NOTE we need this function to use the same                                                                                                                                                           │
│         // rounding scheme as wDiv in order to avoid a case                                                                                                                                                     │
│         // in which a user is trying to resolve decay in which                                                                                                                                                  │
│         // quoteTokenQtyDecayChange ends up being 0 and we are stuck in                                                                                                                                         │
│         // a bad state.                                                                                                                                                                                         │
│         uint256 quoteTokenQtyDecayChange =                                                                                                                                                                      │
│             roundToNearest(                                                                                                                                                                                     │
│                 (baseTokenQty * wInternalQuoteToBaseTokenRatio),                                                                                                                                                │
│                 MathLib.WAD                                                                                                                                                                                     │
│             ) / WAD;                                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         require(                                                                                                                                                                                                │
│             quoteTokenQtyDecayChange > 0,                                                                                                                                                                       │
│             "MathLib: INSUFFICIENT_CHANGE_IN_DECAY"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // we can now calculate the total amount of quote token decay                                                                                                                                           │
│         uint256 quoteTokenDecay =                                                                                                                                                                               │
│             (maxBaseTokenQty * wInternalQuoteToBaseTokenRatio) / WAD;                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         // this may be redundant quoted on the above math, but will check to ensure the decay wasn't so small                                                                                                   │
│         // that it was <1 and rounded down to 0 saving the caller some gas                                                                                                                                      │
│         // also could fix a potential revert due to div by zero.                                                                                                                                                │
│         require(quoteTokenDecay > 0, "MathLib: NO_QUOTE_DECAY");                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // we are not changing anything about our internal accounting here. We are simply adding tokens                                                                                                         │
│         // to make our internal account "right"...or rather getting the external balances to match our internal                                                                                                 │
│         // quoteTokenReserveQty += quoteTokenQtyDecayChange;                                                                                                                                                    │
│         // baseTokenReserveQty += baseTokenQty;                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         // calculate the number of liquidity tokens to return to user using:                                                                                                                                    │
│         liquidityTokenQty = calculateLiquidityTokenQtyForSingleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             baseTokenQty,                                                                                                                                                                                       │
│             _internalBalances.baseTokenReserveQty,                                                                                                                                                              │
│             quoteTokenQtyDecayChange,                                                                                                                                                                           │
│             quoteTokenDecay                                                                                                                                                                                     │
│         );                                                                                                                                                                                                      │
│         return (baseTokenQty, liquidityTokenQty);                                                                                                                                                               │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve calculating swap/liquidity or adding liquidity, and there is asset exchanges or price queries,                                                                                               │
│ have code statements that get or calculate LP token's value/price                                                                                                                                               │
│ have inside code statements that update/accrue interest/exchange rate,                                                                                                                                          │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddLiquidityQuantities(                                                                                                                                                                   │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (TokenQtys memory tokenQtys) {                                                                                                                                                             │
│         if (_totalSupplyOfLiquidityTokens > 0) {                                                                                                                                                                │
│             // we have outstanding liquidity tokens present and an existing price curve                                                                                                                         │
│                                                                                                                                                                                                                 │
│             tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                       │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // we need to take this amount (that will be minted) into account for below calculations                                                                                                            │
│             _totalSupplyOfLiquidityTokens += tokenQtys.liquidityTokenFeeQty;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│             // confirm that we have no beta or alpha decay present                                                                                                                                              │
│             // if we do, we need to resolve that first                                                                                                                                                          │
│             if (                                                                                                                                                                                                │
│                 isSufficientDecayPresent(                                                                                                                                                                       │
│                     _baseTokenReserveQty,                                                                                                                                                                       │
│                     _internalBalances                                                                                                                                                                           │
│                 )                                                                                                                                                                                               │
│             ) {                                                                                                                                                                                                 │
│                 // decay is present and needs to be dealt with by the caller.                                                                                                                                   │
│                                                                                                                                                                                                                 │
│                 uint256 baseTokenQtyFromDecay;                                                                                                                                                                  │
│                 uint256 quoteTokenQtyFromDecay;                                                                                                                                                                 │
│                 uint256 liquidityTokenQtyFromDecay;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     _baseTokenReserveQty > _internalBalances.baseTokenReserveQty                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // we have more base token than expected (base token decay) due to rebase up                                                                                                                │
│                     // we first need to handle this situation by requiring this user                                                                                                                            │
│                     // to add quote tokens                                                                                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         quoteTokenQtyFromDecay,                                                                                                                                                                 │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                              │
│                         _quoteTokenQtyDesired,                                                                                                                                                                  │
│                         0, // there is no minimum for this particular call since we may use quote tokens later.                                                                                                 │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // we have less base token than expected (quote token decay) due to a rebase down                                                                                                           │
│                     // we first need to handle this by adding base tokens to offset this.                                                                                                                       │
│                     (                                                                                                                                                                                           │
│                         baseTokenQtyFromDecay,                                                                                                                                                                  │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddBaseTokenLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired,                                                                                                                                                                   │
│                         0, // there is no minimum for this particular call since we may use base tokens later.                                                                                                  │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     quoteTokenQtyFromDecay < _quoteTokenQtyDesired &&                                                                                                                                           │
│                     baseTokenQtyFromDecay < _baseTokenQtyDesired                                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // the user still has qty that they desire to contribute to the exchange for liquidity                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                         tokenQtys.quoteTokenQty,                                                                                                                                                                │
│                         tokenQtys.liquidityTokenQty                                                                                                                                                             │
│                     ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired - baseTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                                 │
│                         _quoteTokenQtyDesired - quoteTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                               │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         _quoteTokenReserveQty + quoteTokenQtyFromDecay,                                                                                                                                         │
│                         _totalSupplyOfLiquidityTokens +                                                                                                                                                         │
│                             liquidityTokenQtyFromDecay,                                                                                                                                                         │
│                         _internalBalances // NOTE: these balances have already been updated when we did the decay math.                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 tokenQtys.baseTokenQty += baseTokenQtyFromDecay;                                                                                                                                                │
│                 tokenQtys.quoteTokenQty += quoteTokenQtyFromDecay;                                                                                                                                              │
│                 tokenQtys.liquidityTokenQty += liquidityTokenQtyFromDecay;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.baseTokenQty >= _baseTokenQtyMin,                                                                                                                                                 │
│                     "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                            │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.quoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                               │
│                     "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 // the user is just doing a simple double asset entry / providing both base and quote.                                                                                                          │
│                 (                                                                                                                                                                                               │
│                     tokenQtys.baseTokenQty,                                                                                                                                                                     │
│                     tokenQtys.quoteTokenQty,                                                                                                                                                                    │
│                     tokenQtys.liquidityTokenQty                                                                                                                                                                 │
│                 ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                                   │
│                     _baseTokenQtyDesired,                                                                                                                                                                       │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _baseTokenQtyMin,                                                                                                                                                                           │
│                     _quoteTokenQtyMin,                                                                                                                                                                          │
│                     _quoteTokenReserveQty,                                                                                                                                                                      │
│                     _totalSupplyOfLiquidityTokens,                                                                                                                                                              │
│                     _internalBalances                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // this user will set the initial pricing curve                                                                                                                                                     │
│             require(                                                                                                                                                                                            │
│                 _baseTokenQtyDesired > 0,                                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY_DESIRED"                                                                                                                                                        │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 _quoteTokenQtyDesired > 0,                                                                                                                                                                      │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY_DESIRED"                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             tokenQtys.baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                      │
│             tokenQtys.quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                    │
│             tokenQtys.liquidityTokenQty = sqrt(                                                                                                                                                                 │
│                 _baseTokenQtyDesired * _quoteTokenQtyDesired                                                                                                                                                    │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _internalBalances.baseTokenReserveQty += tokenQtys.baseTokenQty;                                                                                                                                    │
│             _internalBalances.quoteTokenReserveQty += tokenQtys.quoteTokenQty;                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes",                                                                                                                                                                                                 │
│     "2": "No",                                                                                                                                                                                                  │
│     "3": "Yes",                                                                                                                                                                                                 │
│     "4": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve calculating swap/liquidity or adding liquidity, and there is asset exchanges or price queries, but this operation could be attacked by slippage/Sandwich Attack due to no slip limit/minimum │
│ value check                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddLiquidityQuantities(                                                                                                                                                                   │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (TokenQtys memory tokenQtys) {                                                                                                                                                             │
│         if (_totalSupplyOfLiquidityTokens > 0) {                                                                                                                                                                │
│             // we have outstanding liquidity tokens present and an existing price curve                                                                                                                         │
│                                                                                                                                                                                                                 │
│             tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                       │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // we need to take this amount (that will be minted) into account for below calculations                                                                                                            │
│             _totalSupplyOfLiquidityTokens += tokenQtys.liquidityTokenFeeQty;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│             // confirm that we have no beta or alpha decay present                                                                                                                                              │
│             // if we do, we need to resolve that first                                                                                                                                                          │
│             if (                                                                                                                                                                                                │
│                 isSufficientDecayPresent(                                                                                                                                                                       │
│                     _baseTokenReserveQty,                                                                                                                                                                       │
│                     _internalBalances                                                                                                                                                                           │
│                 )                                                                                                                                                                                               │
│             ) {                                                                                                                                                                                                 │
│                 // decay is present and needs to be dealt with by the caller.                                                                                                                                   │
│                                                                                                                                                                                                                 │
│                 uint256 baseTokenQtyFromDecay;                                                                                                                                                                  │
│                 uint256 quoteTokenQtyFromDecay;                                                                                                                                                                 │
│                 uint256 liquidityTokenQtyFromDecay;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     _baseTokenReserveQty > _internalBalances.baseTokenReserveQty                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // we have more base token than expected (base token decay) due to rebase up                                                                                                                │
│                     // we first need to handle this situation by requiring this user                                                                                                                            │
│                     // to add quote tokens                                                                                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         quoteTokenQtyFromDecay,                                                                                                                                                                 │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                              │
│                         _quoteTokenQtyDesired,                                                                                                                                                                  │
│                         0, // there is no minimum for this particular call since we may use quote tokens later.                                                                                                 │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // we have less base token than expected (quote token decay) due to a rebase down                                                                                                           │
│                     // we first need to handle this by adding base tokens to offset this.                                                                                                                       │
│                     (                                                                                                                                                                                           │
│                         baseTokenQtyFromDecay,                                                                                                                                                                  │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddBaseTokenLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired,                                                                                                                                                                   │
│                         0, // there is no minimum for this particular call since we may use base tokens later.                                                                                                  │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     quoteTokenQtyFromDecay < _quoteTokenQtyDesired &&                                                                                                                                           │
│                     baseTokenQtyFromDecay < _baseTokenQtyDesired                                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // the user still has qty that they desire to contribute to the exchange for liquidity                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                         tokenQtys.quoteTokenQty,                                                                                                                                                                │
│                         tokenQtys.liquidityTokenQty                                                                                                                                                             │
│                     ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired - baseTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                                 │
│                         _quoteTokenQtyDesired - quoteTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                               │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         _quoteTokenReserveQty + quoteTokenQtyFromDecay,                                                                                                                                         │
│                         _totalSupplyOfLiquidityTokens +                                                                                                                                                         │
│                             liquidityTokenQtyFromDecay,                                                                                                                                                         │
│                         _internalBalances // NOTE: these balances have already been updated when we did the decay math.                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 tokenQtys.baseTokenQty += baseTokenQtyFromDecay;                                                                                                                                                │
│                 tokenQtys.quoteTokenQty += quoteTokenQtyFromDecay;                                                                                                                                              │
│                 tokenQtys.liquidityTokenQty += liquidityTokenQtyFromDecay;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.baseTokenQty >= _baseTokenQtyMin,                                                                                                                                                 │
│                     "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                            │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.quoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                               │
│                     "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 // the user is just doing a simple double asset entry / providing both base and quote.                                                                                                          │
│                 (                                                                                                                                                                                               │
│                     tokenQtys.baseTokenQty,                                                                                                                                                                     │
│                     tokenQtys.quoteTokenQty,                                                                                                                                                                    │
│                     tokenQtys.liquidityTokenQty                                                                                                                                                                 │
│                 ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                                   │
│                     _baseTokenQtyDesired,                                                                                                                                                                       │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _baseTokenQtyMin,                                                                                                                                                                           │
│                     _quoteTokenQtyMin,                                                                                                                                                                          │
│                     _quoteTokenReserveQty,                                                                                                                                                                      │
│                     _totalSupplyOfLiquidityTokens,                                                                                                                                                              │
│                     _internalBalances                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // this user will set the initial pricing curve                                                                                                                                                     │
│             require(                                                                                                                                                                                            │
│                 _baseTokenQtyDesired > 0,                                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY_DESIRED"                                                                                                                                                        │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 _quoteTokenQtyDesired > 0,                                                                                                                                                                      │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY_DESIRED"                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             tokenQtys.baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                      │
│             tokenQtys.quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                    │
│             tokenQtys.liquidityTokenQty = sqrt(                                                                                                                                                                 │
│                 _baseTokenQtyDesired * _quoteTokenQtyDesired                                                                                                                                                    │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _internalBalances.baseTokenReserveQty += tokenQtys.baseTokenQty;                                                                                                                                    │
│             _internalBalances.quoteTokenReserveQty += tokenQtys.quoteTokenQty;                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                      │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddLiquidityQuantities(                                                                                                                                                                   │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (TokenQtys memory tokenQtys) {                                                                                                                                                             │
│         if (_totalSupplyOfLiquidityTokens > 0) {                                                                                                                                                                │
│             // we have outstanding liquidity tokens present and an existing price curve                                                                                                                         │
│                                                                                                                                                                                                                 │
│             tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                       │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // we need to take this amount (that will be minted) into account for below calculations                                                                                                            │
│             _totalSupplyOfLiquidityTokens += tokenQtys.liquidityTokenFeeQty;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│             // confirm that we have no beta or alpha decay present                                                                                                                                              │
│             // if we do, we need to resolve that first                                                                                                                                                          │
│             if (                                                                                                                                                                                                │
│                 isSufficientDecayPresent(                                                                                                                                                                       │
│                     _baseTokenReserveQty,                                                                                                                                                                       │
│                     _internalBalances                                                                                                                                                                           │
│                 )                                                                                                                                                                                               │
│             ) {                                                                                                                                                                                                 │
│                 // decay is present and needs to be dealt with by the caller.                                                                                                                                   │
│                                                                                                                                                                                                                 │
│                 uint256 baseTokenQtyFromDecay;                                                                                                                                                                  │
│                 uint256 quoteTokenQtyFromDecay;                                                                                                                                                                 │
│                 uint256 liquidityTokenQtyFromDecay;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     _baseTokenReserveQty > _internalBalances.baseTokenReserveQty                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // we have more base token than expected (base token decay) due to rebase up                                                                                                                │
│                     // we first need to handle this situation by requiring this user                                                                                                                            │
│                     // to add quote tokens                                                                                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         quoteTokenQtyFromDecay,                                                                                                                                                                 │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                              │
│                         _quoteTokenQtyDesired,                                                                                                                                                                  │
│                         0, // there is no minimum for this particular call since we may use quote tokens later.                                                                                                 │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // we have less base token than expected (quote token decay) due to a rebase down                                                                                                           │
│                     // we first need to handle this by adding base tokens to offset this.                                                                                                                       │
│                     (                                                                                                                                                                                           │
│                         baseTokenQtyFromDecay,                                                                                                                                                                  │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddBaseTokenLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired,                                                                                                                                                                   │
│                         0, // there is no minimum for this particular call since we may use base tokens later.                                                                                                  │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     quoteTokenQtyFromDecay < _quoteTokenQtyDesired &&                                                                                                                                           │
│                     baseTokenQtyFromDecay < _baseTokenQtyDesired                                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // the user still has qty that they desire to contribute to the exchange for liquidity                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                         tokenQtys.quoteTokenQty,                                                                                                                                                                │
│                         tokenQtys.liquidityTokenQty                                                                                                                                                             │
│                     ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired - baseTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                                 │
│                         _quoteTokenQtyDesired - quoteTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                               │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         _quoteTokenReserveQty + quoteTokenQtyFromDecay,                                                                                                                                         │
│                         _totalSupplyOfLiquidityTokens +                                                                                                                                                         │
│                             liquidityTokenQtyFromDecay,                                                                                                                                                         │
│                         _internalBalances // NOTE: these balances have already been updated when we did the decay math.                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 tokenQtys.baseTokenQty += baseTokenQtyFromDecay;                                                                                                                                                │
│                 tokenQtys.quoteTokenQty += quoteTokenQtyFromDecay;                                                                                                                                              │
│                 tokenQtys.liquidityTokenQty += liquidityTokenQtyFromDecay;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.baseTokenQty >= _baseTokenQtyMin,                                                                                                                                                 │
│                     "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                            │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.quoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                               │
│                     "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 // the user is just doing a simple double asset entry / providing both base and quote.                                                                                                          │
│                 (                                                                                                                                                                                               │
│                     tokenQtys.baseTokenQty,                                                                                                                                                                     │
│                     tokenQtys.quoteTokenQty,                                                                                                                                                                    │
│                     tokenQtys.liquidityTokenQty                                                                                                                                                                 │
│                 ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                                   │
│                     _baseTokenQtyDesired,                                                                                                                                                                       │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _baseTokenQtyMin,                                                                                                                                                                           │
│                     _quoteTokenQtyMin,                                                                                                                                                                          │
│                     _quoteTokenReserveQty,                                                                                                                                                                      │
│                     _totalSupplyOfLiquidityTokens,                                                                                                                                                              │
│                     _internalBalances                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // this user will set the initial pricing curve                                                                                                                                                     │
│             require(                                                                                                                                                                                            │
│                 _baseTokenQtyDesired > 0,                                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY_DESIRED"                                                                                                                                                        │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 _quoteTokenQtyDesired > 0,                                                                                                                                                                      │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY_DESIRED"                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             tokenQtys.baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                      │
│             tokenQtys.quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                    │
│             tokenQtys.liquidityTokenQty = sqrt(                                                                                                                                                                 │
│                 _baseTokenQtyDesired * _quoteTokenQtyDesired                                                                                                                                                    │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _internalBalances.baseTokenReserveQty += tokenQtys.baseTokenQty;                                                                                                                                    │
│             _internalBalances.quoteTokenReserveQty += tokenQtys.quoteTokenQty;                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddLiquidityQuantities(                                                                                                                                                                   │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (TokenQtys memory tokenQtys) {                                                                                                                                                             │
│         if (_totalSupplyOfLiquidityTokens > 0) {                                                                                                                                                                │
│             // we have outstanding liquidity tokens present and an existing price curve                                                                                                                         │
│                                                                                                                                                                                                                 │
│             tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                       │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // we need to take this amount (that will be minted) into account for below calculations                                                                                                            │
│             _totalSupplyOfLiquidityTokens += tokenQtys.liquidityTokenFeeQty;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│             // confirm that we have no beta or alpha decay present                                                                                                                                              │
│             // if we do, we need to resolve that first                                                                                                                                                          │
│             if (                                                                                                                                                                                                │
│                 isSufficientDecayPresent(                                                                                                                                                                       │
│                     _baseTokenReserveQty,                                                                                                                                                                       │
│                     _internalBalances                                                                                                                                                                           │
│                 )                                                                                                                                                                                               │
│             ) {                                                                                                                                                                                                 │
│                 // decay is present and needs to be dealt with by the caller.                                                                                                                                   │
│                                                                                                                                                                                                                 │
│                 uint256 baseTokenQtyFromDecay;                                                                                                                                                                  │
│                 uint256 quoteTokenQtyFromDecay;                                                                                                                                                                 │
│                 uint256 liquidityTokenQtyFromDecay;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     _baseTokenReserveQty > _internalBalances.baseTokenReserveQty                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // we have more base token than expected (base token decay) due to rebase up                                                                                                                │
│                     // we first need to handle this situation by requiring this user                                                                                                                            │
│                     // to add quote tokens                                                                                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         quoteTokenQtyFromDecay,                                                                                                                                                                 │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                              │
│                         _quoteTokenQtyDesired,                                                                                                                                                                  │
│                         0, // there is no minimum for this particular call since we may use quote tokens later.                                                                                                 │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // we have less base token than expected (quote token decay) due to a rebase down                                                                                                           │
│                     // we first need to handle this by adding base tokens to offset this.                                                                                                                       │
│                     (                                                                                                                                                                                           │
│                         baseTokenQtyFromDecay,                                                                                                                                                                  │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddBaseTokenLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired,                                                                                                                                                                   │
│                         0, // there is no minimum for this particular call since we may use base tokens later.                                                                                                  │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     quoteTokenQtyFromDecay < _quoteTokenQtyDesired &&                                                                                                                                           │
│                     baseTokenQtyFromDecay < _baseTokenQtyDesired                                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // the user still has qty that they desire to contribute to the exchange for liquidity                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                         tokenQtys.quoteTokenQty,                                                                                                                                                                │
│                         tokenQtys.liquidityTokenQty                                                                                                                                                             │
│                     ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired - baseTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                                 │
│                         _quoteTokenQtyDesired - quoteTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                               │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         _quoteTokenReserveQty + quoteTokenQtyFromDecay,                                                                                                                                         │
│                         _totalSupplyOfLiquidityTokens +                                                                                                                                                         │
│                             liquidityTokenQtyFromDecay,                                                                                                                                                         │
│                         _internalBalances // NOTE: these balances have already been updated when we did the decay math.                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 tokenQtys.baseTokenQty += baseTokenQtyFromDecay;                                                                                                                                                │
│                 tokenQtys.quoteTokenQty += quoteTokenQtyFromDecay;                                                                                                                                              │
│                 tokenQtys.liquidityTokenQty += liquidityTokenQtyFromDecay;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.baseTokenQty >= _baseTokenQtyMin,                                                                                                                                                 │
│                     "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                            │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.quoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                               │
│                     "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 // the user is just doing a simple double asset entry / providing both base and quote.                                                                                                          │
│                 (                                                                                                                                                                                               │
│                     tokenQtys.baseTokenQty,                                                                                                                                                                     │
│                     tokenQtys.quoteTokenQty,                                                                                                                                                                    │
│                     tokenQtys.liquidityTokenQty                                                                                                                                                                 │
│                 ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                                   │
│                     _baseTokenQtyDesired,                                                                                                                                                                       │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _baseTokenQtyMin,                                                                                                                                                                           │
│                     _quoteTokenQtyMin,                                                                                                                                                                          │
│                     _quoteTokenReserveQty,                                                                                                                                                                      │
│                     _totalSupplyOfLiquidityTokens,                                                                                                                                                              │
│                     _internalBalances                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // this user will set the initial pricing curve                                                                                                                                                     │
│             require(                                                                                                                                                                                            │
│                 _baseTokenQtyDesired > 0,                                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY_DESIRED"                                                                                                                                                        │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 _quoteTokenQtyDesired > 0,                                                                                                                                                                      │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY_DESIRED"                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             tokenQtys.baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                      │
│             tokenQtys.quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                    │
│             tokenQtys.liquidityTokenQty = sqrt(                                                                                                                                                                 │
│                 _baseTokenQtyDesired * _quoteTokenQtyDesired                                                                                                                                                    │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _internalBalances.baseTokenReserveQty += tokenQtys.baseTokenQty;                                                                                                                                    │
│             _internalBalances.quoteTokenReserveQty += tokenQtys.quoteTokenQty;                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve calculating swap/liquidity or adding liquidity, and there is asset exchanges or price queries,                                                                                               │
│ have code statements that get or calculate LP token's value/price                                                                                                                                               │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddTokenPairLiquidityQuantities(                                                                                                                                                          │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     )                                                                                                                                                                                                           │
│         public                                                                                                                                                                                                  │
│         returns (                                                                                                                                                                                               │
│             uint256 baseTokenQty,                                                                                                                                                                               │
│             uint256 quoteTokenQty,                                                                                                                                                                              │
│             uint256 liquidityTokenQty                                                                                                                                                                           │
│         )                                                                                                                                                                                                       │
│     {                                                                                                                                                                                                           │
│         uint256 requiredQuoteTokenQty =                                                                                                                                                                         │
│             calculateQty(                                                                                                                                                                                       │
│                 _baseTokenQtyDesired,                                                                                                                                                                           │
│                 _internalBalances.baseTokenReserveQty,                                                                                                                                                          │
│                 _internalBalances.quoteTokenReserveQty                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         if (requiredQuoteTokenQty <= _quoteTokenQtyDesired) {                                                                                                                                                   │
│             // user has to provide less than their desired amount                                                                                                                                               │
│             require(                                                                                                                                                                                            │
│                 requiredQuoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                                     │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│             baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                                │
│             quoteTokenQty = requiredQuoteTokenQty;                                                                                                                                                              │
│         } else {                                                                                                                                                                                                │
│             // we need to check the opposite way.                                                                                                                                                               │
│             uint256 requiredBaseTokenQty =                                                                                                                                                                      │
│                 calculateQty(                                                                                                                                                                                   │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _internalBalances.quoteTokenReserveQty,                                                                                                                                                     │
│                     _internalBalances.baseTokenReserveQty                                                                                                                                                       │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│             require(                                                                                                                                                                                            │
│                 requiredBaseTokenQty >= _baseTokenQtyMin,                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                                │
│             );                                                                                                                                                                                                  │
│             baseTokenQty = requiredBaseTokenQty;                                                                                                                                                                │
│             quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         liquidityTokenQty = calculateLiquidityTokenQtyForDoubleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             quoteTokenQty,                                                                                                                                                                                      │
│             _quoteTokenReserveQty                                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         _internalBalances.baseTokenReserveQty += baseTokenQty;                                                                                                                                                  │
│         _internalBalances.quoteTokenReserveQty += quoteTokenQty;                                                                                                                                                │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes",                                                                                                                                                                                                 │
│     "2": "No",                                                                                                                                                                                                  │
│     "3": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve calculating swap/liquidity or adding liquidity, and there is asset exchanges or price queries, but this operation could be attacked by slippage/Sandwich Attack due to no slip limit/minimum │
│ value check                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddTokenPairLiquidityQuantities(                                                                                                                                                          │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     )                                                                                                                                                                                                           │
│         public                                                                                                                                                                                                  │
│         returns (                                                                                                                                                                                               │
│             uint256 baseTokenQty,                                                                                                                                                                               │
│             uint256 quoteTokenQty,                                                                                                                                                                              │
│             uint256 liquidityTokenQty                                                                                                                                                                           │
│         )                                                                                                                                                                                                       │
│     {                                                                                                                                                                                                           │
│         uint256 requiredQuoteTokenQty =                                                                                                                                                                         │
│             calculateQty(                                                                                                                                                                                       │
│                 _baseTokenQtyDesired,                                                                                                                                                                           │
│                 _internalBalances.baseTokenReserveQty,                                                                                                                                                          │
│                 _internalBalances.quoteTokenReserveQty                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         if (requiredQuoteTokenQty <= _quoteTokenQtyDesired) {                                                                                                                                                   │
│             // user has to provide less than their desired amount                                                                                                                                               │
│             require(                                                                                                                                                                                            │
│                 requiredQuoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                                     │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│             baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                                │
│             quoteTokenQty = requiredQuoteTokenQty;                                                                                                                                                              │
│         } else {                                                                                                                                                                                                │
│             // we need to check the opposite way.                                                                                                                                                               │
│             uint256 requiredBaseTokenQty =                                                                                                                                                                      │
│                 calculateQty(                                                                                                                                                                                   │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _internalBalances.quoteTokenReserveQty,                                                                                                                                                     │
│                     _internalBalances.baseTokenReserveQty                                                                                                                                                       │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│             require(                                                                                                                                                                                            │
│                 requiredBaseTokenQty >= _baseTokenQtyMin,                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                                │
│             );                                                                                                                                                                                                  │
│             baseTokenQty = requiredBaseTokenQty;                                                                                                                                                                │
│             quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         liquidityTokenQty = calculateLiquidityTokenQtyForDoubleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             quoteTokenQty,                                                                                                                                                                                      │
│             _quoteTokenReserveQty                                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         _internalBalances.baseTokenReserveQty += baseTokenQty;                                                                                                                                                  │
│         _internalBalances.quoteTokenReserveQty += quoteTokenQty;                                                                                                                                                │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddTokenPairLiquidityQuantities(                                                                                                                                                          │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     )                                                                                                                                                                                                           │
│         public                                                                                                                                                                                                  │
│         returns (                                                                                                                                                                                               │
│             uint256 baseTokenQty,                                                                                                                                                                               │
│             uint256 quoteTokenQty,                                                                                                                                                                              │
│             uint256 liquidityTokenQty                                                                                                                                                                           │
│         )                                                                                                                                                                                                       │
│     {                                                                                                                                                                                                           │
│         uint256 requiredQuoteTokenQty =                                                                                                                                                                         │
│             calculateQty(                                                                                                                                                                                       │
│                 _baseTokenQtyDesired,                                                                                                                                                                           │
│                 _internalBalances.baseTokenReserveQty,                                                                                                                                                          │
│                 _internalBalances.quoteTokenReserveQty                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         if (requiredQuoteTokenQty <= _quoteTokenQtyDesired) {                                                                                                                                                   │
│             // user has to provide less than their desired amount                                                                                                                                               │
│             require(                                                                                                                                                                                            │
│                 requiredQuoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                                     │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│             baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                                │
│             quoteTokenQty = requiredQuoteTokenQty;                                                                                                                                                              │
│         } else {                                                                                                                                                                                                │
│             // we need to check the opposite way.                                                                                                                                                               │
│             uint256 requiredBaseTokenQty =                                                                                                                                                                      │
│                 calculateQty(                                                                                                                                                                                   │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _internalBalances.quoteTokenReserveQty,                                                                                                                                                     │
│                     _internalBalances.baseTokenReserveQty                                                                                                                                                       │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│             require(                                                                                                                                                                                            │
│                 requiredBaseTokenQty >= _baseTokenQtyMin,                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                                │
│             );                                                                                                                                                                                                  │
│             baseTokenQty = requiredBaseTokenQty;                                                                                                                                                                │
│             quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         liquidityTokenQty = calculateLiquidityTokenQtyForDoubleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             quoteTokenQty,                                                                                                                                                                                      │
│             _quoteTokenReserveQty                                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         _internalBalances.baseTokenReserveQty += baseTokenQty;                                                                                                                                                  │
│         _internalBalances.quoteTokenReserveQty += quoteTokenQty;                                                                                                                                                │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve calculating swap/liquidity or adding liquidity, and there is asset exchanges or price queries,                                                                                               │
│ have code statements that get or calculate LP token's value/price                                                                                                                                               │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddLiquidityQuantities(                                                                                                                                                                   │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (TokenQtys memory tokenQtys) {                                                                                                                                                             │
│         if (_totalSupplyOfLiquidityTokens > 0) {                                                                                                                                                                │
│             // we have outstanding liquidity tokens present and an existing price curve                                                                                                                         │
│                                                                                                                                                                                                                 │
│             tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                       │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // we need to take this amount (that will be minted) into account for below calculations                                                                                                            │
│             _totalSupplyOfLiquidityTokens += tokenQtys.liquidityTokenFeeQty;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│             // confirm that we have no beta or alpha decay present                                                                                                                                              │
│             // if we do, we need to resolve that first                                                                                                                                                          │
│             if (                                                                                                                                                                                                │
│                 isSufficientDecayPresent(                                                                                                                                                                       │
│                     _baseTokenReserveQty,                                                                                                                                                                       │
│                     _internalBalances                                                                                                                                                                           │
│                 )                                                                                                                                                                                               │
│             ) {                                                                                                                                                                                                 │
│                 // decay is present and needs to be dealt with by the caller.                                                                                                                                   │
│                                                                                                                                                                                                                 │
│                 uint256 baseTokenQtyFromDecay;                                                                                                                                                                  │
│                 uint256 quoteTokenQtyFromDecay;                                                                                                                                                                 │
│                 uint256 liquidityTokenQtyFromDecay;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     _baseTokenReserveQty > _internalBalances.baseTokenReserveQty                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // we have more base token than expected (base token decay) due to rebase up                                                                                                                │
│                     // we first need to handle this situation by requiring this user                                                                                                                            │
│                     // to add quote tokens                                                                                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         quoteTokenQtyFromDecay,                                                                                                                                                                 │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                              │
│                         _quoteTokenQtyDesired,                                                                                                                                                                  │
│                         0, // there is no minimum for this particular call since we may use quote tokens later.                                                                                                 │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // we have less base token than expected (quote token decay) due to a rebase down                                                                                                           │
│                     // we first need to handle this by adding base tokens to offset this.                                                                                                                       │
│                     (                                                                                                                                                                                           │
│                         baseTokenQtyFromDecay,                                                                                                                                                                  │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddBaseTokenLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired,                                                                                                                                                                   │
│                         0, // there is no minimum for this particular call since we may use base tokens later.                                                                                                  │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     quoteTokenQtyFromDecay < _quoteTokenQtyDesired &&                                                                                                                                           │
│                     baseTokenQtyFromDecay < _baseTokenQtyDesired                                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // the user still has qty that they desire to contribute to the exchange for liquidity                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                         tokenQtys.quoteTokenQty,                                                                                                                                                                │
│                         tokenQtys.liquidityTokenQty                                                                                                                                                             │
│                     ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired - baseTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                                 │
│                         _quoteTokenQtyDesired - quoteTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                               │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         _quoteTokenReserveQty + quoteTokenQtyFromDecay,                                                                                                                                         │
│                         _totalSupplyOfLiquidityTokens +                                                                                                                                                         │
│                             liquidityTokenQtyFromDecay,                                                                                                                                                         │
│                         _internalBalances // NOTE: these balances have already been updated when we did the decay math.                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 tokenQtys.baseTokenQty += baseTokenQtyFromDecay;                                                                                                                                                │
│                 tokenQtys.quoteTokenQty += quoteTokenQtyFromDecay;                                                                                                                                              │
│                 tokenQtys.liquidityTokenQty += liquidityTokenQtyFromDecay;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.baseTokenQty >= _baseTokenQtyMin,                                                                                                                                                 │
│                     "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                            │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.quoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                               │
│                     "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 // the user is just doing a simple double asset entry / providing both base and quote.                                                                                                          │
│                 (                                                                                                                                                                                               │
│                     tokenQtys.baseTokenQty,                                                                                                                                                                     │
│                     tokenQtys.quoteTokenQty,                                                                                                                                                                    │
│                     tokenQtys.liquidityTokenQty                                                                                                                                                                 │
│                 ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                                   │
│                     _baseTokenQtyDesired,                                                                                                                                                                       │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _baseTokenQtyMin,                                                                                                                                                                           │
│                     _quoteTokenQtyMin,                                                                                                                                                                          │
│                     _quoteTokenReserveQty,                                                                                                                                                                      │
│                     _totalSupplyOfLiquidityTokens,                                                                                                                                                              │
│                     _internalBalances                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // this user will set the initial pricing curve                                                                                                                                                     │
│             require(                                                                                                                                                                                            │
│                 _baseTokenQtyDesired > 0,                                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY_DESIRED"                                                                                                                                                        │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 _quoteTokenQtyDesired > 0,                                                                                                                                                                      │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY_DESIRED"                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             tokenQtys.baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                      │
│             tokenQtys.quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                    │
│             tokenQtys.liquidityTokenQty = sqrt(                                                                                                                                                                 │
│                 _baseTokenQtyDesired * _quoteTokenQtyDesired                                                                                                                                                    │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _internalBalances.baseTokenReserveQty += tokenQtys.baseTokenQty;                                                                                                                                    │
│             _internalBalances.quoteTokenReserveQty += tokenQtys.quoteTokenQty;                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function calculateAddTokenPairLiquidityQuantities(                                                                                                                                                          │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     )                                                                                                                                                                                                           │
│         public                                                                                                                                                                                                  │
│         returns (                                                                                                                                                                                               │
│             uint256 baseTokenQty,                                                                                                                                                                               │
│             uint256 quoteTokenQty,                                                                                                                                                                              │
│             uint256 liquidityTokenQty                                                                                                                                                                           │
│         )                                                                                                                                                                                                       │
│     {                                                                                                                                                                                                           │
│         uint256 requiredQuoteTokenQty =                                                                                                                                                                         │
│             calculateQty(                                                                                                                                                                                       │
│                 _baseTokenQtyDesired,                                                                                                                                                                           │
│                 _internalBalances.baseTokenReserveQty,                                                                                                                                                          │
│                 _internalBalances.quoteTokenReserveQty                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         if (requiredQuoteTokenQty <= _quoteTokenQtyDesired) {                                                                                                                                                   │
│             // user has to provide less than their desired amount                                                                                                                                               │
│             require(                                                                                                                                                                                            │
│                 requiredQuoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                                     │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│             baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                                │
│             quoteTokenQty = requiredQuoteTokenQty;                                                                                                                                                              │
│         } else {                                                                                                                                                                                                │
│             // we need to check the opposite way.                                                                                                                                                               │
│             uint256 requiredBaseTokenQty =                                                                                                                                                                      │
│                 calculateQty(                                                                                                                                                                                   │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _internalBalances.quoteTokenReserveQty,                                                                                                                                                     │
│                     _internalBalances.baseTokenReserveQty                                                                                                                                                       │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│             require(                                                                                                                                                                                            │
│                 requiredBaseTokenQty >= _baseTokenQtyMin,                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                                │
│             );                                                                                                                                                                                                  │
│             baseTokenQty = requiredBaseTokenQty;                                                                                                                                                                │
│             quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         liquidityTokenQty = calculateLiquidityTokenQtyForDoubleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             quoteTokenQty,                                                                                                                                                                                      │
│             _quoteTokenReserveQty                                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         _internalBalances.baseTokenReserveQty += baseTokenQty;                                                                                                                                                  │
│         _internalBalances.quoteTokenReserveQty += quoteTokenQty;                                                                                                                                                │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes",                                                                                                                                                                                                 │
│     "2": "Yes",                                                                                                                                                                                                 │
│     "3": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve calculating swap/liquidity or adding liquidity, and there is asset exchanges or price queries, but this operation could be attacked by slippage/Sandwich Attack due to no slip limit/minimum │
│ value check                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddLiquidityQuantities(                                                                                                                                                                   │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (TokenQtys memory tokenQtys) {                                                                                                                                                             │
│         if (_totalSupplyOfLiquidityTokens > 0) {                                                                                                                                                                │
│             // we have outstanding liquidity tokens present and an existing price curve                                                                                                                         │
│                                                                                                                                                                                                                 │
│             tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                       │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // we need to take this amount (that will be minted) into account for below calculations                                                                                                            │
│             _totalSupplyOfLiquidityTokens += tokenQtys.liquidityTokenFeeQty;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│             // confirm that we have no beta or alpha decay present                                                                                                                                              │
│             // if we do, we need to resolve that first                                                                                                                                                          │
│             if (                                                                                                                                                                                                │
│                 isSufficientDecayPresent(                                                                                                                                                                       │
│                     _baseTokenReserveQty,                                                                                                                                                                       │
│                     _internalBalances                                                                                                                                                                           │
│                 )                                                                                                                                                                                               │
│             ) {                                                                                                                                                                                                 │
│                 // decay is present and needs to be dealt with by the caller.                                                                                                                                   │
│                                                                                                                                                                                                                 │
│                 uint256 baseTokenQtyFromDecay;                                                                                                                                                                  │
│                 uint256 quoteTokenQtyFromDecay;                                                                                                                                                                 │
│                 uint256 liquidityTokenQtyFromDecay;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     _baseTokenReserveQty > _internalBalances.baseTokenReserveQty                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // we have more base token than expected (base token decay) due to rebase up                                                                                                                │
│                     // we first need to handle this situation by requiring this user                                                                                                                            │
│                     // to add quote tokens                                                                                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         quoteTokenQtyFromDecay,                                                                                                                                                                 │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                              │
│                         _quoteTokenQtyDesired,                                                                                                                                                                  │
│                         0, // there is no minimum for this particular call since we may use quote tokens later.                                                                                                 │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // we have less base token than expected (quote token decay) due to a rebase down                                                                                                           │
│                     // we first need to handle this by adding base tokens to offset this.                                                                                                                       │
│                     (                                                                                                                                                                                           │
│                         baseTokenQtyFromDecay,                                                                                                                                                                  │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddBaseTokenLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired,                                                                                                                                                                   │
│                         0, // there is no minimum for this particular call since we may use base tokens later.                                                                                                  │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     quoteTokenQtyFromDecay < _quoteTokenQtyDesired &&                                                                                                                                           │
│                     baseTokenQtyFromDecay < _baseTokenQtyDesired                                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // the user still has qty that they desire to contribute to the exchange for liquidity                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                         tokenQtys.quoteTokenQty,                                                                                                                                                                │
│                         tokenQtys.liquidityTokenQty                                                                                                                                                             │
│                     ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired - baseTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                                 │
│                         _quoteTokenQtyDesired - quoteTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                               │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         _quoteTokenReserveQty + quoteTokenQtyFromDecay,                                                                                                                                         │
│                         _totalSupplyOfLiquidityTokens +                                                                                                                                                         │
│                             liquidityTokenQtyFromDecay,                                                                                                                                                         │
│                         _internalBalances // NOTE: these balances have already been updated when we did the decay math.                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 tokenQtys.baseTokenQty += baseTokenQtyFromDecay;                                                                                                                                                │
│                 tokenQtys.quoteTokenQty += quoteTokenQtyFromDecay;                                                                                                                                              │
│                 tokenQtys.liquidityTokenQty += liquidityTokenQtyFromDecay;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.baseTokenQty >= _baseTokenQtyMin,                                                                                                                                                 │
│                     "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                            │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.quoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                               │
│                     "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 // the user is just doing a simple double asset entry / providing both base and quote.                                                                                                          │
│                 (                                                                                                                                                                                               │
│                     tokenQtys.baseTokenQty,                                                                                                                                                                     │
│                     tokenQtys.quoteTokenQty,                                                                                                                                                                    │
│                     tokenQtys.liquidityTokenQty                                                                                                                                                                 │
│                 ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                                   │
│                     _baseTokenQtyDesired,                                                                                                                                                                       │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _baseTokenQtyMin,                                                                                                                                                                           │
│                     _quoteTokenQtyMin,                                                                                                                                                                          │
│                     _quoteTokenReserveQty,                                                                                                                                                                      │
│                     _totalSupplyOfLiquidityTokens,                                                                                                                                                              │
│                     _internalBalances                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // this user will set the initial pricing curve                                                                                                                                                     │
│             require(                                                                                                                                                                                            │
│                 _baseTokenQtyDesired > 0,                                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY_DESIRED"                                                                                                                                                        │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 _quoteTokenQtyDesired > 0,                                                                                                                                                                      │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY_DESIRED"                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             tokenQtys.baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                      │
│             tokenQtys.quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                    │
│             tokenQtys.liquidityTokenQty = sqrt(                                                                                                                                                                 │
│                 _baseTokenQtyDesired * _quoteTokenQtyDesired                                                                                                                                                    │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _internalBalances.baseTokenReserveQty += tokenQtys.baseTokenQty;                                                                                                                                    │
│             _internalBalances.quoteTokenReserveQty += tokenQtys.quoteTokenQty;                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function calculateAddTokenPairLiquidityQuantities(                                                                                                                                                          │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     )                                                                                                                                                                                                           │
│         public                                                                                                                                                                                                  │
│         returns (                                                                                                                                                                                               │
│             uint256 baseTokenQty,                                                                                                                                                                               │
│             uint256 quoteTokenQty,                                                                                                                                                                              │
│             uint256 liquidityTokenQty                                                                                                                                                                           │
│         )                                                                                                                                                                                                       │
│     {                                                                                                                                                                                                           │
│         uint256 requiredQuoteTokenQty =                                                                                                                                                                         │
│             calculateQty(                                                                                                                                                                                       │
│                 _baseTokenQtyDesired,                                                                                                                                                                           │
│                 _internalBalances.baseTokenReserveQty,                                                                                                                                                          │
│                 _internalBalances.quoteTokenReserveQty                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         if (requiredQuoteTokenQty <= _quoteTokenQtyDesired) {                                                                                                                                                   │
│             // user has to provide less than their desired amount                                                                                                                                               │
│             require(                                                                                                                                                                                            │
│                 requiredQuoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                                     │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│             baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                                │
│             quoteTokenQty = requiredQuoteTokenQty;                                                                                                                                                              │
│         } else {                                                                                                                                                                                                │
│             // we need to check the opposite way.                                                                                                                                                               │
│             uint256 requiredBaseTokenQty =                                                                                                                                                                      │
│                 calculateQty(                                                                                                                                                                                   │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _internalBalances.quoteTokenReserveQty,                                                                                                                                                     │
│                     _internalBalances.baseTokenReserveQty                                                                                                                                                       │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│             require(                                                                                                                                                                                            │
│                 requiredBaseTokenQty >= _baseTokenQtyMin,                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                                │
│             );                                                                                                                                                                                                  │
│             baseTokenQty = requiredBaseTokenQty;                                                                                                                                                                │
│             quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         liquidityTokenQty = calculateLiquidityTokenQtyForDoubleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             quoteTokenQty,                                                                                                                                                                                      │
│             _quoteTokenReserveQty                                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         _internalBalances.baseTokenReserveQty += baseTokenQty;                                                                                                                                                  │
│         _internalBalances.quoteTokenReserveQty += quoteTokenQty;                                                                                                                                                │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price based on the market reserves/AMMprice/exchangeRate OR the custom token balanceOf/totalSupply/amount/liquidity calculation          │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddLiquidityQuantities(                                                                                                                                                                   │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (TokenQtys memory tokenQtys) {                                                                                                                                                             │
│         if (_totalSupplyOfLiquidityTokens > 0) {                                                                                                                                                                │
│             // we have outstanding liquidity tokens present and an existing price curve                                                                                                                         │
│                                                                                                                                                                                                                 │
│             tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                       │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // we need to take this amount (that will be minted) into account for below calculations                                                                                                            │
│             _totalSupplyOfLiquidityTokens += tokenQtys.liquidityTokenFeeQty;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│             // confirm that we have no beta or alpha decay present                                                                                                                                              │
│             // if we do, we need to resolve that first                                                                                                                                                          │
│             if (                                                                                                                                                                                                │
│                 isSufficientDecayPresent(                                                                                                                                                                       │
│                     _baseTokenReserveQty,                                                                                                                                                                       │
│                     _internalBalances                                                                                                                                                                           │
│                 )                                                                                                                                                                                               │
│             ) {                                                                                                                                                                                                 │
│                 // decay is present and needs to be dealt with by the caller.                                                                                                                                   │
│                                                                                                                                                                                                                 │
│                 uint256 baseTokenQtyFromDecay;                                                                                                                                                                  │
│                 uint256 quoteTokenQtyFromDecay;                                                                                                                                                                 │
│                 uint256 liquidityTokenQtyFromDecay;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     _baseTokenReserveQty > _internalBalances.baseTokenReserveQty                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // we have more base token than expected (base token decay) due to rebase up                                                                                                                │
│                     // we first need to handle this situation by requiring this user                                                                                                                            │
│                     // to add quote tokens                                                                                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         quoteTokenQtyFromDecay,                                                                                                                                                                 │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                              │
│                         _quoteTokenQtyDesired,                                                                                                                                                                  │
│                         0, // there is no minimum for this particular call since we may use quote tokens later.                                                                                                 │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // we have less base token than expected (quote token decay) due to a rebase down                                                                                                           │
│                     // we first need to handle this by adding base tokens to offset this.                                                                                                                       │
│                     (                                                                                                                                                                                           │
│                         baseTokenQtyFromDecay,                                                                                                                                                                  │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddBaseTokenLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired,                                                                                                                                                                   │
│                         0, // there is no minimum for this particular call since we may use base tokens later.                                                                                                  │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     quoteTokenQtyFromDecay < _quoteTokenQtyDesired &&                                                                                                                                           │
│                     baseTokenQtyFromDecay < _baseTokenQtyDesired                                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // the user still has qty that they desire to contribute to the exchange for liquidity                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                         tokenQtys.quoteTokenQty,                                                                                                                                                                │
│                         tokenQtys.liquidityTokenQty                                                                                                                                                             │
│                     ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired - baseTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                                 │
│                         _quoteTokenQtyDesired - quoteTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                               │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         _quoteTokenReserveQty + quoteTokenQtyFromDecay,                                                                                                                                         │
│                         _totalSupplyOfLiquidityTokens +                                                                                                                                                         │
│                             liquidityTokenQtyFromDecay,                                                                                                                                                         │
│                         _internalBalances // NOTE: these balances have already been updated when we did the decay math.                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 tokenQtys.baseTokenQty += baseTokenQtyFromDecay;                                                                                                                                                │
│                 tokenQtys.quoteTokenQty += quoteTokenQtyFromDecay;                                                                                                                                              │
│                 tokenQtys.liquidityTokenQty += liquidityTokenQtyFromDecay;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.baseTokenQty >= _baseTokenQtyMin,                                                                                                                                                 │
│                     "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                            │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.quoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                               │
│                     "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 // the user is just doing a simple double asset entry / providing both base and quote.                                                                                                          │
│                 (                                                                                                                                                                                               │
│                     tokenQtys.baseTokenQty,                                                                                                                                                                     │
│                     tokenQtys.quoteTokenQty,                                                                                                                                                                    │
│                     tokenQtys.liquidityTokenQty                                                                                                                                                                 │
│                 ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                                   │
│                     _baseTokenQtyDesired,                                                                                                                                                                       │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _baseTokenQtyMin,                                                                                                                                                                           │
│                     _quoteTokenQtyMin,                                                                                                                                                                          │
│                     _quoteTokenReserveQty,                                                                                                                                                                      │
│                     _totalSupplyOfLiquidityTokens,                                                                                                                                                              │
│                     _internalBalances                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // this user will set the initial pricing curve                                                                                                                                                     │
│             require(                                                                                                                                                                                            │
│                 _baseTokenQtyDesired > 0,                                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY_DESIRED"                                                                                                                                                        │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 _quoteTokenQtyDesired > 0,                                                                                                                                                                      │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY_DESIRED"                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             tokenQtys.baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                      │
│             tokenQtys.quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                    │
│             tokenQtys.liquidityTokenQty = sqrt(                                                                                                                                                                 │
│                 _baseTokenQtyDesired * _quoteTokenQtyDesired                                                                                                                                                    │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _internalBalances.baseTokenReserveQty += tokenQtys.baseTokenQty;                                                                                                                                    │
│             _internalBalances.quoteTokenReserveQty += tokenQtys.quoteTokenQty;                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function calculateAddTokenPairLiquidityQuantities(                                                                                                                                                          │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     )                                                                                                                                                                                                           │
│         public                                                                                                                                                                                                  │
│         returns (                                                                                                                                                                                               │
│             uint256 baseTokenQty,                                                                                                                                                                               │
│             uint256 quoteTokenQty,                                                                                                                                                                              │
│             uint256 liquidityTokenQty                                                                                                                                                                           │
│         )                                                                                                                                                                                                       │
│     {                                                                                                                                                                                                           │
│         uint256 requiredQuoteTokenQty =                                                                                                                                                                         │
│             calculateQty(                                                                                                                                                                                       │
│                 _baseTokenQtyDesired,                                                                                                                                                                           │
│                 _internalBalances.baseTokenReserveQty,                                                                                                                                                          │
│                 _internalBalances.quoteTokenReserveQty                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         if (requiredQuoteTokenQty <= _quoteTokenQtyDesired) {                                                                                                                                                   │
│             // user has to provide less than their desired amount                                                                                                                                               │
│             require(                                                                                                                                                                                            │
│                 requiredQuoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                                     │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│             baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                                │
│             quoteTokenQty = requiredQuoteTokenQty;                                                                                                                                                              │
│         } else {                                                                                                                                                                                                │
│             // we need to check the opposite way.                                                                                                                                                               │
│             uint256 requiredBaseTokenQty =                                                                                                                                                                      │
│                 calculateQty(                                                                                                                                                                                   │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _internalBalances.quoteTokenReserveQty,                                                                                                                                                     │
│                     _internalBalances.baseTokenReserveQty                                                                                                                                                       │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│             require(                                                                                                                                                                                            │
│                 requiredBaseTokenQty >= _baseTokenQtyMin,                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                                │
│             );                                                                                                                                                                                                  │
│             baseTokenQty = requiredBaseTokenQty;                                                                                                                                                                │
│             quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         liquidityTokenQty = calculateLiquidityTokenQtyForDoubleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             quoteTokenQty,                                                                                                                                                                                      │
│             _quoteTokenReserveQty                                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         _internalBalances.baseTokenReserveQty += baseTokenQty;                                                                                                                                                  │
│         _internalBalances.quoteTokenReserveQty += quoteTokenQty;                                                                                                                                                │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddLiquidityQuantities(                                                                                                                                                                   │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (TokenQtys memory tokenQtys) {                                                                                                                                                             │
│         if (_totalSupplyOfLiquidityTokens > 0) {                                                                                                                                                                │
│             // we have outstanding liquidity tokens present and an existing price curve                                                                                                                         │
│                                                                                                                                                                                                                 │
│             tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                       │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // we need to take this amount (that will be minted) into account for below calculations                                                                                                            │
│             _totalSupplyOfLiquidityTokens += tokenQtys.liquidityTokenFeeQty;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│             // confirm that we have no beta or alpha decay present                                                                                                                                              │
│             // if we do, we need to resolve that first                                                                                                                                                          │
│             if (                                                                                                                                                                                                │
│                 isSufficientDecayPresent(                                                                                                                                                                       │
│                     _baseTokenReserveQty,                                                                                                                                                                       │
│                     _internalBalances                                                                                                                                                                           │
│                 )                                                                                                                                                                                               │
│             ) {                                                                                                                                                                                                 │
│                 // decay is present and needs to be dealt with by the caller.                                                                                                                                   │
│                                                                                                                                                                                                                 │
│                 uint256 baseTokenQtyFromDecay;                                                                                                                                                                  │
│                 uint256 quoteTokenQtyFromDecay;                                                                                                                                                                 │
│                 uint256 liquidityTokenQtyFromDecay;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     _baseTokenReserveQty > _internalBalances.baseTokenReserveQty                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // we have more base token than expected (base token decay) due to rebase up                                                                                                                │
│                     // we first need to handle this situation by requiring this user                                                                                                                            │
│                     // to add quote tokens                                                                                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         quoteTokenQtyFromDecay,                                                                                                                                                                 │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                              │
│                         _quoteTokenQtyDesired,                                                                                                                                                                  │
│                         0, // there is no minimum for this particular call since we may use quote tokens later.                                                                                                 │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // we have less base token than expected (quote token decay) due to a rebase down                                                                                                           │
│                     // we first need to handle this by adding base tokens to offset this.                                                                                                                       │
│                     (                                                                                                                                                                                           │
│                         baseTokenQtyFromDecay,                                                                                                                                                                  │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddBaseTokenLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired,                                                                                                                                                                   │
│                         0, // there is no minimum for this particular call since we may use base tokens later.                                                                                                  │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     quoteTokenQtyFromDecay < _quoteTokenQtyDesired &&                                                                                                                                           │
│                     baseTokenQtyFromDecay < _baseTokenQtyDesired                                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // the user still has qty that they desire to contribute to the exchange for liquidity                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                         tokenQtys.quoteTokenQty,                                                                                                                                                                │
│                         tokenQtys.liquidityTokenQty                                                                                                                                                             │
│                     ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired - baseTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                                 │
│                         _quoteTokenQtyDesired - quoteTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                               │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         _quoteTokenReserveQty + quoteTokenQtyFromDecay,                                                                                                                                         │
│                         _totalSupplyOfLiquidityTokens +                                                                                                                                                         │
│                             liquidityTokenQtyFromDecay,                                                                                                                                                         │
│                         _internalBalances // NOTE: these balances have already been updated when we did the decay math.                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 tokenQtys.baseTokenQty += baseTokenQtyFromDecay;                                                                                                                                                │
│                 tokenQtys.quoteTokenQty += quoteTokenQtyFromDecay;                                                                                                                                              │
│                 tokenQtys.liquidityTokenQty += liquidityTokenQtyFromDecay;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.baseTokenQty >= _baseTokenQtyMin,                                                                                                                                                 │
│                     "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                            │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.quoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                               │
│                     "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 // the user is just doing a simple double asset entry / providing both base and quote.                                                                                                          │
│                 (                                                                                                                                                                                               │
│                     tokenQtys.baseTokenQty,                                                                                                                                                                     │
│                     tokenQtys.quoteTokenQty,                                                                                                                                                                    │
│                     tokenQtys.liquidityTokenQty                                                                                                                                                                 │
│                 ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                                   │
│                     _baseTokenQtyDesired,                                                                                                                                                                       │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _baseTokenQtyMin,                                                                                                                                                                           │
│                     _quoteTokenQtyMin,                                                                                                                                                                          │
│                     _quoteTokenReserveQty,                                                                                                                                                                      │
│                     _totalSupplyOfLiquidityTokens,                                                                                                                                                              │
│                     _internalBalances                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // this user will set the initial pricing curve                                                                                                                                                     │
│             require(                                                                                                                                                                                            │
│                 _baseTokenQtyDesired > 0,                                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY_DESIRED"                                                                                                                                                        │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 _quoteTokenQtyDesired > 0,                                                                                                                                                                      │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY_DESIRED"                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             tokenQtys.baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                      │
│             tokenQtys.quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                    │
│             tokenQtys.liquidityTokenQty = sqrt(                                                                                                                                                                 │
│                 _baseTokenQtyDesired * _quoteTokenQtyDesired                                                                                                                                                    │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _internalBalances.baseTokenReserveQty += tokenQtys.baseTokenQty;                                                                                                                                    │
│             _internalBalances.quoteTokenReserveQty += tokenQtys.quoteTokenQty;                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function calculateAddTokenPairLiquidityQuantities(                                                                                                                                                          │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     )                                                                                                                                                                                                           │
│         public                                                                                                                                                                                                  │
│         returns (                                                                                                                                                                                               │
│             uint256 baseTokenQty,                                                                                                                                                                               │
│             uint256 quoteTokenQty,                                                                                                                                                                              │
│             uint256 liquidityTokenQty                                                                                                                                                                           │
│         )                                                                                                                                                                                                       │
│     {                                                                                                                                                                                                           │
│         uint256 requiredQuoteTokenQty =                                                                                                                                                                         │
│             calculateQty(                                                                                                                                                                                       │
│                 _baseTokenQtyDesired,                                                                                                                                                                           │
│                 _internalBalances.baseTokenReserveQty,                                                                                                                                                          │
│                 _internalBalances.quoteTokenReserveQty                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         if (requiredQuoteTokenQty <= _quoteTokenQtyDesired) {                                                                                                                                                   │
│             // user has to provide less than their desired amount                                                                                                                                               │
│             require(                                                                                                                                                                                            │
│                 requiredQuoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                                     │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│             baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                                │
│             quoteTokenQty = requiredQuoteTokenQty;                                                                                                                                                              │
│         } else {                                                                                                                                                                                                │
│             // we need to check the opposite way.                                                                                                                                                               │
│             uint256 requiredBaseTokenQty =                                                                                                                                                                      │
│                 calculateQty(                                                                                                                                                                                   │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _internalBalances.quoteTokenReserveQty,                                                                                                                                                     │
│                     _internalBalances.baseTokenReserveQty                                                                                                                                                       │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│             require(                                                                                                                                                                                            │
│                 requiredBaseTokenQty >= _baseTokenQtyMin,                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                                │
│             );                                                                                                                                                                                                  │
│             baseTokenQty = requiredBaseTokenQty;                                                                                                                                                                │
│             quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                              │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         liquidityTokenQty = calculateLiquidityTokenQtyForDoubleAssetEntry(                                                                                                                                      │
│             _totalSupplyOfLiquidityTokens,                                                                                                                                                                      │
│             quoteTokenQty,                                                                                                                                                                                      │
│             _quoteTokenReserveQty                                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         _internalBalances.baseTokenReserveQty += baseTokenQty;                                                                                                                                                  │
│         _internalBalances.quoteTokenReserveQty += quoteTokenQty;                                                                                                                                                │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function calculateLiquidityTokenFees(                                                                                                                                                                       │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances memory _internalBalances                                                                                                                                                               │
│     ) public pure returns (uint256 liquidityTokenFeeQty) {                                                                                                                                                      │
│         uint256 rootK =                                                                                                                                                                                         │
│             sqrt(                                                                                                                                                                                               │
│                 _internalBalances.baseTokenReserveQty *                                                                                                                                                         │
│                     _internalBalances.quoteTokenReserveQty                                                                                                                                                      │
│             );                                                                                                                                                                                                  │
│         uint256 rootKLast = sqrt(_internalBalances.kLast);                                                                                                                                                      │
│         if (rootK > rootKLast) {                                                                                                                                                                                │
│             uint256 numerator =                                                                                                                                                                                 │
│                 _totalSupplyOfLiquidityTokens * (rootK - rootKLast);                                                                                                                                            │
│             uint256 denominator = (rootK * 5) + rootKLast;                                                                                                                                                      │
│             liquidityTokenFeeQty = numerator / denominator;                                                                                                                                                     │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes",                                                                                                                                                                                                 │
│     "2": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price based on the market reserves/AMMprice/exchangeRate OR the custom token balanceOf/totalSupply/amount/liquidity calculation          │
│ Code:                                                                                                                                                                                                           │
│     function calculateLiquidityTokenFees(                                                                                                                                                                       │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances memory _internalBalances                                                                                                                                                               │
│     ) public pure returns (uint256 liquidityTokenFeeQty) {                                                                                                                                                      │
│         uint256 rootK =                                                                                                                                                                                         │
│             sqrt(                                                                                                                                                                                               │
│                 _internalBalances.baseTokenReserveQty *                                                                                                                                                         │
│                     _internalBalances.quoteTokenReserveQty                                                                                                                                                      │
│             );                                                                                                                                                                                                  │
│         uint256 rootKLast = sqrt(_internalBalances.kLast);                                                                                                                                                      │
│         if (rootK > rootKLast) {                                                                                                                                                                                │
│             uint256 numerator =                                                                                                                                                                                 │
│                 _totalSupplyOfLiquidityTokens * (rootK - rootKLast);                                                                                                                                            │
│             uint256 denominator = (rootK * 5) + rootKLast;                                                                                                                                                      │
│             liquidityTokenFeeQty = numerator / denominator;                                                                                                                                                     │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddLiquidityQuantities(                                                                                                                                                                   │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (TokenQtys memory tokenQtys) {                                                                                                                                                             │
│         if (_totalSupplyOfLiquidityTokens > 0) {                                                                                                                                                                │
│             // we have outstanding liquidity tokens present and an existing price curve                                                                                                                         │
│                                                                                                                                                                                                                 │
│             tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                       │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // we need to take this amount (that will be minted) into account for below calculations                                                                                                            │
│             _totalSupplyOfLiquidityTokens += tokenQtys.liquidityTokenFeeQty;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│             // confirm that we have no beta or alpha decay present                                                                                                                                              │
│             // if we do, we need to resolve that first                                                                                                                                                          │
│             if (                                                                                                                                                                                                │
│                 isSufficientDecayPresent(                                                                                                                                                                       │
│                     _baseTokenReserveQty,                                                                                                                                                                       │
│                     _internalBalances                                                                                                                                                                           │
│                 )                                                                                                                                                                                               │
│             ) {                                                                                                                                                                                                 │
│                 // decay is present and needs to be dealt with by the caller.                                                                                                                                   │
│                                                                                                                                                                                                                 │
│                 uint256 baseTokenQtyFromDecay;                                                                                                                                                                  │
│                 uint256 quoteTokenQtyFromDecay;                                                                                                                                                                 │
│                 uint256 liquidityTokenQtyFromDecay;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     _baseTokenReserveQty > _internalBalances.baseTokenReserveQty                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // we have more base token than expected (base token decay) due to rebase up                                                                                                                │
│                     // we first need to handle this situation by requiring this user                                                                                                                            │
│                     // to add quote tokens                                                                                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         quoteTokenQtyFromDecay,                                                                                                                                                                 │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                              │
│                         _quoteTokenQtyDesired,                                                                                                                                                                  │
│                         0, // there is no minimum for this particular call since we may use quote tokens later.                                                                                                 │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // we have less base token than expected (quote token decay) due to a rebase down                                                                                                           │
│                     // we first need to handle this by adding base tokens to offset this.                                                                                                                       │
│                     (                                                                                                                                                                                           │
│                         baseTokenQtyFromDecay,                                                                                                                                                                  │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddBaseTokenLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired,                                                                                                                                                                   │
│                         0, // there is no minimum for this particular call since we may use base tokens later.                                                                                                  │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     quoteTokenQtyFromDecay < _quoteTokenQtyDesired &&                                                                                                                                           │
│                     baseTokenQtyFromDecay < _baseTokenQtyDesired                                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // the user still has qty that they desire to contribute to the exchange for liquidity                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                         tokenQtys.quoteTokenQty,                                                                                                                                                                │
│                         tokenQtys.liquidityTokenQty                                                                                                                                                             │
│                     ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired - baseTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                                 │
│                         _quoteTokenQtyDesired - quoteTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                               │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         _quoteTokenReserveQty + quoteTokenQtyFromDecay,                                                                                                                                         │
│                         _totalSupplyOfLiquidityTokens +                                                                                                                                                         │
│                             liquidityTokenQtyFromDecay,                                                                                                                                                         │
│                         _internalBalances // NOTE: these balances have already been updated when we did the decay math.                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 tokenQtys.baseTokenQty += baseTokenQtyFromDecay;                                                                                                                                                │
│                 tokenQtys.quoteTokenQty += quoteTokenQtyFromDecay;                                                                                                                                              │
│                 tokenQtys.liquidityTokenQty += liquidityTokenQtyFromDecay;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.baseTokenQty >= _baseTokenQtyMin,                                                                                                                                                 │
│                     "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                            │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.quoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                               │
│                     "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 // the user is just doing a simple double asset entry / providing both base and quote.                                                                                                          │
│                 (                                                                                                                                                                                               │
│                     tokenQtys.baseTokenQty,                                                                                                                                                                     │
│                     tokenQtys.quoteTokenQty,                                                                                                                                                                    │
│                     tokenQtys.liquidityTokenQty                                                                                                                                                                 │
│                 ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                                   │
│                     _baseTokenQtyDesired,                                                                                                                                                                       │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _baseTokenQtyMin,                                                                                                                                                                           │
│                     _quoteTokenQtyMin,                                                                                                                                                                          │
│                     _quoteTokenReserveQty,                                                                                                                                                                      │
│                     _totalSupplyOfLiquidityTokens,                                                                                                                                                              │
│                     _internalBalances                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // this user will set the initial pricing curve                                                                                                                                                     │
│             require(                                                                                                                                                                                            │
│                 _baseTokenQtyDesired > 0,                                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY_DESIRED"                                                                                                                                                        │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 _quoteTokenQtyDesired > 0,                                                                                                                                                                      │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY_DESIRED"                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             tokenQtys.baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                      │
│             tokenQtys.quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                    │
│             tokenQtys.liquidityTokenQty = sqrt(                                                                                                                                                                 │
│                 _baseTokenQtyDesired * _quoteTokenQtyDesired                                                                                                                                                    │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _internalBalances.baseTokenReserveQty += tokenQtys.baseTokenQty;                                                                                                                                    │
│             _internalBalances.quoteTokenReserveQty += tokenQtys.quoteTokenQty;                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function calculateLiquidityTokenFees(                                                                                                                                                                       │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances memory _internalBalances                                                                                                                                                               │
│     ) public pure returns (uint256 liquidityTokenFeeQty) {                                                                                                                                                      │
│         uint256 rootK =                                                                                                                                                                                         │
│             sqrt(                                                                                                                                                                                               │
│                 _internalBalances.baseTokenReserveQty *                                                                                                                                                         │
│                     _internalBalances.quoteTokenReserveQty                                                                                                                                                      │
│             );                                                                                                                                                                                                  │
│         uint256 rootKLast = sqrt(_internalBalances.kLast);                                                                                                                                                      │
│         if (rootK > rootKLast) {                                                                                                                                                                                │
│             uint256 numerator =                                                                                                                                                                                 │
│                 _totalSupplyOfLiquidityTokens * (rootK - rootKLast);                                                                                                                                            │
│             uint256 denominator = (rootK * 5) + rootKLast;                                                                                                                                                      │
│             liquidityTokenFeeQty = numerator / denominator;                                                                                                                                                     │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes",                                                                                                                                                                                                 │
│     "2": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price based on the market reserves/AMMprice/exchangeRate OR the custom token balanceOf/totalSupply/amount/liquidity calculation          │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddLiquidityQuantities(                                                                                                                                                                   │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (TokenQtys memory tokenQtys) {                                                                                                                                                             │
│         if (_totalSupplyOfLiquidityTokens > 0) {                                                                                                                                                                │
│             // we have outstanding liquidity tokens present and an existing price curve                                                                                                                         │
│                                                                                                                                                                                                                 │
│             tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                       │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // we need to take this amount (that will be minted) into account for below calculations                                                                                                            │
│             _totalSupplyOfLiquidityTokens += tokenQtys.liquidityTokenFeeQty;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│             // confirm that we have no beta or alpha decay present                                                                                                                                              │
│             // if we do, we need to resolve that first                                                                                                                                                          │
│             if (                                                                                                                                                                                                │
│                 isSufficientDecayPresent(                                                                                                                                                                       │
│                     _baseTokenReserveQty,                                                                                                                                                                       │
│                     _internalBalances                                                                                                                                                                           │
│                 )                                                                                                                                                                                               │
│             ) {                                                                                                                                                                                                 │
│                 // decay is present and needs to be dealt with by the caller.                                                                                                                                   │
│                                                                                                                                                                                                                 │
│                 uint256 baseTokenQtyFromDecay;                                                                                                                                                                  │
│                 uint256 quoteTokenQtyFromDecay;                                                                                                                                                                 │
│                 uint256 liquidityTokenQtyFromDecay;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     _baseTokenReserveQty > _internalBalances.baseTokenReserveQty                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // we have more base token than expected (base token decay) due to rebase up                                                                                                                │
│                     // we first need to handle this situation by requiring this user                                                                                                                            │
│                     // to add quote tokens                                                                                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         quoteTokenQtyFromDecay,                                                                                                                                                                 │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                              │
│                         _quoteTokenQtyDesired,                                                                                                                                                                  │
│                         0, // there is no minimum for this particular call since we may use quote tokens later.                                                                                                 │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // we have less base token than expected (quote token decay) due to a rebase down                                                                                                           │
│                     // we first need to handle this by adding base tokens to offset this.                                                                                                                       │
│                     (                                                                                                                                                                                           │
│                         baseTokenQtyFromDecay,                                                                                                                                                                  │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddBaseTokenLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired,                                                                                                                                                                   │
│                         0, // there is no minimum for this particular call since we may use base tokens later.                                                                                                  │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     quoteTokenQtyFromDecay < _quoteTokenQtyDesired &&                                                                                                                                           │
│                     baseTokenQtyFromDecay < _baseTokenQtyDesired                                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // the user still has qty that they desire to contribute to the exchange for liquidity                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                         tokenQtys.quoteTokenQty,                                                                                                                                                                │
│                         tokenQtys.liquidityTokenQty                                                                                                                                                             │
│                     ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired - baseTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                                 │
│                         _quoteTokenQtyDesired - quoteTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                               │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         _quoteTokenReserveQty + quoteTokenQtyFromDecay,                                                                                                                                         │
│                         _totalSupplyOfLiquidityTokens +                                                                                                                                                         │
│                             liquidityTokenQtyFromDecay,                                                                                                                                                         │
│                         _internalBalances // NOTE: these balances have already been updated when we did the decay math.                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 tokenQtys.baseTokenQty += baseTokenQtyFromDecay;                                                                                                                                                │
│                 tokenQtys.quoteTokenQty += quoteTokenQtyFromDecay;                                                                                                                                              │
│                 tokenQtys.liquidityTokenQty += liquidityTokenQtyFromDecay;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.baseTokenQty >= _baseTokenQtyMin,                                                                                                                                                 │
│                     "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                            │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.quoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                               │
│                     "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 // the user is just doing a simple double asset entry / providing both base and quote.                                                                                                          │
│                 (                                                                                                                                                                                               │
│                     tokenQtys.baseTokenQty,                                                                                                                                                                     │
│                     tokenQtys.quoteTokenQty,                                                                                                                                                                    │
│                     tokenQtys.liquidityTokenQty                                                                                                                                                                 │
│                 ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                                   │
│                     _baseTokenQtyDesired,                                                                                                                                                                       │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _baseTokenQtyMin,                                                                                                                                                                           │
│                     _quoteTokenQtyMin,                                                                                                                                                                          │
│                     _quoteTokenReserveQty,                                                                                                                                                                      │
│                     _totalSupplyOfLiquidityTokens,                                                                                                                                                              │
│                     _internalBalances                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // this user will set the initial pricing curve                                                                                                                                                     │
│             require(                                                                                                                                                                                            │
│                 _baseTokenQtyDesired > 0,                                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY_DESIRED"                                                                                                                                                        │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 _quoteTokenQtyDesired > 0,                                                                                                                                                                      │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY_DESIRED"                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             tokenQtys.baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                      │
│             tokenQtys.quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                    │
│             tokenQtys.liquidityTokenQty = sqrt(                                                                                                                                                                 │
│                 _baseTokenQtyDesired * _quoteTokenQtyDesired                                                                                                                                                    │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _internalBalances.baseTokenReserveQty += tokenQtys.baseTokenQty;                                                                                                                                    │
│             _internalBalances.quoteTokenReserveQty += tokenQtys.quoteTokenQty;                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function calculateLiquidityTokenFees(                                                                                                                                                                       │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances memory _internalBalances                                                                                                                                                               │
│     ) public pure returns (uint256 liquidityTokenFeeQty) {                                                                                                                                                      │
│         uint256 rootK =                                                                                                                                                                                         │
│             sqrt(                                                                                                                                                                                               │
│                 _internalBalances.baseTokenReserveQty *                                                                                                                                                         │
│                     _internalBalances.quoteTokenReserveQty                                                                                                                                                      │
│             );                                                                                                                                                                                                  │
│         uint256 rootKLast = sqrt(_internalBalances.kLast);                                                                                                                                                      │
│         if (rootK > rootKLast) {                                                                                                                                                                                │
│             uint256 numerator =                                                                                                                                                                                 │
│                 _totalSupplyOfLiquidityTokens * (rootK - rootKLast);                                                                                                                                            │
│             uint256 denominator = (rootK * 5) + rootKLast;                                                                                                                                                      │
│             liquidityTokenFeeQty = numerator / denominator;                                                                                                                                                     │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddLiquidityQuantities(                                                                                                                                                                   │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (TokenQtys memory tokenQtys) {                                                                                                                                                             │
│         if (_totalSupplyOfLiquidityTokens > 0) {                                                                                                                                                                │
│             // we have outstanding liquidity tokens present and an existing price curve                                                                                                                         │
│                                                                                                                                                                                                                 │
│             tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                       │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // we need to take this amount (that will be minted) into account for below calculations                                                                                                            │
│             _totalSupplyOfLiquidityTokens += tokenQtys.liquidityTokenFeeQty;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│             // confirm that we have no beta or alpha decay present                                                                                                                                              │
│             // if we do, we need to resolve that first                                                                                                                                                          │
│             if (                                                                                                                                                                                                │
│                 isSufficientDecayPresent(                                                                                                                                                                       │
│                     _baseTokenReserveQty,                                                                                                                                                                       │
│                     _internalBalances                                                                                                                                                                           │
│                 )                                                                                                                                                                                               │
│             ) {                                                                                                                                                                                                 │
│                 // decay is present and needs to be dealt with by the caller.                                                                                                                                   │
│                                                                                                                                                                                                                 │
│                 uint256 baseTokenQtyFromDecay;                                                                                                                                                                  │
│                 uint256 quoteTokenQtyFromDecay;                                                                                                                                                                 │
│                 uint256 liquidityTokenQtyFromDecay;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     _baseTokenReserveQty > _internalBalances.baseTokenReserveQty                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // we have more base token than expected (base token decay) due to rebase up                                                                                                                │
│                     // we first need to handle this situation by requiring this user                                                                                                                            │
│                     // to add quote tokens                                                                                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         quoteTokenQtyFromDecay,                                                                                                                                                                 │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                              │
│                         _quoteTokenQtyDesired,                                                                                                                                                                  │
│                         0, // there is no minimum for this particular call since we may use quote tokens later.                                                                                                 │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // we have less base token than expected (quote token decay) due to a rebase down                                                                                                           │
│                     // we first need to handle this by adding base tokens to offset this.                                                                                                                       │
│                     (                                                                                                                                                                                           │
│                         baseTokenQtyFromDecay,                                                                                                                                                                  │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddBaseTokenLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired,                                                                                                                                                                   │
│                         0, // there is no minimum for this particular call since we may use base tokens later.                                                                                                  │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     quoteTokenQtyFromDecay < _quoteTokenQtyDesired &&                                                                                                                                           │
│                     baseTokenQtyFromDecay < _baseTokenQtyDesired                                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // the user still has qty that they desire to contribute to the exchange for liquidity                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                         tokenQtys.quoteTokenQty,                                                                                                                                                                │
│                         tokenQtys.liquidityTokenQty                                                                                                                                                             │
│                     ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired - baseTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                                 │
│                         _quoteTokenQtyDesired - quoteTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                               │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         _quoteTokenReserveQty + quoteTokenQtyFromDecay,                                                                                                                                         │
│                         _totalSupplyOfLiquidityTokens +                                                                                                                                                         │
│                             liquidityTokenQtyFromDecay,                                                                                                                                                         │
│                         _internalBalances // NOTE: these balances have already been updated when we did the decay math.                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 tokenQtys.baseTokenQty += baseTokenQtyFromDecay;                                                                                                                                                │
│                 tokenQtys.quoteTokenQty += quoteTokenQtyFromDecay;                                                                                                                                              │
│                 tokenQtys.liquidityTokenQty += liquidityTokenQtyFromDecay;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.baseTokenQty >= _baseTokenQtyMin,                                                                                                                                                 │
│                     "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                            │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.quoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                               │
│                     "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 // the user is just doing a simple double asset entry / providing both base and quote.                                                                                                          │
│                 (                                                                                                                                                                                               │
│                     tokenQtys.baseTokenQty,                                                                                                                                                                     │
│                     tokenQtys.quoteTokenQty,                                                                                                                                                                    │
│                     tokenQtys.liquidityTokenQty                                                                                                                                                                 │
│                 ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                                   │
│                     _baseTokenQtyDesired,                                                                                                                                                                       │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _baseTokenQtyMin,                                                                                                                                                                           │
│                     _quoteTokenQtyMin,                                                                                                                                                                          │
│                     _quoteTokenReserveQty,                                                                                                                                                                      │
│                     _totalSupplyOfLiquidityTokens,                                                                                                                                                              │
│                     _internalBalances                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // this user will set the initial pricing curve                                                                                                                                                     │
│             require(                                                                                                                                                                                            │
│                 _baseTokenQtyDesired > 0,                                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY_DESIRED"                                                                                                                                                        │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 _quoteTokenQtyDesired > 0,                                                                                                                                                                      │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY_DESIRED"                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             tokenQtys.baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                      │
│             tokenQtys.quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                    │
│             tokenQtys.liquidityTokenQty = sqrt(                                                                                                                                                                 │
│                 _baseTokenQtyDesired * _quoteTokenQtyDesired                                                                                                                                                    │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _internalBalances.baseTokenReserveQty += tokenQtys.baseTokenQty;                                                                                                                                    │
│             _internalBalances.quoteTokenReserveQty += tokenQtys.quoteTokenQty;                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
│     function calculateLiquidityTokenFees(                                                                                                                                                                       │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances memory _internalBalances                                                                                                                                                               │
│     ) public pure returns (uint256 liquidityTokenFeeQty) {                                                                                                                                                      │
│         uint256 rootK =                                                                                                                                                                                         │
│             sqrt(                                                                                                                                                                                               │
│                 _internalBalances.baseTokenReserveQty *                                                                                                                                                         │
│                     _internalBalances.quoteTokenReserveQty                                                                                                                                                      │
│             );                                                                                                                                                                                                  │
│         uint256 rootKLast = sqrt(_internalBalances.kLast);                                                                                                                                                      │
│         if (rootK > rootKLast) {                                                                                                                                                                                │
│             uint256 numerator =                                                                                                                                                                                 │
│                 _totalSupplyOfLiquidityTokens * (rootK - rootKLast);                                                                                                                                            │
│             uint256 denominator = (rootK * 5) + rootKLast;                                                                                                                                                      │
│             liquidityTokenFeeQty = numerator / denominator;                                                                                                                                                     │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│   "VariableName": "_baseTokenQtyMin"                                                                                                                                                                            │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "totalSupplyOfLiquidityTokens": "Holds the value of total minted share or amount"                                                                                                                       │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "this.totalSupply()": "Holds the total supply/liquidity AND is used by the conditional branch to determine the supply/liquidity is 0"                                                                   │
│     },                                                                                                                                                                                                          │
│     "VariableC": {                                                                                                                                                                                              │
│         "_liquidityTokenQty": "Holds the value of the deposit/mint/add amount"                                                                                                                                  │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:36:58] INFO     static_check: first_deposit_check: VariableA: totalSupplyOfLiquidityTokens; VariableB: this.totalSupply(); VariableC: _liquidityTokenQty                           static_check.py:128
            first_deposit_check            
┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Argument ┃ Value                        ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ arg[0]   │ this.totalSupply()           │
│ arg[1]   │ _liquidityTokenQty           │
│ arg[2]   │ totalSupplyOfLiquidityTokens │
└──────────┴──────────────────────────────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│   "VariableA": {                                                                                                                                                                                                │
│     "_internalTokenAReserveQty": "Holds the market reserves/AMMprice/exchangeRate OR the custom token balanceOf/totalSupply/amount/liquidity calculation"                                                       │
│   },                                                                                                                                                                                                            │
│   "VariableB": {                                                                                                                                                                                                │
│     "liquidityTokenQty": "Holds the calculated value/price of LP token"                                                                                                                                         │
│   }                                                                                                                                                                                                             │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
          find_data_dependency          
┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Argument ┃ Value                     ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ arg[0]   │ _internalTokenAReserveQty │
│ arg[1]   │ liquidityTokenQty         │
└──────────┴───────────────────────────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_baseTokenReserveQty": "Variable holding the market reserves/AMMprice/exchangeRate",                                                                                                                   │
│         "_internalBalances": "Variable holding the custom token balanceOf/totalSupply/amount/liquidity calculation"                                                                                             │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "liquidityTokenQty": "Variable holding the calculated value/price of LP token"                                                                                                                          │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
       find_data_dependency        
┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┓
┃ Argument ┃ Value                ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━┩
│ arg[0]   │ _baseTokenReserveQty │
│ arg[1]   │ liquidityTokenQty    │
└──────────┴──────────────────────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_baseTokenReserveQty": "Holds the market reserves or AMM price or exchange rate",                                                                                                                      │
│         "_internalBalances": "Holds the custom token balanceOf, totalSupply, amount, or liquidity calculation"                                                                                                  │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "liquidityTokenQty": "Holds the calculated value or price of LP token"                                                                                                                                  │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
       find_data_dependency        
┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┓
┃ Argument ┃ Value                ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━┩
│ arg[0]   │ _baseTokenReserveQty │
│ arg[1]   │ liquidityTokenQty    │
└──────────┴──────────────────────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "liquidityTokenQty": "Holds the value of total minted share or amount"                                                                                                                                  │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "_totalSupplyOfLiquidityTokens": "Holds the total supply/liquidity AND is used by the conditional branch to determine the supply/liquidity is 0"                                                        │
│     },                                                                                                                                                                                                          │
│     "VariableC": {                                                                                                                                                                                              │
│         "_tokenQtyAToAdd": "Holds the value of the deposit/mint/add amount"                                                                                                                                     │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:37:02] INFO     static_check: first_deposit_check: VariableA: liquidityTokenQty; VariableB: _totalSupplyOfLiquidityTokens; VariableC: _tokenQtyAToAdd                              static_check.py:128
            first_deposit_check             
┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Argument ┃ Value                         ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ arg[0]   │ _totalSupplyOfLiquidityTokens │
│ arg[1]   │ _tokenQtyAToAdd               │
│ arg[2]   │ liquidityTokenQty             │
└──────────┴───────────────────────────────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_quoteTokenQtyDesired": "Holds the value of total minted share or amount"                                                                                                                              │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "_totalSupplyOfLiquidityTokens": "Holds the total supply/liquidity AND is used by the conditional branch to determine the supply/liquidity is 0"                                                        │
│     },                                                                                                                                                                                                          │
│     "VariableC": {                                                                                                                                                                                              │
│         "_quoteTokenQty": "Holds the value of the deposit/mint/add amount"                                                                                                                                      │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:37:03] INFO     static_check: first_deposit_check: VariableA: _quoteTokenQtyDesired; VariableB: _totalSupplyOfLiquidityTokens; VariableC: _quoteTokenQty                           static_check.py:128
            first_deposit_check             
┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Argument ┃ Value                         ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ arg[0]   │ _totalSupplyOfLiquidityTokens │
│ arg[1]   │ _quoteTokenQty                │
│ arg[2]   │ _quoteTokenQtyDesired         │
└──────────┴───────────────────────────────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│   "VariableName": "_quoteTokenQtyMin"                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│   "VariableName": "_baseTokenQtyMin"                                                                                                                                                                            │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_quoteTokenQtyDesired": "Holds the value of total minted share or amount"                                                                                                                              │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "_totalSupplyOfLiquidityTokens": "Holds the total supply/liquidity AND is used by the conditional branch to determine the supply/liquidity is 0"                                                        │
│     },                                                                                                                                                                                                          │
│     "VariableC": {                                                                                                                                                                                              │
│         "_quoteTokenQty": "Holds the value of the deposit/mint/add amount"                                                                                                                                      │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:37:05] INFO     static_check: first_deposit_check: VariableA: _quoteTokenQtyDesired; VariableB: _totalSupplyOfLiquidityTokens; VariableC: _quoteTokenQty                           static_check.py:128
            first_deposit_check             
┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Argument ┃ Value                         ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ arg[0]   │ _totalSupplyOfLiquidityTokens │
│ arg[1]   │ _quoteTokenQty                │
│ arg[2]   │ _quoteTokenQtyDesired         │
└──────────┴───────────────────────────────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_totalSupplyOfLiquidityTokens": "Holds the value of total minted share or amount"                                                                                                                      │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "_totalSupplyOfLiquidityTokens": "Holds the total supply/liquidity AND is used by the conditional branch to determine the supply/liquidity is 0"                                                        │
│     },                                                                                                                                                                                                          │
│     "VariableC": {                                                                                                                                                                                              │
│         "_baseTokenQtyDesired": "Holds the value of the deposit/mint/add amount"                                                                                                                                │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:37:07] INFO     static_check: first_deposit_check: VariableA: _totalSupplyOfLiquidityTokens; VariableB: _totalSupplyOfLiquidityTokens; VariableC: _baseTokenQtyDesired             static_check.py:128
            first_deposit_check             
┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Argument ┃ Value                         ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ arg[0]   │ _totalSupplyOfLiquidityTokens │
│ arg[1]   │ _baseTokenQtyDesired          │
│ arg[2]   │ _totalSupplyOfLiquidityTokens │
└──────────┴───────────────────────────────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│   "VariableName": "_baseTokenQtyMin"                                                                                                                                                                            │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│   "VariableName": "_baseTokenQtyMin"                                                                                                                                                                            │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "baseTokenQty": "Holds the value of total minted base token quantity"                                                                                                                                   │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "_totalSupplyOfLiquidityTokens": "Holds the total supply of liquidity tokens and is used to determine if the supply/liquidity is 0"                                                                     │
│     },                                                                                                                                                                                                          │
│     "VariableC": {                                                                                                                                                                                              │
│         "baseTokenQty": "Holds the value of the deposit/minted/add amount"                                                                                                                                      │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:37:09] INFO     static_check: first_deposit_check: VariableA: baseTokenQty; VariableB: _totalSupplyOfLiquidityTokens; VariableC: baseTokenQty                                      static_check.py:128
            first_deposit_check             
┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Argument ┃ Value                         ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ arg[0]   │ _totalSupplyOfLiquidityTokens │
│ arg[1]   │ baseTokenQty                  │
│ arg[2]   │ baseTokenQty                  │
└──────────┴───────────────────────────────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_totalSupplyOfLiquidityTokens": "Holds the value of total minted share or amount"                                                                                                                      │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "_totalSupplyOfLiquidityTokens": "Holds the total supply/liquidity AND is used by the conditional branch to determine the supply/liquidity is 0"                                                        │
│     },                                                                                                                                                                                                          │
│     "VariableC": {                                                                                                                                                                                              │
│         "_baseTokenQtyDesired": "Holds the value of the deposit/mint/add amount"                                                                                                                                │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:37:10] INFO     static_check: first_deposit_check: VariableA: _totalSupplyOfLiquidityTokens; VariableB: _totalSupplyOfLiquidityTokens; VariableC: _baseTokenQtyDesired             static_check.py:128
            first_deposit_check             
┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Argument ┃ Value                         ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ arg[0]   │ _totalSupplyOfLiquidityTokens │
│ arg[1]   │ _baseTokenQtyDesired          │
│ arg[2]   │ _totalSupplyOfLiquidityTokens │
└──────────┴───────────────────────────────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│   "VariableName": "_baseTokenQtyMin"                                                                                                                                                                            │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to update/accrue interest/exchange rate? Answer only ZERO or ONE statement, cover the code with backquotes.                    │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddLiquidityQuantities(                                                                                                                                                                   │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (TokenQtys memory tokenQtys) {                                                                                                                                                             │
│         if (_totalSupplyOfLiquidityTokens > 0) {                                                                                                                                                                │
│             // we have outstanding liquidity tokens present and an existing price curve                                                                                                                         │
│                                                                                                                                                                                                                 │
│             tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                       │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // we need to take this amount (that will be minted) into account for below calculations                                                                                                            │
│             _totalSupplyOfLiquidityTokens += tokenQtys.liquidityTokenFeeQty;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│             // confirm that we have no beta or alpha decay present                                                                                                                                              │
│             // if we do, we need to resolve that first                                                                                                                                                          │
│             if (                                                                                                                                                                                                │
│                 isSufficientDecayPresent(                                                                                                                                                                       │
│                     _baseTokenReserveQty,                                                                                                                                                                       │
│                     _internalBalances                                                                                                                                                                           │
│                 )                                                                                                                                                                                               │
│             ) {                                                                                                                                                                                                 │
│                 // decay is present and needs to be dealt with by the caller.                                                                                                                                   │
│                                                                                                                                                                                                                 │
│                 uint256 baseTokenQtyFromDecay;                                                                                                                                                                  │
│                 uint256 quoteTokenQtyFromDecay;                                                                                                                                                                 │
│                 uint256 liquidityTokenQtyFromDecay;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     _baseTokenReserveQty > _internalBalances.baseTokenReserveQty                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // we have more base token than expected (base token decay) due to rebase up                                                                                                                │
│                     // we first need to handle this situation by requiring this user                                                                                                                            │
│                     // to add quote tokens                                                                                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         quoteTokenQtyFromDecay,                                                                                                                                                                 │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                              │
│                         _quoteTokenQtyDesired,                                                                                                                                                                  │
│                         0, // there is no minimum for this particular call since we may use quote tokens later.                                                                                                 │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // we have less base token than expected (quote token decay) due to a rebase down                                                                                                           │
│                     // we first need to handle this by adding base tokens to offset this.                                                                                                                       │
│                     (                                                                                                                                                                                           │
│                         baseTokenQtyFromDecay,                                                                                                                                                                  │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddBaseTokenLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired,                                                                                                                                                                   │
│                         0, // there is no minimum for this particular call since we may use base tokens later.                                                                                                  │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     quoteTokenQtyFromDecay < _quoteTokenQtyDesired &&                                                                                                                                           │
│                     baseTokenQtyFromDecay < _baseTokenQtyDesired                                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // the user still has qty that they desire to contribute to the exchange for liquidity                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                         tokenQtys.quoteTokenQty,                                                                                                                                                                │
│                         tokenQtys.liquidityTokenQty                                                                                                                                                             │
│                     ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired - baseTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                                 │
│                         _quoteTokenQtyDesired - quoteTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                               │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         _quoteTokenReserveQty + quoteTokenQtyFromDecay,                                                                                                                                         │
│                         _totalSupplyOfLiquidityTokens +                                                                                                                                                         │
│                             liquidityTokenQtyFromDecay,                                                                                                                                                         │
│                         _internalBalances // NOTE: these balances have already been updated when we did the decay math.                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 tokenQtys.baseTokenQty += baseTokenQtyFromDecay;                                                                                                                                                │
│                 tokenQtys.quoteTokenQty += quoteTokenQtyFromDecay;                                                                                                                                              │
│                 tokenQtys.liquidityTokenQty += liquidityTokenQtyFromDecay;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.baseTokenQty >= _baseTokenQtyMin,                                                                                                                                                 │
│                     "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                            │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.quoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                               │
│                     "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 // the user is just doing a simple double asset entry / providing both base and quote.                                                                                                          │
│                 (                                                                                                                                                                                               │
│                     tokenQtys.baseTokenQty,                                                                                                                                                                     │
│                     tokenQtys.quoteTokenQty,                                                                                                                                                                    │
│                     tokenQtys.liquidityTokenQty                                                                                                                                                                 │
│                 ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                                   │
│                     _baseTokenQtyDesired,                                                                                                                                                                       │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _baseTokenQtyMin,                                                                                                                                                                           │
│                     _quoteTokenQtyMin,                                                                                                                                                                          │
│                     _quoteTokenReserveQty,                                                                                                                                                                      │
│                     _totalSupplyOfLiquidityTokens,                                                                                                                                                              │
│                     _internalBalances                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // this user will set the initial pricing curve                                                                                                                                                     │
│             require(                                                                                                                                                                                            │
│                 _baseTokenQtyDesired > 0,                                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY_DESIRED"                                                                                                                                                        │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 _quoteTokenQtyDesired > 0,                                                                                                                                                                      │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY_DESIRED"                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             tokenQtys.baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                      │
│             tokenQtys.quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                    │
│             tokenQtys.liquidityTokenQty = sqrt(                                                                                                                                                                 │
│                 _baseTokenQtyDesired * _quoteTokenQtyDesired                                                                                                                                                    │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _internalBalances.baseTokenReserveQty += tokenQtys.baseTokenQty;                                                                                                                                    │
│             _internalBalances.quoteTokenReserveQty += tokenQtys.quoteTokenQty;                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ `tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                                  │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );`                                                                                                                                                                                                 │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward? Answer only ZERO or ONE statement, cover the code with │
│ backquotes.                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function calculateAddLiquidityQuantities(                                                                                                                                                                   │
│         uint256 _baseTokenQtyDesired,                                                                                                                                                                           │
│         uint256 _quoteTokenQtyDesired,                                                                                                                                                                          │
│         uint256 _baseTokenQtyMin,                                                                                                                                                                               │
│         uint256 _quoteTokenQtyMin,                                                                                                                                                                              │
│         uint256 _baseTokenReserveQty,                                                                                                                                                                           │
│         uint256 _quoteTokenReserveQty,                                                                                                                                                                          │
│         uint256 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│         InternalBalances storage _internalBalances                                                                                                                                                              │
│     ) public returns (TokenQtys memory tokenQtys) {                                                                                                                                                             │
│         if (_totalSupplyOfLiquidityTokens > 0) {                                                                                                                                                                │
│             // we have outstanding liquidity tokens present and an existing price curve                                                                                                                         │
│                                                                                                                                                                                                                 │
│             tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                       │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // we need to take this amount (that will be minted) into account for below calculations                                                                                                            │
│             _totalSupplyOfLiquidityTokens += tokenQtys.liquidityTokenFeeQty;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│             // confirm that we have no beta or alpha decay present                                                                                                                                              │
│             // if we do, we need to resolve that first                                                                                                                                                          │
│             if (                                                                                                                                                                                                │
│                 isSufficientDecayPresent(                                                                                                                                                                       │
│                     _baseTokenReserveQty,                                                                                                                                                                       │
│                     _internalBalances                                                                                                                                                                           │
│                 )                                                                                                                                                                                               │
│             ) {                                                                                                                                                                                                 │
│                 // decay is present and needs to be dealt with by the caller.                                                                                                                                   │
│                                                                                                                                                                                                                 │
│                 uint256 baseTokenQtyFromDecay;                                                                                                                                                                  │
│                 uint256 quoteTokenQtyFromDecay;                                                                                                                                                                 │
│                 uint256 liquidityTokenQtyFromDecay;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     _baseTokenReserveQty > _internalBalances.baseTokenReserveQty                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // we have more base token than expected (base token decay) due to rebase up                                                                                                                │
│                     // we first need to handle this situation by requiring this user                                                                                                                            │
│                     // to add quote tokens                                                                                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         quoteTokenQtyFromDecay,                                                                                                                                                                 │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddQuoteTokenLiquidityQuantities(                                                                                                                                              │
│                         _quoteTokenQtyDesired,                                                                                                                                                                  │
│                         0, // there is no minimum for this particular call since we may use quote tokens later.                                                                                                 │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // we have less base token than expected (quote token decay) due to a rebase down                                                                                                           │
│                     // we first need to handle this by adding base tokens to offset this.                                                                                                                       │
│                     (                                                                                                                                                                                           │
│                         baseTokenQtyFromDecay,                                                                                                                                                                  │
│                         liquidityTokenQtyFromDecay                                                                                                                                                              │
│                     ) = calculateAddBaseTokenLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired,                                                                                                                                                                   │
│                         0, // there is no minimum for this particular call since we may use base tokens later.                                                                                                  │
│                         _baseTokenReserveQty,                                                                                                                                                                   │
│                         _totalSupplyOfLiquidityTokens,                                                                                                                                                          │
│                         _internalBalances                                                                                                                                                                       │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 if (                                                                                                                                                                                            │
│                     quoteTokenQtyFromDecay < _quoteTokenQtyDesired &&                                                                                                                                           │
│                     baseTokenQtyFromDecay < _baseTokenQtyDesired                                                                                                                                                │
│                 ) {                                                                                                                                                                                             │
│                     // the user still has qty that they desire to contribute to the exchange for liquidity                                                                                                      │
│                     (                                                                                                                                                                                           │
│                         tokenQtys.baseTokenQty,                                                                                                                                                                 │
│                         tokenQtys.quoteTokenQty,                                                                                                                                                                │
│                         tokenQtys.liquidityTokenQty                                                                                                                                                             │
│                     ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                               │
│                         _baseTokenQtyDesired - baseTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                                 │
│                         _quoteTokenQtyDesired - quoteTokenQtyFromDecay, // safe from underflow quoted on above IF                                                                                               │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         0, // we will check minimums below                                                                                                                                                      │
│                         _quoteTokenReserveQty + quoteTokenQtyFromDecay,                                                                                                                                         │
│                         _totalSupplyOfLiquidityTokens +                                                                                                                                                         │
│                             liquidityTokenQtyFromDecay,                                                                                                                                                         │
│                         _internalBalances // NOTE: these balances have already been updated when we did the decay math.                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                 tokenQtys.baseTokenQty += baseTokenQtyFromDecay;                                                                                                                                                │
│                 tokenQtys.quoteTokenQty += quoteTokenQtyFromDecay;                                                                                                                                              │
│                 tokenQtys.liquidityTokenQty += liquidityTokenQtyFromDecay;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.baseTokenQty >= _baseTokenQtyMin,                                                                                                                                                 │
│                     "MathLib: INSUFFICIENT_BASE_QTY"                                                                                                                                                            │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 require(                                                                                                                                                                                        │
│                     tokenQtys.quoteTokenQty >= _quoteTokenQtyMin,                                                                                                                                               │
│                     "MathLib: INSUFFICIENT_QUOTE_QTY"                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             } else {                                                                                                                                                                                            │
│                 // the user is just doing a simple double asset entry / providing both base and quote.                                                                                                          │
│                 (                                                                                                                                                                                               │
│                     tokenQtys.baseTokenQty,                                                                                                                                                                     │
│                     tokenQtys.quoteTokenQty,                                                                                                                                                                    │
│                     tokenQtys.liquidityTokenQty                                                                                                                                                                 │
│                 ) = calculateAddTokenPairLiquidityQuantities(                                                                                                                                                   │
│                     _baseTokenQtyDesired,                                                                                                                                                                       │
│                     _quoteTokenQtyDesired,                                                                                                                                                                      │
│                     _baseTokenQtyMin,                                                                                                                                                                           │
│                     _quoteTokenQtyMin,                                                                                                                                                                          │
│                     _quoteTokenReserveQty,                                                                                                                                                                      │
│                     _totalSupplyOfLiquidityTokens,                                                                                                                                                              │
│                     _internalBalances                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // this user will set the initial pricing curve                                                                                                                                                     │
│             require(                                                                                                                                                                                            │
│                 _baseTokenQtyDesired > 0,                                                                                                                                                                       │
│                 "MathLib: INSUFFICIENT_BASE_QTY_DESIRED"                                                                                                                                                        │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 _quoteTokenQtyDesired > 0,                                                                                                                                                                      │
│                 "MathLib: INSUFFICIENT_QUOTE_QTY_DESIRED"                                                                                                                                                       │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             tokenQtys.baseTokenQty = _baseTokenQtyDesired;                                                                                                                                                      │
│             tokenQtys.quoteTokenQty = _quoteTokenQtyDesired;                                                                                                                                                    │
│             tokenQtys.liquidityTokenQty = sqrt(                                                                                                                                                                 │
│                 _baseTokenQtyDesired * _quoteTokenQtyDesired                                                                                                                                                    │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             _internalBalances.baseTokenReserveQty += tokenQtys.baseTokenQty;                                                                                                                                    │
│             _internalBalances.quoteTokenReserveQty += tokenQtys.quoteTokenQty;                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ `tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(                                                                                                                                                  │
│                 _totalSupplyOfLiquidityTokens,                                                                                                                                                                  │
│                 _internalBalances                                                                                                                                                                               │
│             );`                                                                                                                                                                                                 │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
                                        order_first_b                                         
┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Argument ┃ Value                                                                           ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ arg[0]   │ [tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(]                 │
│ arg[1]   │ [tokenQtys.liquidityTokenFeeQty = calculateLiquidityTokenFees(,             );] │
└──────────┴─────────────────────────────────────────────────────────────────────────────────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_totalSupplyOfLiquidityTokens": "Holds the value of total minted share or amount"                                                                                                                      │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "_totalSupplyOfLiquidityTokens": "Holds the total supply/liquidity AND is used by the conditional branch to determine the supply/liquidity is 0"                                                        │
│     },                                                                                                                                                                                                          │
│     "VariableC": {                                                                                                                                                                                              │
│         "_baseTokenQtyDesired": "Holds the value of the deposit/mint/add amount"                                                                                                                                │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:37:12] INFO     static_check: first_deposit_check: VariableA: _totalSupplyOfLiquidityTokens; VariableB: _totalSupplyOfLiquidityTokens; VariableC: _baseTokenQtyDesired             static_check.py:128
            first_deposit_check             
┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Argument ┃ Value                         ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ arg[0]   │ _totalSupplyOfLiquidityTokens │
│ arg[1]   │ _baseTokenQtyDesired          │
│ arg[2]   │ _totalSupplyOfLiquidityTokens │
└──────────┴───────────────────────────────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│   "VariableName": "_baseTokenQtyMin"                                                                                                                                                                            │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│   "VariableName": "_baseTokenQtyMin"                                                                                                                                                                            │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_quoteTokenReserveQty": "Variable holding the market reserves/AMMprice/exchangeRate",                                                                                                                  │
│         "_internalBalances": "Variable holding the custom token balanceOf/totalSupply/amount/liquidity calculation"                                                                                             │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "liquidityTokenQty": "Variable holding the calculated value/price of LP token"                                                                                                                          │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
        find_data_dependency        
┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Argument ┃ Value                 ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━┩
│ arg[0]   │ _quoteTokenReserveQty │
│ arg[1]   │ liquidityTokenQty     │
└──────────┴───────────────────────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_baseTokenReserveQty": "Variable holding the base token reserve quantity",                                                                                                                             │
│         "_quoteTokenReserveQty": "Variable holding the quote token reserve quantity",                                                                                                                           │
│         "_totalSupplyOfLiquidityTokens": "Variable holding the total supply of liquidity tokens",                                                                                                               │
│         "_internalBalances": "Variable holding internal balances"                                                                                                                                               │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "tokenQtys": "Variable holding the calculated token quantities"                                                                                                                                         │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:37:15] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:357
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-elasticswap-main/src/libraries/MathLib.sol, current       tasks.py:359
                             function: calculateAddTokenPairLiquidityQuantities, current vul: price-manipulation                                                                                                   
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:361
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 310, in simple_cli                                                                                       
                                 raise Exception(                                                                                                                                                                  
                             Exception: The description of variable did not pass the validation                                                                                                                    
                                                                                                                                                                                                                   
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_totalSupplyOfLiquidityTokens": "Holds the value of total minted share or amount"                                                                                                                      │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "_totalSupplyOfLiquidityTokens": "Holds the total supply/liquidity AND is used by the conditional branch to determine the supply/liquidity is 0"                                                        │
│     },                                                                                                                                                                                                          │
│     "VariableC": {                                                                                                                                                                                              │
│         "baseTokenQty": "Holds the value of the deposit/mint/add amount"                                                                                                                                        │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:37:17] INFO     static_check: first_deposit_check: VariableA: _totalSupplyOfLiquidityTokens; VariableB: _totalSupplyOfLiquidityTokens; VariableC: baseTokenQty                     static_check.py:128
            first_deposit_check             
┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Argument ┃ Value                         ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ arg[0]   │ _totalSupplyOfLiquidityTokens │
│ arg[1]   │ baseTokenQty                  │
│ arg[2]   │ _totalSupplyOfLiquidityTokens │
└──────────┴───────────────────────────────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_totalSupplyOfLiquidityTokens": "Holds the value of total minted share or amount"                                                                                                                      │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "_totalSupplyOfLiquidityTokens": "Holds the total supply/liquidity AND is used by the conditional branch to determine the supply/liquidity is 0"                                                        │
│     },                                                                                                                                                                                                          │
│     "VariableC": {                                                                                                                                                                                              │
│         "_baseTokenQtyDesired": "Holds the value of the deposit/mint/add amount"                                                                                                                                │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:37:18] INFO     static_check: first_deposit_check: VariableA: _totalSupplyOfLiquidityTokens; VariableB: _totalSupplyOfLiquidityTokens; VariableC: _baseTokenQtyDesired             static_check.py:128
            first_deposit_check             
┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Argument ┃ Value                         ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ arg[0]   │ _totalSupplyOfLiquidityTokens │
│ arg[1]   │ _baseTokenQtyDesired          │
│ arg[2]   │ _totalSupplyOfLiquidityTokens │
└──────────┴───────────────────────────────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_internalBalances": "Holds the market reserves/AMMprice/exchangeRate OR the custom token balanceOf/totalSupply/amount/liquidity calculation"                                                           │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "liquidityTokenFeeQty": "Holds the calculated value/price of LP token"                                                                                                                                  │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
       find_data_dependency        
┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┓
┃ Argument ┃ Value                ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━┩
│ arg[0]   │ _internalBalances    │
│ arg[1]   │ liquidityTokenFeeQty │
└──────────┴──────────────────────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_baseTokenReserveQty": "Variable holding the base token reserve quantity",                                                                                                                             │
│         "_quoteTokenReserveQty": "Variable holding the quote token reserve quantity",                                                                                                                           │
│         "_totalSupplyOfLiquidityTokens": "Variable holding the total supply of liquidity tokens",                                                                                                               │
│         "_internalBalances": "Variable holding internal balances"                                                                                                                                               │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "tokenQtys": "Variable holding the calculated token quantities"                                                                                                                                         │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:37:21] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:357
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2022-01-elasticswap-main/src/libraries/MathLib.sol, current       tasks.py:359
                             function: calculateLiquidityTokenFees, current vul: price-manipulation                                                                                                                
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:361
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 310, in simple_cli                                                                                       
                                 raise Exception(                                                                                                                                                                  
                             Exception: The description of variable did not pass the validation                                                                                                                    
                                                                                                                                                                                                                   
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_totalSupplyOfLiquidityTokens": "Holds the value of total minted share or amount"                                                                                                                      │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "_totalSupplyOfLiquidityTokens": "Holds the total supply/liquidity AND is used by the conditional branch to determine the supply/liquidity is 0"                                                        │
│     },                                                                                                                                                                                                          │
│     "VariableC": {                                                                                                                                                                                              │
│         "_internalBalances.baseTokenReserveQty": "Holds the value of the deposit/mint/add amount"                                                                                                               │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:37:22] INFO     static_check: first_deposit_check: VariableA: _totalSupplyOfLiquidityTokens; VariableB: _totalSupplyOfLiquidityTokens; VariableC:                                  static_check.py:128
                             _internalBalances.baseTokenReserveQty                                                                                                                                                 
                first_deposit_check                 
┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Argument ┃ Value                                 ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ arg[0]   │ _totalSupplyOfLiquidityTokens         │
│ arg[1]   │ _internalBalances.baseTokenReserveQty │
│ arg[2]   │ _totalSupplyOfLiquidityTokens         │
└──────────┴───────────────────────────────────────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                              │
│         "_totalSupplyOfLiquidityTokens": "Holds the value of total minted share or amount"                                                                                                                      │
│     },                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                              │
│         "_totalSupplyOfLiquidityTokens": "Holds the total supply/liquidity AND is used by the conditional branch to determine the supply/liquidity is 0"                                                        │
│     },                                                                                                                                                                                                          │
│     "VariableC": {                                                                                                                                                                                              │
│         "_baseTokenQtyDesired": "Holds the value of the deposit/mint/add amount"                                                                                                                                │
│     }                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:37:23] INFO     static_check: first_deposit_check: VariableA: _totalSupplyOfLiquidityTokens; VariableB: _totalSupplyOfLiquidityTokens; VariableC: _baseTokenQtyDesired             static_check.py:128
            first_deposit_check             
┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Argument ┃ Value                         ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ arg[0]   │ _totalSupplyOfLiquidityTokens │
│ arg[1]   │ _baseTokenQtyDesired          │
│ arg[2]   │ _totalSupplyOfLiquidityTokens │
└──────────┴───────────────────────────────┘
                                                                                                   Scan Results                                                                                                    
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Type                                     ┃ Description                                           ┃ Affected Files                                        ┃ Analysis Report                                      ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ Wrong Order for Interest or ExchangeRate │ Update of interest or exchange rate should be         │ ┏━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┓ │ ┏━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━┓ │
│                                          │ executed before calculating new balance, share,       │ ┃ File Path         ┃ Line Range ┃ Code             ┃ │ ┃ Secure  ┃         ┃         ┃          ┃         ┃ │
│                                          │ stake, loan or fee.                                   │ ┡━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━┩ │ ┃ Code    ┃ Best    ┃ CVSS    ┃          ┃         ┃ │
│                                          │                                                       │ │ /home/owen/Docum… │ 378 - 513  │     function     │ │ ┃ Exampl… ┃ Practi… ┃ Score   ┃ Severity ┃ Recomm… ┃ │
│                                          │                                                       │ │                   │            │ calculateAddLiq… │ │ ┡━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━┩ │
│                                          │                                                       │ │                   │            │                  │ │ │ To      │ To      │ 7.5     │ High     │ Ensure  │ │
│                                          │                                                       │ │                   │            │         uint256  │ │ │ improve │ mitiga… │         │          │ all     │ │
│                                          │                                                       │ │                   │            │ _baseTokenQtyDe… │ │ │ the     │ vulner… │         │          │ input   │ │
│                                          │                                                       │ │                   │            │                  │ │ │ securi… │ in the  │         │          │ data is │ │
│                                          │                                                       │ │                   │            │         uint256  │ │ │ of the  │ provid… │         │          │ proper… │ │
│                                          │                                                       │ │                   │            │ _quoteTokenQtyD… │ │ │ provid… │ code,   │         │          │ valida… │ │
│                                          │                                                       │ │                   │            │                  │ │ │ code,   │ consid… │         │          │ and     │ │
│                                          │                                                       │ │                   │            │         uint256  │ │ │ you can │ the     │         │          │ saniti… │ │
│                                          │                                                       │ │                   │            │ _baseTokenQtyMi… │ │ │ consid… │ follow… │         │          │ to      │ │
│                                          │                                                       │ │                   │            │                  │ │ │ the     │ best    │         │          │ prevent │ │
│                                          │                                                       │ │                   │            │         uint256  │ │ │ follow… │ practi… │         │          │ potent… │ │
│                                          │                                                       │ │                   │            │ _quoteTokenQtyM… │ │ │ secure  │         │         │          │ exploi… │ │
│                                          │                                                       │ │                   │            │                  │ │ │ altern… │ 1.      │         │          │ such as │ │
│                                          │                                                       │ │                   │            │         uint256  │ │ │         │ **Input │         │          │ inject… │ │
│                                          │                                                       │ │                   │            │ _baseTokenReser… │ │ │ 1.      │ Valida… │         │          │ attack… │ │
│                                          │                                                       │ │                   │            │                  │ │ │ **Use   │ Ensure  │         │          │ Implem… │ │
│                                          │                                                       │ │                   │            │         uint256  │ │ │ SafeMa… │ that    │         │          │ proper  │ │
│                                          │                                                       │ │                   │            │ _quoteTokenRese… │ │ │ Librar… │ all     │         │          │ error   │ │
│                                          │                                                       │ │                   │            │                  │ │ │ Replace │ extern… │         │          │ handli… │ │
│                                          │                                                       │ │                   │            │         uint256  │ │ │ arithm… │ inputs  │         │          │ and     │ │
│                                          │                                                       │ │                   │            │ _totalSupplyOfL… │ │ │ operat… │ are     │         │          │ input   │ │
│                                          │                                                       │ │                   │            │                  │ │ │ with    │ valida… │         │          │ valida… │ │
│                                          │                                                       │ │                   │            │         Interna… │ │ │ SafeMa… │ before  │         │          │ mechan… │ │
│                                          │                                                       │ │                   │            │ storage          │ │ │ library │ proces… │         │          │         │ │
│                                          │                                                       │ │                   │            │ _internalBalanc… │ │ │ to      │ Valida… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ prevent │ the     │         │          │         │ │
│                                          │                                                       │ │                   │            │     ) public     │ │ │ overfl… │ input   │         │          │         │ │
│                                          │                                                       │ │                   │            │ returns          │ │ │ and     │ parame… │         │          │         │ │
│                                          │                                                       │ │                   │            │ (TokenQtys       │ │ │ underf… │ to      │         │          │         │ │
│                                          │                                                       │ │                   │            │ memory           │ │ │         │ prevent │         │          │         │ │
│                                          │                                                       │ │                   │            │ tokenQtys) {     │ │ │ 2.      │ integer │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ **Acce… │ overfl… │         │          │         │ │
│                                          │                                                       │ │                   │            │         if       │ │ │ Contro… │ underf… │         │          │         │ │
│                                          │                                                       │ │                   │            │ (_totalSupplyOf… │ │ │ Implem… │ and     │         │          │         │ │
│                                          │                                                       │ │                   │            │ > 0) {           │ │ │ proper  │ other   │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ access  │ potent… │         │          │         │ │
│                                          │                                                       │ │                   │            │             //   │ │ │ control │ vulner… │         │          │         │ │
│                                          │                                                       │ │                   │            │ we have          │ │ │ mechan… │         │         │          │         │ │
│                                          │                                                       │ │                   │            │ outstanding      │ │ │ to      │ 2.      │         │          │         │ │
│                                          │                                                       │ │                   │            │ liquidity tokens │ │ │ restri… │ **Acce… │         │          │         │ │
│                                          │                                                       │ │                   │            │ present and an   │ │ │ who can │ Contro… │         │          │         │ │
│                                          │                                                       │ │                   │            │ existing price   │ │ │ call    │ Implem… │         │          │         │ │
│                                          │                                                       │ │                   │            │ curve            │ │ │ the     │ approp… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ functi… │ access  │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │         │ contro… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ 3.      │ to      │         │          │         │ │
│                                          │                                                       │ │                   │            │             tok… │ │ │ **Input │ restri… │         │          │         │ │
│                                          │                                                       │ │                   │            │ =                │ │ │ Valida… │ who can │         │          │         │ │
│                                          │                                                       │ │                   │            │ calculateLiquid… │ │ │ Valida… │ call    │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ input   │ the     │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ parame… │ functi… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ to      │ Consid… │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ ensure  │ using   │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ they    │ modifi… │         │          │         │ │
│                                          │                                                       │ │                   │            │             );   │ │ │ are     │ or      │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ within  │ access  │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ accept… │ control │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ ranges  │ mechan… │         │          │         │ │
│                                          │                                                       │ │                   │            │             //   │ │ │ and     │ to      │         │          │         │ │
│                                          │                                                       │ │                   │            │ we need to take  │ │ │ prevent │ restri… │         │          │         │ │
│                                          │                                                       │ │                   │            │ this amount      │ │ │ unexpe… │ access  │         │          │         │ │
│                                          │                                                       │ │                   │            │ (that will be    │ │ │ behavi… │ to      │         │          │         │ │
│                                          │                                                       │ │                   │            │ minted) into     │ │ │         │ author… │         │          │         │ │
│                                          │                                                       │ │                   │            │ account for      │ │ │ 4.      │ users.  │         │          │         │ │
│                                          │                                                       │ │                   │            │ below            │ │ │ **Error │         │         │          │         │ │
│                                          │                                                       │ │                   │            │ calculations     │ │ │ Handli… │ 3.      │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ Implem… │ **Error │         │          │         │ │
│                                          │                                                       │ │                   │            │             _to… │ │ │ robust  │ Handli… │         │          │         │ │
│                                          │                                                       │ │                   │            │ +=               │ │ │ error   │ Implem… │         │          │         │ │
│                                          │                                                       │ │                   │            │ tokenQtys.liqui… │ │ │ handli… │ robust  │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ mechan… │ error   │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ to      │ handli… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ provide │ mechan… │         │          │         │ │
│                                          │                                                       │ │                   │            │             //   │ │ │ clear   │ to      │         │          │         │ │
│                                          │                                                       │ │                   │            │ confirm that we  │ │ │ error   │ provide │         │          │         │ │
│                                          │                                                       │ │                   │            │ have no beta or  │ │ │ messag… │ clear   │         │          │         │ │
│                                          │                                                       │ │                   │            │ alpha decay      │ │ │ to      │ error   │         │          │         │ │
│                                          │                                                       │ │                   │            │ present          │ │ │ users.  │ messag… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │         │ and     │         │          │         │ │
│                                          │                                                       │ │                   │            │             //   │ │ │ 5.      │ prevent │         │          │         │ │
│                                          │                                                       │ │                   │            │ if we do, we     │ │ │ **Sepa… │ unexpe… │         │          │         │ │
│                                          │                                                       │ │                   │            │ need to resolve  │ │ │ of      │ behavi… │         │          │         │ │
│                                          │                                                       │ │                   │            │ that first       │ │ │ Concer… │ Use     │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ Consid… │ require │         │          │         │ │
│                                          │                                                       │ │                   │            │             if ( │ │ │ breaki… │ statem… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ down    │ to      │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ the     │ enforce │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ functi… │ condit… │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ into    │ that    │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ smalle… │ must be │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ more    │ met     │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ manage… │ before  │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ functi… │ procee… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ to      │         │         │          │         │ │
│                                          │                                                       │ │                   │            │             ) {  │ │ │ improve │ 4.      │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ readab… │ **Gas   │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ and     │ Limita… │         │          │         │ │
│                                          │                                                       │ │                   │            │ decay is present │ │ │ mainta… │ Be      │         │          │         │ │
│                                          │                                                       │ │                   │            │ and needs to be  │ │ │         │ mindful │         │          │         │ │
│                                          │                                                       │ │                   │            │ dealt with by    │ │ │ 6.      │ of gas  │         │          │         │ │
│                                          │                                                       │ │                   │            │ the caller.      │ │ │ **Event │ limita… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ Loggin… │ and     │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ Emit    │ optimi… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ events  │ the     │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ to log  │ code to │         │          │         │ │
│                                          │                                                       │ │                   │            │ baseTokenQtyFro… │ │ │ import… │ reduce  │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ state   │ gas     │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ changes │ costs.  │         │          │         │ │
│                                          │                                                       │ │                   │            │ quoteTokenQtyFr… │ │ │ and     │ Avoid   │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ intera… │ complex │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ within  │ calcul… │         │          │         │ │
│                                          │                                                       │ │                   │            │ liquidityTokenQ… │ │ │ the     │ or      │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ functi… │ loops   │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │         │ that    │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ Here is │ may     │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ a       │ consume │         │          │         │ │
│                                          │                                                       │ │                   │            │ (                │ │ │ simpli… │ excess… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ and     │ gas.    │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ more    │         │         │          │         │ │
│                                          │                                                       │ │                   │            │ >                │ │ │ secure  │ 5.      │         │          │         │ │
│                                          │                                                       │ │                   │            │ _internalBalanc… │ │ │ version │ **Secu… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ of the  │ Audits… │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ code    │ Consid… │         │          │         │ │
│                                          │                                                       │ │                   │            │ {                │ │ │ with    │ conduc… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ some of │ securi… │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ these   │ audits  │         │          │         │ │
│                                          │                                                       │ │                   │            │ we have more     │ │ │ improv… │ of the  │         │          │         │ │
│                                          │                                                       │ │                   │            │ base token than  │ │ │         │ code by │         │          │         │ │
│                                          │                                                       │ │                   │            │ expected (base   │ │ │ ```sol… │ third-… │         │          │         │ │
│                                          │                                                       │ │                   │            │ token decay) due │ │ │ import  │ experts │         │          │         │ │
│                                          │                                                       │ │                   │            │ to rebase up     │ │ │ "./Saf… │ to      │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │         │ identi… │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ contra… │ potent… │         │          │         │ │
│                                          │                                                       │ │                   │            │ we first need to │ │ │ Liquid… │ vulner… │         │          │         │ │
│                                          │                                                       │ │                   │            │ handle this      │ │ │ {       │ and     │         │          │         │ │
│                                          │                                                       │ │                   │            │ situation by     │ │ │     us… │ suggest │         │          │         │ │
│                                          │                                                       │ │                   │            │ requiring this   │ │ │ SafeMa… │ improv… │         │          │         │ │
│                                          │                                                       │ │                   │            │ user             │ │ │ for     │         │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ uint25… │ 6.      │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │         │ **Immu… │         │          │         │ │
│                                          │                                                       │ │                   │            │ to add quote     │ │ │     st… │ Variab… │         │          │         │ │
│                                          │                                                       │ │                   │            │ tokens           │ │ │ TokenQ… │ Consid… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ {       │ marking │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │       … │ variab… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ baseTo… │ as      │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │       … │ immuta… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ quoteT… │ where   │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │       … │ possib… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ liquid… │ to      │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │     }   │ prevent │         │          │         │ │
│                                          │                                                       │ │                   │            │ =                │ │ │         │ uninte… │         │          │         │ │
│                                          │                                                       │ │                   │            │ calculateAddQuo… │ │ │     fu… │ modifi… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ calcul… │         │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │       … │ 7.      │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ _baseT… │ **Code  │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │       … │ Commen… │         │          │         │ │
│                                          │                                                       │ │                   │            │ // there is no   │ │ │ _quote… │ Add     │         │          │         │ │
│                                          │                                                       │ │                   │            │ minimum for this │ │ │       … │ detail… │         │          │         │ │
│                                          │                                                       │ │                   │            │ particular call  │ │ │ _baseT… │ commen… │         │          │         │ │
│                                          │                                                       │ │                   │            │ since we may use │ │ │       … │ to      │         │          │         │ │
│                                          │                                                       │ │                   │            │ quote tokens     │ │ │ _quote… │ explain │         │          │         │ │
│                                          │                                                       │ │                   │            │ later.           │ │ │       … │ the     │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ _baseT… │ purpose │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │       … │ of the  │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ _quote… │ code,   │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │       … │ logic   │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ _total… │ behind  │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │       … │ calcul… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ storage │ and any │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ _inter… │ potent… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │     )   │ risks   │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ public  │ or      │         │          │         │ │
│                                          │                                                       │ │                   │            │ else {           │ │ │ returns │ consid… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ (Token… │         │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ memory  │ 8.      │         │          │         │ │
│                                          │                                                       │ │                   │            │ we have less     │ │ │ tokenQ… │ **Code  │         │          │         │ │
│                                          │                                                       │ │                   │            │ base token than  │ │ │ {       │ Refact… │         │          │         │ │
│                                          │                                                       │ │                   │            │ expected (quote  │ │ │       … │ Break   │         │          │         │ │
│                                          │                                                       │ │                   │            │ token decay) due │ │ │ Implem… │ down    │         │          │         │ │
│                                          │                                                       │ │                   │            │ to a rebase down │ │ │ your    │ complex │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ secure  │ functi… │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ logic   │ into    │         │          │         │ │
│                                          │                                                       │ │                   │            │ we first need to │ │ │ here    │ smalle… │         │          │         │ │
│                                          │                                                       │ │                   │            │ handle this by   │ │ │     }   │ more    │         │          │         │ │
│                                          │                                                       │ │                   │            │ adding base      │ │ │         │ manage… │         │          │         │ │
│                                          │                                                       │ │                   │            │ tokens to offset │ │ │     fu… │ functi… │         │          │         │ │
│                                          │                                                       │ │                   │            │ this.            │ │ │ sqrt(u… │ to      │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ x)      │ improve │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ intern… │ readab… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ pure    │ and     │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ returns │ mainta… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ (uint2… │         │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ {       │ 9.      │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │       … │ **Test… │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ Implem… │ Thorou… │         │          │         │ │
│                                          │                                                       │ │                   │            │ =                │ │ │ square  │ test    │         │          │         │ │
│                                          │                                                       │ │                   │            │ calculateAddBas… │ │ │ root    │ the     │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ calcul… │ code    │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │     }   │ under   │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ }       │ various │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ ```     │ scenar… │         │          │         │ │
│                                          │                                                       │ │                   │            │ // there is no   │ │ │         │ and     │         │          │         │ │
│                                          │                                                       │ │                   │            │ minimum for this │ │ │ Rememb… │ edge    │         │          │         │ │
│                                          │                                                       │ │                   │            │ particular call  │ │ │ to      │ cases   │         │          │         │ │
│                                          │                                                       │ │                   │            │ since we may use │ │ │ replace │ to      │         │          │         │ │
│                                          │                                                       │ │                   │            │ base tokens      │ │ │ `"Safe… │ ensure  │         │          │         │ │
│                                          │                                                       │ │                   │            │ later.           │ │ │ with    │ its     │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ the     │ securi… │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ actual  │ and     │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ SafeMa… │ functi… │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ library │ Consid… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ you are │ using   │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ using.  │ automa… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ Additi… │ testing │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ ensure  │ tools   │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ that    │ and     │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ all     │ framew… │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ necess… │         │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ checks  │ By      │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ and     │ follow… │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ valida… │ these   │         │          │         │ │
│                                          │                                                       │ │                   │            │ (                │ │ │ are     │ best    │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ includ… │ practi… │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ in the  │ and     │         │          │         │ │
│                                          │                                                       │ │                   │            │ <                │ │ │ actual  │ contin… │         │          │         │ │
│                                          │                                                       │ │                   │            │ _quoteTokenQtyD… │ │ │ implem… │ updati… │         │          │         │ │
│                                          │                                                       │ │                   │            │ &&               │ │ │ to make │ and     │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │ it more │ improv… │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │ secure. │ the     │         │          │         │ │
│                                          │                                                       │ │                   │            │ <                │ │ │         │ codeba… │         │          │         │ │
│                                          │                                                       │ │                   │            │ _baseTokenQtyDe… │ │ │         │ you can │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │         │ mitiga… │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │         │ vulner… │         │          │         │ │
│                                          │                                                       │ │                   │            │ {                │ │ │         │ and     │         │          │         │ │
│                                          │                                                       │ │                   │            │                  │ │ │         │ enhance │         │          │         │ │
│                                          │                                                       │ │                   │            │                … │ │ │         │ the     │         │          │         │ │
│                                          │                                                       │ │                   │            │ the user still   │ │ │         │ overall │         │          │         │ │
│                                          │                                                       │ │                   │            │ has qty that     │ │ │         │ securi… │         │          │         │ │
│                                          │                                                       │ │                   │            │ they desire to   │ │ │         │ of the  │         │          │         │ │
│                                          │                                                       │ │                   │            │ contribute to    │ │ │         │ smart   │         │          │         │ │
│                                          │                                                       │ │                   │            │ the exchange for │ │ │         │ contra… │         │          │         │ │
│                                          │                                                       │ │                   │            │ liquidity        │ │ └─────────┴─────────┴─────────┴──────────┴─────────┘ │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ =                │ │                                                      │
│                                          │                                                       │ │                   │            │ calculateAddTok… │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ -                │ │                                                      │
│                                          │                                                       │ │                   │            │ baseTokenQtyFro… │ │                                                      │
│                                          │                                                       │ │                   │            │ // safe from     │ │                                                      │
│                                          │                                                       │ │                   │            │ underflow quoted │ │                                                      │
│                                          │                                                       │ │                   │            │ on above IF      │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ -                │ │                                                      │
│                                          │                                                       │ │                   │            │ quoteTokenQtyFr… │ │                                                      │
│                                          │                                                       │ │                   │            │ // safe from     │ │                                                      │
│                                          │                                                       │ │                   │            │ underflow quoted │ │                                                      │
│                                          │                                                       │ │                   │            │ on above IF      │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ // we will check │ │                                                      │
│                                          │                                                       │ │                   │            │ minimums below   │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ // we will check │ │                                                      │
│                                          │                                                       │ │                   │            │ minimums below   │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ +                │ │                                                      │
│                                          │                                                       │ │                   │            │ quoteTokenQtyFr… │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ +                │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ // NOTE: these   │ │                                                      │
│                                          │                                                       │ │                   │            │ balances have    │ │                                                      │
│                                          │                                                       │ │                   │            │ already been     │ │                                                      │
│                                          │                                                       │ │                   │            │ updated when we  │ │                                                      │
│                                          │                                                       │ │                   │            │ did the decay    │ │                                                      │
│                                          │                                                       │ │                   │            │ math.            │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ +=               │ │                                                      │
│                                          │                                                       │ │                   │            │ baseTokenQtyFro… │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ +=               │ │                                                      │
│                                          │                                                       │ │                   │            │ quoteTokenQtyFr… │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ +=               │ │                                                      │
│                                          │                                                       │ │                   │            │ liquidityTokenQ… │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ >=               │ │                                                      │
│                                          │                                                       │ │                   │            │ _baseTokenQtyMi… │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ INSUFFICIENT_BA… │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ >=               │ │                                                      │
│                                          │                                                       │ │                   │            │ _quoteTokenQtyM… │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ INSUFFICIENT_QU… │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │             }    │ │                                                      │
│                                          │                                                       │ │                   │            │ else {           │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ the user is just │ │                                                      │
│                                          │                                                       │ │                   │            │ doing a simple   │ │                                                      │
│                                          │                                                       │ │                   │            │ double asset     │ │                                                      │
│                                          │                                                       │ │                   │            │ entry /          │ │                                                      │
│                                          │                                                       │ │                   │            │ providing both   │ │                                                      │
│                                          │                                                       │ │                   │            │ base and quote.  │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ =                │ │                                                      │
│                                          │                                                       │ │                   │            │ calculateAddTok… │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │             }    │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │         } else { │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │             //   │ │                                                      │
│                                          │                                                       │ │                   │            │ this user will   │ │                                                      │
│                                          │                                                       │ │                   │            │ set the initial  │ │                                                      │
│                                          │                                                       │ │                   │            │ pricing curve    │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │             req… │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ > 0,             │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ INSUFFICIENT_BA… │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │             );   │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │             req… │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ > 0,             │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ INSUFFICIENT_QU… │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │             );   │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │             tok… │ │                                                      │
│                                          │                                                       │ │                   │            │ =                │ │                                                      │
│                                          │                                                       │ │                   │            │ _baseTokenQtyDe… │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │             tok… │ │                                                      │
│                                          │                                                       │ │                   │            │ =                │ │                                                      │
│                                          │                                                       │ │                   │            │ _quoteTokenQtyD… │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │             tok… │ │                                                      │
│                                          │                                                       │ │                   │            │ = sqrt(          │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                … │ │                                                      │
│                                          │                                                       │ │                   │            │ *                │ │                                                      │
│                                          │                                                       │ │                   │            │ _quoteTokenQtyD… │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │             );   │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │             _in… │ │                                                      │
│                                          │                                                       │ │                   │            │ +=               │ │                                                      │
│                                          │                                                       │ │                   │            │ tokenQtys.baseT… │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │             _in… │ │                                                      │
│                                          │                                                       │ │                   │            │ +=               │ │                                                      │
│                                          │                                                       │ │                   │            │ tokenQtys.quote… │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │         }        │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ │                   │            │     }            │ │                                                      │
│                                          │                                                       │ │                   │            │                  │ │                                                      │
│                                          │                                                       │ └───────────────────┴────────────┴──────────────────┘ │                                                      │
└──────────────────────────────────────────┴───────────────────────────────────────────────────────┴───────────────────────────────────────────────────────┴──────────────────────────────────────────────────────┘
                  Summary                   
┏━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓
┃ Key                  ┃ Value             ┃
┡━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩
│ Files                │ 6                 │
│ Contracts            │ 6                 │
│ Functions            │ 17                │
│ Lines of Code        │ 1208              │
│ Used Time            │ 73.12531757354736 │
│ Estimated Cost (USD) │ 0.1159505         │
└──────────────────────┴───────────────────┘
