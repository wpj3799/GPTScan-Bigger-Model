

  .oooooo.    ooooooooo.   ooooooooooooo  .oooooo..o                                 
 d8P'  `Y8b   `888   `Y88. 8'   888   `8 d8P'    `Y8                                 
888            888   .d88'      888      Y88bo.       .ooooo.   .oooo.   ooo. .oo.   
888            888ooo88P'       888       `"Y8888o.  d88' `"Y8 `P  )88b  `888P"Y88b  
888     ooooo  888              888           `"Y88b 888        .oP"888   888   888  
`88.    .88'   888              888      oo     .d8P 888   .o8 d8(  888   888   888  
 `Y8bood8P'   o888o            o888o     8""88888P'  `Y8bod8P' `Y888""8o o888o o888o                                                        


                                                                   

[19:19:28] Loaded 10 rules                                                                                                                                                                             tasks.py:119
[12/08/24 19:19:28] INFO     CryticCompile: 'npx hardhat clean' running (wd: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-11-overlay-main)              subprocess.py:41
[12/08/24 19:19:30] INFO     CryticCompile: 'npx hardhat clean --global' running (wd: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-11-overlay-main)     subprocess.py:41
[12/08/24 19:19:32] INFO     CryticCompile: 'npx hardhat compile --force' running (wd: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-11-overlay-main)    subprocess.py:41
[12/08/24 19:19:34] ERROR    CryticCompile: 'npx' returned non-zero exit code 1                                                                                                                    subprocess.py:60
                    ERROR    CryticCompile: Error HH411: The library @openzeppelin/contracts, imported from contracts/OverlayToken.sol, is not installed. Try installing it using npm.             subprocess.py:68
                             stderr: For more info go to https://hardhat.org/HH411 or run Hardhat with --show-stack-traces                                                                                         
[19:19:34] Traceback (most recent call last):                                                                                                                                                          tasks.py:126
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/falcon/falcon.py", line 90, in __init__                                                                     
               crytic_compile = CryticCompile(target, **kwargs)                                                                                                                                                    
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/crytic_compile/crytic_compile.py", line 131, in __init__                                                    
               self._compile(**kwargs)                                                                                                                                                                             
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/crytic_compile/crytic_compile.py", line 553, in _compile                                                    
               self._platform.compile(self, **kwargs)                                                                                                                                                              
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/crytic_compile/platform/hardhat.py", line 183, in compile                                                   
               hardhat_like_parsing(crytic_compile, self._target, build_directory, hardhat_working_dir)                                                                                                            
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/crytic_compile/platform/hardhat.py", line 52, in hardhat_like_parsing                                       
               raise InvalidCompilation(txt)                                                                                                                                                                       
           crytic_compile.platform.exceptions.InvalidCompilation: Compilation failed. Can you run build command?                                                                                                   
           /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-11-overlay-main/artifacts/build-info is not a directory.                                                        
                                                                                                                                                                                                                   
           During handling of the above exception, another exception occurred:                                                                                                                                     
                                                                                                                                                                                                                   
           Traceback (most recent call last):                                                                                                                                                                      
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 124, in simple_cli                                                                                                         
               falcon_instance = compile_project(source_dir)                                                                                                                                                       
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 103, in compile_project                                                                                                    
               return falcon.Falcon(abs_path)                                                                                                                                                                      
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/falcon/falcon.py", line 94, in __init__                                                                     
               raise FalconError(f"Invalid compilation: \n{str(e)}")                                                                                                                                               
           falcon.exceptions.FalconError: Invalid compilation:                                                                                                                                                     
           Compilation failed. Can you run build command?                                                                                                                                                          
           /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-11-overlay-main/artifacts/build-info is not a directory.                                                        
                                                                                                                                                                                                                   
           Compile failed.                                                                                                                                                                             tasks.py:127
           Since the compilation is failed, some static analysis tool may not be enabled, which may cause lower precision and recall.                                                                  tasks.py:128
[12/08/24 19:19:36] INFO     antlr4helper.callgraph: In whitelist: AccessControl.renounceRole(bytes32,address) returns()                                                                            callgraph.py:21
                    INFO     antlr4helper.callgraph: In whitelist: AccessControl._setRoleAdmin(bytes32,bytes32) returns()                                                                           callgraph.py:21
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function addOi(                                                                                                                                                                                             │
│         bool _isLong,                                                                                                                                                                                           │
│         uint256 _openInterest,                                                                                                                                                                                  │
│         uint256 _oiCap                                                                                                                                                                                          │
│     ) internal {                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         if (_isLong) {                                                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│             oiLongShares += _openInterest;                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│             uint _oiLong = __oiLong__ + _openInterest;                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│             require(_oiLong <= _oiCap, "OVLV1:>cap");                                                                                                                                                           │
│                                                                                                                                                                                                                 │
│             __oiLong__ = _oiLong;                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         } else {                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│             oiShortShares += _openInterest;                                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│             uint _oiShort = __oiShort__ + _openInterest;                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│             require(_oiShort <= _oiCap, "OVLV1:>cap");                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│             __oiShort__ = _oiShort;                                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                      │
│ Code:                                                                                                                                                                                                           │
│     function addOi(                                                                                                                                                                                             │
│         bool _isLong,                                                                                                                                                                                           │
│         uint256 _openInterest,                                                                                                                                                                                  │
│         uint256 _oiCap                                                                                                                                                                                          │
│     ) internal {                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         if (_isLong) {                                                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│             oiLongShares += _openInterest;                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│             uint _oiLong = __oiLong__ + _openInterest;                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│             require(_oiLong <= _oiCap, "OVLV1:>cap");                                                                                                                                                           │
│                                                                                                                                                                                                                 │
│             __oiLong__ = _oiLong;                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         } else {                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│             oiShortShares += _openInterest;                                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│             uint _oiShort = __oiShort__ + _openInterest;                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│             require(_oiShort <= _oiCap, "OVLV1:>cap");                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│             __oiShort__ = _oiShort;                                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function adjustGlobalParams(                                                                                                                                                                                │
│         uint16 _fee,                                                                                                                                                                                            │
│         uint16 _feeBurnRate,                                                                                                                                                                                    │
│         address _feeTo                                                                                                                                                                                          │
│     ) external onlyGovernor {                                                                                                                                                                                   │
│         fee = _fee;                                                                                                                                                                                             │
│         feeBurnRate = _feeBurnRate;                                                                                                                                                                             │
│         feeTo = _feeTo;                                                                                                                                                                                         │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve transfering token from an address different from message sender                                                                                                                              │
│ Code:                                                                                                                                                                                                           │
│     function transferBurn(                                                                                                                                                                                      │
│         address recipient,                                                                                                                                                                                      │
│         uint256 amount,                                                                                                                                                                                         │
│         uint256 burnt                                                                                                                                                                                           │
│     ) public override onlyBurner returns (                                                                                                                                                                      │
│         bool                                                                                                                                                                                                    │
│     ) {                                                                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         _transferBurn(msg.sender, recipient, amount, burnt);                                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         return true;                                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve transfering token from an address different from message sender                                                                                                                              │
│ Code:                                                                                                                                                                                                           │
│     function transferMint(                                                                                                                                                                                      │
│         address recipient,                                                                                                                                                                                      │
│         uint256 amount,                                                                                                                                                                                         │
│         uint256 minted                                                                                                                                                                                          │
│     ) public override onlyMinter returns (                                                                                                                                                                      │
│         bool success                                                                                                                                                                                            │
│     ) {                                                                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         _transferMint(msg.sender, recipient, amount, minted);                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         success = true;                                                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: involve transfering token from an address different from message sender and there is no check of allowance/approval from the address owner                                                           │
│ Code:                                                                                                                                                                                                           │
│     function transferMint(                                                                                                                                                                                      │
│         address recipient,                                                                                                                                                                                      │
│         uint256 amount,                                                                                                                                                                                         │
│         uint256 minted                                                                                                                                                                                          │
│     ) public override onlyMinter returns (                                                                                                                                                                      │
│         bool success                                                                                                                                                                                            │
│     ) {                                                                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         _transferMint(msg.sender, recipient, amount, minted);                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         success = true;                                                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function _mint(                                                                                                                                                                                             │
│         address account,                                                                                                                                                                                        │
│         uint256 amount                                                                                                                                                                                          │
│     ) internal virtual {                                                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         require(account != address(0), "ERC20: mint to the zero address");                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         _beforeTokenTransfer(address(0), account, amount);                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         _totalSupply += amount;                                                                                                                                                                                 │
│         _balances += amount;                                                                                                                                                                                    │
│         emit Transfer(address(0), account, amount);                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         _afterTokenTransfer(address(0), account, amount);                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function build (                                                                                                                                                                                            │
│         address _market,                                                                                                                                                                                        │
│         uint256 _collateral,                                                                                                                                                                                    │
│         uint256 _leverage,                                                                                                                                                                                      │
│         bool _isLong,                                                                                                                                                                                           │
│         uint256 _oiMinimum                                                                                                                                                                                      │
│     ) external returns (                                                                                                                                                                                        │
│         uint positionId_                                                                                                                                                                                        │
│     ) {                                                                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         require(mothership.marketActive(_market), "OVLV1:!market");                                                                                                                                             │
│         require(_leverage <= marketInfo[_market].maxLeverage, "OVLV1:lev>max");                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         (   uint _oiAdjusted,                                                                                                                                                                                   │
│             uint _collateralAdjusted,                                                                                                                                                                           │
│             uint _debtAdjusted,                                                                                                                                                                                 │
│             uint _fee,                                                                                                                                                                                          │
│             uint _impact,                                                                                                                                                                                       │
│             uint _pricePointNext ) = IOverlayV1Market(_market)                                                                                                                                                  │
│                 .enterOI(                                                                                                                                                                                       │
│                     _isLong,                                                                                                                                                                                    │
│                     _collateral,                                                                                                                                                                                │
│                     _leverage                                                                                                                                                                                   │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         require(_oiAdjusted >= _oiMinimum, "OVLV1:oi<min");                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         uint _positionId = getCurrentBlockPositionId(                                                                                                                                                           │
│             _market,                                                                                                                                                                                            │
│             _isLong,                                                                                                                                                                                            │
│             _leverage,                                                                                                                                                                                          │
│             _pricePointNext                                                                                                                                                                                     │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         Position.Info storage pos = positions[_positionId];                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         pos.oiShares += _oiAdjusted;                                                                                                                                                                            │
│         pos.cost += _collateralAdjusted;                                                                                                                                                                        │
│         pos.debt += _debtAdjusted;                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         fees += _fee;                                                                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         emit Build(_market, _positionId, _oiAdjusted, _debtAdjusted);                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         ovl.transferFromBurn(msg.sender, address(this), _collateralAdjusted + _fee, _impact);                                                                                                                   │
│                                                                                                                                                                                                                 │
│         // ovl.burn(msg.sender, _impact);                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         _mint(msg.sender, _positionId, _oiAdjusted, ""); // WARNING: last b/c erc1155 callback                                                                                                                  │
│                                                                                                                                                                                                                 │
│         positionId_ = _positionId;                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
│     function _mint(                                                                                                                                                                                             │
│         address account,                                                                                                                                                                                        │
│         uint256 amount                                                                                                                                                                                          │
│     ) internal virtual {                                                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         require(account != address(0), "ERC20: mint to the zero address");                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         _beforeTokenTransfer(address(0), account, amount);                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         _totalSupply += amount;                                                                                                                                                                                 │
│         _balances += amount;                                                                                                                                                                                    │
│         emit Transfer(address(0), account, amount);                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         _afterTokenTransfer(address(0), account, amount);                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function build (                                                                                                                                                                                            │
│         address _market,                                                                                                                                                                                        │
│         uint256 _collateral,                                                                                                                                                                                    │
│         uint256 _leverage,                                                                                                                                                                                      │
│         bool _isLong,                                                                                                                                                                                           │
│         uint256 _oiMinimum                                                                                                                                                                                      │
│     ) external returns (                                                                                                                                                                                        │
│         uint positionId_                                                                                                                                                                                        │
│     ) {                                                                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         require(mothership.marketActive(_market), "OVLV1:!market");                                                                                                                                             │
│         require(_leverage <= marketInfo[_market].maxLeverage, "OVLV1:lev>max");                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         (   uint _oiAdjusted,                                                                                                                                                                                   │
│             uint _collateralAdjusted,                                                                                                                                                                           │
│             uint _debtAdjusted,                                                                                                                                                                                 │
│             uint _fee,                                                                                                                                                                                          │
│             uint _impact,                                                                                                                                                                                       │
│             uint _pricePointNext ) = IOverlayV1Market(_market)                                                                                                                                                  │
│                 .enterOI(                                                                                                                                                                                       │
│                     _isLong,                                                                                                                                                                                    │
│                     _collateral,                                                                                                                                                                                │
│                     _leverage                                                                                                                                                                                   │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         require(_oiAdjusted >= _oiMinimum, "OVLV1:oi<min");                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         uint _positionId = getCurrentBlockPositionId(                                                                                                                                                           │
│             _market,                                                                                                                                                                                            │
│             _isLong,                                                                                                                                                                                            │
│             _leverage,                                                                                                                                                                                          │
│             _pricePointNext                                                                                                                                                                                     │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         Position.Info storage pos = positions[_positionId];                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         pos.oiShares += _oiAdjusted;                                                                                                                                                                            │
│         pos.cost += _collateralAdjusted;                                                                                                                                                                        │
│         pos.debt += _debtAdjusted;                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         fees += _fee;                                                                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         emit Build(_market, _positionId, _oiAdjusted, _debtAdjusted);                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         ovl.transferFromBurn(msg.sender, address(this), _collateralAdjusted + _fee, _impact);                                                                                                                   │
│                                                                                                                                                                                                                 │
│         // ovl.burn(msg.sender, _impact);                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         _mint(msg.sender, _positionId, _oiAdjusted, ""); // WARNING: last b/c erc1155 callback                                                                                                                  │
│                                                                                                                                                                                                                 │
│         positionId_ = _positionId;                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
│     function _mint(                                                                                                                                                                                             │
│         address account,                                                                                                                                                                                        │
│         uint256 amount                                                                                                                                                                                          │
│     ) internal virtual {                                                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         require(account != address(0), "ERC20: mint to the zero address");                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         _beforeTokenTransfer(address(0), account, amount);                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         _totalSupply += amount;                                                                                                                                                                                 │
│         _balances += amount;                                                                                                                                                                                    │
│         emit Transfer(address(0), account, amount);                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         _afterTokenTransfer(address(0), account, amount);                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function _burn(                                                                                                                                                                                             │
│         address account,                                                                                                                                                                                        │
│         uint256 amount                                                                                                                                                                                          │
│     ) internal virtual {                                                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         require(account != address(0), "ERC20: burn from the zero address");                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         _beforeTokenTransfer(account, address(0), amount);                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint256 accountBalance = _balances;                                                                                                                                                                     │
│         require(accountBalance >= amount, "ERC20: burn amount exceeds balance");                                                                                                                                │
│         unchecked {                                                                                                                                                                                             │
│             _balances = accountBalance - amount;                                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│         _totalSupply -= amount;                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         emit Transfer(account, address(0), amount);                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         _afterTokenTransfer(account, address(0), amount);                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function unwind (                                                                                                                                                                                           │
│         uint256 _positionId,                                                                                                                                                                                    │
│         uint256 _shares                                                                                                                                                                                         │
│     ) external {                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         require( 0 < _shares && _shares <= balanceOf(msg.sender, _positionId), "OVLV1:!shares");                                                                                                                │
│                                                                                                                                                                                                                 │
│         Position.Info storage pos = positions[_positionId];                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         require(0 < pos.oiShares, "OVLV1:liquidated");                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         {                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         (   uint _oi,                                                                                                                                                                                           │
│             uint _oiShares,                                                                                                                                                                                     │
│             uint _priceFrame ) = IOverlayV1Market(pos.market)                                                                                                                                                   │
│                 .exitData(                                                                                                                                                                                      │
│                     pos.isLong,                                                                                                                                                                                 │
│                     pos.pricePoint                                                                                                                                                                              │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         uint _totalPosShares = totalSupply(_positionId);                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         uint _userOiShares = _shares;                                                                                                                                                                           │
│         uint _userNotional = _shares * pos.notional(_oi, _oiShares, _priceFrame) / _totalPosShares;                                                                                                             │
│         uint _userDebt = _shares * pos.debt / _totalPosShares;                                                                                                                                                  │
│         uint _userCost = _shares * pos.cost / _totalPosShares;                                                                                                                                                  │
│         uint _userOi = _shares * pos.oi(_oi, _oiShares) / _totalPosShares;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         emit Unwind(pos.market, _positionId, _userOi, _userDebt);                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         // TODO: think through edge case of underwater position ... and fee adjustments ...                                                                                                                     │
│         uint _feeAmount = _userNotional.mulUp(mothership.fee());                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         uint _userValueAdjusted = _userNotional - _feeAmount;                                                                                                                                                   │
│         if (_userValueAdjusted > _userDebt) _userValueAdjusted -= _userDebt;                                                                                                                                    │
│         else _userValueAdjusted = 0;                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         fees += _feeAmount; // adds to fee pot, which is transferred on update                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         pos.debt -= _userDebt;                                                                                                                                                                                  │
│         pos.cost -= _userCost;                                                                                                                                                                                  │
│         pos.oiShares -= _userOiShares;                                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         // ovl.transfer(msg.sender, _userCost);                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         // mint/burn excess PnL = valueAdjusted - cost                                                                                                                                                          │
│         if (_userCost < _userValueAdjusted) {                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│             ovl.transferMint(                                                                                                                                                                                   │
│                 msg.sender,                                                                                                                                                                                     │
│                 _userCost,                                                                                                                                                                                      │
│                 _userValueAdjusted - _userCost                                                                                                                                                                  │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         } else {                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│             ovl.transferBurn(                                                                                                                                                                                   │
│                 msg.sender,                                                                                                                                                                                     │
│                 _userValueAdjusted,                                                                                                                                                                             │
│                 _userCost - _userValueAdjusted                                                                                                                                                                  │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         IOverlayV1Market(pos.market).exitOI(                                                                                                                                                                    │
│             pos.isLong,                                                                                                                                                                                         │
│             _userOi,                                                                                                                                                                                            │
│             _userOiShares,                                                                                                                                                                                      │
│             _userCost < _userValueAdjusted ? _userValueAdjusted - _userCost : 0,                                                                                                                                │
│             _userCost < _userValueAdjusted ? 0 : _userCost - _userValueAdjusted                                                                                                                                 │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         _burn(msg.sender, _positionId, _shares);                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
│     function _burn(                                                                                                                                                                                             │
│         address account,                                                                                                                                                                                        │
│         uint256 amount                                                                                                                                                                                          │
│     ) internal virtual {                                                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         require(account != address(0), "ERC20: burn from the zero address");                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         _beforeTokenTransfer(account, address(0), amount);                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint256 accountBalance = _balances;                                                                                                                                                                     │
│         require(accountBalance >= amount, "ERC20: burn amount exceeds balance");                                                                                                                                │
│         unchecked {                                                                                                                                                                                             │
│             _balances = accountBalance - amount;                                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│         _totalSupply -= amount;                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         emit Transfer(account, address(0), amount);                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         _afterTokenTransfer(account, address(0), amount);                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function unwind (                                                                                                                                                                                           │
│         uint256 _positionId,                                                                                                                                                                                    │
│         uint256 _shares                                                                                                                                                                                         │
│     ) external {                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         require( 0 < _shares && _shares <= balanceOf(msg.sender, _positionId), "OVLV1:!shares");                                                                                                                │
│                                                                                                                                                                                                                 │
│         Position.Info storage pos = positions[_positionId];                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         require(0 < pos.oiShares, "OVLV1:liquidated");                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         {                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         (   uint _oi,                                                                                                                                                                                           │
│             uint _oiShares,                                                                                                                                                                                     │
│             uint _priceFrame ) = IOverlayV1Market(pos.market)                                                                                                                                                   │
│                 .exitData(                                                                                                                                                                                      │
│                     pos.isLong,                                                                                                                                                                                 │
│                     pos.pricePoint                                                                                                                                                                              │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         uint _totalPosShares = totalSupply(_positionId);                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         uint _userOiShares = _shares;                                                                                                                                                                           │
│         uint _userNotional = _shares * pos.notional(_oi, _oiShares, _priceFrame) / _totalPosShares;                                                                                                             │
│         uint _userDebt = _shares * pos.debt / _totalPosShares;                                                                                                                                                  │
│         uint _userCost = _shares * pos.cost / _totalPosShares;                                                                                                                                                  │
│         uint _userOi = _shares * pos.oi(_oi, _oiShares) / _totalPosShares;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         emit Unwind(pos.market, _positionId, _userOi, _userDebt);                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         // TODO: think through edge case of underwater position ... and fee adjustments ...                                                                                                                     │
│         uint _feeAmount = _userNotional.mulUp(mothership.fee());                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         uint _userValueAdjusted = _userNotional - _feeAmount;                                                                                                                                                   │
│         if (_userValueAdjusted > _userDebt) _userValueAdjusted -= _userDebt;                                                                                                                                    │
│         else _userValueAdjusted = 0;                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         fees += _feeAmount; // adds to fee pot, which is transferred on update                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         pos.debt -= _userDebt;                                                                                                                                                                                  │
│         pos.cost -= _userCost;                                                                                                                                                                                  │
│         pos.oiShares -= _userOiShares;                                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         // ovl.transfer(msg.sender, _userCost);                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         // mint/burn excess PnL = valueAdjusted - cost                                                                                                                                                          │
│         if (_userCost < _userValueAdjusted) {                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│             ovl.transferMint(                                                                                                                                                                                   │
│                 msg.sender,                                                                                                                                                                                     │
│                 _userCost,                                                                                                                                                                                      │
│                 _userValueAdjusted - _userCost                                                                                                                                                                  │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         } else {                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│             ovl.transferBurn(                                                                                                                                                                                   │
│                 msg.sender,                                                                                                                                                                                     │
│                 _userValueAdjusted,                                                                                                                                                                             │
│                 _userCost - _userValueAdjusted                                                                                                                                                                  │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         IOverlayV1Market(pos.market).exitOI(                                                                                                                                                                    │
│             pos.isLong,                                                                                                                                                                                         │
│             _userOi,                                                                                                                                                                                            │
│             _userOiShares,                                                                                                                                                                                      │
│             _userCost < _userValueAdjusted ? _userValueAdjusted - _userCost : 0,                                                                                                                                │
│             _userCost < _userValueAdjusted ? 0 : _userCost - _userValueAdjusted                                                                                                                                 │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         _burn(msg.sender, _positionId, _shares);                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
│     function _burn(                                                                                                                                                                                             │
│         address account,                                                                                                                                                                                        │
│         uint256 amount                                                                                                                                                                                          │
│     ) internal virtual {                                                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         require(account != address(0), "ERC20: burn from the zero address");                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         _beforeTokenTransfer(account, address(0), amount);                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         uint256 accountBalance = _balances;                                                                                                                                                                     │
│         require(accountBalance >= amount, "ERC20: burn amount exceeds balance");                                                                                                                                │
│         unchecked {                                                                                                                                                                                             │
│             _balances = accountBalance - amount;                                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│         _totalSupply -= amount;                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         emit Transfer(account, address(0), amount);                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         _afterTokenTransfer(account, address(0), amount);                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function setMarketInfo (                                                                                                                                                                                    │
│         address _market,                                                                                                                                                                                        │
│         uint _marginMaintenance,                                                                                                                                                                                │
│         uint _marginRewardRate,                                                                                                                                                                                 │
│         uint _maxLeverage                                                                                                                                                                                       │
│     ) external onlyGovernor {                                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         marketInfo[_market].marginMaintenance = _marginMaintenance;                                                                                                                                             │
│         marketInfo[_market].marginRewardRate = _marginRewardRate;                                                                                                                                               │
│         marketInfo[_market].maxLeverage = _maxLeverage;                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                      │
│ Code:                                                                                                                                                                                                           │
│     function setMarketInfo (                                                                                                                                                                                    │
│         address _market,                                                                                                                                                                                        │
│         uint _marginMaintenance,                                                                                                                                                                                │
│         uint _marginRewardRate,                                                                                                                                                                                 │
│         uint _maxLeverage                                                                                                                                                                                       │
│     ) external onlyGovernor {                                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         marketInfo[_market].marginMaintenance = _marginMaintenance;                                                                                                                                             │
│         marketInfo[_market].marginRewardRate = _marginRewardRate;                                                                                                                                               │
│         marketInfo[_market].maxLeverage = _maxLeverage;                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function disburse () public {                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         (   uint256 _marginBurnRate,                                                                                                                                                                            │
│             uint256 _feeBurnRate,                                                                                                                                                                               │
│             address _feeTo ) = mothership.getUpdateParams();                                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         uint _feeForward = fees;                                                                                                                                                                                │
│         uint _feeBurn = _feeForward.mulUp(_feeBurnRate);                                                                                                                                                        │
│         _feeForward = _feeForward - _feeBurn;                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         uint _liqForward = liquidations;                                                                                                                                                                        │
│         uint _liqBurn = _liqForward.mulUp(_marginBurnRate);                                                                                                                                                     │
│         _liqForward -= _liqBurn;                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         fees = 0;                                                                                                                                                                                               │
│         liquidations = 0;                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         emit Update(                                                                                                                                                                                            │
│             _feeForward,                                                                                                                                                                                        │
│             _feeBurn,                                                                                                                                                                                           │
│             _liqForward,                                                                                                                                                                                        │
│             _liqBurn                                                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         ovl.burn(address(this), _feeBurn + _liqBurn);                                                                                                                                                           │
│         ovl.transfer(_feeTo, _feeForward + _liqForward);                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                      │
│ Code:                                                                                                                                                                                                           │
│     function disburse () public {                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         (   uint256 _marginBurnRate,                                                                                                                                                                            │
│             uint256 _feeBurnRate,                                                                                                                                                                               │
│             address _feeTo ) = mothership.getUpdateParams();                                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         uint _feeForward = fees;                                                                                                                                                                                │
│         uint _feeBurn = _feeForward.mulUp(_feeBurnRate);                                                                                                                                                        │
│         _feeForward = _feeForward - _feeBurn;                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         uint _liqForward = liquidations;                                                                                                                                                                        │
│         uint _liqBurn = _liqForward.mulUp(_marginBurnRate);                                                                                                                                                     │
│         _liqForward -= _liqBurn;                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         fees = 0;                                                                                                                                                                                               │
│         liquidations = 0;                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         emit Update(                                                                                                                                                                                            │
│             _feeForward,                                                                                                                                                                                        │
│             _feeBurn,                                                                                                                                                                                           │
│             _liqForward,                                                                                                                                                                                        │
│             _liqBurn                                                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         ovl.burn(address(this), _feeBurn + _liqBurn);                                                                                                                                                           │
│         ovl.transfer(_feeTo, _feeForward + _liqForward);                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                │
│ Code:                                                                                                                                                                                                           │
│     function unwind (                                                                                                                                                                                           │
│         uint256 _positionId,                                                                                                                                                                                    │
│         uint256 _shares                                                                                                                                                                                         │
│     ) external {                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         require( 0 < _shares && _shares <= balanceOf(msg.sender, _positionId), "OVLV1:!shares");                                                                                                                │
│                                                                                                                                                                                                                 │
│         Position.Info storage pos = positions[_positionId];                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         require(0 < pos.oiShares, "OVLV1:liquidated");                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         {                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         (   uint _oi,                                                                                                                                                                                           │
│             uint _oiShares,                                                                                                                                                                                     │
│             uint _priceFrame ) = IOverlayV1Market(pos.market)                                                                                                                                                   │
│                 .exitData(                                                                                                                                                                                      │
│                     pos.isLong,                                                                                                                                                                                 │
│                     pos.pricePoint                                                                                                                                                                              │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         uint _totalPosShares = totalSupply(_positionId);                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         uint _userOiShares = _shares;                                                                                                                                                                           │
│         uint _userNotional = _shares * pos.notional(_oi, _oiShares, _priceFrame) / _totalPosShares;                                                                                                             │
│         uint _userDebt = _shares * pos.debt / _totalPosShares;                                                                                                                                                  │
│         uint _userCost = _shares * pos.cost / _totalPosShares;                                                                                                                                                  │
│         uint _userOi = _shares * pos.oi(_oi, _oiShares) / _totalPosShares;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         emit Unwind(pos.market, _positionId, _userOi, _userDebt);                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         // TODO: think through edge case of underwater position ... and fee adjustments ...                                                                                                                     │
│         uint _feeAmount = _userNotional.mulUp(mothership.fee());                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         uint _userValueAdjusted = _userNotional - _feeAmount;                                                                                                                                                   │
│         if (_userValueAdjusted > _userDebt) _userValueAdjusted -= _userDebt;                                                                                                                                    │
│         else _userValueAdjusted = 0;                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         fees += _feeAmount; // adds to fee pot, which is transferred on update                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         pos.debt -= _userDebt;                                                                                                                                                                                  │
│         pos.cost -= _userCost;                                                                                                                                                                                  │
│         pos.oiShares -= _userOiShares;                                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         // ovl.transfer(msg.sender, _userCost);                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         // mint/burn excess PnL = valueAdjusted - cost                                                                                                                                                          │
│         if (_userCost < _userValueAdjusted) {                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│             ovl.transferMint(                                                                                                                                                                                   │
│                 msg.sender,                                                                                                                                                                                     │
│                 _userCost,                                                                                                                                                                                      │
│                 _userValueAdjusted - _userCost                                                                                                                                                                  │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         } else {                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│             ovl.transferBurn(                                                                                                                                                                                   │
│                 msg.sender,                                                                                                                                                                                     │
│                 _userValueAdjusted,                                                                                                                                                                             │
│                 _userCost - _userValueAdjusted                                                                                                                                                                  │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         IOverlayV1Market(pos.market).exitOI(                                                                                                                                                                    │
│             pos.isLong,                                                                                                                                                                                         │
│             _userOi,                                                                                                                                                                                            │
│             _userOiShares,                                                                                                                                                                                      │
│             _userCost < _userValueAdjusted ? _userValueAdjusted - _userCost : 0,                                                                                                                                │
│             _userCost < _userValueAdjusted ? 0 : _userCost - _userValueAdjusted                                                                                                                                 │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         _burn(msg.sender, _positionId, _shares);                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                               │
│ Code:                                                                                                                                                                                                           │
│     function unwind (                                                                                                                                                                                           │
│         uint256 _positionId,                                                                                                                                                                                    │
│         uint256 _shares                                                                                                                                                                                         │
│     ) external {                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         require( 0 < _shares && _shares <= balanceOf(msg.sender, _positionId), "OVLV1:!shares");                                                                                                                │
│                                                                                                                                                                                                                 │
│         Position.Info storage pos = positions[_positionId];                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         require(0 < pos.oiShares, "OVLV1:liquidated");                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         {                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         (   uint _oi,                                                                                                                                                                                           │
│             uint _oiShares,                                                                                                                                                                                     │
│             uint _priceFrame ) = IOverlayV1Market(pos.market)                                                                                                                                                   │
│                 .exitData(                                                                                                                                                                                      │
│                     pos.isLong,                                                                                                                                                                                 │
│                     pos.pricePoint                                                                                                                                                                              │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         uint _totalPosShares = totalSupply(_positionId);                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         uint _userOiShares = _shares;                                                                                                                                                                           │
│         uint _userNotional = _shares * pos.notional(_oi, _oiShares, _priceFrame) / _totalPosShares;                                                                                                             │
│         uint _userDebt = _shares * pos.debt / _totalPosShares;                                                                                                                                                  │
│         uint _userCost = _shares * pos.cost / _totalPosShares;                                                                                                                                                  │
│         uint _userOi = _shares * pos.oi(_oi, _oiShares) / _totalPosShares;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         emit Unwind(pos.market, _positionId, _userOi, _userDebt);                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         // TODO: think through edge case of underwater position ... and fee adjustments ...                                                                                                                     │
│         uint _feeAmount = _userNotional.mulUp(mothership.fee());                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         uint _userValueAdjusted = _userNotional - _feeAmount;                                                                                                                                                   │
│         if (_userValueAdjusted > _userDebt) _userValueAdjusted -= _userDebt;                                                                                                                                    │
│         else _userValueAdjusted = 0;                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         fees += _feeAmount; // adds to fee pot, which is transferred on update                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         pos.debt -= _userDebt;                                                                                                                                                                                  │
│         pos.cost -= _userCost;                                                                                                                                                                                  │
│         pos.oiShares -= _userOiShares;                                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         // ovl.transfer(msg.sender, _userCost);                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         // mint/burn excess PnL = valueAdjusted - cost                                                                                                                                                          │
│         if (_userCost < _userValueAdjusted) {                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│             ovl.transferMint(                                                                                                                                                                                   │
│                 msg.sender,                                                                                                                                                                                     │
│                 _userCost,                                                                                                                                                                                      │
│                 _userValueAdjusted - _userCost                                                                                                                                                                  │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         } else {                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│             ovl.transferBurn(                                                                                                                                                                                   │
│                 msg.sender,                                                                                                                                                                                     │
│                 _userValueAdjusted,                                                                                                                                                                             │
│                 _userCost - _userValueAdjusted                                                                                                                                                                  │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         IOverlayV1Market(pos.market).exitOI(                                                                                                                                                                    │
│             pos.isLong,                                                                                                                                                                                         │
│             _userOi,                                                                                                                                                                                            │
│             _userOiShares,                                                                                                                                                                                      │
│             _userCost < _userValueAdjusted ? _userValueAdjusted - _userCost : 0,                                                                                                                                │
│             _userCost < _userValueAdjusted ? 0 : _userCost - _userValueAdjusted                                                                                                                                 │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         _burn(msg.sender, _positionId, _shares);                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function liquidate (                                                                                                                                                                                        │
│         uint256 _positionId,                                                                                                                                                                                    │
│         address _rewardsTo                                                                                                                                                                                      │
│     ) external {                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         Position.Info storage pos = positions[_positionId];                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         require(0 < pos.oiShares, "OVLV1:liquidated");                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│         bool _isLong = pos.isLong;                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         (   uint _oi,                                                                                                                                                                                           │
│             uint _oiShares,                                                                                                                                                                                     │
│             uint _priceFrame ) = IOverlayV1Market(pos.market)                                                                                                                                                   │
│                 .exitData(                                                                                                                                                                                      │
│                     _isLong,                                                                                                                                                                                    │
│                     pos.pricePoint                                                                                                                                                                              │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         MarketInfo memory _marketInfo = marketInfo;                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         require(pos.isLiquidatable(                                                                                                                                                                             │
│             _oi,                                                                                                                                                                                                │
│             _oiShares,                                                                                                                                                                                          │
│             _priceFrame,                                                                                                                                                                                        │
│             _marketInfo.marginMaintenance                                                                                                                                                                       │
│         ), "OVLV1:!liquidatable");                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         uint _value = pos.value(_oi, _oiShares, _priceFrame);                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         IOverlayV1Market(pos.market).exitOI(                                                                                                                                                                    │
│             _isLong,                                                                                                                                                                                            │
│             pos.oi(_oi, _oiShares),                                                                                                                                                                             │
│             pos.oiShares,                                                                                                                                                                                       │
│             0,                                                                                                                                                                                                  │
│             pos.cost - _value                                                                                                                                                                                   │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // TODO: which is better on gas                                                                                                                                                                         │
│         pos.oiShares = 0;                                                                                                                                                                                       │
│         pos.debt = 0;                                                                                                                                                                                           │
│         // positions.oiShares = 0;                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         uint _toReward = _value.mulUp(_marketInfo.marginRewardRate);                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         liquidations += _value - _toReward;                                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         emit Liquidate(                                                                                                                                                                                         │
│             _positionId,                                                                                                                                                                                        │
│             _oi,                                                                                                                                                                                                │
│             _toReward,                                                                                                                                                                                          │
│             _rewardsTo                                                                                                                                                                                          │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // ovl.burn(address(this), pos.cost - _value);                                                                                                                                                          │
│         ovl.transferBurn(_rewardsTo, _toReward, pos.cost - _value);                                                                                                                                             │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to update/accrue interest/exchange rate? Answer only ZERO or ONE statement, cover the code with backquotes.                    │
│ Code:                                                                                                                                                                                                           │
│     function addOi(                                                                                                                                                                                             │
│         bool _isLong,                                                                                                                                                                                           │
│         uint256 _openInterest,                                                                                                                                                                                  │
│         uint256 _oiCap                                                                                                                                                                                          │
│     ) internal {                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         if (_isLong) {                                                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│             oiLongShares += _openInterest;                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│             uint _oiLong = __oiLong__ + _openInterest;                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│             require(_oiLong <= _oiCap, "OVLV1:>cap");                                                                                                                                                           │
│                                                                                                                                                                                                                 │
│             __oiLong__ = _oiLong;                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         } else {                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│             oiShortShares += _openInterest;                                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│             uint _oiShort = __oiShort__ + _openInterest;                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│             require(_oiShort <= _oiCap, "OVLV1:>cap");                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│             __oiShort__ = _oiShort;                                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to update/accrue interest/exchange rate is `oiLongShares += _openInterest;`.                                                                                                                │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward? Answer only ZERO or ONE statement, cover the code with │
│ backquotes.                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function addOi(                                                                                                                                                                                             │
│         bool _isLong,                                                                                                                                                                                           │
│         uint256 _openInterest,                                                                                                                                                                                  │
│         uint256 _oiCap                                                                                                                                                                                          │
│     ) internal {                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         if (_isLong) {                                                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│             oiLongShares += _openInterest;                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│             uint _oiLong = __oiLong__ + _openInterest;                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│             require(_oiLong <= _oiCap, "OVLV1:>cap");                                                                                                                                                           │
│                                                                                                                                                                                                                 │
│             __oiLong__ = _oiLong;                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         } else {                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│             oiShortShares += _openInterest;                                                                                                                                                                     │
│                                                                                                                                                                                                                 │
│             uint _oiShort = __oiShort__ + _openInterest;                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│             require(_oiShort <= _oiCap, "OVLV1:>cap");                                                                                                                                                          │
│                                                                                                                                                                                                                 │
│             __oiShort__ = _oiShort;                                                                                                                                                                             │
│                                                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ `oiLongShares += _openInterest;`                                                                                                                                                                                │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:19:46] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-11-overlay-main/contracts/market/OverlayV1OI.sol, current    tasks.py:260
                             function: addOi, current vul: wrong-order-interest                                                                                                                                    
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {"VariableA":{"msg.sender":"Holds the sender's address of transfer"}}                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
                    ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-11-overlay-main/contracts/ovl/OverlayToken.sol, current      tasks.py:260
                             function: transferMint, current vul: unauthorized-transfer                                                                                                                            
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 220, in simple_cli                                                                                       
                                 raise Exception(                                                                                                                                                                  
                             Exception: The description of variable did not pass the `exclude_variable` validation                                                                                                 
                                                                                                                                                                                                                   
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to update/accrue interest/exchange rate? Answer only ZERO or ONE statement, cover the code with backquotes.                    │
│ Code:                                                                                                                                                                                                           │
│     function disburse () public {                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         (   uint256 _marginBurnRate,                                                                                                                                                                            │
│             uint256 _feeBurnRate,                                                                                                                                                                               │
│             address _feeTo ) = mothership.getUpdateParams();                                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         uint _feeForward = fees;                                                                                                                                                                                │
│         uint _feeBurn = _feeForward.mulUp(_feeBurnRate);                                                                                                                                                        │
│         _feeForward = _feeForward - _feeBurn;                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         uint _liqForward = liquidations;                                                                                                                                                                        │
│         uint _liqBurn = _liqForward.mulUp(_marginBurnRate);                                                                                                                                                     │
│         _liqForward -= _liqBurn;                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         fees = 0;                                                                                                                                                                                               │
│         liquidations = 0;                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         emit Update(                                                                                                                                                                                            │
│             _feeForward,                                                                                                                                                                                        │
│             _feeBurn,                                                                                                                                                                                           │
│             _liqForward,                                                                                                                                                                                        │
│             _liqBurn                                                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         ovl.burn(address(this), _feeBurn + _liqBurn);                                                                                                                                                           │
│         ovl.transfer(_feeTo, _feeForward + _liqForward);                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to update/accrue interest/exchange rate is `uint _feeBurn = _feeForward.mulUp(_feeBurnRate);`.                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward? Answer only ZERO or ONE statement, cover the code with │
│ backquotes.                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function disburse () public {                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│         (   uint256 _marginBurnRate,                                                                                                                                                                            │
│             uint256 _feeBurnRate,                                                                                                                                                                               │
│             address _feeTo ) = mothership.getUpdateParams();                                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         uint _feeForward = fees;                                                                                                                                                                                │
│         uint _feeBurn = _feeForward.mulUp(_feeBurnRate);                                                                                                                                                        │
│         _feeForward = _feeForward - _feeBurn;                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│         uint _liqForward = liquidations;                                                                                                                                                                        │
│         uint _liqBurn = _liqForward.mulUp(_marginBurnRate);                                                                                                                                                     │
│         _liqForward -= _liqBurn;                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         fees = 0;                                                                                                                                                                                               │
│         liquidations = 0;                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         emit Update(                                                                                                                                                                                            │
│             _feeForward,                                                                                                                                                                                        │
│             _feeBurn,                                                                                                                                                                                           │
│             _liqForward,                                                                                                                                                                                        │
│             _liqBurn                                                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         ovl.burn(address(this), _feeBurn + _liqBurn);                                                                                                                                                           │
│         ovl.transfer(_feeTo, _feeForward + _liqForward);                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward is `fees = 0;`.                                                                                                      │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 19:19:47] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File:                                                                                                                                                      tasks.py:260
                             /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-11-overlay-main/contracts/collateral/OverlayV1OVLCollateral.sol, current                      
                             function: disburse, current vul: wrong-order-interest                                                                                                                                 
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
                      Scan Results                       
┏━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┓
┃ Type ┃ Description ┃ Affected Files ┃ Analysis Report ┃
┡━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━┩
└──────┴─────────────┴────────────────┴─────────────────┘
                   Summary                   
┏━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┓
┃ Key                  ┃ Value              ┃
┡━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━┩
│ Files                │ 49                 │
│ Contracts            │ 49                 │
│ Functions            │ 121                │
│ Lines of Code        │ 7121               │
│ Used Time            │ 19.101560354232788 │
│ Estimated Cost (USD) │ 0.0135205          │
└──────────────────────┴────────────────────┘
