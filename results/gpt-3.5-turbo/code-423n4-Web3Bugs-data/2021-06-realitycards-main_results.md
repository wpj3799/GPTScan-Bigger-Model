

  .oooooo.    ooooooooo.   ooooooooooooo  .oooooo..o                                 
 d8P'  `Y8b   `888   `Y88. 8'   888   `8 d8P'    `Y8                                 
888            888   .d88'      888      Y88bo.       .ooooo.   .oooo.   ooo. .oo.   
888            888ooo88P'       888       `"Y8888o.  d88' `"Y8 `P  )88b  `888P"Y88b  
888     ooooo  888              888           `"Y88b 888        .oP"888   888   888  
`88.    .88'   888              888      oo     .d8P 888   .o8 d8(  888   888   888  
 `Y8bood8P'   o888o            o888o     8""88888P'  `Y8bod8P' `Y888""8o o888o o888o                                                        


                                                                   

[18:56:34] Loaded 10 rules                                                                                                                                                                             tasks.py:119
[12/08/24 18:56:34] INFO     CryticCompile: 'npx hardhat clean' running (wd: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main)         subprocess.py:41
[12/08/24 18:56:35] ERROR    CryticCompile: 'npx' returned non-zero exit code 1                                                                                                                    subprocess.py:60
                    ERROR    CryticCompile: An unexpected error occurred:                                                                                                                          subprocess.py:68
                             stderr: Error: Cannot find module '@nomicfoundation/hardhat-toolbox'                                                                                                                  
                             stderr: Require stack:                                                                                                                                                                
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/hardhat.config.js                                              
                             stderr: -                                                                                                                                                                             
                             /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/core/config/config-loading                 
                             .js                                                                                                                                                                                   
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/cli/cli.js                       
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/cli/bootstrap.js                 
                             stderr:     at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)                                                                                                   
                             stderr:     at Function._load (node:internal/modules/cjs/loader:1075:27)                                                                                                              
                             stderr:     at TracingChannel.traceSync (node:diagnostics_channel:322:14)                                                                                                             
                             stderr:     at wrapModuleLoad (node:internal/modules/cjs/loader:219:24)                                                                                                               
                             stderr:     at Module.require (node:internal/modules/cjs/loader:1340:12)                                                                                                              
                             stderr:     at require (node:internal/modules/helpers:138:16)                                                                                                                         
                             stderr:     at Object.<anonymous>                                                                                                                                                     
                             (/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/hardhat.config.js:1:1)                                                  
                             stderr:     at Module._compile (node:internal/modules/cjs/loader:1565:14)                                                                                                             
                             stderr:     at Object..js (node:internal/modules/cjs/loader:1708:10)                                                                                                                  
                             stderr:     at Module.load (node:internal/modules/cjs/loader:1318:32) {                                                                                                               
                             stderr:   code: 'MODULE_NOT_FOUND',                                                                                                                                                   
                             stderr:   requireStack: [                                                                                                                                                             
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/hardhat.config.js',                                         
                             stderr:                                                                                                                                                                               
                             '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/core/config/config-loadin                 
                             g.js',                                                                                                                                                                                
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/cli/cli.js',                  
                             stderr:                                                                                                                                                                               
                             '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/cli/bootstrap.js'                         
                             stderr:   ]                                                                                                                                                                           
                             stderr: }                                                                                                                                                                             
                    INFO     CryticCompile: 'npx hardhat clean --global' running (wd:                                                                                                              subprocess.py:41
                             /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main)                                                                         
                    ERROR    CryticCompile: 'npx' returned non-zero exit code 1                                                                                                                    subprocess.py:60
                    ERROR    CryticCompile: An unexpected error occurred:                                                                                                                          subprocess.py:68
                             stderr: Error: Cannot find module '@nomicfoundation/hardhat-toolbox'                                                                                                                  
                             stderr: Require stack:                                                                                                                                                                
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/hardhat.config.js                                              
                             stderr: -                                                                                                                                                                             
                             /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/core/config/config-loading                 
                             .js                                                                                                                                                                                   
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/cli/cli.js                       
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/cli/bootstrap.js                 
                             stderr:     at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)                                                                                                   
                             stderr:     at Function._load (node:internal/modules/cjs/loader:1075:27)                                                                                                              
                             stderr:     at TracingChannel.traceSync (node:diagnostics_channel:322:14)                                                                                                             
                             stderr:     at wrapModuleLoad (node:internal/modules/cjs/loader:219:24)                                                                                                               
                             stderr:     at Module.require (node:internal/modules/cjs/loader:1340:12)                                                                                                              
                             stderr:     at require (node:internal/modules/helpers:138:16)                                                                                                                         
                             stderr:     at Object.<anonymous>                                                                                                                                                     
                             (/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/hardhat.config.js:1:1)                                                  
                             stderr:     at Module._compile (node:internal/modules/cjs/loader:1565:14)                                                                                                             
                             stderr:     at Object..js (node:internal/modules/cjs/loader:1708:10)                                                                                                                  
                             stderr:     at Module.load (node:internal/modules/cjs/loader:1318:32) {                                                                                                               
                             stderr:   code: 'MODULE_NOT_FOUND',                                                                                                                                                   
                             stderr:   requireStack: [                                                                                                                                                             
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/hardhat.config.js',                                         
                             stderr:                                                                                                                                                                               
                             '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/core/config/config-loadin                 
                             g.js',                                                                                                                                                                                
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/cli/cli.js',                  
                             stderr:                                                                                                                                                                               
                             '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/cli/bootstrap.js'                         
                             stderr:   ]                                                                                                                                                                           
                             stderr: }                                                                                                                                                                             
[12/08/24 18:56:36] INFO     CryticCompile: Problem executing hardhat: An unexpected error occurred:                                                                                                 hardhat.py:327
                             Error: Cannot find module '@nomicfoundation/hardhat-toolbox'                                                                                                                          
                             Require stack:                                                                                                                                                                        
                             - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/hardhat.config.js                                                      
                             -                                                                                                                                                                                     
                             /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/core/config/config-loading.j               
                             s                                                                                                                                                                                     
                             - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/cli/cli.js                               
                             - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/cli/bootstrap.js                         
                                 at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)                                                                                                           
                                 at Function._load (node:internal/modules/cjs/loader:1075:27)                                                                                                                      
                                 at TracingChannel.traceSync (node:diagnostics_channel:322:14)                                                                                                                     
                                 at wrapModuleLoad (node:internal/modules/cjs/loader:219:24)                                                                                                                       
                                 at Module.require (node:internal/modules/cjs/loader:1340:12)                                                                                                                      
                                 at require (node:internal/modules/helpers:138:16)                                                                                                                                 
                                 at Object.<anonymous> (/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/hardhat.config.js:1:1)                        
                                 at Module._compile (node:internal/modules/cjs/loader:1565:14)                                                                                                                     
                                 at Object..js (node:internal/modules/cjs/loader:1708:10)                                                                                                                          
                                 at Module.load (node:internal/modules/cjs/loader:1318:32) {                                                                                                                       
                               code: 'MODULE_NOT_FOUND',                                                                                                                                                           
                               requireStack: [                                                                                                                                                                     
                                 '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/hardhat.config.js',                                                 
                                 '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/core/config/config-load               
                             ing.js',                                                                                                                                                                              
                                 '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/cli/cli.js',                          
                                 '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/cli/bootstrap.js'                     
                               ]                                                                                                                                                                                   
                             }                                                                                                                                                                                     
                                                                                                                                                                                                                   
                    INFO     CryticCompile: 'npx hardhat compile --force' running (wd:                                                                                                             subprocess.py:41
                             /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main)                                                                         
[12/08/24 18:56:37] ERROR    CryticCompile: 'npx' returned non-zero exit code 1                                                                                                                    subprocess.py:60
                    ERROR    CryticCompile: An unexpected error occurred:                                                                                                                          subprocess.py:68
                             stderr: Error: Cannot find module '@nomicfoundation/hardhat-toolbox'                                                                                                                  
                             stderr: Require stack:                                                                                                                                                                
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/hardhat.config.js                                              
                             stderr: -                                                                                                                                                                             
                             /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/core/config/config-loading                 
                             .js                                                                                                                                                                                   
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/cli/cli.js                       
                             stderr: - /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/cli/bootstrap.js                 
                             stderr:     at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)                                                                                                   
                             stderr:     at Function._load (node:internal/modules/cjs/loader:1075:27)                                                                                                              
                             stderr:     at TracingChannel.traceSync (node:diagnostics_channel:322:14)                                                                                                             
                             stderr:     at wrapModuleLoad (node:internal/modules/cjs/loader:219:24)                                                                                                               
                             stderr:     at Module.require (node:internal/modules/cjs/loader:1340:12)                                                                                                              
                             stderr:     at require (node:internal/modules/helpers:138:16)                                                                                                                         
                             stderr:     at Object.<anonymous>                                                                                                                                                     
                             (/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/hardhat.config.js:1:1)                                                  
                             stderr:     at Module._compile (node:internal/modules/cjs/loader:1565:14)                                                                                                             
                             stderr:     at Object..js (node:internal/modules/cjs/loader:1708:10)                                                                                                                  
                             stderr:     at Module.load (node:internal/modules/cjs/loader:1318:32) {                                                                                                               
                             stderr:   code: 'MODULE_NOT_FOUND',                                                                                                                                                   
                             stderr:   requireStack: [                                                                                                                                                             
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/hardhat.config.js',                                         
                             stderr:                                                                                                                                                                               
                             '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/core/config/config-loadin                 
                             g.js',                                                                                                                                                                                
                             stderr:     '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/cli/cli.js',                  
                             stderr:                                                                                                                                                                               
                             '/home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/node_modules/hardhat/internal/cli/bootstrap.js'                         
                             stderr:   ]                                                                                                                                                                           
                             stderr: }                                                                                                                                                                             
[18:56:37] Traceback (most recent call last):                                                                                                                                                          tasks.py:126
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/falcon/falcon.py", line 90, in __init__                                                                     
               crytic_compile = CryticCompile(target, **kwargs)                                                                                                                                                    
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/crytic_compile/crytic_compile.py", line 131, in __init__                                                    
               self._compile(**kwargs)                                                                                                                                                                             
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/crytic_compile/crytic_compile.py", line 553, in _compile                                                    
               self._platform.compile(self, **kwargs)                                                                                                                                                              
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/crytic_compile/platform/hardhat.py", line 183, in compile                                                   
               hardhat_like_parsing(crytic_compile, self._target, build_directory, hardhat_working_dir)                                                                                                            
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/crytic_compile/platform/hardhat.py", line 52, in hardhat_like_parsing                                       
               raise InvalidCompilation(txt)                                                                                                                                                                       
           crytic_compile.platform.exceptions.InvalidCompilation: Compilation failed. Can you run build command?                                                                                                   
           /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/artifacts/build-info is not a directory.                                                   
                                                                                                                                                                                                                   
           During handling of the above exception, another exception occurred:                                                                                                                                     
                                                                                                                                                                                                                   
           Traceback (most recent call last):                                                                                                                                                                      
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 124, in simple_cli                                                                                                         
               falcon_instance = compile_project(source_dir)                                                                                                                                                       
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 103, in compile_project                                                                                                    
               return falcon.Falcon(abs_path)                                                                                                                                                                      
             File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/.venv/lib/python3.10/site-packages/falcon/falcon.py", line 94, in __init__                                                                     
               raise FalconError(f"Invalid compilation: \n{str(e)}")                                                                                                                                               
           falcon.exceptions.FalconError: Invalid compilation:                                                                                                                                                     
           Compilation failed. Can you run build command?                                                                                                                                                          
           /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/artifacts/build-info is not a directory.                                                   
                                                                                                                                                                                                                   
           Compile failed.                                                                                                                                                                             tasks.py:127
           Since the compilation is failed, some static analysis tool may not be enabled, which may cause lower precision and recall.                                                                  tasks.py:128
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: add or check approval via require/if statements before the token transfer,                                                                                                                           │
│ Code:                                                                                                                                                                                                           │
│     function upgradeCard(uint256 _card) external onlyTokenOwner(_card) {                                                                                                                                        │
│         _checkState(States.WITHDRAW);                                                                                                                                                                           │
│         require(                                                                                                                                                                                                │
│             !factory.trapIfUnapproved() ||                                                                                                                                                                      │
│                 factory.isMarketApproved(address(this)),                                                                                                                                                        │
│             "Upgrade blocked"                                                                                                                                                                                   │
│         );                                                                                                                                                                                                      │
│         uint256 _tokenId = _card + totalNftMintCount;                                                                                                                                                           │
│         _transferCard(ownerOf(_card), address(this), _card); // contract becomes final resting place                                                                                                            │
│         nfthub.withdrawWithMetadata(_tokenId);                                                                                                                                                                  │
│         emit LogNftUpgraded(_card, _tokenId);                                                                                                                                                                   │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: add or check approval via require/if statements before the token transfer, and there is no clear/reset of the approval when the transfer finishes its main branch or encounters exceptions           │
│ Code:                                                                                                                                                                                                           │
│     function upgradeCard(uint256 _card) external onlyTokenOwner(_card) {                                                                                                                                        │
│         _checkState(States.WITHDRAW);                                                                                                                                                                           │
│         require(                                                                                                                                                                                                │
│             !factory.trapIfUnapproved() ||                                                                                                                                                                      │
│                 factory.isMarketApproved(address(this)),                                                                                                                                                        │
│             "Upgrade blocked"                                                                                                                                                                                   │
│         );                                                                                                                                                                                                      │
│         uint256 _tokenId = _card + totalNftMintCount;                                                                                                                                                           │
│         _transferCard(ownerOf(_card), address(this), _card); // contract becomes final resting place                                                                                                            │
│         nfthub.withdrawWithMetadata(_tokenId);                                                                                                                                                                  │
│         emit LogNftUpgraded(_card, _tokenId);                                                                                                                                                                   │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function newRental(                                                                                                                                                                                         │
│         uint256 _newPrice,                                                                                                                                                                                      │
│         uint256 _timeHeldLimit,                                                                                                                                                                                 │
│         address _startingPosition,                                                                                                                                                                              │
│         uint256 _card                                                                                                                                                                                           │
│     ) public autoUnlock() autoLock() {                                                                                                                                                                          │
│         if (state == States.OPEN) {                                                                                                                                                                             │
│             require(_newPrice >= MIN_RENTAL_VALUE, "Price below min");                                                                                                                                          │
│             require(_card < numberOfCards, "Card does not exist");                                                                                                                                              │
│                                                                                                                                                                                                                 │
│             address _user = msgSender();                                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│             require(                                                                                                                                                                                            │
│                 exitedTimestamp[_user] != block.timestamp,                                                                                                                                                      │
│                 "Cannot lose and re-rent in same block"                                                                                                                                                         │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 !treasury.marketPaused(address(this)) &&                                                                                                                                                        │
│                     !treasury.globalPause(),                                                                                                                                                                    │
│                 "Rentals are disabled"                                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│             bool _userStillForeclosed = treasury.isForeclosed(_user);                                                                                                                                           │
│             if (_userStillForeclosed) {                                                                                                                                                                         │
│                 _userStillForeclosed = orderbook.removeUserFromOrderbook(_user);                                                                                                                                │
│             }                                                                                                                                                                                                   │
│             if (!_userStillForeclosed) {                                                                                                                                                                        │
│                 if (ownerOf(_card) == _user) {                                                                                                                                                                  │
│                     // the owner may only increase by more than X% or reduce their price                                                                                                                        │
│                     uint256 _requiredPrice =                                                                                                                                                                    │
│                         (cardPrice[_card] *                                                                                                                                                                     │
│                             (minimumPriceIncreasePercent + 100)) / (100);                                                                                                                                       │
│                     require(                                                                                                                                                                                    │
│                         _newPrice >= _requiredPrice ||                                                                                                                                                          │
│                             _newPrice < cardPrice[_card],                                                                                                                                                       │
│                         "Invalid price"                                                                                                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 // do some cleaning up before we collect rent or check their bidRate                                                                                                                            │
│                 orderbook.removeOldBids(_user);                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│                 _collectRent(_card);                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│                 // check sufficient deposit                                                                                                                                                                     │
│                 uint256 _userTotalBidRate =                                                                                                                                                                     │
│                     treasury.userTotalBids(_user) -                                                                                                                                                             │
│                         (orderbook.getBidValue(_user, _card)) +                                                                                                                                                 │
│                         _newPrice;                                                                                                                                                                              │
│                 require(                                                                                                                                                                                        │
│                     treasury.userDeposit(_user) >=                                                                                                                                                              │
│                         _userTotalBidRate / minRentalDayDivisor,                                                                                                                                                │
│                     "Insufficient deposit"                                                                                                                                                                      │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 _timeHeldLimit = _checkTimeHeldLimit(_timeHeldLimit);                                                                                                                                           │
│                                                                                                                                                                                                                 │
│                 // replaces _newBid and _updateBid                                                                                                                                                              │
│                 orderbook.addBidToOrderbook(                                                                                                                                                                    │
│                     _user,                                                                                                                                                                                      │
│                     _card,                                                                                                                                                                                      │
│                     _newPrice,                                                                                                                                                                                  │
│                     _timeHeldLimit,                                                                                                                                                                             │
│                     _startingPosition                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 assert(treasury.updateLastRentalTime(_user));                                                                                                                                                   │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                      │
│ Code:                                                                                                                                                                                                           │
│     function newRental(                                                                                                                                                                                         │
│         uint256 _newPrice,                                                                                                                                                                                      │
│         uint256 _timeHeldLimit,                                                                                                                                                                                 │
│         address _startingPosition,                                                                                                                                                                              │
│         uint256 _card                                                                                                                                                                                           │
│     ) public autoUnlock() autoLock() {                                                                                                                                                                          │
│         if (state == States.OPEN) {                                                                                                                                                                             │
│             require(_newPrice >= MIN_RENTAL_VALUE, "Price below min");                                                                                                                                          │
│             require(_card < numberOfCards, "Card does not exist");                                                                                                                                              │
│                                                                                                                                                                                                                 │
│             address _user = msgSender();                                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│             require(                                                                                                                                                                                            │
│                 exitedTimestamp[_user] != block.timestamp,                                                                                                                                                      │
│                 "Cannot lose and re-rent in same block"                                                                                                                                                         │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 !treasury.marketPaused(address(this)) &&                                                                                                                                                        │
│                     !treasury.globalPause(),                                                                                                                                                                    │
│                 "Rentals are disabled"                                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│             bool _userStillForeclosed = treasury.isForeclosed(_user);                                                                                                                                           │
│             if (_userStillForeclosed) {                                                                                                                                                                         │
│                 _userStillForeclosed = orderbook.removeUserFromOrderbook(_user);                                                                                                                                │
│             }                                                                                                                                                                                                   │
│             if (!_userStillForeclosed) {                                                                                                                                                                        │
│                 if (ownerOf(_card) == _user) {                                                                                                                                                                  │
│                     // the owner may only increase by more than X% or reduce their price                                                                                                                        │
│                     uint256 _requiredPrice =                                                                                                                                                                    │
│                         (cardPrice[_card] *                                                                                                                                                                     │
│                             (minimumPriceIncreasePercent + 100)) / (100);                                                                                                                                       │
│                     require(                                                                                                                                                                                    │
│                         _newPrice >= _requiredPrice ||                                                                                                                                                          │
│                             _newPrice < cardPrice[_card],                                                                                                                                                       │
│                         "Invalid price"                                                                                                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 // do some cleaning up before we collect rent or check their bidRate                                                                                                                            │
│                 orderbook.removeOldBids(_user);                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│                 _collectRent(_card);                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│                 // check sufficient deposit                                                                                                                                                                     │
│                 uint256 _userTotalBidRate =                                                                                                                                                                     │
│                     treasury.userTotalBids(_user) -                                                                                                                                                             │
│                         (orderbook.getBidValue(_user, _card)) +                                                                                                                                                 │
│                         _newPrice;                                                                                                                                                                              │
│                 require(                                                                                                                                                                                        │
│                     treasury.userDeposit(_user) >=                                                                                                                                                              │
│                         _userTotalBidRate / minRentalDayDivisor,                                                                                                                                                │
│                     "Insufficient deposit"                                                                                                                                                                      │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 _timeHeldLimit = _checkTimeHeldLimit(_timeHeldLimit);                                                                                                                                           │
│                                                                                                                                                                                                                 │
│                 // replaces _newBid and _updateBid                                                                                                                                                              │
│                 orderbook.addBidToOrderbook(                                                                                                                                                                    │
│                     _user,                                                                                                                                                                                      │
│                     _card,                                                                                                                                                                                      │
│                     _newPrice,                                                                                                                                                                                  │
│                     _timeHeldLimit,                                                                                                                                                                             │
│                     _startingPosition                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 assert(treasury.updateLastRentalTime(_user));                                                                                                                                                   │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function _newBidInOrderbook(                                                                                                                                                                                │
│         address _user,                                                                                                                                                                                          │
│         address _market,                                                                                                                                                                                        │
│         uint256 _card,                                                                                                                                                                                          │
│         uint256 _price,                                                                                                                                                                                         │
│         uint256 _timeHeldLimit,                                                                                                                                                                                 │
│         Bid storage _prevUser                                                                                                                                                                                   │
│     ) internal {                                                                                                                                                                                                │
│         if (ownerOf[_market][_card] != _market) {                                                                                                                                                               │
│             (_prevUser, _price) = _searchOrderbook(                                                                                                                                                             │
│                 _prevUser,                                                                                                                                                                                      │
│                 _market,                                                                                                                                                                                        │
│                 _card,                                                                                                                                                                                          │
│                 _price                                                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         Bid storage _nextUser =                                                                                                                                                                                 │
│             user[_prevUser.next][index[_prevUser.next][_market][_card]];                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         // create new record                                                                                                                                                                                    │
│         Bid memory _newBid;                                                                                                                                                                                     │
│         _newBid.market = _market;                                                                                                                                                                               │
│         _newBid.token = SafeCast.toUint64(_card);                                                                                                                                                               │
│         _newBid.prev = _nextUser.prev;                                                                                                                                                                          │
│         _newBid.next = _prevUser.next;                                                                                                                                                                          │
│         _newBid.price = SafeCast.toUint128(_price);                                                                                                                                                             │
│         _newBid.timeHeldLimit = SafeCast.toUint64(_timeHeldLimit);                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         // insert in linked list                                                                                                                                                                                │
│         _nextUser.prev = _user; // next record update prev link                                                                                                                                                 │
│         _prevUser.next = _user; // prev record update next link                                                                                                                                                 │
│         user[_user].push(_newBid);                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         // update the index to help find the record later                                                                                                                                                       │
│         index[_user][_market][_card] = user[_user].length - (1);                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         emit LogAddToOrderbook(                                                                                                                                                                                 │
│             _user,                                                                                                                                                                                              │
│             _price,                                                                                                                                                                                             │
│             _timeHeldLimit,                                                                                                                                                                                     │
│             nonce,                                                                                                                                                                                              │
│             _card,                                                                                                                                                                                              │
│             _market                                                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         nonce++;                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // update treasury values and transfer ownership if required                                                                                                                                            │
│         treasury.increaseBidRate(_user, _price);                                                                                                                                                                │
│         if (user[_user][index[_user][_market][_card]].prev == _market) {                                                                                                                                        │
│             address _oldOwner = user[_user][index[_user][_market][_card]].next;                                                                                                                                 │
│             transferCard(_market, _card, _oldOwner, _user, _price);                                                                                                                                             │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _oldOwner,                                                                                                                                                                                      │
│                 _user,                                                                                                                                                                                          │
│                 user[_oldOwner][index[_oldOwner][_market][_card]].price,                                                                                                                                        │
│                 _price,                                                                                                                                                                                         │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                      │
│ Code:                                                                                                                                                                                                           │
│     function _newBidInOrderbook(                                                                                                                                                                                │
│         address _user,                                                                                                                                                                                          │
│         address _market,                                                                                                                                                                                        │
│         uint256 _card,                                                                                                                                                                                          │
│         uint256 _price,                                                                                                                                                                                         │
│         uint256 _timeHeldLimit,                                                                                                                                                                                 │
│         Bid storage _prevUser                                                                                                                                                                                   │
│     ) internal {                                                                                                                                                                                                │
│         if (ownerOf[_market][_card] != _market) {                                                                                                                                                               │
│             (_prevUser, _price) = _searchOrderbook(                                                                                                                                                             │
│                 _prevUser,                                                                                                                                                                                      │
│                 _market,                                                                                                                                                                                        │
│                 _card,                                                                                                                                                                                          │
│                 _price                                                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         Bid storage _nextUser =                                                                                                                                                                                 │
│             user[_prevUser.next][index[_prevUser.next][_market][_card]];                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         // create new record                                                                                                                                                                                    │
│         Bid memory _newBid;                                                                                                                                                                                     │
│         _newBid.market = _market;                                                                                                                                                                               │
│         _newBid.token = SafeCast.toUint64(_card);                                                                                                                                                               │
│         _newBid.prev = _nextUser.prev;                                                                                                                                                                          │
│         _newBid.next = _prevUser.next;                                                                                                                                                                          │
│         _newBid.price = SafeCast.toUint128(_price);                                                                                                                                                             │
│         _newBid.timeHeldLimit = SafeCast.toUint64(_timeHeldLimit);                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         // insert in linked list                                                                                                                                                                                │
│         _nextUser.prev = _user; // next record update prev link                                                                                                                                                 │
│         _prevUser.next = _user; // prev record update next link                                                                                                                                                 │
│         user[_user].push(_newBid);                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         // update the index to help find the record later                                                                                                                                                       │
│         index[_user][_market][_card] = user[_user].length - (1);                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         emit LogAddToOrderbook(                                                                                                                                                                                 │
│             _user,                                                                                                                                                                                              │
│             _price,                                                                                                                                                                                             │
│             _timeHeldLimit,                                                                                                                                                                                     │
│             nonce,                                                                                                                                                                                              │
│             _card,                                                                                                                                                                                              │
│             _market                                                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         nonce++;                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // update treasury values and transfer ownership if required                                                                                                                                            │
│         treasury.increaseBidRate(_user, _price);                                                                                                                                                                │
│         if (user[_user][index[_user][_market][_card]].prev == _market) {                                                                                                                                        │
│             address _oldOwner = user[_user][index[_user][_market][_card]].next;                                                                                                                                 │
│             transferCard(_market, _card, _oldOwner, _user, _price);                                                                                                                                             │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _oldOwner,                                                                                                                                                                                      │
│                 _user,                                                                                                                                                                                          │
│                 user[_oldOwner][index[_oldOwner][_market][_card]].price,                                                                                                                                        │
│                 _price,                                                                                                                                                                                         │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function _updateBidInOrderbook(                                                                                                                                                                             │
│         address _user,                                                                                                                                                                                          │
│         address _market,                                                                                                                                                                                        │
│         uint256 _card,                                                                                                                                                                                          │
│         uint256 _price,                                                                                                                                                                                         │
│         uint256 _timeHeldLimit,                                                                                                                                                                                 │
│         Bid storage _prevUser                                                                                                                                                                                   │
│     ) internal {                                                                                                                                                                                                │
│         // TODO no need to unlink and relink if bid doesn't change position in orderbook                                                                                                                        │
│         // unlink current bid                                                                                                                                                                                   │
│         Bid storage _currUser = user[_user][index[_user][_market][_card]];                                                                                                                                      │
│         user[_currUser.next][index[_currUser.next][_market][_card]]                                                                                                                                             │
│             .prev = _currUser.prev;                                                                                                                                                                             │
│         user[_currUser.prev][index[_currUser.prev][_market][_card]]                                                                                                                                             │
│             .next = _currUser.next;                                                                                                                                                                             │
│         bool _owner = _currUser.prev == _market;                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // find new position                                                                                                                                                                                    │
│         (_prevUser, _price) = _searchOrderbook(                                                                                                                                                                 │
│             _prevUser,                                                                                                                                                                                          │
│             _market,                                                                                                                                                                                            │
│             _card,                                                                                                                                                                                              │
│             _price                                                                                                                                                                                              │
│         );                                                                                                                                                                                                      │
│         Bid storage _nextUser =                                                                                                                                                                                 │
│             user[_prevUser.next][index[_prevUser.next][_market][_card]];                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         // update price, save old price for rental rate adjustment later                                                                                                                                        │
│         (_currUser.price, _price) = (                                                                                                                                                                           │
│             SafeCast.toUint128(_price),                                                                                                                                                                         │
│             uint256(_currUser.price)                                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│         _currUser.timeHeldLimit = SafeCast.toUint64(_timeHeldLimit);                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         // relink bid                                                                                                                                                                                           │
│         _currUser.next = _prevUser.next;                                                                                                                                                                        │
│         _currUser.prev = _nextUser.prev;                                                                                                                                                                        │
│         _nextUser.prev = _user; // next record update prev link                                                                                                                                                 │
│         _prevUser.next = _user; // prev record update next link                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         emit LogAddToOrderbook(                                                                                                                                                                                 │
│             _user,                                                                                                                                                                                              │
│             _currUser.price,                                                                                                                                                                                    │
│             _timeHeldLimit,                                                                                                                                                                                     │
│             nonce,                                                                                                                                                                                              │
│             _card,                                                                                                                                                                                              │
│             _market                                                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         nonce++;                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // update treasury values and transfer ownership if required                                                                                                                                            │
│         treasury.increaseBidRate(_user, _currUser.price);                                                                                                                                                       │
│         treasury.decreaseBidRate(_user, _price);                                                                                                                                                                │
│         if (_owner && _currUser.prev == _market) {                                                                                                                                                              │
│             // if owner before and after, update the price difference                                                                                                                                           │
│             transferCard(_market, _card, _user, _user, _currUser.price);                                                                                                                                        │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _user,                                                                                                                                                                                          │
│                 _user,                                                                                                                                                                                          │
│                 _price,                                                                                                                                                                                         │
│                 _currUser.price,                                                                                                                                                                                │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│         } else if (_owner && _currUser.prev != _market) {                                                                                                                                                       │
│             // if owner before and not after, remove the old price                                                                                                                                              │
│             address _newOwner =                                                                                                                                                                                 │
│                 user[_market][index[_market][_market][_card]].next;                                                                                                                                             │
│             uint256 _newPrice =                                                                                                                                                                                 │
│                 user[_newOwner][index[_newOwner][_market][_card]].price;                                                                                                                                        │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _user,                                                                                                                                                                                          │
│                 _newOwner,                                                                                                                                                                                      │
│                 _price,                                                                                                                                                                                         │
│                 _newPrice,                                                                                                                                                                                      │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│             transferCard(_market, _card, _user, _newOwner, _newPrice);                                                                                                                                          │
│         } else if (!_owner && _currUser.prev == _market) {                                                                                                                                                      │
│             // if not owner before but is owner after, add new price                                                                                                                                            │
│             address _oldOwner = _currUser.next;                                                                                                                                                                 │
│             uint256 _oldPrice =                                                                                                                                                                                 │
│                 user[_oldOwner][index[_oldOwner][_market][_card]].price;                                                                                                                                        │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _oldOwner,                                                                                                                                                                                      │
│                 _user,                                                                                                                                                                                          │
│                 _oldPrice,                                                                                                                                                                                      │
│                 _currUser.price,                                                                                                                                                                                │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│             transferCard(_market, _card, _oldOwner, _user, _currUser.price);                                                                                                                                    │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                      │
│ Code:                                                                                                                                                                                                           │
│     function _updateBidInOrderbook(                                                                                                                                                                             │
│         address _user,                                                                                                                                                                                          │
│         address _market,                                                                                                                                                                                        │
│         uint256 _card,                                                                                                                                                                                          │
│         uint256 _price,                                                                                                                                                                                         │
│         uint256 _timeHeldLimit,                                                                                                                                                                                 │
│         Bid storage _prevUser                                                                                                                                                                                   │
│     ) internal {                                                                                                                                                                                                │
│         // TODO no need to unlink and relink if bid doesn't change position in orderbook                                                                                                                        │
│         // unlink current bid                                                                                                                                                                                   │
│         Bid storage _currUser = user[_user][index[_user][_market][_card]];                                                                                                                                      │
│         user[_currUser.next][index[_currUser.next][_market][_card]]                                                                                                                                             │
│             .prev = _currUser.prev;                                                                                                                                                                             │
│         user[_currUser.prev][index[_currUser.prev][_market][_card]]                                                                                                                                             │
│             .next = _currUser.next;                                                                                                                                                                             │
│         bool _owner = _currUser.prev == _market;                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // find new position                                                                                                                                                                                    │
│         (_prevUser, _price) = _searchOrderbook(                                                                                                                                                                 │
│             _prevUser,                                                                                                                                                                                          │
│             _market,                                                                                                                                                                                            │
│             _card,                                                                                                                                                                                              │
│             _price                                                                                                                                                                                              │
│         );                                                                                                                                                                                                      │
│         Bid storage _nextUser =                                                                                                                                                                                 │
│             user[_prevUser.next][index[_prevUser.next][_market][_card]];                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         // update price, save old price for rental rate adjustment later                                                                                                                                        │
│         (_currUser.price, _price) = (                                                                                                                                                                           │
│             SafeCast.toUint128(_price),                                                                                                                                                                         │
│             uint256(_currUser.price)                                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│         _currUser.timeHeldLimit = SafeCast.toUint64(_timeHeldLimit);                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         // relink bid                                                                                                                                                                                           │
│         _currUser.next = _prevUser.next;                                                                                                                                                                        │
│         _currUser.prev = _nextUser.prev;                                                                                                                                                                        │
│         _nextUser.prev = _user; // next record update prev link                                                                                                                                                 │
│         _prevUser.next = _user; // prev record update next link                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         emit LogAddToOrderbook(                                                                                                                                                                                 │
│             _user,                                                                                                                                                                                              │
│             _currUser.price,                                                                                                                                                                                    │
│             _timeHeldLimit,                                                                                                                                                                                     │
│             nonce,                                                                                                                                                                                              │
│             _card,                                                                                                                                                                                              │
│             _market                                                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         nonce++;                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // update treasury values and transfer ownership if required                                                                                                                                            │
│         treasury.increaseBidRate(_user, _currUser.price);                                                                                                                                                       │
│         treasury.decreaseBidRate(_user, _price);                                                                                                                                                                │
│         if (_owner && _currUser.prev == _market) {                                                                                                                                                              │
│             // if owner before and after, update the price difference                                                                                                                                           │
│             transferCard(_market, _card, _user, _user, _currUser.price);                                                                                                                                        │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _user,                                                                                                                                                                                          │
│                 _user,                                                                                                                                                                                          │
│                 _price,                                                                                                                                                                                         │
│                 _currUser.price,                                                                                                                                                                                │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│         } else if (_owner && _currUser.prev != _market) {                                                                                                                                                       │
│             // if owner before and not after, remove the old price                                                                                                                                              │
│             address _newOwner =                                                                                                                                                                                 │
│                 user[_market][index[_market][_market][_card]].next;                                                                                                                                             │
│             uint256 _newPrice =                                                                                                                                                                                 │
│                 user[_newOwner][index[_newOwner][_market][_card]].price;                                                                                                                                        │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _user,                                                                                                                                                                                          │
│                 _newOwner,                                                                                                                                                                                      │
│                 _price,                                                                                                                                                                                         │
│                 _newPrice,                                                                                                                                                                                      │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│             transferCard(_market, _card, _user, _newOwner, _newPrice);                                                                                                                                          │
│         } else if (!_owner && _currUser.prev == _market) {                                                                                                                                                      │
│             // if not owner before but is owner after, add new price                                                                                                                                            │
│             address _oldOwner = _currUser.next;                                                                                                                                                                 │
│             uint256 _oldPrice =                                                                                                                                                                                 │
│                 user[_oldOwner][index[_oldOwner][_market][_card]].price;                                                                                                                                        │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _oldOwner,                                                                                                                                                                                      │
│                 _user,                                                                                                                                                                                          │
│                 _oldPrice,                                                                                                                                                                                      │
│                 _currUser.price,                                                                                                                                                                                │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│             transferCard(_market, _card, _oldOwner, _user, _currUser.price);                                                                                                                                    │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function removeBidFromOrderbook(address _user, uint256 _card)                                                                                                                                               │
│         public                                                                                                                                                                                                  │
│         override                                                                                                                                                                                                │
│         onlyMarkets                                                                                                                                                                                             │
│     {                                                                                                                                                                                                           │
│         address _market = msgSender();                                                                                                                                                                          │
│         // update rates                                                                                                                                                                                         │
│         Bid storage _currUser = user[_user][index[_user][_market][_card]];                                                                                                                                      │
│         treasury.decreaseBidRate(_user, _currUser.price);                                                                                                                                                       │
│         if (_currUser.prev == _market) {                                                                                                                                                                        │
│             // user is owner, deal with it                                                                                                                                                                      │
│             uint256 _price =                                                                                                                                                                                    │
│                 user[_currUser.next][index[_currUser.next][_market][_card]]                                                                                                                                     │
│                     .price;                                                                                                                                                                                     │
│             transferCard(_market, _card, _user, _currUser.next, _price);                                                                                                                                        │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _user,                                                                                                                                                                                          │
│                 _currUser.next,                                                                                                                                                                                 │
│                 _currUser.price,                                                                                                                                                                                │
│                 _price,                                                                                                                                                                                         │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│         // extract from linked list                                                                                                                                                                             │
│         address _tempNext = _currUser.next;                                                                                                                                                                     │
│         address _tempPrev = _currUser.prev;                                                                                                                                                                     │
│         user[_tempNext][index[_tempNext][_market][_card]].prev = _tempPrev;                                                                                                                                     │
│         user[_tempPrev][index[_tempPrev][_market][_card]].next = _tempNext;                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         // overwrite array element                                                                                                                                                                              │
│         uint256 _index = index[_user][_market][_card];                                                                                                                                                          │
│         uint256 _lastRecord = user[_user].length - (1);                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         // no point overwriting itself                                                                                                                                                                          │
│         if (_index != _lastRecord) {                                                                                                                                                                            │
│             user[_user][_index] = user[_user][_lastRecord];                                                                                                                                                     │
│         }                                                                                                                                                                                                       │
│         user[_user].pop();                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // update the index to help find the record later                                                                                                                                                       │
│         index[_user][_market][_card] = 0;                                                                                                                                                                       │
│         if (user[_user].length != 0 && _index != _lastRecord) {                                                                                                                                                 │
│             index[_user][user[_user][_index].market][                                                                                                                                                           │
│                 user[_user][_index].token                                                                                                                                                                       │
│             ] = _index;                                                                                                                                                                                         │
│         }                                                                                                                                                                                                       │
│         emit LogRemoveFromOrderbook(_user, _market, _card);                                                                                                                                                     │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function _removeBidFromOrderbookIgnoreOwner(address _user, uint256 _card)                                                                                                                                   │
│         internal                                                                                                                                                                                                │
│         returns (uint256 _newPrice)                                                                                                                                                                             │
│     {                                                                                                                                                                                                           │
│         address _market = msgSender();                                                                                                                                                                          │
│         // update rates                                                                                                                                                                                         │
│         Bid storage _currUser = user[_user][index[_user][_market][_card]];                                                                                                                                      │
│         treasury.decreaseBidRate(_user, _currUser.price);                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // extract from linked list                                                                                                                                                                             │
│         address _tempNext = _currUser.next;                                                                                                                                                                     │
│         address _tempPrev = _currUser.prev;                                                                                                                                                                     │
│         user[_tempNext][index[_tempNext][_market][_card]].prev = _tempPrev;                                                                                                                                     │
│         user[_tempPrev][index[_tempPrev][_market][_card]].next = _tempNext;                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         // return next users price to check they're eligable later                                                                                                                                              │
│         _newPrice = user[_tempNext][index[_tempNext][_market][_card]].price;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         // overwrite array element                                                                                                                                                                              │
│         uint256 _index = index[_user][_market][_card];                                                                                                                                                          │
│         uint256 _lastRecord = user[_user].length - 1;                                                                                                                                                           │
│         // no point overwriting itself                                                                                                                                                                          │
│         if (_index != _lastRecord) {                                                                                                                                                                            │
│             user[_user][_index] = user[_user][_lastRecord];                                                                                                                                                     │
│         }                                                                                                                                                                                                       │
│         user[_user].pop();                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // update the index to help find the record later                                                                                                                                                       │
│         index[_user][_market][_card] = 0;                                                                                                                                                                       │
│         if (user[_user].length != 0 && _index != _lastRecord) {                                                                                                                                                 │
│             index[_user][user[_user][_index].market][                                                                                                                                                           │
│                 user[_user][_index].token                                                                                                                                                                       │
│             ] = _index;                                                                                                                                                                                         │
│         }                                                                                                                                                                                                       │
│         emit LogRemoveFromOrderbook(_user, _market, _card);                                                                                                                                                     │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                      │
│ Code:                                                                                                                                                                                                           │
│     function _removeBidFromOrderbookIgnoreOwner(address _user, uint256 _card)                                                                                                                                   │
│         internal                                                                                                                                                                                                │
│         returns (uint256 _newPrice)                                                                                                                                                                             │
│     {                                                                                                                                                                                                           │
│         address _market = msgSender();                                                                                                                                                                          │
│         // update rates                                                                                                                                                                                         │
│         Bid storage _currUser = user[_user][index[_user][_market][_card]];                                                                                                                                      │
│         treasury.decreaseBidRate(_user, _currUser.price);                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // extract from linked list                                                                                                                                                                             │
│         address _tempNext = _currUser.next;                                                                                                                                                                     │
│         address _tempPrev = _currUser.prev;                                                                                                                                                                     │
│         user[_tempNext][index[_tempNext][_market][_card]].prev = _tempPrev;                                                                                                                                     │
│         user[_tempPrev][index[_tempPrev][_market][_card]].next = _tempNext;                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         // return next users price to check they're eligable later                                                                                                                                              │
│         _newPrice = user[_tempNext][index[_tempNext][_market][_card]].price;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         // overwrite array element                                                                                                                                                                              │
│         uint256 _index = index[_user][_market][_card];                                                                                                                                                          │
│         uint256 _lastRecord = user[_user].length - 1;                                                                                                                                                           │
│         // no point overwriting itself                                                                                                                                                                          │
│         if (_index != _lastRecord) {                                                                                                                                                                            │
│             user[_user][_index] = user[_user][_lastRecord];                                                                                                                                                     │
│         }                                                                                                                                                                                                       │
│         user[_user].pop();                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // update the index to help find the record later                                                                                                                                                       │
│         index[_user][_market][_card] = 0;                                                                                                                                                                       │
│         if (user[_user].length != 0 && _index != _lastRecord) {                                                                                                                                                 │
│             index[_user][user[_user][_index].market][                                                                                                                                                           │
│                 user[_user][_index].token                                                                                                                                                                       │
│             ] = _index;                                                                                                                                                                                         │
│         }                                                                                                                                                                                                       │
│         emit LogRemoveFromOrderbook(_user, _market, _card);                                                                                                                                                     │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function findNewOwner(uint256 _card, uint256 _timeOwnershipChanged)                                                                                                                                         │
│         external                                                                                                                                                                                                │
│         override                                                                                                                                                                                                │
│         onlyMarkets                                                                                                                                                                                             │
│         returns (address _newOwner)                                                                                                                                                                             │
│     {                                                                                                                                                                                                           │
│         address _market = msgSender();                                                                                                                                                                          │
│         // the market is the head of the list, the next bid is therefore the owner                                                                                                                              │
│         Bid storage _head = user[_market][index[_market][_market][_card]];                                                                                                                                      │
│         address _oldOwner = _head.next;                                                                                                                                                                         │
│         uint256 _oldPrice =                                                                                                                                                                                     │
│             user[_oldOwner][index[_oldOwner][_market][_card]].price;                                                                                                                                            │
│         uint256 minimumTimeToOwnTo =                                                                                                                                                                            │
│             _timeOwnershipChanged + market[_market].minimumRentalDuration;                                                                                                                                      │
│         uint256 _newPrice;                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // delete current owner                                                                                                                                                                                 │
│         do {                                                                                                                                                                                                    │
│             _newPrice = _removeBidFromOrderbookIgnoreOwner(_head.next, _card);                                                                                                                                  │
│             // delete next bid if foreclosed                                                                                                                                                                    │
│         } while (                                                                                                                                                                                               │
│             treasury.foreclosureTimeUser(                                                                                                                                                                       │
│                 _head.next,                                                                                                                                                                                     │
│                 _newPrice,                                                                                                                                                                                      │
│                 _timeOwnershipChanged                                                                                                                                                                           │
│             ) < minimumTimeToOwnTo                                                                                                                                                                              │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // the old owner is dead, long live the new owner                                                                                                                                                       │
│         _newOwner = user[_market][index[_market][_market][_card]].next;                                                                                                                                         │
│         treasury.updateRentalRate(                                                                                                                                                                              │
│             _oldOwner,                                                                                                                                                                                          │
│             _newOwner,                                                                                                                                                                                          │
│             _oldPrice,                                                                                                                                                                                          │
│             _newPrice,                                                                                                                                                                                          │
│             _timeOwnershipChanged                                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│         transferCard(_market, _card, _oldOwner, _newOwner, _newPrice);                                                                                                                                          │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                      │
│ Code:                                                                                                                                                                                                           │
│     function findNewOwner(uint256 _card, uint256 _timeOwnershipChanged)                                                                                                                                         │
│         external                                                                                                                                                                                                │
│         override                                                                                                                                                                                                │
│         onlyMarkets                                                                                                                                                                                             │
│         returns (address _newOwner)                                                                                                                                                                             │
│     {                                                                                                                                                                                                           │
│         address _market = msgSender();                                                                                                                                                                          │
│         // the market is the head of the list, the next bid is therefore the owner                                                                                                                              │
│         Bid storage _head = user[_market][index[_market][_market][_card]];                                                                                                                                      │
│         address _oldOwner = _head.next;                                                                                                                                                                         │
│         uint256 _oldPrice =                                                                                                                                                                                     │
│             user[_oldOwner][index[_oldOwner][_market][_card]].price;                                                                                                                                            │
│         uint256 minimumTimeToOwnTo =                                                                                                                                                                            │
│             _timeOwnershipChanged + market[_market].minimumRentalDuration;                                                                                                                                      │
│         uint256 _newPrice;                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // delete current owner                                                                                                                                                                                 │
│         do {                                                                                                                                                                                                    │
│             _newPrice = _removeBidFromOrderbookIgnoreOwner(_head.next, _card);                                                                                                                                  │
│             // delete next bid if foreclosed                                                                                                                                                                    │
│         } while (                                                                                                                                                                                               │
│             treasury.foreclosureTimeUser(                                                                                                                                                                       │
│                 _head.next,                                                                                                                                                                                     │
│                 _newPrice,                                                                                                                                                                                      │
│                 _timeOwnershipChanged                                                                                                                                                                           │
│             ) < minimumTimeToOwnTo                                                                                                                                                                              │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // the old owner is dead, long live the new owner                                                                                                                                                       │
│         _newOwner = user[_market][index[_market][_market][_card]].next;                                                                                                                                         │
│         treasury.updateRentalRate(                                                                                                                                                                              │
│             _oldOwner,                                                                                                                                                                                          │
│             _newOwner,                                                                                                                                                                                          │
│             _oldPrice,                                                                                                                                                                                          │
│             _newPrice,                                                                                                                                                                                          │
│             _timeOwnershipChanged                                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│         transferCard(_market, _card, _oldOwner, _newOwner, _newPrice);                                                                                                                                          │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function removeUserFromOrderbook(address _user)                                                                                                                                                             │
│         external                                                                                                                                                                                                │
│         override                                                                                                                                                                                                │
│         returns (bool _userForeclosed)                                                                                                                                                                          │
│     {                                                                                                                                                                                                           │
│         require(treasury.isForeclosed(_user), "User must be foreclosed");                                                                                                                                       │
│         uint256 i = user[_user].length;                                                                                                                                                                         │
│         uint256 _limit = 0;                                                                                                                                                                                     │
│         if (i > maxDeletions) {                                                                                                                                                                                 │
│             _limit = i - maxDeletions;                                                                                                                                                                          │
│         }                                                                                                                                                                                                       │
│         address _market = user[_user].market;                                                                                                                                                                   │
│         uint256 _card = user[_user].token;                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         do {                                                                                                                                                                                                    │
│             i--;                                                                                                                                                                                                │
│             index[_user][user[_user].market][user[_user].token] = 0;                                                                                                                                            │
│             address _tempPrev = user[_user].prev;                                                                                                                                                               │
│             address _tempNext = user[_user].next;                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│             // reduce the rentalRate if they are owner                                                                                                                                                          │
│             if (_tempPrev == user[_user].market) {                                                                                                                                                              │
│                 _market = user[_user].market;                                                                                                                                                                   │
│                 _card = user[_user].token;                                                                                                                                                                      │
│                 uint256 _price =                                                                                                                                                                                │
│                     user[_tempNext][index[_tempNext][_market][_card]].price;                                                                                                                                    │
│                 treasury.updateRentalRate(                                                                                                                                                                      │
│                     _user,                                                                                                                                                                                      │
│                     _tempNext,                                                                                                                                                                                  │
│                     user[_user].price,                                                                                                                                                                          │
│                     _price,                                                                                                                                                                                     │
│                     block.timestamp                                                                                                                                                                             │
│                 );                                                                                                                                                                                              │
│                 transferCard(_market, _card, _user, _tempNext, _price);                                                                                                                                         │
│             }                                                                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│             treasury.decreaseBidRate(_user, user[_user].price);                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│             user[_tempNext][                                                                                                                                                                                    │
│                 index[_tempNext][user[_user].market][user[_user].token]                                                                                                                                         │
│             ]                                                                                                                                                                                                   │
│                 .prev = _tempPrev;                                                                                                                                                                              │
│             user[_tempPrev][                                                                                                                                                                                    │
│                 index[_tempPrev][user[_user].market][user[_user].token]                                                                                                                                         │
│             ]                                                                                                                                                                                                   │
│                 .next = _tempNext;                                                                                                                                                                              │
│             user[_user].pop();                                                                                                                                                                                  │
│         } while (user[_user].length > _limit);                                                                                                                                                                  │
│         if (user[_user].length == 0) {                                                                                                                                                                          │
│             treasury.resetUser(_user);                                                                                                                                                                          │
│             _userForeclosed = false;                                                                                                                                                                            │
│         } else {                                                                                                                                                                                                │
│             _userForeclosed = true;                                                                                                                                                                             │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function closeMarket() external override onlyMarkets {                                                                                                                                                      │
│         address _market = msgSender();                                                                                                                                                                          │
│         closedMarkets.push(_market);                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         for (uint64 i = 0; i < market[_market].tokenCount; i++) {                                                                                                                                               │
│             // reduce owners rental rate                                                                                                                                                                        │
│             address _owner = user[_market][index[_market][_market]].next;                                                                                                                                       │
│             uint256 _price = user[_owner][index[_owner][_market]].price;                                                                                                                                        │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _owner,                                                                                                                                                                                         │
│                 _market,                                                                                                                                                                                        │
│                 _price,                                                                                                                                                                                         │
│                 0,                                                                                                                                                                                              │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // store first and last bids for later                                                                                                                                                              │
│             address _firstBid = _owner;                                                                                                                                                                         │
│             address _lastBid = user[_market][index[_market][_market]].prev;                                                                                                                                     │
│                                                                                                                                                                                                                 │
│             // detach market from rest of list                                                                                                                                                                  │
│             user[_market][index[_market][_market]].prev = _market;                                                                                                                                              │
│             user[_market][index[_market][_market]].next = _market;                                                                                                                                              │
│             user[_firstBid][index[_market][_firstBid]].prev = address(this);                                                                                                                                    │
│             user[_lastBid][index[_market][_lastBid]].next = address(this);                                                                                                                                      │
│                                                                                                                                                                                                                 │
│             // insert bids in the waste pile                                                                                                                                                                    │
│             Bid memory _newBid;                                                                                                                                                                                 │
│             _newBid.market = _market;                                                                                                                                                                           │
│             _newBid.token = i;                                                                                                                                                                                  │
│             _newBid.prev = _lastBid;                                                                                                                                                                            │
│             _newBid.next = _firstBid;                                                                                                                                                                           │
│             _newBid.price = 0;                                                                                                                                                                                  │
│             _newBid.timeHeldLimit = 0;                                                                                                                                                                          │
│             user.push(_newBid);                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                      │
│ Code:                                                                                                                                                                                                           │
│     function closeMarket() external override onlyMarkets {                                                                                                                                                      │
│         address _market = msgSender();                                                                                                                                                                          │
│         closedMarkets.push(_market);                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         for (uint64 i = 0; i < market[_market].tokenCount; i++) {                                                                                                                                               │
│             // reduce owners rental rate                                                                                                                                                                        │
│             address _owner = user[_market][index[_market][_market]].next;                                                                                                                                       │
│             uint256 _price = user[_owner][index[_owner][_market]].price;                                                                                                                                        │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _owner,                                                                                                                                                                                         │
│                 _market,                                                                                                                                                                                        │
│                 _price,                                                                                                                                                                                         │
│                 0,                                                                                                                                                                                              │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // store first and last bids for later                                                                                                                                                              │
│             address _firstBid = _owner;                                                                                                                                                                         │
│             address _lastBid = user[_market][index[_market][_market]].prev;                                                                                                                                     │
│                                                                                                                                                                                                                 │
│             // detach market from rest of list                                                                                                                                                                  │
│             user[_market][index[_market][_market]].prev = _market;                                                                                                                                              │
│             user[_market][index[_market][_market]].next = _market;                                                                                                                                              │
│             user[_firstBid][index[_market][_firstBid]].prev = address(this);                                                                                                                                    │
│             user[_lastBid][index[_market][_lastBid]].next = address(this);                                                                                                                                      │
│                                                                                                                                                                                                                 │
│             // insert bids in the waste pile                                                                                                                                                                    │
│             Bid memory _newBid;                                                                                                                                                                                 │
│             _newBid.market = _market;                                                                                                                                                                           │
│             _newBid.token = i;                                                                                                                                                                                  │
│             _newBid.prev = _lastBid;                                                                                                                                                                            │
│             _newBid.next = _firstBid;                                                                                                                                                                           │
│             _newBid.price = 0;                                                                                                                                                                                  │
│             _newBid.timeHeldLimit = 0;                                                                                                                                                                          │
│             user.push(_newBid);                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes.                                                                                                                                                                                                            │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function removeOldBids(address _user) external override {                                                                                                                                                   │
│         address _market;                                                                                                                                                                                        │
│         uint256 _cardCount;                                                                                                                                                                                     │
│         uint256 _loopCounter;                                                                                                                                                                                   │
│         while (                                                                                                                                                                                                 │
│             userClosedMarketIndex[_user] < closedMarkets.length &&                                                                                                                                              │
│             _loopCounter + _cardCount < maxDeletions                                                                                                                                                            │
│         ) {                                                                                                                                                                                                     │
│             _market = closedMarkets[userClosedMarketIndex[_user]];                                                                                                                                              │
│             _cardCount = market[_market].tokenCount;                                                                                                                                                            │
│             for (uint256 i = market[_market].tokenCount; i != 0; ) {                                                                                                                                            │
│                 i--;                                                                                                                                                                                            │
│                 if (bidExists(_user, _market, i)) {                                                                                                                                                             │
│                     // reduce bidRate                                                                                                                                                                           │
│                     uint256 _price =                                                                                                                                                                            │
│                         user[_user][index[_user][_market]].price;                                                                                                                                               │
│                     treasury.decreaseBidRate(_user, _price);                                                                                                                                                    │
│                                                                                                                                                                                                                 │
│                     // preserve linked list                                                                                                                                                                     │
│                     address _tempPrev =                                                                                                                                                                         │
│                         user[_user][index[_user][_market]].prev;                                                                                                                                                │
│                     address _tempNext =                                                                                                                                                                         │
│                         user[_user][index[_user][_market]].next;                                                                                                                                                │
│                                                                                                                                                                                                                 │
│                     user[_tempNext][index[_tempNext][_market]]                                                                                                                                                  │
│                         .prev = _tempPrev;                                                                                                                                                                      │
│                     user[_tempPrev][index[_tempPrev][_market]]                                                                                                                                                  │
│                         .next = _tempNext;                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                     // delete bid                                                                                                                                                                               │
│                     user[_user].pop();                                                                                                                                                                          │
│                     index[_user][_market] = 0;                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│                     // count deletions                                                                                                                                                                          │
│                     _loopCounter++;                                                                                                                                                                             │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│             userClosedMarketIndex[_user]++;                                                                                                                                                                     │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                    │
│ have inside code statements that update/accrue interest/exchange rate,                                                                                                                                          │
│ Code:                                                                                                                                                                                                           │
│     function deposit(uint256 _amount, address _user)                                                                                                                                                            │
│         public                                                                                                                                                                                                  │
│         override                                                                                                                                                                                                │
│         balancedBooks                                                                                                                                                                                           │
│         returns (bool)                                                                                                                                                                                          │
│     {                                                                                                                                                                                                           │
│         require(!globalPause, "Deposits are disabled");                                                                                                                                                         │
│         require(                                                                                                                                                                                                │
│             erc20.allowance(msgSender(), address(this)) >= _amount,                                                                                                                                             │
│             "User not approved to send this amount"                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         require(                                                                                                                                                                                                │
│             (erc20.balanceOf(address(this)) + _amount) <= maxContractBalance,                                                                                                                                   │
│             "Limit hit"                                                                                                                                                                                         │
│         );                                                                                                                                                                                                      │
│         require(_amount > 0, "Must deposit something");                                                                                                                                                         │
│         if (whitelistEnabled) {                                                                                                                                                                                 │
│             require(isAllowed, "Not in whitelist");                                                                                                                                                             │
│         }                                                                                                                                                                                                       │
│         erc20.transferFrom(msgSender(), address(this), _amount);                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // do some cleaning up, it might help cancel their foreclosure                                                                                                                                          │
│         orderbook.removeOldBids(_user);                                                                                                                                                                         │
│                                                                                                                                                                                                                 │
│         user[_user].deposit += SafeCast.toUint128(_amount);                                                                                                                                                     │
│         totalDeposits += _amount;                                                                                                                                                                               │
│         emit LogAdjustDeposit(_user, _amount, true);                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         // this deposit could cancel the users foreclosure                                                                                                                                                      │
│         if (                                                                                                                                                                                                    │
│             (user[_user].deposit + _amount) >                                                                                                                                                                   │
│             (user[_user].bidRate / minRentalDayDivisor)                                                                                                                                                         │
│         ) {                                                                                                                                                                                                     │
│             isForeclosed[_user] = false;                                                                                                                                                                        │
│             emit LogUserForeclosed(_user, false);                                                                                                                                                               │
│         }                                                                                                                                                                                                       │
│         return true;                                                                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function withdrawDeposit(uint256 _amount, bool _localWithdrawal)                                                                                                                                            │
│         external                                                                                                                                                                                                │
│         override                                                                                                                                                                                                │
│         balancedBooks                                                                                                                                                                                           │
│     {                                                                                                                                                                                                           │
│         require(!globalPause, "Withdrawals are disabled");                                                                                                                                                      │
│         address _msgSender = msgSender();                                                                                                                                                                       │
│         require(user[_msgSender].deposit > 0, "Nothing to withdraw");                                                                                                                                           │
│         // only allow withdraw if they have no bids,                                                                                                                                                            │
│         // OR they've had their cards for at least the minimum rental period                                                                                                                                    │
│         require(                                                                                                                                                                                                │
│             user[_msgSender].bidRate == 0 ||                                                                                                                                                                    │
│                 block.timestamp - (user[_msgSender].lastRentalTime) >                                                                                                                                           │
│                 uint256(1 days) / minRentalDayDivisor,                                                                                                                                                          │
│             "Too soon"                                                                                                                                                                                          │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // stpe 1: collect rent on owned cards                                                                                                                                                                  │
│         collectRentUser(_msgSender, block.timestamp);                                                                                                                                                           │
│                                                                                                                                                                                                                 │
│         // step 2: process withdrawal                                                                                                                                                                           │
│         if (_amount > user[_msgSender].deposit) {                                                                                                                                                               │
│             _amount = user[_msgSender].deposit;                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│         emit LogAdjustDeposit(_msgSender, _amount, false);                                                                                                                                                      │
│         user[_msgSender].deposit -= SafeCast.toUint128(_amount);                                                                                                                                                │
│         totalDeposits -= _amount;                                                                                                                                                                               │
│         if (_localWithdrawal) {                                                                                                                                                                                 │
│             erc20.transfer(_msgSender, _amount);                                                                                                                                                                │
│         } else {                                                                                                                                                                                                │
│             IRCBridge bridge = IRCBridge(bridgeAddress);                                                                                                                                                        │
│             bridge.withdrawToMainnet(_msgSender, _amount);                                                                                                                                                      │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // step 3: remove bids if insufficient deposit                                                                                                                                                          │
│         if (                                                                                                                                                                                                    │
│             user[_msgSender].bidRate != 0 &&                                                                                                                                                                    │
│             user[_msgSender].bidRate / (minRentalDayDivisor) >                                                                                                                                                  │
│             user[_msgSender].deposit                                                                                                                                                                            │
│         ) {                                                                                                                                                                                                     │
│             isForeclosed[_msgSender] = true;                                                                                                                                                                    │
│             isForeclosed[_msgSender] = orderbook.removeUserFromOrderbook(                                                                                                                                       │
│                 _msgSender                                                                                                                                                                                      │
│             );                                                                                                                                                                                                  │
│             emit LogUserForeclosed(_msgSender, isForeclosed[_msgSender]);                                                                                                                                       │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function refundUser(address _user, uint256 _refund)                                                                                                                                                         │
│         external                                                                                                                                                                                                │
│         override                                                                                                                                                                                                │
│         onlyMarkets                                                                                                                                                                                             │
│     {                                                                                                                                                                                                           │
│         marketBalance -= _refund;                                                                                                                                                                               │
│         user[_user].deposit += SafeCast.toUint128(_refund);                                                                                                                                                     │
│         totalDeposits += _refund;                                                                                                                                                                               │
│         emit LogAdjustDeposit(_user, _refund, true);                                                                                                                                                            │
│         if (                                                                                                                                                                                                    │
│             isForeclosed[_user] &&                                                                                                                                                                              │
│             user[_user].deposit > user[_user].bidRate / minRentalDayDivisor                                                                                                                                     │
│         ) {                                                                                                                                                                                                     │
│             isForeclosed[_user] = false;                                                                                                                                                                        │
│             emit LogUserForeclosed(_user, false);                                                                                                                                                               │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                      │
│ Code:                                                                                                                                                                                                           │
│     function refundUser(address _user, uint256 _refund)                                                                                                                                                         │
│         external                                                                                                                                                                                                │
│         override                                                                                                                                                                                                │
│         onlyMarkets                                                                                                                                                                                             │
│     {                                                                                                                                                                                                           │
│         marketBalance -= _refund;                                                                                                                                                                               │
│         user[_user].deposit += SafeCast.toUint128(_refund);                                                                                                                                                     │
│         totalDeposits += _refund;                                                                                                                                                                               │
│         emit LogAdjustDeposit(_user, _refund, true);                                                                                                                                                            │
│         if (                                                                                                                                                                                                    │
│             isForeclosed[_user] &&                                                                                                                                                                              │
│             user[_user].deposit > user[_user].bidRate / minRentalDayDivisor                                                                                                                                     │
│         ) {                                                                                                                                                                                                     │
│             isForeclosed[_user] = false;                                                                                                                                                                        │
│             emit LogUserForeclosed(_user, false);                                                                                                                                                               │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ No                                                                                                                                                                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function updateRentalRate(                                                                                                                                                                                  │
│         address _oldOwner,                                                                                                                                                                                      │
│         address _newOwner,                                                                                                                                                                                      │
│         uint256 _oldPrice,                                                                                                                                                                                      │
│         uint256 _newPrice,                                                                                                                                                                                      │
│         uint256 _timeOwnershipChanged                                                                                                                                                                           │
│     ) external override onlyOrderbook {                                                                                                                                                                         │
│         if (                                                                                                                                                                                                    │
│             _timeOwnershipChanged != user[_newOwner].lastRentCalc &&                                                                                                                                            │
│             !isMarket[_newOwner]                                                                                                                                                                                │
│         ) {                                                                                                                                                                                                     │
│             // The new owners rent must be collected before adjusting their rentalRate                                                                                                                          │
│             // See if the new owner has had a rent collection before or after this ownership change                                                                                                             │
│             if (_timeOwnershipChanged < user[_newOwner].lastRentCalc) {                                                                                                                                         │
│                 // the new owner has a more recent rent collection                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 uint256 _additionalRentOwed =                                                                                                                                                                   │
│                     rentOwedBetweenTimestmaps(                                                                                                                                                                  │
│                         block.timestamp,                                                                                                                                                                        │
│                         _timeOwnershipChanged,                                                                                                                                                                  │
│                         _newPrice                                                                                                                                                                               │
│                     );                                                                                                                                                                                          │
│                 collectRentUser(_newOwner, block.timestamp);                                                                                                                                                    │
│                                                                                                                                                                                                                 │
│                 // they have enough funds, just collect the extra                                                                                                                                               │
│                 _increaseMarketBalance(_additionalRentOwed, _newOwner);                                                                                                                                         │
│             } else {                                                                                                                                                                                            │
│                 // the new owner has an old rent collection, do they own anything else?                                                                                                                         │
│                 if (user[_newOwner].rentalRate != 0) {                                                                                                                                                          │
│                     // rent collect upto ownership change time                                                                                                                                                  │
│                     collectRentUser(_newOwner, _timeOwnershipChanged);                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // first card owned, set start time                                                                                                                                                         │
│                     user[_newOwner].lastRentCalc = SafeCast.toUint64(                                                                                                                                           │
│                         _timeOwnershipChanged                                                                                                                                                                   │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         // Must add before subtract, to avoid underflow in the case a user is only updating their price.                                                                                                        │
│         user[_newOwner].rentalRate += SafeCast.toUint128(_newPrice);                                                                                                                                            │
│         user[_oldOwner].rentalRate -= SafeCast.toUint128(_oldPrice);                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                      │
│ Code:                                                                                                                                                                                                           │
│     function updateRentalRate(                                                                                                                                                                                  │
│         address _oldOwner,                                                                                                                                                                                      │
│         address _newOwner,                                                                                                                                                                                      │
│         uint256 _oldPrice,                                                                                                                                                                                      │
│         uint256 _newPrice,                                                                                                                                                                                      │
│         uint256 _timeOwnershipChanged                                                                                                                                                                           │
│     ) external override onlyOrderbook {                                                                                                                                                                         │
│         if (                                                                                                                                                                                                    │
│             _timeOwnershipChanged != user[_newOwner].lastRentCalc &&                                                                                                                                            │
│             !isMarket[_newOwner]                                                                                                                                                                                │
│         ) {                                                                                                                                                                                                     │
│             // The new owners rent must be collected before adjusting their rentalRate                                                                                                                          │
│             // See if the new owner has had a rent collection before or after this ownership change                                                                                                             │
│             if (_timeOwnershipChanged < user[_newOwner].lastRentCalc) {                                                                                                                                         │
│                 // the new owner has a more recent rent collection                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 uint256 _additionalRentOwed =                                                                                                                                                                   │
│                     rentOwedBetweenTimestmaps(                                                                                                                                                                  │
│                         block.timestamp,                                                                                                                                                                        │
│                         _timeOwnershipChanged,                                                                                                                                                                  │
│                         _newPrice                                                                                                                                                                               │
│                     );                                                                                                                                                                                          │
│                 collectRentUser(_newOwner, block.timestamp);                                                                                                                                                    │
│                                                                                                                                                                                                                 │
│                 // they have enough funds, just collect the extra                                                                                                                                               │
│                 _increaseMarketBalance(_additionalRentOwed, _newOwner);                                                                                                                                         │
│             } else {                                                                                                                                                                                            │
│                 // the new owner has an old rent collection, do they own anything else?                                                                                                                         │
│                 if (user[_newOwner].rentalRate != 0) {                                                                                                                                                          │
│                     // rent collect upto ownership change time                                                                                                                                                  │
│                     collectRentUser(_newOwner, _timeOwnershipChanged);                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // first card owned, set start time                                                                                                                                                         │
│                     user[_newOwner].lastRentCalc = SafeCast.toUint64(                                                                                                                                           │
│                         _timeOwnershipChanged                                                                                                                                                                   │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         // Must add before subtract, to avoid underflow in the case a user is only updating their price.                                                                                                        │
│         user[_newOwner].rentalRate += SafeCast.toUint128(_newPrice);                                                                                                                                            │
│         user[_oldOwner].rentalRate -= SafeCast.toUint128(_oldPrice);                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                               │
│ Code:                                                                                                                                                                                                           │
│     function foreclosureTimeUser(                                                                                                                                                                               │
│         address _user,                                                                                                                                                                                          │
│         uint256 _newBid,                                                                                                                                                                                        │
│         uint256 _timeOfNewBid                                                                                                                                                                                   │
│     ) external view override returns (uint256) {                                                                                                                                                                │
│         uint256 totalUserDailyRent = user[_user].rentalRate;                                                                                                                                                    │
│         if (totalUserDailyRent > 0) {                                                                                                                                                                           │
│             // timeLeftOfDeposit = deposit / (totalUserDailyRent / 1 day)                                                                                                                                       │
│             //                   = (deposit * 1day) / totalUserDailyRent                                                                                                                                        │
│             uint256 timeLeftOfDeposit =                                                                                                                                                                         │
│                 (depositAbleToWithdraw(_user) * 1 days) / totalUserDailyRent;                                                                                                                                   │
│                                                                                                                                                                                                                 │
│             uint256 foreclosureTimeWithoutNewCard =                                                                                                                                                             │
│                 user[_user].lastRentCalc + timeLeftOfDeposit;                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│             if (foreclosureTimeWithoutNewCard > _timeOfNewBid) {                                                                                                                                                │
│                 // calculate how long they can own the new card for                                                                                                                                             │
│                 uint256 _rentAlreadyOwed =                                                                                                                                                                      │
│                     rentOwedBetweenTimestmaps(                                                                                                                                                                  │
│                         user[_user].lastRentCalc,                                                                                                                                                               │
│                         _timeOfNewBid,                                                                                                                                                                          │
│                         totalUserDailyRent                                                                                                                                                                      │
│                     );                                                                                                                                                                                          │
│                 uint256 _depositAtTimeOfNewBid =                                                                                                                                                                │
│                     user[_user].deposit - _rentAlreadyOwed;                                                                                                                                                     │
│                 uint256 _timeLeftOfDepositWithNewBid =                                                                                                                                                          │
│                     (_depositAtTimeOfNewBid * 1 days) /                                                                                                                                                         │
│                         (totalUserDailyRent + _newBid);                                                                                                                                                         │
│                 return _timeOfNewBid + _timeLeftOfDepositWithNewBid;                                                                                                                                            │
│             } else {                                                                                                                                                                                            │
│                 return user[_user].lastRentCalc + timeLeftOfDeposit;                                                                                                                                            │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // if no rentals they'll foreclose after the heat death of the universe                                                                                                                             │
│             return type(uint256).max;                                                                                                                                                                           │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                      │
│ Code:                                                                                                                                                                                                           │
│     function foreclosureTimeUser(                                                                                                                                                                               │
│         address _user,                                                                                                                                                                                          │
│         uint256 _newBid,                                                                                                                                                                                        │
│         uint256 _timeOfNewBid                                                                                                                                                                                   │
│     ) external view override returns (uint256) {                                                                                                                                                                │
│         uint256 totalUserDailyRent = user[_user].rentalRate;                                                                                                                                                    │
│         if (totalUserDailyRent > 0) {                                                                                                                                                                           │
│             // timeLeftOfDeposit = deposit / (totalUserDailyRent / 1 day)                                                                                                                                       │
│             //                   = (deposit * 1day) / totalUserDailyRent                                                                                                                                        │
│             uint256 timeLeftOfDeposit =                                                                                                                                                                         │
│                 (depositAbleToWithdraw(_user) * 1 days) / totalUserDailyRent;                                                                                                                                   │
│                                                                                                                                                                                                                 │
│             uint256 foreclosureTimeWithoutNewCard =                                                                                                                                                             │
│                 user[_user].lastRentCalc + timeLeftOfDeposit;                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│             if (foreclosureTimeWithoutNewCard > _timeOfNewBid) {                                                                                                                                                │
│                 // calculate how long they can own the new card for                                                                                                                                             │
│                 uint256 _rentAlreadyOwed =                                                                                                                                                                      │
│                     rentOwedBetweenTimestmaps(                                                                                                                                                                  │
│                         user[_user].lastRentCalc,                                                                                                                                                               │
│                         _timeOfNewBid,                                                                                                                                                                          │
│                         totalUserDailyRent                                                                                                                                                                      │
│                     );                                                                                                                                                                                          │
│                 uint256 _depositAtTimeOfNewBid =                                                                                                                                                                │
│                     user[_user].deposit - _rentAlreadyOwed;                                                                                                                                                     │
│                 uint256 _timeLeftOfDepositWithNewBid =                                                                                                                                                          │
│                     (_depositAtTimeOfNewBid * 1 days) /                                                                                                                                                         │
│                         (totalUserDailyRent + _newBid);                                                                                                                                                         │
│                 return _timeOfNewBid + _timeLeftOfDepositWithNewBid;                                                                                                                                            │
│             } else {                                                                                                                                                                                            │
│                 return user[_user].lastRentCalc + timeLeftOfDeposit;                                                                                                                                            │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // if no rentals they'll foreclose after the heat death of the universe                                                                                                                             │
│             return type(uint256).max;                                                                                                                                                                           │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: mint or vest or collect token/liquidity/earning and assign them to the address recipient or to variable,                                                                                             │
│ Code:                                                                                                                                                                                                           │
│     function collectRentUser(address _user, uint256 _timeToCollectTo)                                                                                                                                           │
│         public                                                                                                                                                                                                  │
│         override                                                                                                                                                                                                │
│         returns (uint256 newTimeLastCollectedOnForeclosure)                                                                                                                                                     │
│     {                                                                                                                                                                                                           │
│         require(!globalPause, "Global pause is enabled");                                                                                                                                                       │
│         assert(_timeToCollectTo != 0);                                                                                                                                                                          │
│         if (user[_user].lastRentCalc < _timeToCollectTo) {                                                                                                                                                      │
│             uint256 rentOwedByUser = rentOwedUser(_user, _timeToCollectTo);                                                                                                                                     │
│                                                                                                                                                                                                                 │
│             if (rentOwedByUser > 0 && rentOwedByUser > user[_user].deposit) {                                                                                                                                   │
│                 // The User has run out of deposit already.                                                                                                                                                     │
│                 uint256 previousCollectionTime = user[_user].lastRentCalc;                                                                                                                                      │
│                                                                                                                                                                                                                 │
│                 /*                                                                                                                                                                                              │
│             timeTheirDepsitLasted = timeSinceLastUpdate * (usersDeposit/rentOwed)                                                                                                                               │
│                                   = (now - previousCollectionTime) * (usersDeposit/rentOwed)                                                                                                                    │
│             */                                                                                                                                                                                                  │
│                 uint256 timeUsersDepositLasts =                                                                                                                                                                 │
│                     ((_timeToCollectTo - previousCollectionTime) *                                                                                                                                              │
│                         uint256(user[_user].deposit)) / rentOwedByUser;                                                                                                                                         │
│                 /*                                                                                                                                                                                              │
│             Users last collection time = previousCollectionTime + timeTheirDepsitLasted                                                                                                                         │
│             */                                                                                                                                                                                                  │
│                 rentOwedByUser = uint256(user[_user].deposit);                                                                                                                                                  │
│                 newTimeLastCollectedOnForeclosure =                                                                                                                                                             │
│                     previousCollectionTime +                                                                                                                                                                    │
│                     timeUsersDepositLasts;                                                                                                                                                                      │
│                 _increaseMarketBalance(rentOwedByUser, _user);                                                                                                                                                  │
│                 user[_user].lastRentCalc = SafeCast.toUint64(                                                                                                                                                   │
│                     newTimeLastCollectedOnForeclosure                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│                 assert(user[_user].deposit == 0);                                                                                                                                                               │
│                 isForeclosed[_user] = true;                                                                                                                                                                     │
│                 emit LogUserForeclosed(_user, true);                                                                                                                                                            │
│             } else {                                                                                                                                                                                            │
│                 // User has enough deposit to pay rent.                                                                                                                                                         │
│                 _increaseMarketBalance(rentOwedByUser, _user);                                                                                                                                                  │
│                 user[_user].lastRentCalc = SafeCast.toUint64(_timeToCollectTo);                                                                                                                                 │
│             }                                                                                                                                                                                                   │
│             emit LogAdjustDeposit(_user, rentOwedByUser, false);                                                                                                                                                │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to update/accrue interest/exchange rate? Answer only ZERO or ONE statement, cover the code with backquotes.                    │
│ Code:                                                                                                                                                                                                           │
│     function newRental(                                                                                                                                                                                         │
│         uint256 _newPrice,                                                                                                                                                                                      │
│         uint256 _timeHeldLimit,                                                                                                                                                                                 │
│         address _startingPosition,                                                                                                                                                                              │
│         uint256 _card                                                                                                                                                                                           │
│     ) public autoUnlock() autoLock() {                                                                                                                                                                          │
│         if (state == States.OPEN) {                                                                                                                                                                             │
│             require(_newPrice >= MIN_RENTAL_VALUE, "Price below min");                                                                                                                                          │
│             require(_card < numberOfCards, "Card does not exist");                                                                                                                                              │
│                                                                                                                                                                                                                 │
│             address _user = msgSender();                                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│             require(                                                                                                                                                                                            │
│                 exitedTimestamp[_user] != block.timestamp,                                                                                                                                                      │
│                 "Cannot lose and re-rent in same block"                                                                                                                                                         │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 !treasury.marketPaused(address(this)) &&                                                                                                                                                        │
│                     !treasury.globalPause(),                                                                                                                                                                    │
│                 "Rentals are disabled"                                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│             bool _userStillForeclosed = treasury.isForeclosed(_user);                                                                                                                                           │
│             if (_userStillForeclosed) {                                                                                                                                                                         │
│                 _userStillForeclosed = orderbook.removeUserFromOrderbook(_user);                                                                                                                                │
│             }                                                                                                                                                                                                   │
│             if (!_userStillForeclosed) {                                                                                                                                                                        │
│                 if (ownerOf(_card) == _user) {                                                                                                                                                                  │
│                     // the owner may only increase by more than X% or reduce their price                                                                                                                        │
│                     uint256 _requiredPrice =                                                                                                                                                                    │
│                         (cardPrice[_card] *                                                                                                                                                                     │
│                             (minimumPriceIncreasePercent + 100)) / (100);                                                                                                                                       │
│                     require(                                                                                                                                                                                    │
│                         _newPrice >= _requiredPrice ||                                                                                                                                                          │
│                             _newPrice < cardPrice[_card],                                                                                                                                                       │
│                         "Invalid price"                                                                                                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 // do some cleaning up before we collect rent or check their bidRate                                                                                                                            │
│                 orderbook.removeOldBids(_user);                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│                 _collectRent(_card);                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│                 // check sufficient deposit                                                                                                                                                                     │
│                 uint256 _userTotalBidRate =                                                                                                                                                                     │
│                     treasury.userTotalBids(_user) -                                                                                                                                                             │
│                         (orderbook.getBidValue(_user, _card)) +                                                                                                                                                 │
│                         _newPrice;                                                                                                                                                                              │
│                 require(                                                                                                                                                                                        │
│                     treasury.userDeposit(_user) >=                                                                                                                                                              │
│                         _userTotalBidRate / minRentalDayDivisor,                                                                                                                                                │
│                     "Insufficient deposit"                                                                                                                                                                      │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 _timeHeldLimit = _checkTimeHeldLimit(_timeHeldLimit);                                                                                                                                           │
│                                                                                                                                                                                                                 │
│                 // replaces _newBid and _updateBid                                                                                                                                                              │
│                 orderbook.addBidToOrderbook(                                                                                                                                                                    │
│                     _user,                                                                                                                                                                                      │
│                     _card,                                                                                                                                                                                      │
│                     _newPrice,                                                                                                                                                                                  │
│                     _timeHeldLimit,                                                                                                                                                                             │
│                     _startingPosition                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 assert(treasury.updateLastRentalTime(_user));                                                                                                                                                   │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ `_collectRent(_card);`                                                                                                                                                                                          │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward? Answer only ZERO or ONE statement, cover the code with │
│ backquotes.                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function newRental(                                                                                                                                                                                         │
│         uint256 _newPrice,                                                                                                                                                                                      │
│         uint256 _timeHeldLimit,                                                                                                                                                                                 │
│         address _startingPosition,                                                                                                                                                                              │
│         uint256 _card                                                                                                                                                                                           │
│     ) public autoUnlock() autoLock() {                                                                                                                                                                          │
│         if (state == States.OPEN) {                                                                                                                                                                             │
│             require(_newPrice >= MIN_RENTAL_VALUE, "Price below min");                                                                                                                                          │
│             require(_card < numberOfCards, "Card does not exist");                                                                                                                                              │
│                                                                                                                                                                                                                 │
│             address _user = msgSender();                                                                                                                                                                        │
│                                                                                                                                                                                                                 │
│             require(                                                                                                                                                                                            │
│                 exitedTimestamp[_user] != block.timestamp,                                                                                                                                                      │
│                 "Cannot lose and re-rent in same block"                                                                                                                                                         │
│             );                                                                                                                                                                                                  │
│             require(                                                                                                                                                                                            │
│                 !treasury.marketPaused(address(this)) &&                                                                                                                                                        │
│                     !treasury.globalPause(),                                                                                                                                                                    │
│                 "Rentals are disabled"                                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│             bool _userStillForeclosed = treasury.isForeclosed(_user);                                                                                                                                           │
│             if (_userStillForeclosed) {                                                                                                                                                                         │
│                 _userStillForeclosed = orderbook.removeUserFromOrderbook(_user);                                                                                                                                │
│             }                                                                                                                                                                                                   │
│             if (!_userStillForeclosed) {                                                                                                                                                                        │
│                 if (ownerOf(_card) == _user) {                                                                                                                                                                  │
│                     // the owner may only increase by more than X% or reduce their price                                                                                                                        │
│                     uint256 _requiredPrice =                                                                                                                                                                    │
│                         (cardPrice[_card] *                                                                                                                                                                     │
│                             (minimumPriceIncreasePercent + 100)) / (100);                                                                                                                                       │
│                     require(                                                                                                                                                                                    │
│                         _newPrice >= _requiredPrice ||                                                                                                                                                          │
│                             _newPrice < cardPrice[_card],                                                                                                                                                       │
│                         "Invalid price"                                                                                                                                                                         │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│                                                                                                                                                                                                                 │
│                 // do some cleaning up before we collect rent or check their bidRate                                                                                                                            │
│                 orderbook.removeOldBids(_user);                                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│                 _collectRent(_card);                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│                 // check sufficient deposit                                                                                                                                                                     │
│                 uint256 _userTotalBidRate =                                                                                                                                                                     │
│                     treasury.userTotalBids(_user) -                                                                                                                                                             │
│                         (orderbook.getBidValue(_user, _card)) +                                                                                                                                                 │
│                         _newPrice;                                                                                                                                                                              │
│                 require(                                                                                                                                                                                        │
│                     treasury.userDeposit(_user) >=                                                                                                                                                              │
│                         _userTotalBidRate / minRentalDayDivisor,                                                                                                                                                │
│                     "Insufficient deposit"                                                                                                                                                                      │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 _timeHeldLimit = _checkTimeHeldLimit(_timeHeldLimit);                                                                                                                                           │
│                                                                                                                                                                                                                 │
│                 // replaces _newBid and _updateBid                                                                                                                                                              │
│                 orderbook.addBidToOrderbook(                                                                                                                                                                    │
│                     _user,                                                                                                                                                                                      │
│                     _card,                                                                                                                                                                                      │
│                     _newPrice,                                                                                                                                                                                  │
│                     _timeHeldLimit,                                                                                                                                                                             │
│                     _startingPosition                                                                                                                                                                           │
│                 );                                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 assert(treasury.updateLastRentalTime(_user));                                                                                                                                                   │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ `_collectRent(_card);`                                                                                                                                                                                          │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 18:56:54] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/contracts/RCMarket.sol, current         tasks.py:260
                             function: newRental, current vul: wrong-order-interest                                                                                                                                
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to update/accrue interest/exchange rate? Answer only ZERO or ONE statement, cover the code with backquotes.                    │
│ Code:                                                                                                                                                                                                           │
│     function _newBidInOrderbook(                                                                                                                                                                                │
│         address _user,                                                                                                                                                                                          │
│         address _market,                                                                                                                                                                                        │
│         uint256 _card,                                                                                                                                                                                          │
│         uint256 _price,                                                                                                                                                                                         │
│         uint256 _timeHeldLimit,                                                                                                                                                                                 │
│         Bid storage _prevUser                                                                                                                                                                                   │
│     ) internal {                                                                                                                                                                                                │
│         if (ownerOf[_market][_card] != _market) {                                                                                                                                                               │
│             (_prevUser, _price) = _searchOrderbook(                                                                                                                                                             │
│                 _prevUser,                                                                                                                                                                                      │
│                 _market,                                                                                                                                                                                        │
│                 _card,                                                                                                                                                                                          │
│                 _price                                                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         Bid storage _nextUser =                                                                                                                                                                                 │
│             user[_prevUser.next][index[_prevUser.next][_market][_card]];                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         // create new record                                                                                                                                                                                    │
│         Bid memory _newBid;                                                                                                                                                                                     │
│         _newBid.market = _market;                                                                                                                                                                               │
│         _newBid.token = SafeCast.toUint64(_card);                                                                                                                                                               │
│         _newBid.prev = _nextUser.prev;                                                                                                                                                                          │
│         _newBid.next = _prevUser.next;                                                                                                                                                                          │
│         _newBid.price = SafeCast.toUint128(_price);                                                                                                                                                             │
│         _newBid.timeHeldLimit = SafeCast.toUint64(_timeHeldLimit);                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         // insert in linked list                                                                                                                                                                                │
│         _nextUser.prev = _user; // next record update prev link                                                                                                                                                 │
│         _prevUser.next = _user; // prev record update next link                                                                                                                                                 │
│         user[_user].push(_newBid);                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         // update the index to help find the record later                                                                                                                                                       │
│         index[_user][_market][_card] = user[_user].length - (1);                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         emit LogAddToOrderbook(                                                                                                                                                                                 │
│             _user,                                                                                                                                                                                              │
│             _price,                                                                                                                                                                                             │
│             _timeHeldLimit,                                                                                                                                                                                     │
│             nonce,                                                                                                                                                                                              │
│             _card,                                                                                                                                                                                              │
│             _market                                                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         nonce++;                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // update treasury values and transfer ownership if required                                                                                                                                            │
│         treasury.increaseBidRate(_user, _price);                                                                                                                                                                │
│         if (user[_user][index[_user][_market][_card]].prev == _market) {                                                                                                                                        │
│             address _oldOwner = user[_user][index[_user][_market][_card]].next;                                                                                                                                 │
│             transferCard(_market, _card, _oldOwner, _user, _price);                                                                                                                                             │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _oldOwner,                                                                                                                                                                                      │
│                 _user,                                                                                                                                                                                          │
│                 user[_oldOwner][index[_oldOwner][_market][_card]].price,                                                                                                                                        │
│                 _price,                                                                                                                                                                                         │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to update/accrue interest/exchange rate is `treasury.increaseBidRate(_user, _price);`.                                                                                                      │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward? Answer only ZERO or ONE statement, cover the code with │
│ backquotes.                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function _newBidInOrderbook(                                                                                                                                                                                │
│         address _user,                                                                                                                                                                                          │
│         address _market,                                                                                                                                                                                        │
│         uint256 _card,                                                                                                                                                                                          │
│         uint256 _price,                                                                                                                                                                                         │
│         uint256 _timeHeldLimit,                                                                                                                                                                                 │
│         Bid storage _prevUser                                                                                                                                                                                   │
│     ) internal {                                                                                                                                                                                                │
│         if (ownerOf[_market][_card] != _market) {                                                                                                                                                               │
│             (_prevUser, _price) = _searchOrderbook(                                                                                                                                                             │
│                 _prevUser,                                                                                                                                                                                      │
│                 _market,                                                                                                                                                                                        │
│                 _card,                                                                                                                                                                                          │
│                 _price                                                                                                                                                                                          │
│             );                                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         Bid storage _nextUser =                                                                                                                                                                                 │
│             user[_prevUser.next][index[_prevUser.next][_market][_card]];                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         // create new record                                                                                                                                                                                    │
│         Bid memory _newBid;                                                                                                                                                                                     │
│         _newBid.market = _market;                                                                                                                                                                               │
│         _newBid.token = SafeCast.toUint64(_card);                                                                                                                                                               │
│         _newBid.prev = _nextUser.prev;                                                                                                                                                                          │
│         _newBid.next = _prevUser.next;                                                                                                                                                                          │
│         _newBid.price = SafeCast.toUint128(_price);                                                                                                                                                             │
│         _newBid.timeHeldLimit = SafeCast.toUint64(_timeHeldLimit);                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         // insert in linked list                                                                                                                                                                                │
│         _nextUser.prev = _user; // next record update prev link                                                                                                                                                 │
│         _prevUser.next = _user; // prev record update next link                                                                                                                                                 │
│         user[_user].push(_newBid);                                                                                                                                                                              │
│                                                                                                                                                                                                                 │
│         // update the index to help find the record later                                                                                                                                                       │
│         index[_user][_market][_card] = user[_user].length - (1);                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         emit LogAddToOrderbook(                                                                                                                                                                                 │
│             _user,                                                                                                                                                                                              │
│             _price,                                                                                                                                                                                             │
│             _timeHeldLimit,                                                                                                                                                                                     │
│             nonce,                                                                                                                                                                                              │
│             _card,                                                                                                                                                                                              │
│             _market                                                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         nonce++;                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // update treasury values and transfer ownership if required                                                                                                                                            │
│         treasury.increaseBidRate(_user, _price);                                                                                                                                                                │
│         if (user[_user][index[_user][_market][_card]].prev == _market) {                                                                                                                                        │
│             address _oldOwner = user[_user][index[_user][_market][_card]].next;                                                                                                                                 │
│             transferCard(_market, _card, _oldOwner, _user, _price);                                                                                                                                             │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _oldOwner,                                                                                                                                                                                      │
│                 _user,                                                                                                                                                                                          │
│                 user[_oldOwner][index[_oldOwner][_market][_card]].price,                                                                                                                                        │
│                 _price,                                                                                                                                                                                         │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward is `treasury.increaseBidRate(_user, _price);`.                                                                       │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 18:56:56] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/contracts/RCOrderbook.sol, current      tasks.py:260
                             function: _newBidInOrderbook, current vul: wrong-order-interest                                                                                                                       
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to update/accrue interest/exchange rate? Answer only ZERO or ONE statement, cover the code with backquotes.                    │
│ Code:                                                                                                                                                                                                           │
│     function _updateBidInOrderbook(                                                                                                                                                                             │
│         address _user,                                                                                                                                                                                          │
│         address _market,                                                                                                                                                                                        │
│         uint256 _card,                                                                                                                                                                                          │
│         uint256 _price,                                                                                                                                                                                         │
│         uint256 _timeHeldLimit,                                                                                                                                                                                 │
│         Bid storage _prevUser                                                                                                                                                                                   │
│     ) internal {                                                                                                                                                                                                │
│         // TODO no need to unlink and relink if bid doesn't change position in orderbook                                                                                                                        │
│         // unlink current bid                                                                                                                                                                                   │
│         Bid storage _currUser = user[_user][index[_user][_market][_card]];                                                                                                                                      │
│         user[_currUser.next][index[_currUser.next][_market][_card]]                                                                                                                                             │
│             .prev = _currUser.prev;                                                                                                                                                                             │
│         user[_currUser.prev][index[_currUser.prev][_market][_card]]                                                                                                                                             │
│             .next = _currUser.next;                                                                                                                                                                             │
│         bool _owner = _currUser.prev == _market;                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // find new position                                                                                                                                                                                    │
│         (_prevUser, _price) = _searchOrderbook(                                                                                                                                                                 │
│             _prevUser,                                                                                                                                                                                          │
│             _market,                                                                                                                                                                                            │
│             _card,                                                                                                                                                                                              │
│             _price                                                                                                                                                                                              │
│         );                                                                                                                                                                                                      │
│         Bid storage _nextUser =                                                                                                                                                                                 │
│             user[_prevUser.next][index[_prevUser.next][_market][_card]];                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         // update price, save old price for rental rate adjustment later                                                                                                                                        │
│         (_currUser.price, _price) = (                                                                                                                                                                           │
│             SafeCast.toUint128(_price),                                                                                                                                                                         │
│             uint256(_currUser.price)                                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│         _currUser.timeHeldLimit = SafeCast.toUint64(_timeHeldLimit);                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         // relink bid                                                                                                                                                                                           │
│         _currUser.next = _prevUser.next;                                                                                                                                                                        │
│         _currUser.prev = _nextUser.prev;                                                                                                                                                                        │
│         _nextUser.prev = _user; // next record update prev link                                                                                                                                                 │
│         _prevUser.next = _user; // prev record update next link                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         emit LogAddToOrderbook(                                                                                                                                                                                 │
│             _user,                                                                                                                                                                                              │
│             _currUser.price,                                                                                                                                                                                    │
│             _timeHeldLimit,                                                                                                                                                                                     │
│             nonce,                                                                                                                                                                                              │
│             _card,                                                                                                                                                                                              │
│             _market                                                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         nonce++;                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // update treasury values and transfer ownership if required                                                                                                                                            │
│         treasury.increaseBidRate(_user, _currUser.price);                                                                                                                                                       │
│         treasury.decreaseBidRate(_user, _price);                                                                                                                                                                │
│         if (_owner && _currUser.prev == _market) {                                                                                                                                                              │
│             // if owner before and after, update the price difference                                                                                                                                           │
│             transferCard(_market, _card, _user, _user, _currUser.price);                                                                                                                                        │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _user,                                                                                                                                                                                          │
│                 _user,                                                                                                                                                                                          │
│                 _price,                                                                                                                                                                                         │
│                 _currUser.price,                                                                                                                                                                                │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│         } else if (_owner && _currUser.prev != _market) {                                                                                                                                                       │
│             // if owner before and not after, remove the old price                                                                                                                                              │
│             address _newOwner =                                                                                                                                                                                 │
│                 user[_market][index[_market][_market][_card]].next;                                                                                                                                             │
│             uint256 _newPrice =                                                                                                                                                                                 │
│                 user[_newOwner][index[_newOwner][_market][_card]].price;                                                                                                                                        │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _user,                                                                                                                                                                                          │
│                 _newOwner,                                                                                                                                                                                      │
│                 _price,                                                                                                                                                                                         │
│                 _newPrice,                                                                                                                                                                                      │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│             transferCard(_market, _card, _user, _newOwner, _newPrice);                                                                                                                                          │
│         } else if (!_owner && _currUser.prev == _market) {                                                                                                                                                      │
│             // if not owner before but is owner after, add new price                                                                                                                                            │
│             address _oldOwner = _currUser.next;                                                                                                                                                                 │
│             uint256 _oldPrice =                                                                                                                                                                                 │
│                 user[_oldOwner][index[_oldOwner][_market][_card]].price;                                                                                                                                        │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _oldOwner,                                                                                                                                                                                      │
│                 _user,                                                                                                                                                                                          │
│                 _oldPrice,                                                                                                                                                                                      │
│                 _currUser.price,                                                                                                                                                                                │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│             transferCard(_market, _card, _oldOwner, _user, _currUser.price);                                                                                                                                    │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to update/accrue interest/exchange rate is the following:                                                                                                                                   │
│     `treasury.increaseBidRate(_user, _currUser.price);`                                                                                                                                                         │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward? Answer only ZERO or ONE statement, cover the code with │
│ backquotes.                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function _updateBidInOrderbook(                                                                                                                                                                             │
│         address _user,                                                                                                                                                                                          │
│         address _market,                                                                                                                                                                                        │
│         uint256 _card,                                                                                                                                                                                          │
│         uint256 _price,                                                                                                                                                                                         │
│         uint256 _timeHeldLimit,                                                                                                                                                                                 │
│         Bid storage _prevUser                                                                                                                                                                                   │
│     ) internal {                                                                                                                                                                                                │
│         // TODO no need to unlink and relink if bid doesn't change position in orderbook                                                                                                                        │
│         // unlink current bid                                                                                                                                                                                   │
│         Bid storage _currUser = user[_user][index[_user][_market][_card]];                                                                                                                                      │
│         user[_currUser.next][index[_currUser.next][_market][_card]]                                                                                                                                             │
│             .prev = _currUser.prev;                                                                                                                                                                             │
│         user[_currUser.prev][index[_currUser.prev][_market][_card]]                                                                                                                                             │
│             .next = _currUser.next;                                                                                                                                                                             │
│         bool _owner = _currUser.prev == _market;                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // find new position                                                                                                                                                                                    │
│         (_prevUser, _price) = _searchOrderbook(                                                                                                                                                                 │
│             _prevUser,                                                                                                                                                                                          │
│             _market,                                                                                                                                                                                            │
│             _card,                                                                                                                                                                                              │
│             _price                                                                                                                                                                                              │
│         );                                                                                                                                                                                                      │
│         Bid storage _nextUser =                                                                                                                                                                                 │
│             user[_prevUser.next][index[_prevUser.next][_market][_card]];                                                                                                                                        │
│                                                                                                                                                                                                                 │
│         // update price, save old price for rental rate adjustment later                                                                                                                                        │
│         (_currUser.price, _price) = (                                                                                                                                                                           │
│             SafeCast.toUint128(_price),                                                                                                                                                                         │
│             uint256(_currUser.price)                                                                                                                                                                            │
│         );                                                                                                                                                                                                      │
│         _currUser.timeHeldLimit = SafeCast.toUint64(_timeHeldLimit);                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         // relink bid                                                                                                                                                                                           │
│         _currUser.next = _prevUser.next;                                                                                                                                                                        │
│         _currUser.prev = _nextUser.prev;                                                                                                                                                                        │
│         _nextUser.prev = _user; // next record update prev link                                                                                                                                                 │
│         _prevUser.next = _user; // prev record update next link                                                                                                                                                 │
│                                                                                                                                                                                                                 │
│         emit LogAddToOrderbook(                                                                                                                                                                                 │
│             _user,                                                                                                                                                                                              │
│             _currUser.price,                                                                                                                                                                                    │
│             _timeHeldLimit,                                                                                                                                                                                     │
│             nonce,                                                                                                                                                                                              │
│             _card,                                                                                                                                                                                              │
│             _market                                                                                                                                                                                             │
│         );                                                                                                                                                                                                      │
│         nonce++;                                                                                                                                                                                                │
│                                                                                                                                                                                                                 │
│         // update treasury values and transfer ownership if required                                                                                                                                            │
│         treasury.increaseBidRate(_user, _currUser.price);                                                                                                                                                       │
│         treasury.decreaseBidRate(_user, _price);                                                                                                                                                                │
│         if (_owner && _currUser.prev == _market) {                                                                                                                                                              │
│             // if owner before and after, update the price difference                                                                                                                                           │
│             transferCard(_market, _card, _user, _user, _currUser.price);                                                                                                                                        │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _user,                                                                                                                                                                                          │
│                 _user,                                                                                                                                                                                          │
│                 _price,                                                                                                                                                                                         │
│                 _currUser.price,                                                                                                                                                                                │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│         } else if (_owner && _currUser.prev != _market) {                                                                                                                                                       │
│             // if owner before and not after, remove the old price                                                                                                                                              │
│             address _newOwner =                                                                                                                                                                                 │
│                 user[_market][index[_market][_market][_card]].next;                                                                                                                                             │
│             uint256 _newPrice =                                                                                                                                                                                 │
│                 user[_newOwner][index[_newOwner][_market][_card]].price;                                                                                                                                        │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _user,                                                                                                                                                                                          │
│                 _newOwner,                                                                                                                                                                                      │
│                 _price,                                                                                                                                                                                         │
│                 _newPrice,                                                                                                                                                                                      │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│             transferCard(_market, _card, _user, _newOwner, _newPrice);                                                                                                                                          │
│         } else if (!_owner && _currUser.prev == _market) {                                                                                                                                                      │
│             // if not owner before but is owner after, add new price                                                                                                                                            │
│             address _oldOwner = _currUser.next;                                                                                                                                                                 │
│             uint256 _oldPrice =                                                                                                                                                                                 │
│                 user[_oldOwner][index[_oldOwner][_market][_card]].price;                                                                                                                                        │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _oldOwner,                                                                                                                                                                                      │
│                 _user,                                                                                                                                                                                          │
│                 _oldPrice,                                                                                                                                                                                      │
│                 _currUser.price,                                                                                                                                                                                │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│             transferCard(_market, _card, _oldOwner, _user, _currUser.price);                                                                                                                                    │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward is `treasury.increaseBidRate(_user, _currUser.price);`.                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 18:56:57] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/contracts/RCOrderbook.sol, current      tasks.py:260
                             function: _updateBidInOrderbook, current vul: wrong-order-interest                                                                                                                    
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to update/accrue interest/exchange rate? Answer only ZERO or ONE statement, cover the code with backquotes.                    │
│ Code:                                                                                                                                                                                                           │
│     function _removeBidFromOrderbookIgnoreOwner(address _user, uint256 _card)                                                                                                                                   │
│         internal                                                                                                                                                                                                │
│         returns (uint256 _newPrice)                                                                                                                                                                             │
│     {                                                                                                                                                                                                           │
│         address _market = msgSender();                                                                                                                                                                          │
│         // update rates                                                                                                                                                                                         │
│         Bid storage _currUser = user[_user][index[_user][_market][_card]];                                                                                                                                      │
│         treasury.decreaseBidRate(_user, _currUser.price);                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // extract from linked list                                                                                                                                                                             │
│         address _tempNext = _currUser.next;                                                                                                                                                                     │
│         address _tempPrev = _currUser.prev;                                                                                                                                                                     │
│         user[_tempNext][index[_tempNext][_market][_card]].prev = _tempPrev;                                                                                                                                     │
│         user[_tempPrev][index[_tempPrev][_market][_card]].next = _tempNext;                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         // return next users price to check they're eligable later                                                                                                                                              │
│         _newPrice = user[_tempNext][index[_tempNext][_market][_card]].price;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         // overwrite array element                                                                                                                                                                              │
│         uint256 _index = index[_user][_market][_card];                                                                                                                                                          │
│         uint256 _lastRecord = user[_user].length - 1;                                                                                                                                                           │
│         // no point overwriting itself                                                                                                                                                                          │
│         if (_index != _lastRecord) {                                                                                                                                                                            │
│             user[_user][_index] = user[_user][_lastRecord];                                                                                                                                                     │
│         }                                                                                                                                                                                                       │
│         user[_user].pop();                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // update the index to help find the record later                                                                                                                                                       │
│         index[_user][_market][_card] = 0;                                                                                                                                                                       │
│         if (user[_user].length != 0 && _index != _lastRecord) {                                                                                                                                                 │
│             index[_user][user[_user][_index].market][                                                                                                                                                           │
│                 user[_user][_index].token                                                                                                                                                                       │
│             ] = _index;                                                                                                                                                                                         │
│         }                                                                                                                                                                                                       │
│         emit LogRemoveFromOrderbook(_user, _market, _card);                                                                                                                                                     │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to update/accrue interest/exchange rate is `treasury.decreaseBidRate(_user, _currUser.price);`.                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward? Answer only ZERO or ONE statement, cover the code with │
│ backquotes.                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function _removeBidFromOrderbookIgnoreOwner(address _user, uint256 _card)                                                                                                                                   │
│         internal                                                                                                                                                                                                │
│         returns (uint256 _newPrice)                                                                                                                                                                             │
│     {                                                                                                                                                                                                           │
│         address _market = msgSender();                                                                                                                                                                          │
│         // update rates                                                                                                                                                                                         │
│         Bid storage _currUser = user[_user][index[_user][_market][_card]];                                                                                                                                      │
│         treasury.decreaseBidRate(_user, _currUser.price);                                                                                                                                                       │
│                                                                                                                                                                                                                 │
│         // extract from linked list                                                                                                                                                                             │
│         address _tempNext = _currUser.next;                                                                                                                                                                     │
│         address _tempPrev = _currUser.prev;                                                                                                                                                                     │
│         user[_tempNext][index[_tempNext][_market][_card]].prev = _tempPrev;                                                                                                                                     │
│         user[_tempPrev][index[_tempPrev][_market][_card]].next = _tempNext;                                                                                                                                     │
│                                                                                                                                                                                                                 │
│         // return next users price to check they're eligable later                                                                                                                                              │
│         _newPrice = user[_tempNext][index[_tempNext][_market][_card]].price;                                                                                                                                    │
│                                                                                                                                                                                                                 │
│         // overwrite array element                                                                                                                                                                              │
│         uint256 _index = index[_user][_market][_card];                                                                                                                                                          │
│         uint256 _lastRecord = user[_user].length - 1;                                                                                                                                                           │
│         // no point overwriting itself                                                                                                                                                                          │
│         if (_index != _lastRecord) {                                                                                                                                                                            │
│             user[_user][_index] = user[_user][_lastRecord];                                                                                                                                                     │
│         }                                                                                                                                                                                                       │
│         user[_user].pop();                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // update the index to help find the record later                                                                                                                                                       │
│         index[_user][_market][_card] = 0;                                                                                                                                                                       │
│         if (user[_user].length != 0 && _index != _lastRecord) {                                                                                                                                                 │
│             index[_user][user[_user][_index].market][                                                                                                                                                           │
│                 user[_user][_index].token                                                                                                                                                                       │
│             ] = _index;                                                                                                                                                                                         │
│         }                                                                                                                                                                                                       │
│         emit LogRemoveFromOrderbook(_user, _market, _card);                                                                                                                                                     │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward is `treasury.decreaseBidRate(_user, _currUser.price);`.                                                              │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 18:56:59] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/contracts/RCOrderbook.sol, current      tasks.py:260
                             function: _removeBidFromOrderbookIgnoreOwner, current vul: wrong-order-interest                                                                                                       
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to update/accrue interest/exchange rate? Answer only ZERO or ONE statement, cover the code with backquotes.                    │
│ Code:                                                                                                                                                                                                           │
│     function findNewOwner(uint256 _card, uint256 _timeOwnershipChanged)                                                                                                                                         │
│         external                                                                                                                                                                                                │
│         override                                                                                                                                                                                                │
│         onlyMarkets                                                                                                                                                                                             │
│         returns (address _newOwner)                                                                                                                                                                             │
│     {                                                                                                                                                                                                           │
│         address _market = msgSender();                                                                                                                                                                          │
│         // the market is the head of the list, the next bid is therefore the owner                                                                                                                              │
│         Bid storage _head = user[_market][index[_market][_market][_card]];                                                                                                                                      │
│         address _oldOwner = _head.next;                                                                                                                                                                         │
│         uint256 _oldPrice =                                                                                                                                                                                     │
│             user[_oldOwner][index[_oldOwner][_market][_card]].price;                                                                                                                                            │
│         uint256 minimumTimeToOwnTo =                                                                                                                                                                            │
│             _timeOwnershipChanged + market[_market].minimumRentalDuration;                                                                                                                                      │
│         uint256 _newPrice;                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // delete current owner                                                                                                                                                                                 │
│         do {                                                                                                                                                                                                    │
│             _newPrice = _removeBidFromOrderbookIgnoreOwner(_head.next, _card);                                                                                                                                  │
│             // delete next bid if foreclosed                                                                                                                                                                    │
│         } while (                                                                                                                                                                                               │
│             treasury.foreclosureTimeUser(                                                                                                                                                                       │
│                 _head.next,                                                                                                                                                                                     │
│                 _newPrice,                                                                                                                                                                                      │
│                 _timeOwnershipChanged                                                                                                                                                                           │
│             ) < minimumTimeToOwnTo                                                                                                                                                                              │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // the old owner is dead, long live the new owner                                                                                                                                                       │
│         _newOwner = user[_market][index[_market][_market][_card]].next;                                                                                                                                         │
│         treasury.updateRentalRate(                                                                                                                                                                              │
│             _oldOwner,                                                                                                                                                                                          │
│             _newOwner,                                                                                                                                                                                          │
│             _oldPrice,                                                                                                                                                                                          │
│             _newPrice,                                                                                                                                                                                          │
│             _timeOwnershipChanged                                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│         transferCard(_market, _card, _oldOwner, _newOwner, _newPrice);                                                                                                                                          │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to update/accrue interest/exchange rate is `treasury.updateRentalRate(_oldOwner, _newOwner, _oldPrice, _newPrice, _timeOwnershipChanged);`                                                  │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward? Answer only ZERO or ONE statement, cover the code with │
│ backquotes.                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function findNewOwner(uint256 _card, uint256 _timeOwnershipChanged)                                                                                                                                         │
│         external                                                                                                                                                                                                │
│         override                                                                                                                                                                                                │
│         onlyMarkets                                                                                                                                                                                             │
│         returns (address _newOwner)                                                                                                                                                                             │
│     {                                                                                                                                                                                                           │
│         address _market = msgSender();                                                                                                                                                                          │
│         // the market is the head of the list, the next bid is therefore the owner                                                                                                                              │
│         Bid storage _head = user[_market][index[_market][_market][_card]];                                                                                                                                      │
│         address _oldOwner = _head.next;                                                                                                                                                                         │
│         uint256 _oldPrice =                                                                                                                                                                                     │
│             user[_oldOwner][index[_oldOwner][_market][_card]].price;                                                                                                                                            │
│         uint256 minimumTimeToOwnTo =                                                                                                                                                                            │
│             _timeOwnershipChanged + market[_market].minimumRentalDuration;                                                                                                                                      │
│         uint256 _newPrice;                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // delete current owner                                                                                                                                                                                 │
│         do {                                                                                                                                                                                                    │
│             _newPrice = _removeBidFromOrderbookIgnoreOwner(_head.next, _card);                                                                                                                                  │
│             // delete next bid if foreclosed                                                                                                                                                                    │
│         } while (                                                                                                                                                                                               │
│             treasury.foreclosureTimeUser(                                                                                                                                                                       │
│                 _head.next,                                                                                                                                                                                     │
│                 _newPrice,                                                                                                                                                                                      │
│                 _timeOwnershipChanged                                                                                                                                                                           │
│             ) < minimumTimeToOwnTo                                                                                                                                                                              │
│         );                                                                                                                                                                                                      │
│                                                                                                                                                                                                                 │
│         // the old owner is dead, long live the new owner                                                                                                                                                       │
│         _newOwner = user[_market][index[_market][_market][_card]].next;                                                                                                                                         │
│         treasury.updateRentalRate(                                                                                                                                                                              │
│             _oldOwner,                                                                                                                                                                                          │
│             _newOwner,                                                                                                                                                                                          │
│             _oldPrice,                                                                                                                                                                                          │
│             _newPrice,                                                                                                                                                                                          │
│             _timeOwnershipChanged                                                                                                                                                                               │
│         );                                                                                                                                                                                                      │
│         transferCard(_market, _card, _oldOwner, _newOwner, _newPrice);                                                                                                                                          │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ `_newPrice = _removeBidFromOrderbookIgnoreOwner(_head.next, _card);`                                                                                                                                            │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 18:57:00] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/contracts/RCOrderbook.sol, current      tasks.py:260
                             function: findNewOwner, current vul: wrong-order-interest                                                                                                                             
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to update/accrue interest/exchange rate? Answer only ZERO or ONE statement, cover the code with backquotes.                    │
│ Code:                                                                                                                                                                                                           │
│     function closeMarket() external override onlyMarkets {                                                                                                                                                      │
│         address _market = msgSender();                                                                                                                                                                          │
│         closedMarkets.push(_market);                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         for (uint64 i = 0; i < market[_market].tokenCount; i++) {                                                                                                                                               │
│             // reduce owners rental rate                                                                                                                                                                        │
│             address _owner = user[_market][index[_market][_market]].next;                                                                                                                                       │
│             uint256 _price = user[_owner][index[_owner][_market]].price;                                                                                                                                        │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _owner,                                                                                                                                                                                         │
│                 _market,                                                                                                                                                                                        │
│                 _price,                                                                                                                                                                                         │
│                 0,                                                                                                                                                                                              │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // store first and last bids for later                                                                                                                                                              │
│             address _firstBid = _owner;                                                                                                                                                                         │
│             address _lastBid = user[_market][index[_market][_market]].prev;                                                                                                                                     │
│                                                                                                                                                                                                                 │
│             // detach market from rest of list                                                                                                                                                                  │
│             user[_market][index[_market][_market]].prev = _market;                                                                                                                                              │
│             user[_market][index[_market][_market]].next = _market;                                                                                                                                              │
│             user[_firstBid][index[_market][_firstBid]].prev = address(this);                                                                                                                                    │
│             user[_lastBid][index[_market][_lastBid]].next = address(this);                                                                                                                                      │
│                                                                                                                                                                                                                 │
│             // insert bids in the waste pile                                                                                                                                                                    │
│             Bid memory _newBid;                                                                                                                                                                                 │
│             _newBid.market = _market;                                                                                                                                                                           │
│             _newBid.token = i;                                                                                                                                                                                  │
│             _newBid.prev = _lastBid;                                                                                                                                                                            │
│             _newBid.next = _firstBid;                                                                                                                                                                           │
│             _newBid.price = 0;                                                                                                                                                                                  │
│             _newBid.timeHeldLimit = 0;                                                                                                                                                                          │
│             user.push(_newBid);                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to update/accrue interest/exchange rate is `treasury.updateRentalRate(_owner, _market, _price, 0, block.timestamp)`.                                                                        │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward? Answer only ZERO or ONE statement, cover the code with │
│ backquotes.                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function closeMarket() external override onlyMarkets {                                                                                                                                                      │
│         address _market = msgSender();                                                                                                                                                                          │
│         closedMarkets.push(_market);                                                                                                                                                                            │
│                                                                                                                                                                                                                 │
│         for (uint64 i = 0; i < market[_market].tokenCount; i++) {                                                                                                                                               │
│             // reduce owners rental rate                                                                                                                                                                        │
│             address _owner = user[_market][index[_market][_market]].next;                                                                                                                                       │
│             uint256 _price = user[_owner][index[_owner][_market]].price;                                                                                                                                        │
│             treasury.updateRentalRate(                                                                                                                                                                          │
│                 _owner,                                                                                                                                                                                         │
│                 _market,                                                                                                                                                                                        │
│                 _price,                                                                                                                                                                                         │
│                 0,                                                                                                                                                                                              │
│                 block.timestamp                                                                                                                                                                                 │
│             );                                                                                                                                                                                                  │
│                                                                                                                                                                                                                 │
│             // store first and last bids for later                                                                                                                                                              │
│             address _firstBid = _owner;                                                                                                                                                                         │
│             address _lastBid = user[_market][index[_market][_market]].prev;                                                                                                                                     │
│                                                                                                                                                                                                                 │
│             // detach market from rest of list                                                                                                                                                                  │
│             user[_market][index[_market][_market]].prev = _market;                                                                                                                                              │
│             user[_market][index[_market][_market]].next = _market;                                                                                                                                              │
│             user[_firstBid][index[_market][_firstBid]].prev = address(this);                                                                                                                                    │
│             user[_lastBid][index[_market][_lastBid]].next = address(this);                                                                                                                                      │
│                                                                                                                                                                                                                 │
│             // insert bids in the waste pile                                                                                                                                                                    │
│             Bid memory _newBid;                                                                                                                                                                                 │
│             _newBid.market = _market;                                                                                                                                                                           │
│             _newBid.token = i;                                                                                                                                                                                  │
│             _newBid.prev = _lastBid;                                                                                                                                                                            │
│             _newBid.next = _firstBid;                                                                                                                                                                           │
│             _newBid.price = 0;                                                                                                                                                                                  │
│             _newBid.timeHeldLimit = 0;                                                                                                                                                                          │
│             user.push(_newBid);                                                                                                                                                                                 │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ `treasury.updateRentalRate(                                                                                                                                                                                     │
│     _owner,                                                                                                                                                                                                     │
│     _market,                                                                                                                                                                                                    │
│     _price,                                                                                                                                                                                                     │
│     0,                                                                                                                                                                                                          │
│     block.timestamp                                                                                                                                                                                             │
│ );`                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 18:57:01] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/contracts/RCOrderbook.sol, current      tasks.py:260
                             function: closeMarket, current vul: wrong-order-interest                                                                                                                              
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to update/accrue interest/exchange rate? Answer only ZERO or ONE statement, cover the code with backquotes.                    │
│ Code:                                                                                                                                                                                                           │
│     function updateRentalRate(                                                                                                                                                                                  │
│         address _oldOwner,                                                                                                                                                                                      │
│         address _newOwner,                                                                                                                                                                                      │
│         uint256 _oldPrice,                                                                                                                                                                                      │
│         uint256 _newPrice,                                                                                                                                                                                      │
│         uint256 _timeOwnershipChanged                                                                                                                                                                           │
│     ) external override onlyOrderbook {                                                                                                                                                                         │
│         if (                                                                                                                                                                                                    │
│             _timeOwnershipChanged != user[_newOwner].lastRentCalc &&                                                                                                                                            │
│             !isMarket[_newOwner]                                                                                                                                                                                │
│         ) {                                                                                                                                                                                                     │
│             // The new owners rent must be collected before adjusting their rentalRate                                                                                                                          │
│             // See if the new owner has had a rent collection before or after this ownership change                                                                                                             │
│             if (_timeOwnershipChanged < user[_newOwner].lastRentCalc) {                                                                                                                                         │
│                 // the new owner has a more recent rent collection                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 uint256 _additionalRentOwed =                                                                                                                                                                   │
│                     rentOwedBetweenTimestmaps(                                                                                                                                                                  │
│                         block.timestamp,                                                                                                                                                                        │
│                         _timeOwnershipChanged,                                                                                                                                                                  │
│                         _newPrice                                                                                                                                                                               │
│                     );                                                                                                                                                                                          │
│                 collectRentUser(_newOwner, block.timestamp);                                                                                                                                                    │
│                                                                                                                                                                                                                 │
│                 // they have enough funds, just collect the extra                                                                                                                                               │
│                 _increaseMarketBalance(_additionalRentOwed, _newOwner);                                                                                                                                         │
│             } else {                                                                                                                                                                                            │
│                 // the new owner has an old rent collection, do they own anything else?                                                                                                                         │
│                 if (user[_newOwner].rentalRate != 0) {                                                                                                                                                          │
│                     // rent collect upto ownership change time                                                                                                                                                  │
│                     collectRentUser(_newOwner, _timeOwnershipChanged);                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // first card owned, set start time                                                                                                                                                         │
│                     user[_newOwner].lastRentCalc = SafeCast.toUint64(                                                                                                                                           │
│                         _timeOwnershipChanged                                                                                                                                                                   │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         // Must add before subtract, to avoid underflow in the case a user is only updating their price.                                                                                                        │
│         user[_newOwner].rentalRate += SafeCast.toUint128(_newPrice);                                                                                                                                            │
│         user[_oldOwner].rentalRate -= SafeCast.toUint128(_oldPrice);                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to update/accrue interest/exchange rate is `user[_newOwner].rentalRate += SafeCast.toUint128(_newPrice);`.                                                                                  │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward? Answer only ZERO or ONE statement, cover the code with │
│ backquotes.                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function updateRentalRate(                                                                                                                                                                                  │
│         address _oldOwner,                                                                                                                                                                                      │
│         address _newOwner,                                                                                                                                                                                      │
│         uint256 _oldPrice,                                                                                                                                                                                      │
│         uint256 _newPrice,                                                                                                                                                                                      │
│         uint256 _timeOwnershipChanged                                                                                                                                                                           │
│     ) external override onlyOrderbook {                                                                                                                                                                         │
│         if (                                                                                                                                                                                                    │
│             _timeOwnershipChanged != user[_newOwner].lastRentCalc &&                                                                                                                                            │
│             !isMarket[_newOwner]                                                                                                                                                                                │
│         ) {                                                                                                                                                                                                     │
│             // The new owners rent must be collected before adjusting their rentalRate                                                                                                                          │
│             // See if the new owner has had a rent collection before or after this ownership change                                                                                                             │
│             if (_timeOwnershipChanged < user[_newOwner].lastRentCalc) {                                                                                                                                         │
│                 // the new owner has a more recent rent collection                                                                                                                                              │
│                                                                                                                                                                                                                 │
│                 uint256 _additionalRentOwed =                                                                                                                                                                   │
│                     rentOwedBetweenTimestmaps(                                                                                                                                                                  │
│                         block.timestamp,                                                                                                                                                                        │
│                         _timeOwnershipChanged,                                                                                                                                                                  │
│                         _newPrice                                                                                                                                                                               │
│                     );                                                                                                                                                                                          │
│                 collectRentUser(_newOwner, block.timestamp);                                                                                                                                                    │
│                                                                                                                                                                                                                 │
│                 // they have enough funds, just collect the extra                                                                                                                                               │
│                 _increaseMarketBalance(_additionalRentOwed, _newOwner);                                                                                                                                         │
│             } else {                                                                                                                                                                                            │
│                 // the new owner has an old rent collection, do they own anything else?                                                                                                                         │
│                 if (user[_newOwner].rentalRate != 0) {                                                                                                                                                          │
│                     // rent collect upto ownership change time                                                                                                                                                  │
│                     collectRentUser(_newOwner, _timeOwnershipChanged);                                                                                                                                          │
│                 } else {                                                                                                                                                                                        │
│                     // first card owned, set start time                                                                                                                                                         │
│                     user[_newOwner].lastRentCalc = SafeCast.toUint64(                                                                                                                                           │
│                         _timeOwnershipChanged                                                                                                                                                                   │
│                     );                                                                                                                                                                                          │
│                 }                                                                                                                                                                                               │
│             }                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                       │
│         // Must add before subtract, to avoid underflow in the case a user is only updating their price.                                                                                                        │
│         user[_newOwner].rentalRate += SafeCast.toUint128(_newPrice);                                                                                                                                            │
│         user[_oldOwner].rentalRate -= SafeCast.toUint128(_oldPrice);                                                                                                                                            │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ `user[_newOwner].rentalRate += SafeCast.toUint128(_newPrice);`                                                                                                                                                  │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 18:57:02] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/contracts/RCTreasury.sol, current       tasks.py:260
                             function: updateRentalRate, current vul: wrong-order-interest                                                                                                                         
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to update/accrue interest/exchange rate? Answer only ZERO or ONE statement, cover the code with backquotes.                    │
│ Code:                                                                                                                                                                                                           │
│     function foreclosureTimeUser(                                                                                                                                                                               │
│         address _user,                                                                                                                                                                                          │
│         uint256 _newBid,                                                                                                                                                                                        │
│         uint256 _timeOfNewBid                                                                                                                                                                                   │
│     ) external view override returns (uint256) {                                                                                                                                                                │
│         uint256 totalUserDailyRent = user[_user].rentalRate;                                                                                                                                                    │
│         if (totalUserDailyRent > 0) {                                                                                                                                                                           │
│             // timeLeftOfDeposit = deposit / (totalUserDailyRent / 1 day)                                                                                                                                       │
│             //                   = (deposit * 1day) / totalUserDailyRent                                                                                                                                        │
│             uint256 timeLeftOfDeposit =                                                                                                                                                                         │
│                 (depositAbleToWithdraw(_user) * 1 days) / totalUserDailyRent;                                                                                                                                   │
│                                                                                                                                                                                                                 │
│             uint256 foreclosureTimeWithoutNewCard =                                                                                                                                                             │
│                 user[_user].lastRentCalc + timeLeftOfDeposit;                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│             if (foreclosureTimeWithoutNewCard > _timeOfNewBid) {                                                                                                                                                │
│                 // calculate how long they can own the new card for                                                                                                                                             │
│                 uint256 _rentAlreadyOwed =                                                                                                                                                                      │
│                     rentOwedBetweenTimestmaps(                                                                                                                                                                  │
│                         user[_user].lastRentCalc,                                                                                                                                                               │
│                         _timeOfNewBid,                                                                                                                                                                          │
│                         totalUserDailyRent                                                                                                                                                                      │
│                     );                                                                                                                                                                                          │
│                 uint256 _depositAtTimeOfNewBid =                                                                                                                                                                │
│                     user[_user].deposit - _rentAlreadyOwed;                                                                                                                                                     │
│                 uint256 _timeLeftOfDepositWithNewBid =                                                                                                                                                          │
│                     (_depositAtTimeOfNewBid * 1 days) /                                                                                                                                                         │
│                         (totalUserDailyRent + _newBid);                                                                                                                                                         │
│                 return _timeOfNewBid + _timeLeftOfDepositWithNewBid;                                                                                                                                            │
│             } else {                                                                                                                                                                                            │
│                 return user[_user].lastRentCalc + timeLeftOfDeposit;                                                                                                                                            │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // if no rentals they'll foreclose after the heat death of the universe                                                                                                                             │
│             return type(uint256).max;                                                                                                                                                                           │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to update/accrue interest/exchange rate is `ONE` statement, which is:                                                                                                                       │
│ ```                                                                                                                                                                                                             │
│ uint256 _rentAlreadyOwed = rentOwedBetweenTimestmaps(user[_user].lastRentCalc, _timeOfNewBid, totalUserDailyRent);                                                                                              │
│ ```                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward? Answer only ZERO or ONE statement, cover the code with │
│ backquotes.                                                                                                                                                                                                     │
│ Code:                                                                                                                                                                                                           │
│     function foreclosureTimeUser(                                                                                                                                                                               │
│         address _user,                                                                                                                                                                                          │
│         uint256 _newBid,                                                                                                                                                                                        │
│         uint256 _timeOfNewBid                                                                                                                                                                                   │
│     ) external view override returns (uint256) {                                                                                                                                                                │
│         uint256 totalUserDailyRent = user[_user].rentalRate;                                                                                                                                                    │
│         if (totalUserDailyRent > 0) {                                                                                                                                                                           │
│             // timeLeftOfDeposit = deposit / (totalUserDailyRent / 1 day)                                                                                                                                       │
│             //                   = (deposit * 1day) / totalUserDailyRent                                                                                                                                        │
│             uint256 timeLeftOfDeposit =                                                                                                                                                                         │
│                 (depositAbleToWithdraw(_user) * 1 days) / totalUserDailyRent;                                                                                                                                   │
│                                                                                                                                                                                                                 │
│             uint256 foreclosureTimeWithoutNewCard =                                                                                                                                                             │
│                 user[_user].lastRentCalc + timeLeftOfDeposit;                                                                                                                                                   │
│                                                                                                                                                                                                                 │
│             if (foreclosureTimeWithoutNewCard > _timeOfNewBid) {                                                                                                                                                │
│                 // calculate how long they can own the new card for                                                                                                                                             │
│                 uint256 _rentAlreadyOwed =                                                                                                                                                                      │
│                     rentOwedBetweenTimestmaps(                                                                                                                                                                  │
│                         user[_user].lastRentCalc,                                                                                                                                                               │
│                         _timeOfNewBid,                                                                                                                                                                          │
│                         totalUserDailyRent                                                                                                                                                                      │
│                     );                                                                                                                                                                                          │
│                 uint256 _depositAtTimeOfNewBid =                                                                                                                                                                │
│                     user[_user].deposit - _rentAlreadyOwed;                                                                                                                                                     │
│                 uint256 _timeLeftOfDepositWithNewBid =                                                                                                                                                          │
│                     (_depositAtTimeOfNewBid * 1 days) /                                                                                                                                                         │
│                         (totalUserDailyRent + _newBid);                                                                                                                                                         │
│                 return _timeOfNewBid + _timeLeftOfDepositWithNewBid;                                                                                                                                            │
│             } else {                                                                                                                                                                                            │
│                 return user[_user].lastRentCalc + timeLeftOfDeposit;                                                                                                                                            │
│             }                                                                                                                                                                                                   │
│         } else {                                                                                                                                                                                                │
│             // if no rentals they'll foreclose after the heat death of the universe                                                                                                                             │
│             return type(uint256).max;                                                                                                                                                                           │
│         }                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ The first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward is `uint256 timeLeftOfDeposit = (depositAbleToWithdraw(_user) * 1 days) / totalUserDailyRent;`.                      │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/08/24 18:57:04] ERROR    tasks: Static analysis failed: Invalid args                                                                                                                               tasks.py:258
                    ERROR    tasks: Current File: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/datasets/code-423n4-Web3Bugs-data/2021-06-realitycards-main/contracts/RCTreasury.sol, current       tasks.py:260
                             function: foreclosureTimeUser, current vul: wrong-order-interest                                                                                                                      
                    ERROR    tasks: Traceback (most recent call last):                                                                                                                                 tasks.py:262
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/tasks.py", line 254, in simple_cli                                                                                       
                                 res_1 = static_check.run_static_check(checker, args, function1, falcon_instance,                                                                                                  
                             UnboundLocalError: local variable 'falcon_instance' referenced before assignment                                                                                                      
                                                                                                                                                                                                                   
                      Scan Results                       
┏━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┓
┃ Type ┃ Description ┃ Affected Files ┃ Analysis Report ┃
┡━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━┩
└──────┴─────────────┴────────────────┴─────────────────┘
                   Summary                   
┏━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┓
┃ Key                  ┃ Value              ┃
┡━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━┩
│ Files                │ 15                 │
│ Contracts            │ 15                 │
│ Functions            │ 84                 │
│ Lines of Code        │ 4074               │
│ Used Time            │ 30.256800174713135 │
│ Estimated Cost (USD) │ 0.033251           │
└──────────────────────┴────────────────────┘
