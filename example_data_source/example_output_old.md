

  .oooooo.    ooooooooo.   ooooooooooooo  .oooooo..o                                 
 d8P'  `Y8b   `888   `Y88. 8'   888   `8 d8P'    `Y8                                 
888            888   .d88'      888      Y88bo.       .ooooo.   .oooo.   ooo. .oo.   
888            888ooo88P'       888       `"Y8888o.  d88' `"Y8 `P  )88b  `888P"Y88b  
888     ooooo  888              888           `"Y88b 888        .oP"888   888   888  
`88.    .88'   888              888      oo     .d8P 888   .o8 d8(  888   888   888  
 `Y8bood8P'   o888o            o888o     8""88888P'  `Y8bod8P' `Y888""8o o888o o888o                                                        


                                                                   

[01:23:52] Loaded 10 rules                                                                                                                                                                                                                                                                                                             tasks.py:119
[12/07/24 01:23:52] INFO     CryticCompile: 'npx hardhat clean' running (wd: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/eval_data/2021-05-yield-main)                                                                                                                                                                        subprocess.py:41
                    ERROR    CryticCompile: 'npx' returned non-zero exit code 126                                                                                                                                                                                                                                                  subprocess.py:60
                    ERROR    CryticCompile: sh: 1: hardhat: Permission denied                                                                                                                                                                                                                                                      subprocess.py:68
                    INFO     CryticCompile: 'npx hardhat clean --global' running (wd: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/eval_data/2021-05-yield-main)                                                                                                                                                               subprocess.py:41
                    ERROR    CryticCompile: 'npx' returned non-zero exit code 126                                                                                                                                                                                                                                                  subprocess.py:60
                    ERROR    CryticCompile: sh: 1: hardhat: Permission denied                                                                                                                                                                                                                                                      subprocess.py:68
[12/07/24 01:23:53] INFO     CryticCompile: Problem executing hardhat: sh: 1: hardhat: Permission denied                                                                                                                                                                                                                             hardhat.py:327
                                                                                                                                                                                                                                                                                                                                                   
                    INFO     CryticCompile: 'npx hardhat compile --force' running (wd: /home/owen/Documents/GitHub/GPTScan-Bigger-Model/eval_data/2021-05-yield-main)                                                                                                                                                              subprocess.py:41
                    ERROR    CryticCompile: 'npx' returned non-zero exit code 126                                                                                                                                                                                                                                                  subprocess.py:60
                    ERROR    CryticCompile: sh: 1: hardhat: Permission denied                                                                                                                                                                                                                                                      subprocess.py:68
[12/07/24 01:23:55] ERROR    ContractSolcParsing: Impossible to generate IR for JoinFactory.falconConstructorConstantVariables:                                                                                                                                                                                                     contract.py:392
                              'CompilationUnit' object has no attribute 'bytecode_init'                                                                                                                                                                                                                                                            
[12/07/24 01:23:57] ERROR    ContractSolcParsing: Impossible to generate IR for PoolFactory.falconConstructorConstantVariables:                                                                                                                                                                                                     contract.py:392
                              'CompilationUnit' object has no attribute 'bytecode_init'                                                                                                                                                                                                                                                            
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function _join(address user, uint128 amount)                                                                                                                                                                                                                                                                                                │
│         internal                                                                                                                                                                                                                                                                                                                                │
│         returns (uint128)                                                                                                                                                                                                                                                                                                                       │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         IERC20 token = IERC20(asset);                                                                                                                                                                                                                                                                                                           │
│         uint256 _storedBalance = storedBalance;                                                                                                                                                                                                                                                                                                 │
│         uint256 available = token.balanceOf(address(this)) - _storedBalance; // Fine to panic if this underflows                                                                                                                                                                                                                                │
│         storedBalance = _storedBalance + amount;                                                                                                                                                                                                                                                                                                │
│         unchecked { if (available < amount) token.safeTransferFrom(user, address(this), amount - available); }                                                                                                                                                                                                                                  │
│         return amount;                                                                                                                                                                                                                                                                                                                          │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function flashLoan(IERC3156FlashBorrower receiver, address token, uint256 amount, bytes memory data) public override returns(bool) {                                                                                                                                                                                                        │
│         require(token == asset, "Unsupported currency");                                                                                                                                                                                                                                                                                        │
│         uint128 _amount = amount.u128();                                                                                                                                                                                                                                                                                                        │
│         uint128 _fee = _flashFee(amount).u128();                                                                                                                                                                                                                                                                                                │
│         _exit(address(receiver), _amount);                                                                                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                                                                                                                                 │
│         require(receiver.onFlashLoan(msg.sender, token, _amount, _fee, data) == FLASH_LOAN_RETURN, "Non-compliant borrower");                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                                                                                                 │
│         _join(address(receiver), _amount + _fee);                                                                                                                                                                                                                                                                                               │
│         return true;                                                                                                                                                                                                                                                                                                                            │
│     }                                                                                                                                                                                                                                                                                                                                           │
│     function _join(address user, uint128 amount)                                                                                                                                                                                                                                                                                                │
│         internal                                                                                                                                                                                                                                                                                                                                │
│         returns (uint128)                                                                                                                                                                                                                                                                                                                       │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         IERC20 token = IERC20(asset);                                                                                                                                                                                                                                                                                                           │
│         uint256 _storedBalance = storedBalance;                                                                                                                                                                                                                                                                                                 │
│         uint256 available = token.balanceOf(address(this)) - _storedBalance; // Fine to panic if this underflows                                                                                                                                                                                                                                │
│         storedBalance = _storedBalance + amount;                                                                                                                                                                                                                                                                                                │
│         unchecked { if (available < amount) token.safeTransferFrom(user, address(this), amount - available); }                                                                                                                                                                                                                                  │
│         return amount;                                                                                                                                                                                                                                                                                                                          │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function _burn(address from, uint256 amount)                                                                                                                                                                                                                                                                                                │
│         internal override                                                                                                                                                                                                                                                                                                                       │
│         returns (bool)                                                                                                                                                                                                                                                                                                                          │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         // First use any tokens locked in this contract                                                                                                                                                                                                                                                                                         │
│         uint256 available = _balanceOf;                                                                                                                                                                                                                                                                                                         │
│         if (available >= amount) {                                                                                                                                                                                                                                                                                                              │
│             unchecked { return super._burn(address(this), amount); }                                                                                                                                                                                                                                                                            │
│         } else {                                                                                                                                                                                                                                                                                                                                │
│             if (available > 0 ) super._burn(address(this), available);                                                                                                                                                                                                                                                                          │
│             unchecked { _decreaseAllowance(from, amount - available); }                                                                                                                                                                                                                                                                         │
│             unchecked { return super._burn(from, amount - available); }                                                                                                                                                                                                                                                                         │
│         }                                                                                                                                                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function redeem(address to, uint256 amount)                                                                                                                                                                                                                                                                                                 │
│         external override                                                                                                                                                                                                                                                                                                                       │
│         afterMaturity                                                                                                                                                                                                                                                                                                                           │
│         returns (uint256 redeemed)                                                                                                                                                                                                                                                                                                              │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         _burn(msg.sender, amount);                                                                                                                                                                                                                                                                                                              │
│         redeemed = amount.wmul(_accrual());                                                                                                                                                                                                                                                                                                     │
│         join.exit(to, redeemed.u128());                                                                                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                                                                                 │
│         emit Redeemed(msg.sender, to, amount, redeemed);                                                                                                                                                                                                                                                                                        │
│         return amount;                                                                                                                                                                                                                                                                                                                          │
│     }                                                                                                                                                                                                                                                                                                                                           │
│     function _burn(address from, uint256 amount)                                                                                                                                                                                                                                                                                                │
│         internal override                                                                                                                                                                                                                                                                                                                       │
│         returns (bool)                                                                                                                                                                                                                                                                                                                          │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         // First use any tokens locked in this contract                                                                                                                                                                                                                                                                                         │
│         uint256 available = _balanceOf;                                                                                                                                                                                                                                                                                                         │
│         if (available >= amount) {                                                                                                                                                                                                                                                                                                              │
│             unchecked { return super._burn(address(this), amount); }                                                                                                                                                                                                                                                                            │
│         } else {                                                                                                                                                                                                                                                                                                                                │
│             if (available > 0 ) super._burn(address(this), available);                                                                                                                                                                                                                                                                          │
│             unchecked { _decreaseAllowance(from, amount - available); }                                                                                                                                                                                                                                                                         │
│             unchecked { return super._burn(from, amount - available); }                                                                                                                                                                                                                                                                         │
│         }                                                                                                                                                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function flashLoan(IERC3156FlashBorrower receiver, address token, uint256 amount, bytes memory data)                                                                                                                                                                                                                                        │
│         external override                                                                                                                                                                                                                                                                                                                       │
│         beforeMaturity                                                                                                                                                                                                                                                                                                                          │
│         returns(bool)                                                                                                                                                                                                                                                                                                                           │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         require(token == address(this), "Unsupported currency");                                                                                                                                                                                                                                                                                │
│         _mint(address(receiver), amount);                                                                                                                                                                                                                                                                                                       │
│         require(receiver.onFlashLoan(msg.sender, token, amount, 0, data) == FLASH_LOAN_RETURN, "Non-compliant borrower");                                                                                                                                                                                                                       │
│         _burn(address(receiver), amount);                                                                                                                                                                                                                                                                                                       │
│         return true;                                                                                                                                                                                                                                                                                                                            │
│     }                                                                                                                                                                                                                                                                                                                                           │
│     function _burn(address from, uint256 amount)                                                                                                                                                                                                                                                                                                │
│         internal override                                                                                                                                                                                                                                                                                                                       │
│         returns (bool)                                                                                                                                                                                                                                                                                                                          │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         // First use any tokens locked in this contract                                                                                                                                                                                                                                                                                         │
│         uint256 available = _balanceOf;                                                                                                                                                                                                                                                                                                         │
│         if (available >= amount) {                                                                                                                                                                                                                                                                                                              │
│             unchecked { return super._burn(address(this), amount); }                                                                                                                                                                                                                                                                            │
│         } else {                                                                                                                                                                                                                                                                                                                                │
│             if (available > 0 ) super._burn(address(this), available);                                                                                                                                                                                                                                                                          │
│             unchecked { _decreaseAllowance(from, amount - available); }                                                                                                                                                                                                                                                                         │
│             unchecked { return super._burn(from, amount - available); }                                                                                                                                                                                                                                                                         │
│         }                                                                                                                                                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function _burnInternal(address to, bool tradeToBase, uint256 minBaseOut, uint256 minFYTokenOut)                                                                                                                                                                                                                                             │
│         internal                                                                                                                                                                                                                                                                                                                                │
│         returns (uint256, uint256, uint256)                                                                                                                                                                                                                                                                                                     │
│     {                                                                                                                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                                                                                 │
│         uint256 tokensBurned = _balanceOf;                                                                                                                                                                                                                                                                                                      │
│         uint256 supply = _totalSupply;                                                                                                                                                                                                                                                                                                          │
│         uint256 fyTokenBalance = fyToken.balanceOf(address(this));          // use the real balance rather than the virtual one                                                                                                                                                                                                                 │
│         uint256 baseBalance = base.balanceOf(address(this));                                                                                                                                                                                                                                                                                    │
│         (uint112 _baseCached, uint112 _fyTokenCached) =                                                                                                                                                                                                                                                                                         │
│             (baseCached, fyTokenCached);                                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Calculate trade                                                                                                                                                                                                                                                                                                                      │
│         uint256 tokenOut = (tokensBurned * baseBalance) / supply;                                                                                                                                                                                                                                                                               │
│         uint256 fyTokenOut = (tokensBurned * fyTokenBalance) / supply;                                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                                                                                 │
│         if (tradeToBase) {                                                                                                                                                                                                                                                                                                                      │
│             (int128 _k, int128 _g2) = (k2, g2);                                                                                                                                                                                                                                                                                                 │
│             tokenOut += YieldMath.baseOutForFYTokenIn(                      // This is a virtual sell                                                                                                                                                                                                                                           │
│                 _baseCached - tokenOut.u128(),                              // Cache, minus virtual burn                                                                                                                                                                                                                                        │
│                 _fyTokenCached - fyTokenOut.u128(),                         // Cache, minus virtual burn                                                                                                                                                                                                                                        │
│                 fyTokenOut.u128(),                                          // Sell the virtual fyToken obtained                                                                                                                                                                                                                                │
│                 maturity - uint32(block.timestamp),                         // This can't be called after maturity                                                                                                                                                                                                                              │
│                 _k,                                                                                                                                                                                                                                                                                                                             │
│                 _g2                                                                                                                                                                                                                                                                                                                             │
│             );                                                                                                                                                                                                                                                                                                                                  │
│             fyTokenOut = 0;                                                                                                                                                                                                                                                                                                                     │
│         }                                                                                                                                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Slippage                                                                                                                                                                                                                                                                                                                             │
│         require (tokenOut >= minBaseOut, "Pool: Not enough base tokens obtained");                                                                                                                                                                                                                                                              │
│         require (fyTokenOut >= minFYTokenOut, "Pool: Not enough fyToken obtained");                                                                                                                                                                                                                                                             │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Update TWAR                                                                                                                                                                                                                                                                                                                          │
│         _update(                                                                                                                                                                                                                                                                                                                                │
│             (baseBalance - tokenOut).u128(),                                                                                                                                                                                                                                                                                                    │
│             (fyTokenBalance - fyTokenOut + supply - tokensBurned).u128(),                                                                                                                                                                                                                                                                       │
│             _baseCached,                                                                                                                                                                                                                                                                                                                        │
│             _fyTokenCached                                                                                                                                                                                                                                                                                                                      │
│         );                                                                                                                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Transfer assets                                                                                                                                                                                                                                                                                                                      │
│         _burn(address(this), tokensBurned);                                                                                                                                                                                                                                                                                                     │
│         base.safeTransfer(to, tokenOut);                                                                                                                                                                                                                                                                                                        │
│         if (fyTokenOut > 0) IERC20(address(fyToken)).safeTransfer(to, fyTokenOut);                                                                                                                                                                                                                                                              │
│                                                                                                                                                                                                                                                                                                                                                 │
│         emit Liquidity(maturity, msg.sender, to, tokenOut.i256(), fyTokenOut.i256(), -(tokensBurned.i256()));                                                                                                                                                                                                                                   │
│         return (tokensBurned, tokenOut, 0);                                                                                                                                                                                                                                                                                                     │
│     }                                                                                                                                                                                                                                                                                                                                           │
│     function _burn(address from, uint256 amount)                                                                                                                                                                                                                                                                                                │
│         internal override                                                                                                                                                                                                                                                                                                                       │
│         returns (bool)                                                                                                                                                                                                                                                                                                                          │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         // First use any tokens locked in this contract                                                                                                                                                                                                                                                                                         │
│         uint256 available = _balanceOf;                                                                                                                                                                                                                                                                                                         │
│         if (available >= amount) {                                                                                                                                                                                                                                                                                                              │
│             unchecked { return super._burn(address(this), amount); }                                                                                                                                                                                                                                                                            │
│         } else {                                                                                                                                                                                                                                                                                                                                │
│             if (available > 0 ) super._burn(address(this), available);                                                                                                                                                                                                                                                                          │
│             unchecked { _decreaseAllowance(from, amount - available); }                                                                                                                                                                                                                                                                         │
│             unchecked { return super._burn(from, amount - available); }                                                                                                                                                                                                                                                                         │
│         }                                                                                                                                                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                                                                                                                                                               │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function makeBase(bytes6 assetId, IMultiOracleGov oracle, address rateSource, address chiSource) public auth {                                                                                                                                                                                                                              │
│         require (address(oracle) != address(0), "Oracle required");                                                                                                                                                                                                                                                                             │
│         require (rateSource != address(0), "Rate source required");                                                                                                                                                                                                                                                                             │
│         require (chiSource != address(0), "Chi source required");                                                                                                                                                                                                                                                                               │
│                                                                                                                                                                                                                                                                                                                                                 │
│         oracle.setSource(assetId, RATE, rateSource);                                                                                                                                                                                                                                                                                            │
│         oracle.setSource(assetId, CHI, chiSource);                                                                                                                                                                                                                                                                                              │
│         cauldron.setRateOracle(assetId, IOracle(address(oracle))); // TODO: Consider adding a registry of chi oracles in cauldron as well                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                                                                                                                                                               │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function addSeries(                                                                                                                                                                                                                                                                                                                         │
│         bytes6 seriesId,                                                                                                                                                                                                                                                                                                                        │
│         bytes6 baseId,                                                                                                                                                                                                                                                                                                                          │
│         uint32 maturity,                                                                                                                                                                                                                                                                                                                        │
│         bytes6[] memory ilkIds,                                                                                                                                                                                                                                                                                                                 │
│         string memory name,                                                                                                                                                                                                                                                                                                                     │
│         string memory symbol                                                                                                                                                                                                                                                                                                                    │
│     ) public auth {                                                                                                                                                                                                                                                                                                                             │
│         address base = cauldron.assets(baseId);                                                                                                                                                                                                                                                                                                 │
│         require(base != address(0), "Base not found");                                                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                                                                                 │
│         IJoin baseJoin = ladle.joins(baseId);                                                                                                                                                                                                                                                                                                   │
│         require(address(baseJoin) != address(0), "Join not found");                                                                                                                                                                                                                                                                             │
│                                                                                                                                                                                                                                                                                                                                                 │
│         IOracle oracle = cauldron.rateOracles(baseId);                                                                                                                                                                                                                                                                                          │
│         require(address(oracle) != address(0), "Chi oracle not found");                                                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                                                                                 │
│         FYToken fyToken = new FYToken(                                                                                                                                                                                                                                                                                                          │
│             baseId,                                                                                                                                                                                                                                                                                                                             │
│             oracle,                                                                                                                                                                                                                                                                                                                             │
│             baseJoin,                                                                                                                                                                                                                                                                                                                           │
│             maturity,                                                                                                                                                                                                                                                                                                                           │
│             name,     // Derive from base and maturity, perhaps                                                                                                                                                                                                                                                                                 │
│             symbol    // Derive from base and maturity, perhaps                                                                                                                                                                                                                                                                                 │
│         ); // TODO: Use a FYTokenFactory to make Wand deployable at 20000 runs                                                                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Allow the fyToken to pull from the base join for redemption                                                                                                                                                                                                                                                                          │
│         bytes4[] memory sigs = new bytes4[](1);                                                                                                                                                                                                                                                                                                 │
│         sigs[0] = EXIT;                                                                                                                                                                                                                                                                                                                         │
│         AccessControl(address(baseJoin)).grantRoles(sigs, address(fyToken));                                                                                                                                                                                                                                                                    │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Allow the ladle to issue and cancel fyToken                                                                                                                                                                                                                                                                                          │
│         sigs = new bytes4[](2);                                                                                                                                                                                                                                                                                                                 │
│         sigs[0] = MINT;                                                                                                                                                                                                                                                                                                                         │
│         sigs[1] = BURN;                                                                                                                                                                                                                                                                                                                         │
│         fyToken.grantRoles(sigs, address(ladle));                                                                                                                                                                                                                                                                                               │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Pass ownership of the fyToken to msg.sender                                                                                                                                                                                                                                                                                          │
│         fyToken.grantRole(fyToken.ROOT(), msg.sender);                                                                                                                                                                                                                                                                                          │
│         fyToken.renounceRole(fyToken.ROOT(), address(this));                                                                                                                                                                                                                                                                                    │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Add fyToken/series to the Cauldron and approve ilks for the series                                                                                                                                                                                                                                                                   │
│         cauldron.addSeries(seriesId, baseId, fyToken);                                                                                                                                                                                                                                                                                          │
│         cauldron.addIlks(seriesId, ilkIds);                                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Create the pool for the base and fyToken                                                                                                                                                                                                                                                                                             │
│         poolFactory.createPool(base, address(fyToken));                                                                                                                                                                                                                                                                                         │
│         IOwnable pool = IOwnable(poolFactory.calculatePoolAddress(base, address(fyToken)));                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Pass ownership of pool to msg.sender                                                                                                                                                                                                                                                                                                 │
│         pool.transferOwnership(msg.sender);                                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Register pool in Ladle                                                                                                                                                                                                                                                                                                               │
│         ladle.addPool(seriesId, address(pool));                                                                                                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                                                                                                                                                               │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function setRateOracle(bytes6 baseId, IOracle oracle)                                                                                                                                                                                                                                                                                       │
│         external                                                                                                                                                                                                                                                                                                                                │
│         auth                                                                                                                                                                                                                                                                                                                                    │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         require (assets != address(0), "Base not found");                                                                                                                                                                                                                                                                                       │
│         rateOracles = oracle;                                                                                                                                                                                                                                                                                                                   │
│         emit RateOracleAdded(baseId, address(oracle));                                                                                                                                                                                                                                                                                          │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                                                                                                                                                               │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function addSeries(bytes6 seriesId, bytes6 baseId, IFYToken fyToken)                                                                                                                                                                                                                                                                        │
│         external                                                                                                                                                                                                                                                                                                                                │
│         auth                                                                                                                                                                                                                                                                                                                                    │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         require (seriesId != bytes6(0), "Series id is zero");                                                                                                                                                                                                                                                                                   │
│         address base = assets;                                                                                                                                                                                                                                                                                                                  │
│         require (base != address(0), "Base not found");                                                                                                                                                                                                                                                                                         │
│         require (fyToken != IFYToken(address(0)), "Series need a fyToken");                                                                                                                                                                                                                                                                     │
│         require (fyToken.underlying() == base, "Mismatched series and base");                                                                                                                                                                                                                                                                   │
│         require (rateOracles != IOracle(address(0)), "Rate oracle not found");                                                                                                                                                                                                                                                                  │
│         require (series.fyToken == IFYToken(address(0)), "Id already used");                                                                                                                                                                                                                                                                    │
│         series = DataTypes.Series({                                                                                                                                                                                                                                                                                                             │
│             fyToken: fyToken,                                                                                                                                                                                                                                                                                                                   │
│             maturity: fyToken.maturity().u32(),                                                                                                                                                                                                                                                                                                 │
│             baseId: baseId                                                                                                                                                                                                                                                                                                                      │
│         });                                                                                                                                                                                                                                                                                                                                     │
│         emit SeriesAdded(seriesId, baseId, address(fyToken));                                                                                                                                                                                                                                                                                   │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                                                                                                                                                               │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function mature(bytes6 seriesId)                                                                                                                                                                                                                                                                                                            │
│         public                                                                                                                                                                                                                                                                                                                                  │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         DataTypes.Series memory series_ = series;                                                                                                                                                                                                                                                                                               │
│         require (uint32(block.timestamp) >= series_.maturity, "Only after maturity");                                                                                                                                                                                                                                                           │
│         require (ratesAtMaturity == 0, "Already matured");                                                                                                                                                                                                                                                                                      │
│         _mature(seriesId, series_);                                                                                                                                                                                                                                                                                                             │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                                                                                                                                                               │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function _mature(bytes6 seriesId, DataTypes.Series memory series_)                                                                                                                                                                                                                                                                          │
│         internal                                                                                                                                                                                                                                                                                                                                │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         IOracle rateOracle = rateOracles;                                                                                                                                                                                                                                                                                                       │
│         (uint256 rateAtMaturity,) = rateOracle.get(series_.baseId, bytes32("rate"), 1e18);                                                                                                                                                                                                                                                      │
│         ratesAtMaturity = rateAtMaturity;                                                                                                                                                                                                                                                                                                       │
│         emit SeriesMatured(seriesId, rateAtMaturity);                                                                                                                                                                                                                                                                                           │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate,                                                                                                                                                                                                                                                               │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function _accrual(bytes6 seriesId, DataTypes.Series memory series_)                                                                                                                                                                                                                                                                         │
│         private                                                                                                                                                                                                                                                                                                                                 │
│         returns (uint256 accrual_)                                                                                                                                                                                                                                                                                                              │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         uint256 rateAtMaturity = ratesAtMaturity;                                                                                                                                                                                                                                                                                               │
│         if (rateAtMaturity == 0) {  // After maturity, but rate not yet recorded. Let's record it, and accrual is then 1.                                                                                                                                                                                                                       │
│             _mature(seriesId, series_);                                                                                                                                                                                                                                                                                                         │
│         } else {                                                                                                                                                                                                                                                                                                                                │
│             IOracle rateOracle = rateOracles;                                                                                                                                                                                                                                                                                                   │
│             (uint256 rate,) = rateOracle.get(series_.baseId, bytes32("rate"), 1e18);                                                                                                                                                                                                                                                            │
│             accrual_ = rate.wdiv(rateAtMaturity);                                                                                                                                                                                                                                                                                               │
│         }                                                                                                                                                                                                                                                                                                                                       │
│         accrual_ = accrual_ >= 1e18 ? accrual_ : 1e18;     // The accrual can't be below 1 (with 18 decimals)                                                                                                                                                                                                                                   │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have inside code statements that update/accrue interest/exchange rate, and have inside code statements that calculate/assign/distribute the balance/share/stake/fee/loan/reward                                                                                                                                                      │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function _accrual(bytes6 seriesId, DataTypes.Series memory series_)                                                                                                                                                                                                                                                                         │
│         private                                                                                                                                                                                                                                                                                                                                 │
│         returns (uint256 accrual_)                                                                                                                                                                                                                                                                                                              │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         uint256 rateAtMaturity = ratesAtMaturity;                                                                                                                                                                                                                                                                                               │
│         if (rateAtMaturity == 0) {  // After maturity, but rate not yet recorded. Let's record it, and accrual is then 1.                                                                                                                                                                                                                       │
│             _mature(seriesId, series_);                                                                                                                                                                                                                                                                                                         │
│         } else {                                                                                                                                                                                                                                                                                                                                │
│             IOracle rateOracle = rateOracles;                                                                                                                                                                                                                                                                                                   │
│             (uint256 rate,) = rateOracle.get(series_.baseId, bytes32("rate"), 1e18);                                                                                                                                                                                                                                                            │
│             accrual_ = rate.wdiv(rateAtMaturity);                                                                                                                                                                                                                                                                                               │
│         }                                                                                                                                                                                                                                                                                                                                       │
│         accrual_ = accrual_ >= 1e18 ? accrual_ : 1e18;     // The accrual can't be below 1 (with 18 decimals)                                                                                                                                                                                                                                   │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function _repayLadle(bytes12 vaultId, DataTypes.Vault memory vault)                                                                                                                                                                                                                                                                         │
│         private                                                                                                                                                                                                                                                                                                                                 │
│         returns (DataTypes.Balances memory balances)                                                                                                                                                                                                                                                                                            │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         DataTypes.Series memory series = getSeries(vault.seriesId);                                                                                                                                                                                                                                                                             │
│         balances = cauldron.balances(vaultId);                                                                                                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                                                                                                                                                 │
│         uint256 amount = series.fyToken.balanceOf(address(this));                                                                                                                                                                                                                                                                               │
│         amount = amount <= balances.art ? amount : balances.art;                                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Update accounting                                                                                                                                                                                                                                                                                                                    │
│         balances = cauldron.pour(vaultId, 0, -(amount.u128().i128()));                                                                                                                                                                                                                                                                          │
│         series.fyToken.burn(address(this), amount);                                                                                                                                                                                                                                                                                             │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function batch(                                                                                                                                                                                                                                                                                                                             │
│         Operation[] calldata operations,                                                                                                                                                                                                                                                                                                        │
│         bytes[] calldata data                                                                                                                                                                                                                                                                                                                   │
│     ) external payable {                                                                                                                                                                                                                                                                                                                        │
│         require(operations.length == data.length, "Mismatched operation data");                                                                                                                                                                                                                                                                 │
│         bytes12 cachedId;                                                                                                                                                                                                                                                                                                                       │
│         DataTypes.Vault memory vault;                                                                                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Execute all operations in the batch. Conditionals ordered by expected frequency.                                                                                                                                                                                                                                                     │
│         for (uint256 i = 0; i < operations.length; i += 1) {                                                                                                                                                                                                                                                                                    │
│                                                                                                                                                                                                                                                                                                                                                 │
│             Operation operation = operations;                                                                                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                                                                                                 │
│             if (operation == Operation.BUILD) {                                                                                                                                                                                                                                                                                                 │
│                 (bytes12 vaultId, bytes6 seriesId, bytes6 ilkId) = abi.decode(data, (bytes12, bytes6, bytes6));                                                                                                                                                                                                                                 │
│                 (cachedId, vault) = (vaultId, _build(vaultId, seriesId, ilkId));   // Cache the vault that was just built                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.FORWARD_PERMIT) {                                                                                                                                                                                                                                                                                 │
│                 (bytes6 id, bool isAsset, address spender, uint256 amount, uint256 deadline, uint8 v, bytes32 r, bytes32 s) =                                                                                                                                                                                                                   │
│                     abi.decode(data, (bytes6, bool, address, uint256, uint256, uint8, bytes32, bytes32));                                                                                                                                                                                                                                       │
│                 _forwardPermit(id, isAsset, spender, amount, deadline, v, r, s);                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.JOIN_ETHER) {                                                                                                                                                                                                                                                                                     │
│                 (bytes6 etherId) = abi.decode(data, (bytes6));                                                                                                                                                                                                                                                                                  │
│                 _joinEther(etherId);                                                                                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.POUR) {                                                                                                                                                                                                                                                                                           │
│                 (bytes12 vaultId, address to, int128 ink, int128 art) = abi.decode(data, (bytes12, address, int128, int128));                                                                                                                                                                                                                   │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _pour(vaultId, vault, to, ink, art);                                                                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.SERVE) {                                                                                                                                                                                                                                                                                          │
│                 (bytes12 vaultId, address to, uint128 ink, uint128 base, uint128 max) = abi.decode(data, (bytes12, address, uint128, uint128, uint128));                                                                                                                                                                                        │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _serve(vaultId, vault, to, ink, base, max);                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.ROLL) {                                                                                                                                                                                                                                                                                           │
│                 (bytes12 vaultId, bytes6 newSeriesId, uint8 loan, uint128 max) = abi.decode(data, (bytes12, bytes6, uint8, uint128));                                                                                                                                                                                                           │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 (vault,) = _roll(vaultId, vault, newSeriesId, loan, max);                                                                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.FORWARD_DAI_PERMIT) {                                                                                                                                                                                                                                                                             │
│                 (bytes6 id, bool isAsset, address spender, uint256 nonce, uint256 deadline, bool allowed, uint8 v, bytes32 r, bytes32 s) =                                                                                                                                                                                                      │
│                     abi.decode(data, (bytes6, bool, address, uint256, uint256, bool, uint8, bytes32, bytes32));                                                                                                                                                                                                                                 │
│                 _forwardDaiPermit(id, isAsset, spender, nonce, deadline, allowed, v, r, s);                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.TRANSFER_TO_POOL) {                                                                                                                                                                                                                                                                               │
│                 (bytes6 seriesId, bool base, uint128 wad) =                                                                                                                                                                                                                                                                                     │
│                     abi.decode(data, (bytes6, bool, uint128));                                                                                                                                                                                                                                                                                  │
│                 IPool pool = getPool(seriesId);                                                                                                                                                                                                                                                                                                 │
│                 _transferToPool(pool, base, wad);                                                                                                                                                                                                                                                                                               │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.ROUTE) {                                                                                                                                                                                                                                                                                          │
│                 (bytes6 seriesId, bytes memory poolCall) =                                                                                                                                                                                                                                                                                      │
│                     abi.decode(data, (bytes6, bytes));                                                                                                                                                                                                                                                                                          │
│                 IPool pool = getPool(seriesId);                                                                                                                                                                                                                                                                                                 │
│                 _route(pool, poolCall);                                                                                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.EXIT_ETHER) {                                                                                                                                                                                                                                                                                     │
│                 (address to) = abi.decode(data, (address));                                                                                                                                                                                                                                                                                     │
│                 _exitEther(payable(to));                                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.CLOSE) {                                                                                                                                                                                                                                                                                          │
│                 (bytes12 vaultId, address to, int128 ink, int128 art) = abi.decode(data, (bytes12, address, int128, int128));                                                                                                                                                                                                                   │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _close(vaultId, vault, to, ink, art);                                                                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.REPAY) {                                                                                                                                                                                                                                                                                          │
│                 (bytes12 vaultId, address to, int128 ink, uint128 min) = abi.decode(data, (bytes12, address, int128, uint128));                                                                                                                                                                                                                 │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _repay(vaultId, vault, to, ink, min);                                                                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.REPAY_VAULT) {                                                                                                                                                                                                                                                                                    │
│                 (bytes12 vaultId, address to, int128 ink, uint128 max) = abi.decode(data, (bytes12, address, int128, uint128));                                                                                                                                                                                                                 │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _repayVault(vaultId, vault, to, ink, max);                                                                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.REPAY_LADLE) {                                                                                                                                                                                                                                                                                    │
│                 (bytes12 vaultId) = abi.decode(data, (bytes12));                                                                                                                                                                                                                                                                                │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _repayLadle(vaultId, vault);                                                                                                                                                                                                                                                                                                    │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.RETRIEVE) {                                                                                                                                                                                                                                                                                       │
│                 (bytes6 assetId, bool isAsset, address to) = abi.decode(data, (bytes6, bool, address));                                                                                                                                                                                                                                         │
│                 _retrieve(assetId, isAsset, to);                                                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.TRANSFER_TO_FYTOKEN) {                                                                                                                                                                                                                                                                            │
│                 (bytes6 seriesId, uint256 amount) = abi.decode(data, (bytes6, uint256));                                                                                                                                                                                                                                                        │
│                 IFYToken fyToken = getSeries(seriesId).fyToken;                                                                                                                                                                                                                                                                                 │
│                 _transferToFYToken(fyToken, amount);                                                                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.REDEEM) {                                                                                                                                                                                                                                                                                         │
│                 (bytes6 seriesId, address to, uint256 amount) = abi.decode(data, (bytes6, address, uint256));                                                                                                                                                                                                                                   │
│                 IFYToken fyToken = getSeries(seriesId).fyToken;                                                                                                                                                                                                                                                                                 │
│                 _redeem(fyToken, to, amount);                                                                                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.STIR) {                                                                                                                                                                                                                                                                                           │
│                 (bytes12 from, bytes12 to, uint128 ink, uint128 art) = abi.decode(data, (bytes12, bytes12, uint128, uint128));                                                                                                                                                                                                                  │
│                 _stir(from, to, ink, art);  // Too complicated to use caching here                                                                                                                                                                                                                                                              │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.TWEAK) {                                                                                                                                                                                                                                                                                          │
│                 (bytes12 vaultId, bytes6 seriesId, bytes6 ilkId) = abi.decode(data, (bytes12, bytes6, bytes6));                                                                                                                                                                                                                                 │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 vault = _tweak(vaultId, seriesId, ilkId);                                                                                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.GIVE) {                                                                                                                                                                                                                                                                                           │
│                 (bytes12 vaultId, address to) = abi.decode(data, (bytes12, address));                                                                                                                                                                                                                                                           │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 vault = _give(vaultId, to);                                                                                                                                                                                                                                                                                                     │
│                 delete vault;   // Clear the cache, since the vault doesn't necessarily belong to msg.sender anymore                                                                                                                                                                                                                            │
│                 cachedId = bytes12(0);                                                                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.DESTROY) {                                                                                                                                                                                                                                                                                        │
│                 (bytes12 vaultId) = abi.decode(data, (bytes12));                                                                                                                                                                                                                                                                                │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _destroy(vaultId);                                                                                                                                                                                                                                                                                                              │
│                 delete vault;   // Clear the cache                                                                                                                                                                                                                                                                                              │
│                 cachedId = bytes12(0);                                                                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.MODULE) {                                                                                                                                                                                                                                                                                         │
│                 (address module, bytes memory moduleCall) = abi.decode(data, (address, bytes));                                                                                                                                                                                                                                                 │
│                 _moduleCall(module, moduleCall);                                                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                 │
│             }                                                                                                                                                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                                                                                                                                                           │
│     function _repayLadle(bytes12 vaultId, DataTypes.Vault memory vault)                                                                                                                                                                                                                                                                         │
│         private                                                                                                                                                                                                                                                                                                                                 │
│         returns (DataTypes.Balances memory balances)                                                                                                                                                                                                                                                                                            │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         DataTypes.Series memory series = getSeries(vault.seriesId);                                                                                                                                                                                                                                                                             │
│         balances = cauldron.balances(vaultId);                                                                                                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                                                                                                                                                 │
│         uint256 amount = series.fyToken.balanceOf(address(this));                                                                                                                                                                                                                                                                               │
│         amount = amount <= balances.art ? amount : balances.art;                                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Update accounting                                                                                                                                                                                                                                                                                                                    │
│         balances = cauldron.pour(vaultId, 0, -(amount.u128().i128()));                                                                                                                                                                                                                                                                          │
│         series.fyToken.burn(address(this), amount);                                                                                                                                                                                                                                                                                             │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function _retrieve(bytes6 id, bool isAsset, address to)                                                                                                                                                                                                                                                                                     │
│         private                                                                                                                                                                                                                                                                                                                                 │
│         returns (uint256 amount)                                                                                                                                                                                                                                                                                                                │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         IERC20 token = IERC20(findToken(id, isAsset));                                                                                                                                                                                                                                                                                          │
│         amount = token.balanceOf(address(this));                                                                                                                                                                                                                                                                                                │
│         token.safeTransfer(to, amount);                                                                                                                                                                                                                                                                                                         │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function batch(                                                                                                                                                                                                                                                                                                                             │
│         Operation[] calldata operations,                                                                                                                                                                                                                                                                                                        │
│         bytes[] calldata data                                                                                                                                                                                                                                                                                                                   │
│     ) external payable {                                                                                                                                                                                                                                                                                                                        │
│         require(operations.length == data.length, "Mismatched operation data");                                                                                                                                                                                                                                                                 │
│         bytes12 cachedId;                                                                                                                                                                                                                                                                                                                       │
│         DataTypes.Vault memory vault;                                                                                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Execute all operations in the batch. Conditionals ordered by expected frequency.                                                                                                                                                                                                                                                     │
│         for (uint256 i = 0; i < operations.length; i += 1) {                                                                                                                                                                                                                                                                                    │
│                                                                                                                                                                                                                                                                                                                                                 │
│             Operation operation = operations;                                                                                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                                                                                                 │
│             if (operation == Operation.BUILD) {                                                                                                                                                                                                                                                                                                 │
│                 (bytes12 vaultId, bytes6 seriesId, bytes6 ilkId) = abi.decode(data, (bytes12, bytes6, bytes6));                                                                                                                                                                                                                                 │
│                 (cachedId, vault) = (vaultId, _build(vaultId, seriesId, ilkId));   // Cache the vault that was just built                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.FORWARD_PERMIT) {                                                                                                                                                                                                                                                                                 │
│                 (bytes6 id, bool isAsset, address spender, uint256 amount, uint256 deadline, uint8 v, bytes32 r, bytes32 s) =                                                                                                                                                                                                                   │
│                     abi.decode(data, (bytes6, bool, address, uint256, uint256, uint8, bytes32, bytes32));                                                                                                                                                                                                                                       │
│                 _forwardPermit(id, isAsset, spender, amount, deadline, v, r, s);                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.JOIN_ETHER) {                                                                                                                                                                                                                                                                                     │
│                 (bytes6 etherId) = abi.decode(data, (bytes6));                                                                                                                                                                                                                                                                                  │
│                 _joinEther(etherId);                                                                                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.POUR) {                                                                                                                                                                                                                                                                                           │
│                 (bytes12 vaultId, address to, int128 ink, int128 art) = abi.decode(data, (bytes12, address, int128, int128));                                                                                                                                                                                                                   │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _pour(vaultId, vault, to, ink, art);                                                                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.SERVE) {                                                                                                                                                                                                                                                                                          │
│                 (bytes12 vaultId, address to, uint128 ink, uint128 base, uint128 max) = abi.decode(data, (bytes12, address, uint128, uint128, uint128));                                                                                                                                                                                        │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _serve(vaultId, vault, to, ink, base, max);                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.ROLL) {                                                                                                                                                                                                                                                                                           │
│                 (bytes12 vaultId, bytes6 newSeriesId, uint8 loan, uint128 max) = abi.decode(data, (bytes12, bytes6, uint8, uint128));                                                                                                                                                                                                           │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 (vault,) = _roll(vaultId, vault, newSeriesId, loan, max);                                                                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.FORWARD_DAI_PERMIT) {                                                                                                                                                                                                                                                                             │
│                 (bytes6 id, bool isAsset, address spender, uint256 nonce, uint256 deadline, bool allowed, uint8 v, bytes32 r, bytes32 s) =                                                                                                                                                                                                      │
│                     abi.decode(data, (bytes6, bool, address, uint256, uint256, bool, uint8, bytes32, bytes32));                                                                                                                                                                                                                                 │
│                 _forwardDaiPermit(id, isAsset, spender, nonce, deadline, allowed, v, r, s);                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.TRANSFER_TO_POOL) {                                                                                                                                                                                                                                                                               │
│                 (bytes6 seriesId, bool base, uint128 wad) =                                                                                                                                                                                                                                                                                     │
│                     abi.decode(data, (bytes6, bool, uint128));                                                                                                                                                                                                                                                                                  │
│                 IPool pool = getPool(seriesId);                                                                                                                                                                                                                                                                                                 │
│                 _transferToPool(pool, base, wad);                                                                                                                                                                                                                                                                                               │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.ROUTE) {                                                                                                                                                                                                                                                                                          │
│                 (bytes6 seriesId, bytes memory poolCall) =                                                                                                                                                                                                                                                                                      │
│                     abi.decode(data, (bytes6, bytes));                                                                                                                                                                                                                                                                                          │
│                 IPool pool = getPool(seriesId);                                                                                                                                                                                                                                                                                                 │
│                 _route(pool, poolCall);                                                                                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.EXIT_ETHER) {                                                                                                                                                                                                                                                                                     │
│                 (address to) = abi.decode(data, (address));                                                                                                                                                                                                                                                                                     │
│                 _exitEther(payable(to));                                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.CLOSE) {                                                                                                                                                                                                                                                                                          │
│                 (bytes12 vaultId, address to, int128 ink, int128 art) = abi.decode(data, (bytes12, address, int128, int128));                                                                                                                                                                                                                   │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _close(vaultId, vault, to, ink, art);                                                                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.REPAY) {                                                                                                                                                                                                                                                                                          │
│                 (bytes12 vaultId, address to, int128 ink, uint128 min) = abi.decode(data, (bytes12, address, int128, uint128));                                                                                                                                                                                                                 │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _repay(vaultId, vault, to, ink, min);                                                                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.REPAY_VAULT) {                                                                                                                                                                                                                                                                                    │
│                 (bytes12 vaultId, address to, int128 ink, uint128 max) = abi.decode(data, (bytes12, address, int128, uint128));                                                                                                                                                                                                                 │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _repayVault(vaultId, vault, to, ink, max);                                                                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.REPAY_LADLE) {                                                                                                                                                                                                                                                                                    │
│                 (bytes12 vaultId) = abi.decode(data, (bytes12));                                                                                                                                                                                                                                                                                │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _repayLadle(vaultId, vault);                                                                                                                                                                                                                                                                                                    │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.RETRIEVE) {                                                                                                                                                                                                                                                                                       │
│                 (bytes6 assetId, bool isAsset, address to) = abi.decode(data, (bytes6, bool, address));                                                                                                                                                                                                                                         │
│                 _retrieve(assetId, isAsset, to);                                                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.TRANSFER_TO_FYTOKEN) {                                                                                                                                                                                                                                                                            │
│                 (bytes6 seriesId, uint256 amount) = abi.decode(data, (bytes6, uint256));                                                                                                                                                                                                                                                        │
│                 IFYToken fyToken = getSeries(seriesId).fyToken;                                                                                                                                                                                                                                                                                 │
│                 _transferToFYToken(fyToken, amount);                                                                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.REDEEM) {                                                                                                                                                                                                                                                                                         │
│                 (bytes6 seriesId, address to, uint256 amount) = abi.decode(data, (bytes6, address, uint256));                                                                                                                                                                                                                                   │
│                 IFYToken fyToken = getSeries(seriesId).fyToken;                                                                                                                                                                                                                                                                                 │
│                 _redeem(fyToken, to, amount);                                                                                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.STIR) {                                                                                                                                                                                                                                                                                           │
│                 (bytes12 from, bytes12 to, uint128 ink, uint128 art) = abi.decode(data, (bytes12, bytes12, uint128, uint128));                                                                                                                                                                                                                  │
│                 _stir(from, to, ink, art);  // Too complicated to use caching here                                                                                                                                                                                                                                                              │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.TWEAK) {                                                                                                                                                                                                                                                                                          │
│                 (bytes12 vaultId, bytes6 seriesId, bytes6 ilkId) = abi.decode(data, (bytes12, bytes6, bytes6));                                                                                                                                                                                                                                 │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 vault = _tweak(vaultId, seriesId, ilkId);                                                                                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.GIVE) {                                                                                                                                                                                                                                                                                           │
│                 (bytes12 vaultId, address to) = abi.decode(data, (bytes12, address));                                                                                                                                                                                                                                                           │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 vault = _give(vaultId, to);                                                                                                                                                                                                                                                                                                     │
│                 delete vault;   // Clear the cache, since the vault doesn't necessarily belong to msg.sender anymore                                                                                                                                                                                                                            │
│                 cachedId = bytes12(0);                                                                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.DESTROY) {                                                                                                                                                                                                                                                                                        │
│                 (bytes12 vaultId) = abi.decode(data, (bytes12));                                                                                                                                                                                                                                                                                │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _destroy(vaultId);                                                                                                                                                                                                                                                                                                              │
│                 delete vault;   // Clear the cache                                                                                                                                                                                                                                                                                              │
│                 cachedId = bytes12(0);                                                                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.MODULE) {                                                                                                                                                                                                                                                                                         │
│                 (address module, bytes memory moduleCall) = abi.decode(data, (address, bytes));                                                                                                                                                                                                                                                 │
│                 _moduleCall(module, moduleCall);                                                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                 │
│             }                                                                                                                                                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                                                                                                                                                           │
│     function _retrieve(bytes6 id, bool isAsset, address to)                                                                                                                                                                                                                                                                                     │
│         private                                                                                                                                                                                                                                                                                                                                 │
│         returns (uint256 amount)                                                                                                                                                                                                                                                                                                                │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         IERC20 token = IERC20(findToken(id, isAsset));                                                                                                                                                                                                                                                                                          │
│         amount = token.balanceOf(address(this));                                                                                                                                                                                                                                                                                                │
│         token.safeTransfer(to, amount);                                                                                                                                                                                                                                                                                                         │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function _exitEther(address payable to)                                                                                                                                                                                                                                                                                                     │
│         private                                                                                                                                                                                                                                                                                                                                 │
│         returns (uint256 ethTransferred)                                                                                                                                                                                                                                                                                                        │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         ethTransferred = weth.balanceOf(address(this));                                                                                                                                                                                                                                                                                         │
│         weth.withdraw(ethTransferred);   // TODO: Test gas savings using WETH10 `withdrawTo`                                                                                                                                                                                                                                                    │
│         to.safeTransferETH(ethTransferred);                                                                                                                                                                                                                                                                                                     │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function batch(                                                                                                                                                                                                                                                                                                                             │
│         Operation[] calldata operations,                                                                                                                                                                                                                                                                                                        │
│         bytes[] calldata data                                                                                                                                                                                                                                                                                                                   │
│     ) external payable {                                                                                                                                                                                                                                                                                                                        │
│         require(operations.length == data.length, "Mismatched operation data");                                                                                                                                                                                                                                                                 │
│         bytes12 cachedId;                                                                                                                                                                                                                                                                                                                       │
│         DataTypes.Vault memory vault;                                                                                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Execute all operations in the batch. Conditionals ordered by expected frequency.                                                                                                                                                                                                                                                     │
│         for (uint256 i = 0; i < operations.length; i += 1) {                                                                                                                                                                                                                                                                                    │
│                                                                                                                                                                                                                                                                                                                                                 │
│             Operation operation = operations;                                                                                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                                                                                                 │
│             if (operation == Operation.BUILD) {                                                                                                                                                                                                                                                                                                 │
│                 (bytes12 vaultId, bytes6 seriesId, bytes6 ilkId) = abi.decode(data, (bytes12, bytes6, bytes6));                                                                                                                                                                                                                                 │
│                 (cachedId, vault) = (vaultId, _build(vaultId, seriesId, ilkId));   // Cache the vault that was just built                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.FORWARD_PERMIT) {                                                                                                                                                                                                                                                                                 │
│                 (bytes6 id, bool isAsset, address spender, uint256 amount, uint256 deadline, uint8 v, bytes32 r, bytes32 s) =                                                                                                                                                                                                                   │
│                     abi.decode(data, (bytes6, bool, address, uint256, uint256, uint8, bytes32, bytes32));                                                                                                                                                                                                                                       │
│                 _forwardPermit(id, isAsset, spender, amount, deadline, v, r, s);                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.JOIN_ETHER) {                                                                                                                                                                                                                                                                                     │
│                 (bytes6 etherId) = abi.decode(data, (bytes6));                                                                                                                                                                                                                                                                                  │
│                 _joinEther(etherId);                                                                                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.POUR) {                                                                                                                                                                                                                                                                                           │
│                 (bytes12 vaultId, address to, int128 ink, int128 art) = abi.decode(data, (bytes12, address, int128, int128));                                                                                                                                                                                                                   │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _pour(vaultId, vault, to, ink, art);                                                                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.SERVE) {                                                                                                                                                                                                                                                                                          │
│                 (bytes12 vaultId, address to, uint128 ink, uint128 base, uint128 max) = abi.decode(data, (bytes12, address, uint128, uint128, uint128));                                                                                                                                                                                        │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _serve(vaultId, vault, to, ink, base, max);                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.ROLL) {                                                                                                                                                                                                                                                                                           │
│                 (bytes12 vaultId, bytes6 newSeriesId, uint8 loan, uint128 max) = abi.decode(data, (bytes12, bytes6, uint8, uint128));                                                                                                                                                                                                           │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 (vault,) = _roll(vaultId, vault, newSeriesId, loan, max);                                                                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.FORWARD_DAI_PERMIT) {                                                                                                                                                                                                                                                                             │
│                 (bytes6 id, bool isAsset, address spender, uint256 nonce, uint256 deadline, bool allowed, uint8 v, bytes32 r, bytes32 s) =                                                                                                                                                                                                      │
│                     abi.decode(data, (bytes6, bool, address, uint256, uint256, bool, uint8, bytes32, bytes32));                                                                                                                                                                                                                                 │
│                 _forwardDaiPermit(id, isAsset, spender, nonce, deadline, allowed, v, r, s);                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.TRANSFER_TO_POOL) {                                                                                                                                                                                                                                                                               │
│                 (bytes6 seriesId, bool base, uint128 wad) =                                                                                                                                                                                                                                                                                     │
│                     abi.decode(data, (bytes6, bool, uint128));                                                                                                                                                                                                                                                                                  │
│                 IPool pool = getPool(seriesId);                                                                                                                                                                                                                                                                                                 │
│                 _transferToPool(pool, base, wad);                                                                                                                                                                                                                                                                                               │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.ROUTE) {                                                                                                                                                                                                                                                                                          │
│                 (bytes6 seriesId, bytes memory poolCall) =                                                                                                                                                                                                                                                                                      │
│                     abi.decode(data, (bytes6, bytes));                                                                                                                                                                                                                                                                                          │
│                 IPool pool = getPool(seriesId);                                                                                                                                                                                                                                                                                                 │
│                 _route(pool, poolCall);                                                                                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.EXIT_ETHER) {                                                                                                                                                                                                                                                                                     │
│                 (address to) = abi.decode(data, (address));                                                                                                                                                                                                                                                                                     │
│                 _exitEther(payable(to));                                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.CLOSE) {                                                                                                                                                                                                                                                                                          │
│                 (bytes12 vaultId, address to, int128 ink, int128 art) = abi.decode(data, (bytes12, address, int128, int128));                                                                                                                                                                                                                   │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _close(vaultId, vault, to, ink, art);                                                                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.REPAY) {                                                                                                                                                                                                                                                                                          │
│                 (bytes12 vaultId, address to, int128 ink, uint128 min) = abi.decode(data, (bytes12, address, int128, uint128));                                                                                                                                                                                                                 │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _repay(vaultId, vault, to, ink, min);                                                                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.REPAY_VAULT) {                                                                                                                                                                                                                                                                                    │
│                 (bytes12 vaultId, address to, int128 ink, uint128 max) = abi.decode(data, (bytes12, address, int128, uint128));                                                                                                                                                                                                                 │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _repayVault(vaultId, vault, to, ink, max);                                                                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.REPAY_LADLE) {                                                                                                                                                                                                                                                                                    │
│                 (bytes12 vaultId) = abi.decode(data, (bytes12));                                                                                                                                                                                                                                                                                │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _repayLadle(vaultId, vault);                                                                                                                                                                                                                                                                                                    │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.RETRIEVE) {                                                                                                                                                                                                                                                                                       │
│                 (bytes6 assetId, bool isAsset, address to) = abi.decode(data, (bytes6, bool, address));                                                                                                                                                                                                                                         │
│                 _retrieve(assetId, isAsset, to);                                                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.TRANSFER_TO_FYTOKEN) {                                                                                                                                                                                                                                                                            │
│                 (bytes6 seriesId, uint256 amount) = abi.decode(data, (bytes6, uint256));                                                                                                                                                                                                                                                        │
│                 IFYToken fyToken = getSeries(seriesId).fyToken;                                                                                                                                                                                                                                                                                 │
│                 _transferToFYToken(fyToken, amount);                                                                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.REDEEM) {                                                                                                                                                                                                                                                                                         │
│                 (bytes6 seriesId, address to, uint256 amount) = abi.decode(data, (bytes6, address, uint256));                                                                                                                                                                                                                                   │
│                 IFYToken fyToken = getSeries(seriesId).fyToken;                                                                                                                                                                                                                                                                                 │
│                 _redeem(fyToken, to, amount);                                                                                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.STIR) {                                                                                                                                                                                                                                                                                           │
│                 (bytes12 from, bytes12 to, uint128 ink, uint128 art) = abi.decode(data, (bytes12, bytes12, uint128, uint128));                                                                                                                                                                                                                  │
│                 _stir(from, to, ink, art);  // Too complicated to use caching here                                                                                                                                                                                                                                                              │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.TWEAK) {                                                                                                                                                                                                                                                                                          │
│                 (bytes12 vaultId, bytes6 seriesId, bytes6 ilkId) = abi.decode(data, (bytes12, bytes6, bytes6));                                                                                                                                                                                                                                 │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 vault = _tweak(vaultId, seriesId, ilkId);                                                                                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.GIVE) {                                                                                                                                                                                                                                                                                           │
│                 (bytes12 vaultId, address to) = abi.decode(data, (bytes12, address));                                                                                                                                                                                                                                                           │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 vault = _give(vaultId, to);                                                                                                                                                                                                                                                                                                     │
│                 delete vault;   // Clear the cache, since the vault doesn't necessarily belong to msg.sender anymore                                                                                                                                                                                                                            │
│                 cachedId = bytes12(0);                                                                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.DESTROY) {                                                                                                                                                                                                                                                                                        │
│                 (bytes12 vaultId) = abi.decode(data, (bytes12));                                                                                                                                                                                                                                                                                │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _destroy(vaultId);                                                                                                                                                                                                                                                                                                              │
│                 delete vault;   // Clear the cache                                                                                                                                                                                                                                                                                              │
│                 cachedId = bytes12(0);                                                                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.MODULE) {                                                                                                                                                                                                                                                                                         │
│                 (address module, bytes memory moduleCall) = abi.decode(data, (address, bytes));                                                                                                                                                                                                                                                 │
│                 _moduleCall(module, moduleCall);                                                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                 │
│             }                                                                                                                                                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                                                                                                                                                           │
│     function _exitEther(address payable to)                                                                                                                                                                                                                                                                                                     │
│         private                                                                                                                                                                                                                                                                                                                                 │
│         returns (uint256 ethTransferred)                                                                                                                                                                                                                                                                                                        │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         ethTransferred = weth.balanceOf(address(this));                                                                                                                                                                                                                                                                                         │
│         weth.withdraw(ethTransferred);   // TODO: Test gas savings using WETH10 `withdrawTo`                                                                                                                                                                                                                                                    │
│         to.safeTransferETH(ethTransferred);                                                                                                                                                                                                                                                                                                     │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function batch(                                                                                                                                                                                                                                                                                                                             │
│         PoolDataTypes.Operation[] calldata operations,                                                                                                                                                                                                                                                                                          │
│         bytes[] calldata data                                                                                                                                                                                                                                                                                                                   │
│     ) external payable {                                                                                                                                                                                                                                                                                                                        │
│         require(operations.length == data.length, "Mismatched operation data");                                                                                                                                                                                                                                                                 │
│         PoolAddresses memory cache;                                                                                                                                                                                                                                                                                                             │
│                                                                                                                                                                                                                                                                                                                                                 │
│         for (uint256 i = 0; i < operations.length; i += 1) {                                                                                                                                                                                                                                                                                    │
│             PoolDataTypes.Operation operation = operations;                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│             if (operation == PoolDataTypes.Operation.ROUTE) {                                                                                                                                                                                                                                                                                   │
│                 (address base, address fyToken, bytes memory poolcall) = abi.decode(data, (address, address, bytes));                                                                                                                                                                                                                           │
│                 if (cache.base != base || cache.fyToken != fyToken) cache = PoolAddresses(base, fyToken, findPool(base, fyToken));                                                                                                                                                                                                              │
│                 _route(cache, poolcall);                                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == PoolDataTypes.Operation.TRANSFER_TO_POOL) {                                                                                                                                                                                                                                                                 │
│                 (address base, address fyToken, address token, uint128 wad) = abi.decode(data, (address, address, address, uint128));                                                                                                                                                                                                           │
│                 if (cache.base != base || cache.fyToken != fyToken) cache = PoolAddresses(base, fyToken, findPool(base, fyToken));                                                                                                                                                                                                              │
│                 _transferToPool(cache, token, wad);                                                                                                                                                                                                                                                                                             │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == PoolDataTypes.Operation.FORWARD_PERMIT) {                                                                                                                                                                                                                                                                   │
│                 (address base, address fyToken, address token, address spender, uint256 amount, uint256 deadline, uint8 v, bytes32 r, bytes32 s) =                                                                                                                                                                                              │
│                     abi.decode(data, (address, address, address, address, uint256, uint256, uint8, bytes32, bytes32));                                                                                                                                                                                                                          │
│                 if (cache.base != base || cache.fyToken != fyToken) cache = PoolAddresses(base, fyToken, findPool(base, fyToken));                                                                                                                                                                                                              │
│                 _forwardPermit(cache, token, spender, amount, deadline, v, r, s);                                                                                                                                                                                                                                                               │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == PoolDataTypes.Operation.FORWARD_DAI_PERMIT) {                                                                                                                                                                                                                                                               │
│                         (address base, address fyToken, address spender, uint256 nonce, uint256 deadline, bool allowed, uint8 v, bytes32 r, bytes32 s) =                                                                                                                                                                                        │
│                     abi.decode(data, (address, address, address, uint256, uint256, bool, uint8, bytes32, bytes32));                                                                                                                                                                                                                             │
│                 if (cache.base != base || cache.fyToken != fyToken) cache = PoolAddresses(base, fyToken, findPool(base, fyToken));                                                                                                                                                                                                              │
│                 _forwardDaiPermit(cache, spender, nonce, deadline, allowed, v, r, s);                                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == PoolDataTypes.Operation.JOIN_ETHER) {                                                                                                                                                                                                                                                                       │
│                 (address base, address fyToken) = abi.decode(data, (address, address));                                                                                                                                                                                                                                                         │
│                 if (cache.base != base || cache.fyToken != fyToken) cache = PoolAddresses(base, fyToken, findPool(base, fyToken));                                                                                                                                                                                                              │
│                 _joinEther(cache.pool);                                                                                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == PoolDataTypes.Operation.EXIT_ETHER) {                                                                                                                                                                                                                                                                       │
│                 (address to) = abi.decode(data, (address));                                                                                                                                                                                                                                                                                     │
│                 _exitEther(to);                                                                                                                                                                                                                                                                                                                 │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else {                                                                                                                                                                                                                                                                                                                            │
│                 revert("Invalid operation");                                                                                                                                                                                                                                                                                                    │
│             }                                                                                                                                                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                                                                                                                                                           │
│     function _exitEther(address payable to)                                                                                                                                                                                                                                                                                                     │
│         private                                                                                                                                                                                                                                                                                                                                 │
│         returns (uint256 ethTransferred)                                                                                                                                                                                                                                                                                                        │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         ethTransferred = weth.balanceOf(address(this));                                                                                                                                                                                                                                                                                         │
│         weth.withdraw(ethTransferred);   // TODO: Test gas savings using WETH10 `withdrawTo`                                                                                                                                                                                                                                                    │
│         to.safeTransferETH(ethTransferred);                                                                                                                                                                                                                                                                                                     │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ have inside code statements that update/accrue interest/exchange rate,                                                                                                                                                                                                                                                                          │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function _peek(bytes6 base, bytes6 kind) private view returns (uint price, uint updateTime) {                                                                                                                                                                                                                                               │
│         uint256 rawPrice;                                                                                                                                                                                                                                                                                                                       │
│         address source = sources;                                                                                                                                                                                                                                                                                                               │
│         require (source != address(0), "Source not found");                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│         if (kind == "rate") rawPrice = CTokenInterface(source).borrowIndex();                                                                                                                                                                                                                                                                   │
│         else if (kind == "chi") rawPrice = CTokenInterface(source).exchangeRateStored();                                                                                                                                                                                                                                                        │
│         else revert("Unknown oracle type");                                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│         require(rawPrice > 0, "Compound price is zero");                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                 │
│         price = rawPrice * SCALE_FACTOR;                                                                                                                                                                                                                                                                                                        │
│         updateTime = block.timestamp;                                                                                                                                                                                                                                                                                                           │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function get(bytes32 base, bytes32 quote, uint256 amount) public virtual override view returns (uint256 value, uint256 updateTime) {                                                                                                                                                                                                        │
│         uint256 price;                                                                                                                                                                                                                                                                                                                          │
│         (price, updateTime) = _peek(base.b6(), quote.b6());                                                                                                                                                                                                                                                                                     │
│         value = price * amount / 1e18;                                                                                                                                                                                                                                                                                                          │
│     }                                                                                                                                                                                                                                                                                                                                           │
│     function _peek(bytes6 base, bytes6 kind) private view returns (uint price, uint updateTime) {                                                                                                                                                                                                                                               │
│         uint256 rawPrice;                                                                                                                                                                                                                                                                                                                       │
│         address source = sources;                                                                                                                                                                                                                                                                                                               │
│         require (source != address(0), "Source not found");                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│         if (kind == "rate") rawPrice = CTokenInterface(source).borrowIndex();                                                                                                                                                                                                                                                                   │
│         else if (kind == "chi") rawPrice = CTokenInterface(source).exchangeRateStored();                                                                                                                                                                                                                                                        │
│         else revert("Unknown oracle type");                                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│         require(rawPrice > 0, "Compound price is zero");                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                 │
│         price = rawPrice * SCALE_FACTOR;                                                                                                                                                                                                                                                                                                        │
│         updateTime = block.timestamp;                                                                                                                                                                                                                                                                                                           │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price based on the market reserves/AMMprice/exchangeRate OR the custom token balanceOf/totalSupply/amount/liquidity calculation                                                                                                                                          │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function get(bytes32 base, bytes32 quote, uint256 amount) public virtual override view returns (uint256 value, uint256 updateTime) {                                                                                                                                                                                                        │
│         uint256 price;                                                                                                                                                                                                                                                                                                                          │
│         (price, updateTime) = _peek(base.b6(), quote.b6());                                                                                                                                                                                                                                                                                     │
│         value = price * amount / 1e18;                                                                                                                                                                                                                                                                                                          │
│     }                                                                                                                                                                                                                                                                                                                                           │
│     function _peek(bytes6 base, bytes6 kind) private view returns (uint price, uint updateTime) {                                                                                                                                                                                                                                               │
│         uint256 rawPrice;                                                                                                                                                                                                                                                                                                                       │
│         address source = sources;                                                                                                                                                                                                                                                                                                               │
│         require (source != address(0), "Source not found");                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│         if (kind == "rate") rawPrice = CTokenInterface(source).borrowIndex();                                                                                                                                                                                                                                                                   │
│         else if (kind == "chi") rawPrice = CTokenInterface(source).exchangeRateStored();                                                                                                                                                                                                                                                        │
│         else revert("Unknown oracle type");                                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│         require(rawPrice > 0, "Compound price is zero");                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                 │
│         price = rawPrice * SCALE_FACTOR;                                                                                                                                                                                                                                                                                                        │
│         updateTime = block.timestamp;                                                                                                                                                                                                                                                                                                           │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function peek(bytes32 base, bytes32 kind, uint256 amount) public virtual override view returns (uint256 value, uint256 updateTime) {                                                                                                                                                                                                        │
│         uint256 price;                                                                                                                                                                                                                                                                                                                          │
│         (price, updateTime) = _peek(base.b6(), kind.b6());                                                                                                                                                                                                                                                                                      │
│         value = price * amount / 1e18;                                                                                                                                                                                                                                                                                                          │
│     }                                                                                                                                                                                                                                                                                                                                           │
│     function _peek(bytes6 base, bytes6 kind) private view returns (uint price, uint updateTime) {                                                                                                                                                                                                                                               │
│         uint256 rawPrice;                                                                                                                                                                                                                                                                                                                       │
│         address source = sources;                                                                                                                                                                                                                                                                                                               │
│         require (source != address(0), "Source not found");                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│         if (kind == "rate") rawPrice = CTokenInterface(source).borrowIndex();                                                                                                                                                                                                                                                                   │
│         else if (kind == "chi") rawPrice = CTokenInterface(source).exchangeRateStored();                                                                                                                                                                                                                                                        │
│         else revert("Unknown oracle type");                                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│         require(rawPrice > 0, "Compound price is zero");                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                 │
│         price = rawPrice * SCALE_FACTOR;                                                                                                                                                                                                                                                                                                        │
│         updateTime = block.timestamp;                                                                                                                                                                                                                                                                                                           │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price based on the market reserves/AMMprice/exchangeRate OR the custom token balanceOf/totalSupply/amount/liquidity calculation                                                                                                                                          │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function peek(bytes32 base, bytes32 kind, uint256 amount) public virtual override view returns (uint256 value, uint256 updateTime) {                                                                                                                                                                                                        │
│         uint256 price;                                                                                                                                                                                                                                                                                                                          │
│         (price, updateTime) = _peek(base.b6(), kind.b6());                                                                                                                                                                                                                                                                                      │
│         value = price * amount / 1e18;                                                                                                                                                                                                                                                                                                          │
│     }                                                                                                                                                                                                                                                                                                                                           │
│     function _peek(bytes6 base, bytes6 kind) private view returns (uint price, uint updateTime) {                                                                                                                                                                                                                                               │
│         uint256 rawPrice;                                                                                                                                                                                                                                                                                                                       │
│         address source = sources;                                                                                                                                                                                                                                                                                                               │
│         require (source != address(0), "Source not found");                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│         if (kind == "rate") rawPrice = CTokenInterface(source).borrowIndex();                                                                                                                                                                                                                                                                   │
│         else if (kind == "chi") rawPrice = CTokenInterface(source).exchangeRateStored();                                                                                                                                                                                                                                                        │
│         else revert("Unknown oracle type");                                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│         require(rawPrice > 0, "Compound price is zero");                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                 │
│         price = rawPrice * SCALE_FACTOR;                                                                                                                                                                                                                                                                                                        │
│         updateTime = block.timestamp;                                                                                                                                                                                                                                                                                                           │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function get(bytes32 base, bytes32 kind, uint256 amount) public virtual override view returns (uint256 value, uint256 updateTime) {                                                                                                                                                                                                         │
│         uint256 price;                                                                                                                                                                                                                                                                                                                          │
│         (price, updateTime) = _peek(base.b6(), kind.b6());                                                                                                                                                                                                                                                                                      │
│         value = price * amount / 1e18;                                                                                                                                                                                                                                                                                                          │
│     }                                                                                                                                                                                                                                                                                                                                           │
│     function _peek(bytes6 base, bytes6 kind) private view returns (uint price, uint updateTime) {                                                                                                                                                                                                                                               │
│         uint256 rawPrice;                                                                                                                                                                                                                                                                                                                       │
│         address source = sources;                                                                                                                                                                                                                                                                                                               │
│         require (source != address(0), "Source not found");                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│         if (kind == "rate") rawPrice = CTokenInterface(source).borrowIndex();                                                                                                                                                                                                                                                                   │
│         else if (kind == "chi") rawPrice = CTokenInterface(source).exchangeRateStored();                                                                                                                                                                                                                                                        │
│         else revert("Unknown oracle type");                                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│         require(rawPrice > 0, "Compound price is zero");                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                 │
│         price = rawPrice * SCALE_FACTOR;                                                                                                                                                                                                                                                                                                        │
│         updateTime = block.timestamp;                                                                                                                                                                                                                                                                                                           │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price based on the market reserves/AMMprice/exchangeRate OR the custom token balanceOf/totalSupply/amount/liquidity calculation                                                                                                                                          │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function get(bytes32 base, bytes32 kind, uint256 amount) public virtual override view returns (uint256 value, uint256 updateTime) {                                                                                                                                                                                                         │
│         uint256 price;                                                                                                                                                                                                                                                                                                                          │
│         (price, updateTime) = _peek(base.b6(), kind.b6());                                                                                                                                                                                                                                                                                      │
│         value = price * amount / 1e18;                                                                                                                                                                                                                                                                                                          │
│     }                                                                                                                                                                                                                                                                                                                                           │
│     function _peek(bytes6 base, bytes6 kind) private view returns (uint price, uint updateTime) {                                                                                                                                                                                                                                               │
│         uint256 rawPrice;                                                                                                                                                                                                                                                                                                                       │
│         address source = sources;                                                                                                                                                                                                                                                                                                               │
│         require (source != address(0), "Source not found");                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│         if (kind == "rate") rawPrice = CTokenInterface(source).borrowIndex();                                                                                                                                                                                                                                                                   │
│         else if (kind == "chi") rawPrice = CTokenInterface(source).exchangeRateStored();                                                                                                                                                                                                                                                        │
│         else revert("Unknown oracle type");                                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│         require(rawPrice > 0, "Compound price is zero");                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                 │
│         price = rawPrice * SCALE_FACTOR;                                                                                                                                                                                                                                                                                                        │
│         updateTime = block.timestamp;                                                                                                                                                                                                                                                                                                           │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function peek(bytes32 base, bytes32 quote, uint256 amount) public virtual override view returns (uint256 value, uint256 updateTime) {                                                                                                                                                                                                       │
│         uint256 price;                                                                                                                                                                                                                                                                                                                          │
│         (price, updateTime) = _peek(base.b6(), quote.b6());                                                                                                                                                                                                                                                                                     │
│         value = price * amount / 1e18;                                                                                                                                                                                                                                                                                                          │
│     }                                                                                                                                                                                                                                                                                                                                           │
│     function _peek(bytes6 base, bytes6 kind) private view returns (uint price, uint updateTime) {                                                                                                                                                                                                                                               │
│         uint256 rawPrice;                                                                                                                                                                                                                                                                                                                       │
│         address source = sources;                                                                                                                                                                                                                                                                                                               │
│         require (source != address(0), "Source not found");                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│         if (kind == "rate") rawPrice = CTokenInterface(source).borrowIndex();                                                                                                                                                                                                                                                                   │
│         else if (kind == "chi") rawPrice = CTokenInterface(source).exchangeRateStored();                                                                                                                                                                                                                                                        │
│         else revert("Unknown oracle type");                                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│         require(rawPrice > 0, "Compound price is zero");                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                 │
│         price = rawPrice * SCALE_FACTOR;                                                                                                                                                                                                                                                                                                        │
│         updateTime = block.timestamp;                                                                                                                                                                                                                                                                                                           │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "Yes"                                                                                                                                                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price based on the market reserves/AMMprice/exchangeRate OR the custom token balanceOf/totalSupply/amount/liquidity calculation                                                                                                                                          │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function peek(bytes32 base, bytes32 quote, uint256 amount) public virtual override view returns (uint256 value, uint256 updateTime) {                                                                                                                                                                                                       │
│         uint256 price;                                                                                                                                                                                                                                                                                                                          │
│         (price, updateTime) = _peek(base.b6(), quote.b6());                                                                                                                                                                                                                                                                                     │
│         value = price * amount / 1e18;                                                                                                                                                                                                                                                                                                          │
│     }                                                                                                                                                                                                                                                                                                                                           │
│     function _peek(bytes6 base, bytes6 kind) private view returns (uint price, uint updateTime) {                                                                                                                                                                                                                                               │
│         uint256 rawPrice;                                                                                                                                                                                                                                                                                                                       │
│         address source = sources;                                                                                                                                                                                                                                                                                                               │
│         require (source != address(0), "Source not found");                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│         if (kind == "rate") rawPrice = CTokenInterface(source).borrowIndex();                                                                                                                                                                                                                                                                   │
│         else if (kind == "chi") rawPrice = CTokenInterface(source).exchangeRateStored();                                                                                                                                                                                                                                                        │
│         else revert("Unknown oracle type");                                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│         require(rawPrice > 0, "Compound price is zero");                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                 │
│         price = rawPrice * SCALE_FACTOR;                                                                                                                                                                                                                                                                                                        │
│         updateTime = block.timestamp;                                                                                                                                                                                                                                                                                                           │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function withdraw(uint wad) public {                                                                                                                                                                                                                                                                                                        │
│         require(_balanceOf >= wad, "WETH9: Insufficient balance");                                                                                                                                                                                                                                                                              │
│         _balanceOf -= wad;                                                                                                                                                                                                                                                                                                                      │
│         payable(msg.sender).transfer(wad);                                                                                                                                                                                                                                                                                                      │
│         emit Withdrawal(msg.sender, wad);                                                                                                                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function onFlashLoan(address initiator, address token, uint256 amount, uint256 fee, bytes calldata data) external override returns(bytes32) {                                                                                                                                                                                               │
│         require(msg.sender == address(lender), "FlashBorrower: Untrusted lender");                                                                                                                                                                                                                                                              │
│         (Action action) = abi.decode(data, (Action)); // Use this to unpack arbitrary data                                                                                                                                                                                                                                                      │
│         flashInitiator = initiator;                                                                                                                                                                                                                                                                                                             │
│         flashToken = token;                                                                                                                                                                                                                                                                                                                     │
│         flashAmount = amount;                                                                                                                                                                                                                                                                                                                   │
│         flashFee = fee;                                                                                                                                                                                                                                                                                                                         │
│         if (action == Action.NORMAL) {                                                                                                                                                                                                                                                                                                          │
│             flashBalance = IERC20(token).balanceOf(address(this));                                                                                                                                                                                                                                                                              │
│         } else if (action == Action.TRANSFER) {                                                                                                                                                                                                                                                                                                 │
│             flashBalance = IERC20(token).balanceOf(address(this));                                                                                                                                                                                                                                                                              │
│             IERC20(token).transfer(address(lender), amount + fee);                                                                                                                                                                                                                                                                              │
│         } else if (action == Action.STEAL) {                                                                                                                                                                                                                                                                                                    │
│             IERC20(token).transfer(address(0), amount);                                                                                                                                                                                                                                                                                         │
│         } else if (action == Action.REENTER) {                                                                                                                                                                                                                                                                                                  │
│             flashBorrow(token, amount * 2, Action.NORMAL);                                                                                                                                                                                                                                                                                      │
│         }                                                                                                                                                                                                                                                                                                                                       │
│         return keccak256("ERC3156FlashBorrower.onFlashLoan");                                                                                                                                                                                                                                                                                   │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function _exitEther(address to)                                                                                                                                                                                                                                                                                                             │
│         private                                                                                                                                                                                                                                                                                                                                 │
│         returns (uint256 ethTransferred)                                                                                                                                                                                                                                                                                                        │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         ethTransferred = weth.balanceOf(address(this));                                                                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                                                                                 │
│         weth.withdraw(ethTransferred);   // TODO: Test gas savings using WETH10 `withdrawTo`                                                                                                                                                                                                                                                    │
│         payable(to).safeTransferETH(ethTransferred);                                                                                                                                                                                                                                                                                            │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function batch(                                                                                                                                                                                                                                                                                                                             │
│         Operation[] calldata operations,                                                                                                                                                                                                                                                                                                        │
│         bytes[] calldata data                                                                                                                                                                                                                                                                                                                   │
│     ) external payable {                                                                                                                                                                                                                                                                                                                        │
│         require(operations.length == data.length, "Mismatched operation data");                                                                                                                                                                                                                                                                 │
│         bytes12 cachedId;                                                                                                                                                                                                                                                                                                                       │
│         DataTypes.Vault memory vault;                                                                                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Execute all operations in the batch. Conditionals ordered by expected frequency.                                                                                                                                                                                                                                                     │
│         for (uint256 i = 0; i < operations.length; i += 1) {                                                                                                                                                                                                                                                                                    │
│                                                                                                                                                                                                                                                                                                                                                 │
│             Operation operation = operations;                                                                                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                                                                                                 │
│             if (operation == Operation.BUILD) {                                                                                                                                                                                                                                                                                                 │
│                 (bytes12 vaultId, bytes6 seriesId, bytes6 ilkId) = abi.decode(data, (bytes12, bytes6, bytes6));                                                                                                                                                                                                                                 │
│                 (cachedId, vault) = (vaultId, _build(vaultId, seriesId, ilkId));   // Cache the vault that was just built                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.FORWARD_PERMIT) {                                                                                                                                                                                                                                                                                 │
│                 (bytes6 id, bool isAsset, address spender, uint256 amount, uint256 deadline, uint8 v, bytes32 r, bytes32 s) =                                                                                                                                                                                                                   │
│                     abi.decode(data, (bytes6, bool, address, uint256, uint256, uint8, bytes32, bytes32));                                                                                                                                                                                                                                       │
│                 _forwardPermit(id, isAsset, spender, amount, deadline, v, r, s);                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.JOIN_ETHER) {                                                                                                                                                                                                                                                                                     │
│                 (bytes6 etherId) = abi.decode(data, (bytes6));                                                                                                                                                                                                                                                                                  │
│                 _joinEther(etherId);                                                                                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.POUR) {                                                                                                                                                                                                                                                                                           │
│                 (bytes12 vaultId, address to, int128 ink, int128 art) = abi.decode(data, (bytes12, address, int128, int128));                                                                                                                                                                                                                   │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _pour(vaultId, vault, to, ink, art);                                                                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.SERVE) {                                                                                                                                                                                                                                                                                          │
│                 (bytes12 vaultId, address to, uint128 ink, uint128 base, uint128 max) = abi.decode(data, (bytes12, address, uint128, uint128, uint128));                                                                                                                                                                                        │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _serve(vaultId, vault, to, ink, base, max);                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.ROLL) {                                                                                                                                                                                                                                                                                           │
│                 (bytes12 vaultId, bytes6 newSeriesId, uint8 loan, uint128 max) = abi.decode(data, (bytes12, bytes6, uint8, uint128));                                                                                                                                                                                                           │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 (vault,) = _roll(vaultId, vault, newSeriesId, loan, max);                                                                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.FORWARD_DAI_PERMIT) {                                                                                                                                                                                                                                                                             │
│                 (bytes6 id, bool isAsset, address spender, uint256 nonce, uint256 deadline, bool allowed, uint8 v, bytes32 r, bytes32 s) =                                                                                                                                                                                                      │
│                     abi.decode(data, (bytes6, bool, address, uint256, uint256, bool, uint8, bytes32, bytes32));                                                                                                                                                                                                                                 │
│                 _forwardDaiPermit(id, isAsset, spender, nonce, deadline, allowed, v, r, s);                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.TRANSFER_TO_POOL) {                                                                                                                                                                                                                                                                               │
│                 (bytes6 seriesId, bool base, uint128 wad) =                                                                                                                                                                                                                                                                                     │
│                     abi.decode(data, (bytes6, bool, uint128));                                                                                                                                                                                                                                                                                  │
│                 IPool pool = getPool(seriesId);                                                                                                                                                                                                                                                                                                 │
│                 _transferToPool(pool, base, wad);                                                                                                                                                                                                                                                                                               │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.ROUTE) {                                                                                                                                                                                                                                                                                          │
│                 (bytes6 seriesId, bytes memory poolCall) =                                                                                                                                                                                                                                                                                      │
│                     abi.decode(data, (bytes6, bytes));                                                                                                                                                                                                                                                                                          │
│                 IPool pool = getPool(seriesId);                                                                                                                                                                                                                                                                                                 │
│                 _route(pool, poolCall);                                                                                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.EXIT_ETHER) {                                                                                                                                                                                                                                                                                     │
│                 (address to) = abi.decode(data, (address));                                                                                                                                                                                                                                                                                     │
│                 _exitEther(payable(to));                                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.CLOSE) {                                                                                                                                                                                                                                                                                          │
│                 (bytes12 vaultId, address to, int128 ink, int128 art) = abi.decode(data, (bytes12, address, int128, int128));                                                                                                                                                                                                                   │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _close(vaultId, vault, to, ink, art);                                                                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.REPAY) {                                                                                                                                                                                                                                                                                          │
│                 (bytes12 vaultId, address to, int128 ink, uint128 min) = abi.decode(data, (bytes12, address, int128, uint128));                                                                                                                                                                                                                 │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _repay(vaultId, vault, to, ink, min);                                                                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.REPAY_VAULT) {                                                                                                                                                                                                                                                                                    │
│                 (bytes12 vaultId, address to, int128 ink, uint128 max) = abi.decode(data, (bytes12, address, int128, uint128));                                                                                                                                                                                                                 │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _repayVault(vaultId, vault, to, ink, max);                                                                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.REPAY_LADLE) {                                                                                                                                                                                                                                                                                    │
│                 (bytes12 vaultId) = abi.decode(data, (bytes12));                                                                                                                                                                                                                                                                                │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _repayLadle(vaultId, vault);                                                                                                                                                                                                                                                                                                    │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.RETRIEVE) {                                                                                                                                                                                                                                                                                       │
│                 (bytes6 assetId, bool isAsset, address to) = abi.decode(data, (bytes6, bool, address));                                                                                                                                                                                                                                         │
│                 _retrieve(assetId, isAsset, to);                                                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.TRANSFER_TO_FYTOKEN) {                                                                                                                                                                                                                                                                            │
│                 (bytes6 seriesId, uint256 amount) = abi.decode(data, (bytes6, uint256));                                                                                                                                                                                                                                                        │
│                 IFYToken fyToken = getSeries(seriesId).fyToken;                                                                                                                                                                                                                                                                                 │
│                 _transferToFYToken(fyToken, amount);                                                                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.REDEEM) {                                                                                                                                                                                                                                                                                         │
│                 (bytes6 seriesId, address to, uint256 amount) = abi.decode(data, (bytes6, address, uint256));                                                                                                                                                                                                                                   │
│                 IFYToken fyToken = getSeries(seriesId).fyToken;                                                                                                                                                                                                                                                                                 │
│                 _redeem(fyToken, to, amount);                                                                                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.STIR) {                                                                                                                                                                                                                                                                                           │
│                 (bytes12 from, bytes12 to, uint128 ink, uint128 art) = abi.decode(data, (bytes12, bytes12, uint128, uint128));                                                                                                                                                                                                                  │
│                 _stir(from, to, ink, art);  // Too complicated to use caching here                                                                                                                                                                                                                                                              │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.TWEAK) {                                                                                                                                                                                                                                                                                          │
│                 (bytes12 vaultId, bytes6 seriesId, bytes6 ilkId) = abi.decode(data, (bytes12, bytes6, bytes6));                                                                                                                                                                                                                                 │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 vault = _tweak(vaultId, seriesId, ilkId);                                                                                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.GIVE) {                                                                                                                                                                                                                                                                                           │
│                 (bytes12 vaultId, address to) = abi.decode(data, (bytes12, address));                                                                                                                                                                                                                                                           │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 vault = _give(vaultId, to);                                                                                                                                                                                                                                                                                                     │
│                 delete vault;   // Clear the cache, since the vault doesn't necessarily belong to msg.sender anymore                                                                                                                                                                                                                            │
│                 cachedId = bytes12(0);                                                                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.DESTROY) {                                                                                                                                                                                                                                                                                        │
│                 (bytes12 vaultId) = abi.decode(data, (bytes12));                                                                                                                                                                                                                                                                                │
│                 if (cachedId != vaultId) (cachedId, vault) = (vaultId, getOwnedVault(vaultId));                                                                                                                                                                                                                                                 │
│                 _destroy(vaultId);                                                                                                                                                                                                                                                                                                              │
│                 delete vault;   // Clear the cache                                                                                                                                                                                                                                                                                              │
│                 cachedId = bytes12(0);                                                                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == Operation.MODULE) {                                                                                                                                                                                                                                                                                         │
│                 (address module, bytes memory moduleCall) = abi.decode(data, (address, bytes));                                                                                                                                                                                                                                                 │
│                 _moduleCall(module, moduleCall);                                                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                 │
│             }                                                                                                                                                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                                                                                                                                                           │
│     function _exitEther(address to)                                                                                                                                                                                                                                                                                                             │
│         private                                                                                                                                                                                                                                                                                                                                 │
│         returns (uint256 ethTransferred)                                                                                                                                                                                                                                                                                                        │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         ethTransferred = weth.balanceOf(address(this));                                                                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                                                                                 │
│         weth.withdraw(ethTransferred);   // TODO: Test gas savings using WETH10 `withdrawTo`                                                                                                                                                                                                                                                    │
│         payable(to).safeTransferETH(ethTransferred);                                                                                                                                                                                                                                                                                            │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function batch(                                                                                                                                                                                                                                                                                                                             │
│         PoolDataTypes.Operation[] calldata operations,                                                                                                                                                                                                                                                                                          │
│         bytes[] calldata data                                                                                                                                                                                                                                                                                                                   │
│     ) external payable {                                                                                                                                                                                                                                                                                                                        │
│         require(operations.length == data.length, "Mismatched operation data");                                                                                                                                                                                                                                                                 │
│         PoolAddresses memory cache;                                                                                                                                                                                                                                                                                                             │
│                                                                                                                                                                                                                                                                                                                                                 │
│         for (uint256 i = 0; i < operations.length; i += 1) {                                                                                                                                                                                                                                                                                    │
│             PoolDataTypes.Operation operation = operations;                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                 │
│             if (operation == PoolDataTypes.Operation.ROUTE) {                                                                                                                                                                                                                                                                                   │
│                 (address base, address fyToken, bytes memory poolcall) = abi.decode(data, (address, address, bytes));                                                                                                                                                                                                                           │
│                 if (cache.base != base || cache.fyToken != fyToken) cache = PoolAddresses(base, fyToken, findPool(base, fyToken));                                                                                                                                                                                                              │
│                 _route(cache, poolcall);                                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == PoolDataTypes.Operation.TRANSFER_TO_POOL) {                                                                                                                                                                                                                                                                 │
│                 (address base, address fyToken, address token, uint128 wad) = abi.decode(data, (address, address, address, uint128));                                                                                                                                                                                                           │
│                 if (cache.base != base || cache.fyToken != fyToken) cache = PoolAddresses(base, fyToken, findPool(base, fyToken));                                                                                                                                                                                                              │
│                 _transferToPool(cache, token, wad);                                                                                                                                                                                                                                                                                             │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == PoolDataTypes.Operation.FORWARD_PERMIT) {                                                                                                                                                                                                                                                                   │
│                 (address base, address fyToken, address token, address spender, uint256 amount, uint256 deadline, uint8 v, bytes32 r, bytes32 s) =                                                                                                                                                                                              │
│                     abi.decode(data, (address, address, address, address, uint256, uint256, uint8, bytes32, bytes32));                                                                                                                                                                                                                          │
│                 if (cache.base != base || cache.fyToken != fyToken) cache = PoolAddresses(base, fyToken, findPool(base, fyToken));                                                                                                                                                                                                              │
│                 _forwardPermit(cache, token, spender, amount, deadline, v, r, s);                                                                                                                                                                                                                                                               │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == PoolDataTypes.Operation.FORWARD_DAI_PERMIT) {                                                                                                                                                                                                                                                               │
│                         (address base, address fyToken, address spender, uint256 nonce, uint256 deadline, bool allowed, uint8 v, bytes32 r, bytes32 s) =                                                                                                                                                                                        │
│                     abi.decode(data, (address, address, address, uint256, uint256, bool, uint8, bytes32, bytes32));                                                                                                                                                                                                                             │
│                 if (cache.base != base || cache.fyToken != fyToken) cache = PoolAddresses(base, fyToken, findPool(base, fyToken));                                                                                                                                                                                                              │
│                 _forwardDaiPermit(cache, spender, nonce, deadline, allowed, v, r, s);                                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == PoolDataTypes.Operation.JOIN_ETHER) {                                                                                                                                                                                                                                                                       │
│                 (address base, address fyToken) = abi.decode(data, (address, address));                                                                                                                                                                                                                                                         │
│                 if (cache.base != base || cache.fyToken != fyToken) cache = PoolAddresses(base, fyToken, findPool(base, fyToken));                                                                                                                                                                                                              │
│                 _joinEther(cache.pool);                                                                                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else if (operation == PoolDataTypes.Operation.EXIT_ETHER) {                                                                                                                                                                                                                                                                       │
│                 (address to) = abi.decode(data, (address));                                                                                                                                                                                                                                                                                     │
│                 _exitEther(to);                                                                                                                                                                                                                                                                                                                 │
│                                                                                                                                                                                                                                                                                                                                                 │
│             } else {                                                                                                                                                                                                                                                                                                                            │
│                 revert("Invalid operation");                                                                                                                                                                                                                                                                                                    │
│             }                                                                                                                                                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                                                                                                                                                           │
│     function _exitEther(address to)                                                                                                                                                                                                                                                                                                             │
│         private                                                                                                                                                                                                                                                                                                                                 │
│         returns (uint256 ethTransferred)                                                                                                                                                                                                                                                                                                        │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         ethTransferred = weth.balanceOf(address(this));                                                                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                                                                                 │
│         weth.withdraw(ethTransferred);   // TODO: Test gas savings using WETH10 `withdrawTo`                                                                                                                                                                                                                                                    │
│         payable(to).safeTransferETH(ethTransferred);                                                                                                                                                                                                                                                                                            │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                                                                                                                                                │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function _mintInternal(address to, bool calculateFromBase, uint256 fyTokenToBuy, uint256 minTokensMinted)                                                                                                                                                                                                                                   │
│         internal                                                                                                                                                                                                                                                                                                                                │
│         returns (uint256, uint256, uint256)                                                                                                                                                                                                                                                                                                     │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         // Gather data                                                                                                                                                                                                                                                                                                                          │
│         uint256 supply = _totalSupply;                                                                                                                                                                                                                                                                                                          │
│         (uint112 _baseCached, uint112 _fyTokenCached) =                                                                                                                                                                                                                                                                                         │
│             (baseCached, fyTokenCached);                                                                                                                                                                                                                                                                                                        │
│         uint256 _realFYTokenCached = _fyTokenCached - supply;    // The fyToken cache includes the virtual fyToken, equal to the supply                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Calculate trade                                                                                                                                                                                                                                                                                                                      │
│         uint256 tokensMinted;                                                                                                                                                                                                                                                                                                                   │
│         uint256 baseIn;                                                                                                                                                                                                                                                                                                                         │
│         uint256 baseReturned;                                                                                                                                                                                                                                                                                                                   │
│         uint256 fyTokenIn;                                                                                                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                                                                                                                                 │
│         if (supply == 0) {                                                                                                                                                                                                                                                                                                                      │
│             require (calculateFromBase && fyTokenToBuy == 0, "Pool: Initialize only from base");                                                                                                                                                                                                                                                │
│             baseIn = base.balanceOf(address(this)) - _baseCached;                                                                                                                                                                                                                                                                               │
│             tokensMinted = baseIn;   // If supply == 0 we are initializing the pool and tokensMinted == baseIn; fyTokenIn == 0                                                                                                                                                                                                                  │
│         } else {                                                                                                                                                                                                                                                                                                                                │
│             // There is an optional virtual trade before the mint                                                                                                                                                                                                                                                                               │
│             uint256 baseToSell;                                                                                                                                                                                                                                                                                                                 │
│             if (fyTokenToBuy > 0) {     // calculateFromBase == true and fyTokenToBuy > 0 can't happen in this implementation. To implement a virtual trade and calculateFromBase the trade would need to be a BaseToBuy parameter.                                                                                                             │
│                 baseToSell = _buyFYTokenPreview(                                                                                                                                                                                                                                                                                                │
│                     fyTokenToBuy.u128(),                                                                                                                                                                                                                                                                                                        │
│                     _baseCached,                                                                                                                                                                                                                                                                                                                │
│                     _fyTokenCached                                                                                                                                                                                                                                                                                                              │
│                 );                                                                                                                                                                                                                                                                                                                              │
│             }                                                                                                                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                                                                                                 │
│             if (calculateFromBase) {   // We use all the available base tokens, surplus is in fyTokens                                                                                                                                                                                                                                          │
│                 baseIn = base.balanceOf(address(this)) - _baseCached;                                                                                                                                                                                                                                                                           │
│                 tokensMinted = (supply * baseIn) / _baseCached;                                                                                                                                                                                                                                                                                 │
│                 fyTokenIn = (_realFYTokenCached * tokensMinted) / supply;                                                                                                                                                                                                                                                                       │
│                 require(_realFYTokenCached + fyTokenIn <= fyToken.balanceOf(address(this)), "Pool: Not enough fyToken in");                                                                                                                                                                                                                     │
│             } else {                   // We use all the available fyTokens, plus a virtual trade if it happened, surplus is in base tokens                                                                                                                                                                                                     │
│                 fyTokenIn = fyToken.balanceOf(address(this)) - _realFYTokenCached;                                                                                                                                                                                                                                                              │
│                 tokensMinted = (supply * (fyTokenToBuy + fyTokenIn)) / (_realFYTokenCached - fyTokenToBuy);                                                                                                                                                                                                                                     │
│                 baseIn = baseToSell + ((_baseCached + baseToSell) * tokensMinted) / supply;                                                                                                                                                                                                                                                     │
│                 uint256 _baseBalance = base.balanceOf(address(this));                                                                                                                                                                                                                                                                           │
│                 require(_baseBalance - _baseCached >= baseIn, "Pool: Not enough base token in");                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                 │
│                 // If we did a trade means we came in through `mintWithBase`, and want to return the base token surplus                                                                                                                                                                                                                         │
│                 if (fyTokenToBuy > 0) baseReturned = (_baseBalance - _baseCached) - baseIn;                                                                                                                                                                                                                                                     │
│             }                                                                                                                                                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Slippage                                                                                                                                                                                                                                                                                                                             │
│         require (tokensMinted >= minTokensMinted, "Pool: Not enough tokens minted");                                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Update TWAR                                                                                                                                                                                                                                                                                                                          │
│         _update(                                                                                                                                                                                                                                                                                                                                │
│             (_baseCached + baseIn).u128(),                                                                                                                                                                                                                                                                                                      │
│             (_fyTokenCached + fyTokenIn + tokensMinted).u128(), // Account for the "virtual" fyToken from the new minted LP tokens                                                                                                                                                                                                              │
│             _baseCached,                                                                                                                                                                                                                                                                                                                        │
│             _fyTokenCached                                                                                                                                                                                                                                                                                                                      │
│         );                                                                                                                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Execute mint                                                                                                                                                                                                                                                                                                                         │
│         _mint(to, tokensMinted);                                                                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Return any unused base if we did a trade, meaning slippage was involved.                                                                                                                                                                                                                                                             │
│         if (supply > 0 && fyTokenToBuy > 0) base.safeTransfer(to, baseReturned);                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                 │
│         emit Liquidity(maturity, msg.sender, to, -(baseIn.i256()), -(fyTokenIn.i256()), tokensMinted.i256());                                                                                                                                                                                                                                   │
│         return (baseIn, fyTokenIn, tokensMinted);                                                                                                                                                                                                                                                                                               │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                                                                                                                                                  │
│     "2": "Yes"                                                                                                                                                                                                                                                                                                                                  │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Single Choice Scenario ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: deposit/mint/add the liquidity pool/amount/share and set the total share to the number of first deposit when the supply/liquidity is 0                                                                                                                                                                                               │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function _mintInternal(address to, bool calculateFromBase, uint256 fyTokenToBuy, uint256 minTokensMinted)                                                                                                                                                                                                                                   │
│         internal                                                                                                                                                                                                                                                                                                                                │
│         returns (uint256, uint256, uint256)                                                                                                                                                                                                                                                                                                     │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         // Gather data                                                                                                                                                                                                                                                                                                                          │
│         uint256 supply = _totalSupply;                                                                                                                                                                                                                                                                                                          │
│         (uint112 _baseCached, uint112 _fyTokenCached) =                                                                                                                                                                                                                                                                                         │
│             (baseCached, fyTokenCached);                                                                                                                                                                                                                                                                                                        │
│         uint256 _realFYTokenCached = _fyTokenCached - supply;    // The fyToken cache includes the virtual fyToken, equal to the supply                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Calculate trade                                                                                                                                                                                                                                                                                                                      │
│         uint256 tokensMinted;                                                                                                                                                                                                                                                                                                                   │
│         uint256 baseIn;                                                                                                                                                                                                                                                                                                                         │
│         uint256 baseReturned;                                                                                                                                                                                                                                                                                                                   │
│         uint256 fyTokenIn;                                                                                                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                                                                                                                                 │
│         if (supply == 0) {                                                                                                                                                                                                                                                                                                                      │
│             require (calculateFromBase && fyTokenToBuy == 0, "Pool: Initialize only from base");                                                                                                                                                                                                                                                │
│             baseIn = base.balanceOf(address(this)) - _baseCached;                                                                                                                                                                                                                                                                               │
│             tokensMinted = baseIn;   // If supply == 0 we are initializing the pool and tokensMinted == baseIn; fyTokenIn == 0                                                                                                                                                                                                                  │
│         } else {                                                                                                                                                                                                                                                                                                                                │
│             // There is an optional virtual trade before the mint                                                                                                                                                                                                                                                                               │
│             uint256 baseToSell;                                                                                                                                                                                                                                                                                                                 │
│             if (fyTokenToBuy > 0) {     // calculateFromBase == true and fyTokenToBuy > 0 can't happen in this implementation. To implement a virtual trade and calculateFromBase the trade would need to be a BaseToBuy parameter.                                                                                                             │
│                 baseToSell = _buyFYTokenPreview(                                                                                                                                                                                                                                                                                                │
│                     fyTokenToBuy.u128(),                                                                                                                                                                                                                                                                                                        │
│                     _baseCached,                                                                                                                                                                                                                                                                                                                │
│                     _fyTokenCached                                                                                                                                                                                                                                                                                                              │
│                 );                                                                                                                                                                                                                                                                                                                              │
│             }                                                                                                                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                                                                                                 │
│             if (calculateFromBase) {   // We use all the available base tokens, surplus is in fyTokens                                                                                                                                                                                                                                          │
│                 baseIn = base.balanceOf(address(this)) - _baseCached;                                                                                                                                                                                                                                                                           │
│                 tokensMinted = (supply * baseIn) / _baseCached;                                                                                                                                                                                                                                                                                 │
│                 fyTokenIn = (_realFYTokenCached * tokensMinted) / supply;                                                                                                                                                                                                                                                                       │
│                 require(_realFYTokenCached + fyTokenIn <= fyToken.balanceOf(address(this)), "Pool: Not enough fyToken in");                                                                                                                                                                                                                     │
│             } else {                   // We use all the available fyTokens, plus a virtual trade if it happened, surplus is in base tokens                                                                                                                                                                                                     │
│                 fyTokenIn = fyToken.balanceOf(address(this)) - _realFYTokenCached;                                                                                                                                                                                                                                                              │
│                 tokensMinted = (supply * (fyTokenToBuy + fyTokenIn)) / (_realFYTokenCached - fyTokenToBuy);                                                                                                                                                                                                                                     │
│                 baseIn = baseToSell + ((_baseCached + baseToSell) * tokensMinted) / supply;                                                                                                                                                                                                                                                     │
│                 uint256 _baseBalance = base.balanceOf(address(this));                                                                                                                                                                                                                                                                           │
│                 require(_baseBalance - _baseCached >= baseIn, "Pool: Not enough base token in");                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                 │
│                 // If we did a trade means we came in through `mintWithBase`, and want to return the base token surplus                                                                                                                                                                                                                         │
│                 if (fyTokenToBuy > 0) baseReturned = (_baseBalance - _baseCached) - baseIn;                                                                                                                                                                                                                                                     │
│             }                                                                                                                                                                                                                                                                                                                                   │
│         }                                                                                                                                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Slippage                                                                                                                                                                                                                                                                                                                             │
│         require (tokensMinted >= minTokensMinted, "Pool: Not enough tokens minted");                                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Update TWAR                                                                                                                                                                                                                                                                                                                          │
│         _update(                                                                                                                                                                                                                                                                                                                                │
│             (_baseCached + baseIn).u128(),                                                                                                                                                                                                                                                                                                      │
│             (_fyTokenCached + fyTokenIn + tokensMinted).u128(), // Account for the "virtual" fyToken from the new minted LP tokens                                                                                                                                                                                                              │
│             _baseCached,                                                                                                                                                                                                                                                                                                                        │
│             _fyTokenCached                                                                                                                                                                                                                                                                                                                      │
│         );                                                                                                                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Execute mint                                                                                                                                                                                                                                                                                                                         │
│         _mint(to, tokensMinted);                                                                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Return any unused base if we did a trade, meaning slippage was involved.                                                                                                                                                                                                                                                             │
│         if (supply > 0 && fyTokenToBuy > 0) base.safeTransfer(to, baseReturned);                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                 │
│         emit Liquidity(maturity, msg.sender, to, -(baseIn.i256()), -(fyTokenIn.i256()), tokensMinted.i256());                                                                                                                                                                                                                                   │
│         return (baseIn, fyTokenIn, tokensMinted);                                                                                                                                                                                                                                                                                               │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Yes                                                                                                                                                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Multiple Choice Scenarios ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: have code statements that get or calculate LP token's value/price                                                                                                                                                                                                                                                                    │
│ deposit/mint/add the liquidity pool/amount/share                                                                                                                                                                                                                                                                                                │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function _burnInternal(address to, bool tradeToBase, uint256 minBaseOut, uint256 minFYTokenOut)                                                                                                                                                                                                                                             │
│         internal                                                                                                                                                                                                                                                                                                                                │
│         returns (uint256, uint256, uint256)                                                                                                                                                                                                                                                                                                     │
│     {                                                                                                                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                                                                                 │
│         uint256 tokensBurned = _balanceOf;                                                                                                                                                                                                                                                                                                      │
│         uint256 supply = _totalSupply;                                                                                                                                                                                                                                                                                                          │
│         uint256 fyTokenBalance = fyToken.balanceOf(address(this));          // use the real balance rather than the virtual one                                                                                                                                                                                                                 │
│         uint256 baseBalance = base.balanceOf(address(this));                                                                                                                                                                                                                                                                                    │
│         (uint112 _baseCached, uint112 _fyTokenCached) =                                                                                                                                                                                                                                                                                         │
│             (baseCached, fyTokenCached);                                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Calculate trade                                                                                                                                                                                                                                                                                                                      │
│         uint256 tokenOut = (tokensBurned * baseBalance) / supply;                                                                                                                                                                                                                                                                               │
│         uint256 fyTokenOut = (tokensBurned * fyTokenBalance) / supply;                                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                                                                                 │
│         if (tradeToBase) {                                                                                                                                                                                                                                                                                                                      │
│             (int128 _k, int128 _g2) = (k2, g2);                                                                                                                                                                                                                                                                                                 │
│             tokenOut += YieldMath.baseOutForFYTokenIn(                      // This is a virtual sell                                                                                                                                                                                                                                           │
│                 _baseCached - tokenOut.u128(),                              // Cache, minus virtual burn                                                                                                                                                                                                                                        │
│                 _fyTokenCached - fyTokenOut.u128(),                         // Cache, minus virtual burn                                                                                                                                                                                                                                        │
│                 fyTokenOut.u128(),                                          // Sell the virtual fyToken obtained                                                                                                                                                                                                                                │
│                 maturity - uint32(block.timestamp),                         // This can't be called after maturity                                                                                                                                                                                                                              │
│                 _k,                                                                                                                                                                                                                                                                                                                             │
│                 _g2                                                                                                                                                                                                                                                                                                                             │
│             );                                                                                                                                                                                                                                                                                                                                  │
│             fyTokenOut = 0;                                                                                                                                                                                                                                                                                                                     │
│         }                                                                                                                                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Slippage                                                                                                                                                                                                                                                                                                                             │
│         require (tokenOut >= minBaseOut, "Pool: Not enough base tokens obtained");                                                                                                                                                                                                                                                              │
│         require (fyTokenOut >= minFYTokenOut, "Pool: Not enough fyToken obtained");                                                                                                                                                                                                                                                             │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Update TWAR                                                                                                                                                                                                                                                                                                                          │
│         _update(                                                                                                                                                                                                                                                                                                                                │
│             (baseBalance - tokenOut).u128(),                                                                                                                                                                                                                                                                                                    │
│             (fyTokenBalance - fyTokenOut + supply - tokensBurned).u128(),                                                                                                                                                                                                                                                                       │
│             _baseCached,                                                                                                                                                                                                                                                                                                                        │
│             _fyTokenCached                                                                                                                                                                                                                                                                                                                      │
│         );                                                                                                                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                                                                                                                                 │
│         // Transfer assets                                                                                                                                                                                                                                                                                                                      │
│         _burn(address(this), tokensBurned);                                                                                                                                                                                                                                                                                                     │
│         base.safeTransfer(to, tokenOut);                                                                                                                                                                                                                                                                                                        │
│         if (fyTokenOut > 0) IERC20(address(fyToken)).safeTransfer(to, fyTokenOut);                                                                                                                                                                                                                                                              │
│                                                                                                                                                                                                                                                                                                                                                 │
│         emit Liquidity(maturity, msg.sender, to, tokenOut.i256(), fyTokenOut.i256(), -(tokensBurned.i256()));                                                                                                                                                                                                                                   │
│         return (tokensBurned, tokenOut, 0);                                                                                                                                                                                                                                                                                                     │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "1": "No",                                                                                                                                                                                                                                                                                                                                  │
│     "2": "No"                                                                                                                                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to update/accrue interest/exchange rate? Answer only ZERO or ONE statement, cover the code with backquotes.                                                                                                                                                    │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function _accrual(bytes6 seriesId, DataTypes.Series memory series_)                                                                                                                                                                                                                                                                         │
│         private                                                                                                                                                                                                                                                                                                                                 │
│         returns (uint256 accrual_)                                                                                                                                                                                                                                                                                                              │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         uint256 rateAtMaturity = ratesAtMaturity;                                                                                                                                                                                                                                                                                               │
│         if (rateAtMaturity == 0) {  // After maturity, but rate not yet recorded. Let's record it, and accrual is then 1.                                                                                                                                                                                                                       │
│             _mature(seriesId, series_);                                                                                                                                                                                                                                                                                                         │
│         } else {                                                                                                                                                                                                                                                                                                                                │
│             IOracle rateOracle = rateOracles;                                                                                                                                                                                                                                                                                                   │
│             (uint256 rate,) = rateOracle.get(series_.baseId, bytes32("rate"), 1e18);                                                                                                                                                                                                                                                            │
│             accrual_ = rate.wdiv(rateAtMaturity);                                                                                                                                                                                                                                                                                               │
│         }                                                                                                                                                                                                                                                                                                                                       │
│         accrual_ = accrual_ >= 1e18 ? accrual_ : 1e18;     // The accrual can't be below 1 (with 18 decimals)                                                                                                                                                                                                                                   │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ `_mature(seriesId, series_);`                                                                                                                                                                                                                                                                                                                   │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Current Step ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Knowledge: In the given code, which inside code statement is the first statement to calculate/assign/distribute the balance/share/stake/fee/loan/reward? Answer only ZERO or ONE statement, cover the code with backquotes.                                                                                                                     │
│ Code:                                                                                                                                                                                                                                                                                                                                           │
│     function _accrual(bytes6 seriesId, DataTypes.Series memory series_)                                                                                                                                                                                                                                                                         │
│         private                                                                                                                                                                                                                                                                                                                                 │
│         returns (uint256 accrual_)                                                                                                                                                                                                                                                                                                              │
│     {                                                                                                                                                                                                                                                                                                                                           │
│         uint256 rateAtMaturity = ratesAtMaturity;                                                                                                                                                                                                                                                                                               │
│         if (rateAtMaturity == 0) {  // After maturity, but rate not yet recorded. Let's record it, and accrual is then 1.                                                                                                                                                                                                                       │
│             _mature(seriesId, series_);                                                                                                                                                                                                                                                                                                         │
│         } else {                                                                                                                                                                                                                                                                                                                                │
│             IOracle rateOracle = rateOracles;                                                                                                                                                                                                                                                                                                   │
│             (uint256 rate,) = rateOracle.get(series_.baseId, bytes32("rate"), 1e18);                                                                                                                                                                                                                                                            │
│             accrual_ = rate.wdiv(rateAtMaturity);                                                                                                                                                                                                                                                                                               │
│         }                                                                                                                                                                                                                                                                                                                                       │
│         accrual_ = accrual_ >= 1e18 ? accrual_ : 1e18;     // The accrual can't be below 1 (with 18 decimals)                                                                                                                                                                                                                                   │
│     }                                                                                                                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ `accrual_ = rate.wdiv(rateAtMaturity);`                                                                                                                                                                                                                                                                                                         │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
               order_first_b                
┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Argument ┃ Value                         ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ arg[0]   │ []                            │
│ arg[1]   │ [_mature(seriesId, series_);] │
└──────────┴───────────────────────────────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                                                                                                                                                              │
│         "rawPrice": "Holds the market reserves/AMM price/exchange rate or the custom token balanceOf/totalSupply/amount/liquidity calculation"                                                                                                                                                                                                  │
│     },                                                                                                                                                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                                                                                                                                                              │
│         "price": "Holds the calculated value/price of LP token"                                                                                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
 find_data_dependency  
┏━━━━━━━━━━┳━━━━━━━━━━┓
┃ Argument ┃ Value    ┃
┡━━━━━━━━━━╇━━━━━━━━━━┩
│ arg[0]   │ rawPrice │
│ arg[1]   │ price    │
└──────────┴──────────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                                                                                                                                                              │
│         "price": "Holds the market price retrieved from _peek function"                                                                                                                                                                                                                                                                         │
│     },                                                                                                                                                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                                                                                                                                                              │
│         "value": "Holds the calculated value/price of LP token"                                                                                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
find_data_dependency
┏━━━━━━━━━━┳━━━━━━━┓
┃ Argument ┃ Value ┃
┡━━━━━━━━━━╇━━━━━━━┩
│ arg[0]   │ price │
│ arg[1]   │ value │
└──────────┴───────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                                                                                                                                                              │
│         "price": "Holds the market price of the base token"                                                                                                                                                                                                                                                                                     │
│     },                                                                                                                                                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                                                                                                                                                              │
│         "value": "Holds the calculated value of LP token"                                                                                                                                                                                                                                                                                       │
│     }                                                                                                                                                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
find_data_dependency
┏━━━━━━━━━━┳━━━━━━━┓
┃ Argument ┃ Value ┃
┡━━━━━━━━━━╇━━━━━━━┩
│ arg[0]   │ price │
│ arg[1]   │ value │
└──────────┴───────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                                                                                                                                                              │
│         "price": "Holds the market price of the base token in terms of the quote token"                                                                                                                                                                                                                                                         │
│     },                                                                                                                                                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                                                                                                                                                              │
│         "value": "Holds the calculated value of the LP token based on the input amount"                                                                                                                                                                                                                                                         │
│     }                                                                                                                                                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
find_data_dependency
┏━━━━━━━━━━┳━━━━━━━┓
┃ Argument ┃ Value ┃
┡━━━━━━━━━━╇━━━━━━━┩
│ arg[0]   │ price │
│ arg[1]   │ value │
└──────────┴───────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                                                                                                                                                              │
│         "price": "Holds the market price of the base/quote pair"                                                                                                                                                                                                                                                                                │
│     },                                                                                                                                                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                                                                                                                                                              │
│         "value": "Holds the calculated value/price of LP token"                                                                                                                                                                                                                                                                                 │
│     }                                                                                                                                                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
find_data_dependency
┏━━━━━━━━━━┳━━━━━━━┓
┃ Argument ┃ Value ┃
┡━━━━━━━━━━╇━━━━━━━┩
│ arg[0]   │ price │
│ arg[1]   │ value │
└──────────┴───────┘
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Response ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ {                                                                                                                                                                                                                                                                                                                                               │
│     "VariableA": {                                                                                                                                                                                                                                                                                                                              │
│         "tokensMinted": "Holds the value of total minted tokens"                                                                                                                                                                                                                                                                                │
│     },                                                                                                                                                                                                                                                                                                                                          │
│     "VariableB": {                                                                                                                                                                                                                                                                                                                              │
│         "supply": "Holds the total supply/liquidity and is used to determine if the supply/liquidity is 0"                                                                                                                                                                                                                                      │
│     },                                                                                                                                                                                                                                                                                                                                          │
│     "VariableC": {                                                                                                                                                                                                                                                                                                                              │
│         "baseIn": "Holds the value of the deposit/mint/add amount"                                                                                                                                                                                                                                                                              │
│     }                                                                                                                                                                                                                                                                                                                                           │
│ }                                                                                                                                                                                                                                                                                                                                               │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
[12/07/24 01:24:30] INFO     static_check: first_deposit_check: VariableA: tokensMinted; VariableB: supply; VariableC: baseIn                                                                                                                                                                                                   static_check.py:128
    first_deposit_check    
┏━━━━━━━━━━┳━━━━━━━━━━━━━━┓
┃ Argument ┃ Value        ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━━━┩
│ arg[0]   │ supply       │
│ arg[1]   │ baseIn       │
│ arg[2]   │ tokensMinted │
└──────────┴──────────────┘
                    ERROR    falcon_adapter: Traceback (most recent call last):                                                                                                                                                                                                                                               falcon_adapter.py:146
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/falcon_adapter.py", line 139, in first_deposit_check                                                                                                                                                                                                     
                                 left_part = text[:text.index("=")].strip()                                                                                                                                                                                                                                                                        
                             ValueError: substring not found                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                   
                    ERROR    falcon_adapter: Traceback (most recent call last):                                                                                                                                                                                                                                               falcon_adapter.py:146
                               File "/home/owen/Documents/GitHub/GPTScan-Bigger-Model/src/falcon_adapter.py", line 139, in first_deposit_check                                                                                                                                                                                                     
                                 left_part = text[:text.index("=")].strip()                                                                                                                                                                                                                                                                        
                             ValueError: substring not found                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                   Scan Results                                                                                                                                                                    
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Type                                ┃ Description                                                                      ┃ Affected Files                                                                                                                                                                                                         ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ Insecure LP Token Value Calculation │ Liquidity token value/price can be manipulated to cause flashloan attacks.       │ ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ │
│                                     │                                                                                  │ ┃ File Path                                                                                         ┃ Line Range ┃ Code                                                                                              ┃ │
│                                     │                                                                                  │ ┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩ │
│                                     │                                                                                  │ │ /home/owen/Documents/GitHub/GPTScan-Bigger-Model/eval_data/2021-05-yield-main/contracts/oracles/… │ 40 - 53    │     function _peek(bytes6 base, bytes6 kind) private view returns (uint price, uint updateTime) { │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         uint256 rawPrice;                                                                         │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         address source = sources;                                                                 │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         require (source != address(0), "Source not found");                                       │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         if (kind == "rate") rawPrice = CTokenInterface(source).borrowIndex();                     │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         else if (kind == "chi") rawPrice = CTokenInterface(source).exchangeRateStored();          │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         else revert("Unknown oracle type");                                                       │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         require(rawPrice > 0, "Compound price is zero");                                          │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         price = rawPrice * SCALE_FACTOR;                                                          │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         updateTime = block.timestamp;                                                             │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │     }                                                                                             │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │ /home/owen/Documents/GitHub/GPTScan-Bigger-Model/eval_data/2021-05-yield-main/contracts/oracles/… │ 95 - 99    │     function get(bytes32 base, bytes32 quote, uint256 amount) public virtual override view        │ │
│                                     │                                                                                  │ │                                                                                                   │            │ returns (uint256 value, uint256 updateTime) {                                                     │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         uint256 price;                                                                            │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         (price, updateTime) = _peek(base.b6(), quote.b6());                                       │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         value = price * amount / 1e18;                                                            │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │     }                                                                                             │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ └───────────────────────────────────────────────────────────────────────────────────────────────────┴────────────┴───────────────────────────────────────────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ Unsafe First Deposit                │ First depositor can break minting of shares or drain the liquidity of all users. │ ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ │
│                                     │                                                                                  │ ┃ File Path                                                                                         ┃ Line Range ┃ Code                                                                                              ┃ │
│                                     │                                                                                  │ ┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩ │
│                                     │                                                                                  │ │ /home/owen/Documents/GitHub/GPTScan-Bigger-Model/eval_data/2021-05-yield-main/contracts/yieldspa… │ 231 - 298  │     function _mintInternal(address to, bool calculateFromBase, uint256 fyTokenToBuy, uint256      │ │
│                                     │                                                                                  │ │                                                                                                   │            │ minTokensMinted)                                                                                  │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         internal                                                                                  │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         returns (uint256, uint256, uint256)                                                       │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │     {                                                                                             │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         // Gather data                                                                            │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         uint256 supply = _totalSupply;                                                            │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         (uint112 _baseCached, uint112 _fyTokenCached) =                                           │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │             (baseCached, fyTokenCached);                                                          │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         uint256 _realFYTokenCached = _fyTokenCached - supply;    // The fyToken cache includes    │ │
│                                     │                                                                                  │ │                                                                                                   │            │ the virtual fyToken, equal to the supply                                                          │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         // Calculate trade                                                                        │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         uint256 tokensMinted;                                                                     │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         uint256 baseIn;                                                                           │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         uint256 baseReturned;                                                                     │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         uint256 fyTokenIn;                                                                        │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         if (supply == 0) {                                                                        │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │             require (calculateFromBase && fyTokenToBuy == 0, "Pool: Initialize only from base");  │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │             baseIn = base.balanceOf(address(this)) - _baseCached;                                 │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │             tokensMinted = baseIn;   // If supply == 0 we are initializing the pool and           │ │
│                                     │                                                                                  │ │                                                                                                   │            │ tokensMinted == baseIn; fyTokenIn == 0                                                            │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         } else {                                                                                  │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │             // There is an optional virtual trade before the mint                                 │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │             uint256 baseToSell;                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │             if (fyTokenToBuy > 0) {     // calculateFromBase == true and fyTokenToBuy > 0 can't   │ │
│                                     │                                                                                  │ │                                                                                                   │            │ happen in this implementation. To implement a virtual trade and calculateFromBase the trade would │ │
│                                     │                                                                                  │ │                                                                                                   │            │ need to be a BaseToBuy parameter.                                                                 │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                 baseToSell = _buyFYTokenPreview(                                                  │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                     fyTokenToBuy.u128(),                                                          │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                     _baseCached,                                                                  │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                     _fyTokenCached                                                                │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                 );                                                                                │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │             }                                                                                     │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │             if (calculateFromBase) {   // We use all the available base tokens, surplus is in     │ │
│                                     │                                                                                  │ │                                                                                                   │            │ fyTokens                                                                                          │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                 baseIn = base.balanceOf(address(this)) - _baseCached;                             │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                 tokensMinted = (supply * baseIn) / _baseCached;                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                 fyTokenIn = (_realFYTokenCached * tokensMinted) / supply;                         │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                 require(_realFYTokenCached + fyTokenIn <= fyToken.balanceOf(address(this)),       │ │
│                                     │                                                                                  │ │                                                                                                   │            │ "Pool: Not enough fyToken in");                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │             } else {                   // We use all the available fyTokens, plus a virtual trade │ │
│                                     │                                                                                  │ │                                                                                                   │            │ if it happened, surplus is in base tokens                                                         │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                 fyTokenIn = fyToken.balanceOf(address(this)) - _realFYTokenCached;                │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                 tokensMinted = (supply * (fyTokenToBuy + fyTokenIn)) / (_realFYTokenCached -      │ │
│                                     │                                                                                  │ │                                                                                                   │            │ fyTokenToBuy);                                                                                    │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                 baseIn = baseToSell + ((_baseCached + baseToSell) * tokensMinted) / supply;       │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                 uint256 _baseBalance = base.balanceOf(address(this));                             │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                 require(_baseBalance - _baseCached >= baseIn, "Pool: Not enough base token in");  │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                 // If we did a trade means we came in through `mintWithBase`, and want to return  │ │
│                                     │                                                                                  │ │                                                                                                   │            │ the base token surplus                                                                            │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                 if (fyTokenToBuy > 0) baseReturned = (_baseBalance - _baseCached) - baseIn;       │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │             }                                                                                     │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         }                                                                                         │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         // Slippage                                                                               │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         require (tokensMinted >= minTokensMinted, "Pool: Not enough tokens minted");              │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         // Update TWAR                                                                            │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         _update(                                                                                  │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │             (_baseCached + baseIn).u128(),                                                        │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │             (_fyTokenCached + fyTokenIn + tokensMinted).u128(), // Account for the "virtual"      │ │
│                                     │                                                                                  │ │                                                                                                   │            │ fyToken from the new minted LP tokens                                                             │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │             _baseCached,                                                                          │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │             _fyTokenCached                                                                        │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         );                                                                                        │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         // Execute mint                                                                           │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         _mint(to, tokensMinted);                                                                  │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         // Return any unused base if we did a trade, meaning slippage was involved.               │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         if (supply > 0 && fyTokenToBuy > 0) base.safeTransfer(to, baseReturned);                  │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         emit Liquidity(maturity, msg.sender, to, -(baseIn.i256()), -(fyTokenIn.i256()),           │ │
│                                     │                                                                                  │ │                                                                                                   │            │ tokensMinted.i256());                                                                             │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │         return (baseIn, fyTokenIn, tokensMinted);                                                 │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ │                                                                                                   │            │     }                                                                                             │ │
│                                     │                                                                                  │ │                                                                                                   │            │                                                                                                   │ │
│                                     │                                                                                  │ └───────────────────────────────────────────────────────────────────────────────────────────────────┴────────────┴───────────────────────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────┴──────────────────────────────────────────────────────────────────────────────────┴────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                  Summary                   
┏━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓
┃ Key                  ┃ Value             ┃
┡━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩
│ Files                │ 56                │
│ Contracts            │ 62                │
│ Functions            │ 123               │
│ Lines of Code        │ 5431              │
│ Used Time            │ 38.15444827079773 │
│ Estimated Cost (USD) │ 0.0371405         │
└──────────────────────┴───────────────────┘
